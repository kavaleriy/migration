<% content_for :sub_menu do %>
    <div class="search-heading">
      <div class="col-md-4 active">
        <i class="fa fa-map-marker"></i> <%= t('home.menu.search_map') %>
      </div>
      <div class="col-md-4">
        <a class="" href="<%= root_path %>"><i class="fa fa-home"></i> <%= t('home.menu.search') %></a>
      </div>
    </div>
<% end %>

<div class="search-container row">

  <div id="mapdiv" class="row" style=" height:600px;">
    <div class="spinner"></div>
  </div>
</div>
<!--<%= javascript_include_tag 'http://openlayers.org/api/OpenLayers.js' %>-->

<script type="text/javascript">
    $(document).ready(function () {
        $('#mapdiv').html('');

        window.geo = {}
        window.map = {}
        window.epsg4326 = {}
        window.projectTo = {};


        StartInitMap("mapdiv");
        /* Инициализация объекта карты */
        SetGeoPositionStandart();
        /* Установка стандартов координат */


        window.LayerOblast = new OpenLayers.Layer.Vector("Overlay");
        /* Слой маркеров для областей */
//                window.LayerRayon = new OpenLayers.Layer.Vector("Overlay");
        /* Слой маркеров для районов */
//                window.LayerCity = new OpenLayers.Layer.Vector("Overlay");
        /* Слой маркеров для городов */

        SetMapCenterZoom(3530470.0647431, 6243369.337484, 6);
        /* Карта Украины по центру в масштабе */


        /* Контроллер для показа маркеров областей */
        window.controls = {
            selector: new OpenLayers.Control.SelectFeature(LayerOblast, {onSelect: createPopup, onUnselect: destroyPopup})
        };
        map.addControl(controls['selector']);
        controls['selector'].activate();

        map.events.register("zoomend", map, function (e) {
            EventAfterZoom(e.object.zoom);
        });


        /* Отслеживание зумирования карты */

        /* Отслеживание после перемещения карты */
        map.events.register("moveend", map, function (e) {
            Wcenter = e.object.center;
            lat = Wcenter.lat;
            lon = Wcenter.lon;
            LimitTop = 6863120.762734;
            LimitBottom = 5504681.8962389;
            LimitLeft = 2440783.7896614;
            LimitRight = 4601811.453039;
            if (lon < LimitLeft || lon > LimitRight || lat > LimitTop || lat < LimitBottom) {
                SetMapCenterZoom(3530470.0647431, 6243369.337484, 6);
            }
        });

        $.get("<%= api_get_koatuu_geo_path %>", function( data ) {
            window.arrayGEO = data
            /* Создание маркеров области */
            CreateMarkerForArea();
            /* Слои области на карту */
            map.addLayer(LayerOblast);
        }, 'json');

    })

</script>
