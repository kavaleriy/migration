<div class="menu row">
  <ul class="home-view nav nav-tabs col-sm-12">
    <li class="active col-sm-6"><a href="#"><i class="fa fa-home"></i> <%= t('home.menu.search') %></a></li>
    <li class="col-sm-6"><a href="<%=  %>"><i class="fa fa-map-marker"></i> <%= t('home.menu.search_map') %></a></li>
  </ul>
</div>

<div class="search">
  <%= form_tag(home_search_path, method: "get", remote: true, class: 'form-horizontal' ) do %>
    <div class="row">
        <div class"col-sm-11">
            <div class="col-sm-5">
              <%= text_field_tag 'home_search_area', nil, { 'data-placeholder' => t('home.search.area_placeholder'), :class => 'form-control input-lg' } %>
            </div>
            <div class="col-sm-5">
              <%= text_field_tag 'home_search_region', nil, { 'data-placeholder' => t('home.search.region_placeholder'), :class => 'form-control input-lg' } %>
            </div>

            <div class="col-sm-3">
              <div class="checkbox pull-right">
                <label><input type="checkbox"><%= t('home.search.school') %></label>
              </div>
            </div>
            <div class="col-sm-3">
              <div class="checkbox pull-right">
                <label><input type="checkbox"><%= t('home.search.kgarten') %></label>
              </div>
            </div>
            <div class="col-sm-3">
              <div class="checkbox pull-right">
                <label><input type="checkbox"><%= t('home.search.job') %></label>
              </div>
            </div>
        </div>
        <!--<div class="clearfix"></div>-->
        <div class="col-sm-1 pull-right">
          <button class="btn btn-primary" type="submit"><i class="fa fa-search"></i></button>
        </div>
      </div>
  <% end %>


  <div id="results"></div>

  </div>



<div class="map">
  <div id="map1"></div>
</div>

<script id="script_home_search_area" type="text/javascript">
    $(document).ready(function() {
        $("#home_search_area").on("change", function(e) {
            $("#home_search_region").select2("val", "");
        }).select2({
            closeOnSelect:false,
            ajax: {
                url: "/api/get_areas",
                dataType: 'json',
                data: function (term, page) {
                    return {
                        q: term, // search term
                        page_limit: 10,
                    };
                },
                results: function (data, page) { // parse the results into the format expected by Select2.
                    // since we are using custom formatting functions we do not need to alter remote JSON data
                    return {results: data, text: "name" };
                }
            },
            formatSelection: function(item) {
                return item.name
            },
            formatResult: function(item) {
                return item.name
            }
        });
    });
</script>

<script id="script_home_search_region" type="text/javascript">
    $(document).ready(function() {
        $("#home_search_region").select2({
            closeOnSelect:false,
            ajax: {
                url: "/api/get_regions",
                dataType: 'json',
                data: function (term, page) {
                    return {
                        area: $("#home_search_area").select2("val"), // search term
                        q: term, // search term
                        page_limit: 10,
                    };
                },
                results: function (data, page) { // parse the results into the format expected by Select2.
                    // since we are using custom formatting functions we do not need to alter remote JSON data
                    return {results: data, text: "name" };
                }
            },
            formatSelection: function(item) {
                return item.name
            },
            formatResult: function(item) {
                return item.name
            }
        });
    });
</script>


<script type="text/javascript">
    $(document).ready(function() {
        $(function() {
            // Define variables for OpenLayers
            var center_lat  = '49.234734';      // Sacramento CA latitude
            var center_lon  = '28.4696339';    // Sacramento CA longitude
            var zoom        = 10;
            var mapnik      = new OpenLayers.Layer.OSM();                // OpenStreetMap Layer
            projection_wgs  = new OpenLayers.Projection("EPSG:4326");    // WGS 1984
            projection_smp  = new OpenLayers.Projection("EPSG:900913");  // Spherical Mercator
            position        = new OpenLayers.LonLat(center_lon, center_lat).transform(projection_wgs, projection_smp);

            // Create the map
            map = new OpenLayers.Map('map');    // Argument is the name of the containing div.
            map.addLayer(mapnik);
            map.setCenter(position, zoom);      // Set center of map


            ol.map = map
            ol.LayerOblast= new OpenLayers.Layer.Vector("Overlay")
            ol.LayerRayon = new OpenLayers.Layer.Vector("Overlay")
            ol.LayerRayon = new OpenLayers.Layer.Vector("Overlay")
            ol.projectTo = map.getProjectionObject()


            // Fix map size on dom ready
            ol.stretch_canvas();

            ol.CreateMarkerOblast(49.234734, 28.4696339, 'Житомирська', 120, 20);
        });

        // == Window.resize events ===================================================
        $(window).resize(function() {
            // Fix map size on resize
            ol.stretch_canvas();
        });
    });
</script>
