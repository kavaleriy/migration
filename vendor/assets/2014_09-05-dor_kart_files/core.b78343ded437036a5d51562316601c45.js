/*
 MIT
 @this: {jQuery}
 @return: {jQuery}
 @date: Fri Aug 05 14:02:00 2011
	MIT
	MIT


 @settings
   $.special.scrollend.delay = 300; // default ms

 @flags
   $.isScrolled; // boolean

 @binding
   $(window).bind('scrollstart scrollend', function (evt){
    if( evt.type == 'scrollstart' ){
     // logic
    }
   });

	MIT
*/
window.define=window.define||function(name,deps,callback){(callback||deps||name)()};
(function(a,b){function cg(a){return d.isWindow(a)?a:a.nodeType===9?a.defaultView||a.parentWindow:!1}function cd(a){if(!bZ[a]){var b=d("<"+a+">").appendTo("body"),c=b.css("display");b.remove();if(c==="none"||c==="")c="block";bZ[a]=c}return bZ[a]}function cc(a,b){var c={};d.each(cb.concat.apply([],cb.slice(0,b)),function(){c[this]=a});return c}function bY(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function bX(){try{return new a.XMLHttpRequest}catch(b){}}function bW(){d(a).unload(function(){for(var a in bU)bU[a](0,
1)})}function bQ(a,c){a.dataFilter&&(c=a.dataFilter(c,a.dataType));var e=a.dataTypes,f={},g,h,i=e.length,j,k=e[0],l,m,n,o,p;for(g=1;g<i;g++){if(g===1)for(h in a.converters)typeof h==="string"&&(f[h.toLowerCase()]=a.converters[h]);l=k,k=e[g];if(k==="*")k=l;else if(l!=="*"&&l!==k){m=l+" "+k,n=f[m]||f["* "+k];if(!n){p=b;for(o in f){j=o.split(" ");if(j[0]===l||j[0]==="*"){p=f[j[1]+" "+k];if(p){o=f[o],o===!0?n=p:p===!0&&(n=o);break}}}}!n&&!p&&d.error("No conversion from "+m.replace(" "," to ")),n!==!0&&
(c=n?n(c):p(o(c)))}}return c}function bP(a,c,d){var e=a.contents,f=a.dataTypes,g=a.responseFields,h,i,j,k;for(i in g)i in d&&(c[g[i]]=d[i]);while(f[0]==="*")f.shift(),h===b&&(h=a.mimeType||c.getResponseHeader("content-type"));if(h)for(i in e)if(e[i]&&e[i].test(h)){f.unshift(i);break}if(f[0]in d)j=f[0];else{for(i in d){if(!f[0]||a.converters[i+" "+f[0]]){j=i;break}k||(k=i)}j=j||k}if(j){j!==f[0]&&f.unshift(j);return d[j]}}function bO(a,b,c,e){if(d.isArray(b)&&b.length)d.each(b,function(b,f){c||bq.test(a)?
e(a,f):bO(a+"["+(typeof f==="object"||d.isArray(f)?b:"")+"]",f,c,e)});else if(c||b==null||typeof b!=="object")e(a,b);else if(d.isArray(b)||d.isEmptyObject(b))e(a,"");else for(var f in b)bO(a+"["+f+"]",b[f],c,e)}function bN(a,c,d,e,f,g){f=f||c.dataTypes[0],g=g||{},g[f]=!0;var h=a[f],i=0,j=h?h.length:0,k=a===bH,l;for(;i<j&&(k||!l);i++)l=h[i](c,d,e),typeof l==="string"&&(!k||g[l]?l=b:(c.dataTypes.unshift(l),l=bN(a,c,d,e,l,g)));(k||!l)&&!g["*"]&&(l=bN(a,c,d,e,"*",g));return l}function bM(a){return function(b,
c){typeof b!=="string"&&(c=b,b="*");if(d.isFunction(c)){var e=b.toLowerCase().split(bB),f=0,g=e.length,h,i,j;for(;f<g;f++)h=e[f],j=/^\+/.test(h),j&&(h=h.substr(1)||"*"),i=a[h]=a[h]||[],i[j?"unshift":"push"](c)}}}function bo(a,b,c){var e=b==="width"?bi:bj,f=b==="width"?a.offsetWidth:a.offsetHeight;if(c==="border")return f;d.each(e,function(){c||(f-=parseFloat(d.css(a,"padding"+this))||0),c==="margin"?f+=parseFloat(d.css(a,"margin"+this))||0:f-=parseFloat(d.css(a,"border"+this+"Width"))||0});return f}
function ba(a,b){b.src?d.ajax({url:b.src,async:!1,dataType:"script"}):d.globalEval((b.text||b.textContent||b.innerHTML||"").replace(/^\s*<!(?:\[CDATA\[|\-\-)/,"/*$0*/")),b.parentNode&&b.parentNode.removeChild(b)}function _(a){return"getElementsByTagName"in a?a.getElementsByTagName("*"):"querySelectorAll"in a?a.querySelectorAll("*"):[]}function $(a,b){if(b.nodeType===1){var c=b.nodeName.toLowerCase();b.clearAttributes(),b.mergeAttributes(a);if(c==="object")b.outerHTML=a.outerHTML;else if(c!=="input"||
a.type!=="checkbox"&&a.type!=="radio")if(c==="option")b.selected=a.defaultSelected;else{if(c==="input"||c==="textarea")b.defaultValue=a.defaultValue}else a.checked&&(b.defaultChecked=b.checked=a.checked),b.value!==a.value&&(b.value=a.value);b.removeAttribute(d.expando)}}function Z(a,b){if(b.nodeType===1&&d.hasData(a)){var c=d.expando,e=d.data(a),f=d.data(b,e);if(e=e[c]){var g=e.events;f=f[c]=d.extend({},e);if(g){delete f.handle,f.events={};for(var h in g)for(var i=0,j=g[h].length;i<j;i++)d.event.add(b,
h+(g[h][i].namespace?".":"")+g[h][i].namespace,g[h][i],g[h][i].data)}}}}function Y(a,b){return d.nodeName(a,"table")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function O(a,b,c){if(d.isFunction(b))return d.grep(a,function(a,d){var e=!!b.call(a,d,a);return e===c});if(b.nodeType)return d.grep(a,function(a,d){return a===b===c});if(typeof b==="string"){var e=d.grep(a,function(a){return a.nodeType===1});if(J.test(b))return d.filter(b,e,!c);b=d.filter(b,
e)}return d.grep(a,function(a,e){return d.inArray(a,b)>=0===c})}function N(a){return!a||!a.parentNode||a.parentNode.nodeType===11}function F(a,b){return(a&&a!=="*"?a+".":"")+b.replace(r,"`").replace(s,"&")}function E(a){var b,c,e,f,g,h,i,j,k,l,m,n,o,q=[],r=[],s=d._data(this,"events");if(a.liveFired!==this&&s&&s.live&&!a.target.disabled&&(!a.button||a.type!=="click")){a.namespace&&(n=new RegExp("(^|\\.)"+a.namespace.split(".").join("\\.(?:.*\\.)?")+"(\\.|$)")),a.liveFired=this;var t=s.live.slice(0);
for(i=0;i<t.length;i++)g=t[i],g.origType.replace(p,"")===a.type?r.push(g.selector):t.splice(i--,1);f=d(a.target).closest(r,a.currentTarget);for(j=0,k=f.length;j<k;j++){m=f[j];for(i=0;i<t.length;i++){g=t[i];if(m.selector===g.selector&&(!n||n.test(g.namespace))&&!m.elem.disabled){h=m.elem,e=null;if(g.preType==="mouseenter"||g.preType==="mouseleave")a.type=g.preType,e=d(a.relatedTarget).closest(g.selector)[0];(!e||e!==h)&&q.push({elem:h,handleObj:g,level:m.level})}}}for(j=0,k=q.length;j<k;j++){f=q[j];
if(c&&f.level>c)break;a.currentTarget=f.elem,a.data=f.handleObj.data,a.handleObj=f.handleObj,o=f.handleObj.origHandler.apply(f.elem,arguments);if(o===!1||a.isPropagationStopped()){c=f.level,o===!1&&(b=!1);if(a.isImmediatePropagationStopped())break}}return b}}function C(a,c,e){var f=d.extend({},e[0]);f.type=a,f.originalEvent={},f.liveFired=b,d.event.handle.call(c,f),f.isDefaultPrevented()&&e[0].preventDefault()}function w(){return!0}function v(){return!1}function g(a){for(var b in a)if(b!=="toJSON")return!1;
return!0}function f(a,c,f){if(f===b&&a.nodeType===1){f=a.getAttribute("data-"+c);if(typeof f==="string"){try{f=f==="true"?!0:f==="false"?!1:f==="null"?null:d.isNaN(f)?e.test(f)?d.parseJSON(f):f:parseFloat(f)}catch(g){}d.data(a,c,f)}else f=b}return f}var c=a.document,d=function(){function I(){if(!d.isReady){try{c.documentElement.doScroll("left")}catch(a){setTimeout(I,1);return}d.ready()}}var d=function(a,b){return new d.fn.init(a,b,g)},e=a.jQuery,f=a.$,g,h=/^(?:[^<]*(<[\w\W]+>)[^>]*$|#([\w\-]+)$)/,
i=/\S/,j=/^\s+/,k=/\s+$/,l=/\d/,m=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,n=/^[\],:{}\s]*$/,o=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,p=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,q=/(?:^|:|,)(?:\s*\[)+/g,r=/(webkit)[ \/]([\w.]+)/,s=/(opera)(?:.*version)?[ \/]([\w.]+)/,t=/(msie) ([\w.]+)/,u=/(mozilla)(?:.*? rv:([\w.]+))?/,v=navigator.userAgent,w,x=!1,y,z="then done fail isResolved isRejected promise".split(" "),A,B=Object.prototype.toString,C=Object.prototype.hasOwnProperty,D=Array.prototype.push,
E=Array.prototype.slice,F=String.prototype.trim,G=Array.prototype.indexOf,H={};d.fn=d.prototype={constructor:d,init:function(a,e,f){var g,i,j,k;if(!a)return this;if(a.nodeType){this.context=this[0]=a,this.length=1;return this}if(a==="body"&&!e&&c.body){this.context=c,this[0]=c.body,this.selector="body",this.length=1;return this}if(typeof a==="string"){g=h.exec(a);if(!g||!g[1]&&e)return!e||e.jquery?(e||f).find(a):this.constructor(e).find(a);if(g[1]){e=e instanceof d?e[0]:e,k=e?e.ownerDocument||e:c,
j=m.exec(a),j?d.isPlainObject(e)?(a=[c.createElement(j[1])],d.fn.attr.call(a,e,!0)):a=[k.createElement(j[1])]:(j=d.buildFragment([g[1]],[k]),a=(j.cacheable?d.clone(j.fragment):j.fragment).childNodes);return d.merge(this,a)}i=c.getElementById(g[2]);if(i&&i.parentNode){if(i.id!==g[2])return f.find(a);this.length=1,this[0]=i}this.context=c,this.selector=a;return this}if(d.isFunction(a))return f.ready(a);a.selector!==b&&(this.selector=a.selector,this.context=a.context);return d.makeArray(a,this)},selector:"",
jquery:"1.5.1",length:0,size:function(){return this.length},toArray:function(){return E.call(this,0)},get:function(a){return a==null?this.toArray():a<0?this[this.length+a]:this[a]},pushStack:function(a,b,c){var e=this.constructor();d.isArray(a)?D.apply(e,a):d.merge(e,a),e.prevObject=this,e.context=this.context,b==="find"?e.selector=this.selector+(this.selector?" ":"")+c:b&&(e.selector=this.selector+"."+b+"("+c+")");return e},each:function(a,b){return d.each(this,a,b)},ready:function(a){d.bindReady(),
y.done(a);return this},eq:function(a){return a===-1?this.slice(a):this.slice(a,+a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(E.apply(this,arguments),"slice",E.call(arguments).join(","))},map:function(a){return this.pushStack(d.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:D,sort:[].sort,splice:[].splice},d.fn.init.prototype=d.fn,d.extend=d.fn.extend=function(){var a,
c,e,f,g,h,i=arguments[0]||{},j=1,k=arguments.length,l=!1;typeof i==="boolean"&&(l=i,i=arguments[1]||{},j=2),typeof i!=="object"&&!d.isFunction(i)&&(i={}),k===j&&(i=this,--j);for(;j<k;j++)if((a=arguments[j])!=null)for(c in a){e=i[c],f=a[c];if(i===f)continue;l&&f&&(d.isPlainObject(f)||(g=d.isArray(f)))?(g?(g=!1,h=e&&d.isArray(e)?e:[]):h=e&&d.isPlainObject(e)?e:{},i[c]=d.extend(l,h,f)):f!==b&&(i[c]=f)}return i},d.extend({noConflict:function(b){a.$=f,b&&(a.jQuery=e);return d},isReady:!1,readyWait:1,ready:function(a){a===
!0&&d.readyWait--;if(!d.readyWait||a!==!0&&!d.isReady){if(!c.body)return setTimeout(d.ready,1);d.isReady=!0;if(a!==!0&&--d.readyWait>0)return;y.resolveWith(c,[d]),d.fn.trigger&&d(c).trigger("ready").unbind("ready")}},bindReady:function(){if(!x){x=!0;if(c.readyState==="complete")return setTimeout(d.ready,1);if(c.addEventListener)c.addEventListener("DOMContentLoaded",A,!1),a.addEventListener("load",d.ready,!1);else if(c.attachEvent){c.attachEvent("onreadystatechange",A),a.attachEvent("onload",d.ready);
var b=!1;try{b=a.frameElement==null}catch(e){}c.documentElement.doScroll&&b&&I()}}},isFunction:function(a){return d.type(a)==="function"},isArray:Array.isArray||function(a){return d.type(a)==="array"},isWindow:function(a){return a&&typeof a==="object"&&"setInterval"in a},isNaN:function(a){return a==null||!l.test(a)||isNaN(a)},type:function(a){return a==null?String(a):H[B.call(a)]||"object"},isPlainObject:function(a){if(!a||d.type(a)!=="object"||a.nodeType||d.isWindow(a))return!1;if(a.constructor&&
!C.call(a,"constructor")&&!C.call(a.constructor.prototype,"isPrototypeOf"))return!1;var c;for(c in a);return c===b||C.call(a,c)},isEmptyObject:function(a){for(var b in a)return!1;return!0},error:function(a){throw a;},parseJSON:function(b){if(typeof b!="string"||!b)return null;b=d.trim(b);if(a.JSON&&a.JSON.parse)return a.JSON.parse(b);if(n.test(b.replace(o,"@").replace(p,"]").replace(q,"")))return(new Function("return "+b))();d.error("Invalid JSON: "+b)},parseXML:function(b,c,e){a.DOMParser?(e=new DOMParser,
c=e.parseFromString(b,"text/xml")):(c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(b)),e=c.documentElement,(!e||!e.nodeName||e.nodeName==="parsererror")&&d.error("Invalid XML: "+b);return c},noop:function(){},globalEval:function(d){try{if(d&&i.test(d))(window.execScript||function(d){window["eval"].call(window,d)})(d)}catch(err){if(window.patron&&patron.saveError)patron.saveError("js7",["JQUERY.EVAL",encodeURIComponent(err.message||err)])}},nodeName:function(a,b){return a.nodeName&&
a.nodeName.toUpperCase()===b.toUpperCase()},each:function(a,c,e){var f,g=0,h=a.length,i=h===b||d.isFunction(a);if(e)if(i)for(f in a){if(c.apply(a[f],e)===!1)break}else for(;g<h;){if(c.apply(a[g++],e)===!1)break}else if(i)for(f in a){if(c.call(a[f],f,a[f])===!1)break}else for(var j=a[0];g<h&&c.call(j,g,j)!==!1;j=a[++g]);return a},trim:F?function(a){return a==null?"":F.call(a)}:function(a){return a==null?"":(a+"").replace(j,"").replace(k,"")},makeArray:function(a,b){var c=b||[];if(a!=null){var e=d.type(a);
a.length==null||e==="string"||e==="function"||e==="regexp"||d.isWindow(a)?D.call(c,a):d.merge(c,a)}return c},inArray:function(a,b){if(b.indexOf)return b.indexOf(a);for(var c=0,d=b.length;c<d;c++)if(b[c]===a)return c;return-1},merge:function(a,c){var d=a.length,e=0;if(typeof c.length==="number")for(var f=c.length;e<f;e++)a[d++]=c[e];else while(c[e]!==b)a[d++]=c[e++];a.length=d;return a},grep:function(a,b,c){var d=[],e;c=!!c;for(var f=0,g=a.length;f<g;f++)e=!!b(a[f],f),c!==e&&d.push(a[f]);return d},
map:function(a,b,c){var d=[],e;for(var f=0,g=a.length;f<g;f++)e=b(a[f],f,c),e!=null&&(d[d.length]=e);return d.concat.apply([],d)},guid:1,proxy:function(a,c,e){arguments.length===2&&(typeof c==="string"?(e=a,a=e[c],c=b):c&&!d.isFunction(c)&&(e=c,c=b)),!c&&a&&(c=function(){return a.apply(e||this,arguments)}),a&&(c.guid=a.guid=a.guid||c.guid||d.guid++);return c},access:function(a,c,e,f,g,h){var i=a.length;if(typeof c==="object"){for(var j in c)d.access(a,j,c[j],f,g,e);return a}if(e!==b){f=!h&&f&&d.isFunction(e);
for(var k=0;k<i;k++)g(a[k],c,f?e.call(a[k],k,g(a[k],c)):e,h);return a}return i?g(a[0],c):b},now:function(){return(new Date).getTime()},_Deferred:function(){var a=[],b,c,e,a2,f={done:function(){if(!e){var c=arguments,g,h,i,j,k;b&&(k=b,b=0);for(g=0,h=c.length;g<h;g++)i=c[g],j=d.type(i),j==="array"?f.done.apply(f,i):j==="function"&&a.push(i);k&&f.resolveWith(k[0],k[1])}return this},resolveWith:function(d,f){if(!e&&!b&&!c){c=1;try{while(a[0])(a2=a.shift()).apply(d,f)}catch(g){if(window.patron&&patron.LogDeferredError&&
patron.radarLog)patron.radarLog("deferred_error",{caller:a2.toString(),message:g.message,stack:g.stack});throw g;}finally{b=[d,f],c=0}}return this},resolve:function(){f.resolveWith(d.isFunction(this.promise)?this.promise():this,arguments);return this},isResolved:function(){return c||b},cancel:function(){e=1,a=[];return this}};return f},Deferred:function(a){var b=d._Deferred(),c=d._Deferred(),e;d.extend(b,{then:function(a,c){b.done(a).fail(c);return this},fail:c.done,rejectWith:c.resolveWith,reject:c.resolve,
isRejected:c.isResolved,promise:function(a){if(a==null){if(e)return e;e=a={}}var c=z.length;while(c--)a[z[c]]=b[z[c]];return a}}),b.done(c.cancel).fail(b.cancel),delete b.cancel,a&&a.call(b,b);return b},when:function(a){var b=arguments.length,c=b<=1&&a&&d.isFunction(a.promise)?a:d.Deferred(),e=c.promise();if(b>1){var f=E.call(arguments,0),g=b,h=function(a){return function(b){f[a]=arguments.length>1?E.call(arguments,0):b,--g||c.resolveWith(e,f)}};while(b--)a=f[b],a&&d.isFunction(a.promise)?a.promise().then(h(b),
c.reject):--g;g||c.resolveWith(e,f)}else c!==a&&c.resolve(a);return e},uaMatch:function(a){a=a.toLowerCase();var b=r.exec(a)||s.exec(a)||t.exec(a)||a.indexOf("compatible")<0&&u.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},sub:function(){function a(b,c){return new a.fn.init(b,c)}d.extend(!0,a,this),a.superclass=this,a.fn=a.prototype=this(),a.fn.constructor=a,a.subclass=this.subclass,a.fn.init=function b(b,c){c&&c instanceof d&&!(c instanceof a)&&(c=a(c));return d.fn.init.call(this,b,c,e)},
a.fn.init.prototype=a.fn;var e=a(c);return a},browser:{}}),y=d._Deferred(),d.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(a,b){H["[object "+b+"]"]=b.toLowerCase()}),w=d.uaMatch(v),w.browser&&(d.browser[w.browser]=!0,d.browser.version=w.version),d.browser.webkit&&(d.browser.safari=!0),G&&(d.inArray=function(a,b){return G.call(b,a)}),i.test(" ")&&(j=/^[\s\xA0]+/,k=/[\s\xA0]+$/),g=d(c),c.addEventListener?A=function(){c.removeEventListener("DOMContentLoaded",A,!1),
d.ready()}:c.attachEvent&&(A=function(){c.readyState==="complete"&&(c.detachEvent("onreadystatechange",A),d.ready())});return d}();(function(){d.support={};var b=c.createElement("div");b.style.display="none",b.innerHTML="   <link/><table></table><a href='/a' style='color:red;float:left;opacity:.55;'>a</a><input type='checkbox'/>";var e=b.getElementsByTagName("*"),f=b.getElementsByTagName("a")[0],g=c.createElement("select"),h=g.appendChild(c.createElement("option")),i=b.getElementsByTagName("input")[0];
if(e&&e.length&&f){d.support={leadingWhitespace:b.firstChild.nodeType===3,tbody:!b.getElementsByTagName("tbody").length,htmlSerialize:!!b.getElementsByTagName("link").length,style:/red/.test(f.getAttribute("style")),hrefNormalized:f.getAttribute("href")==="/a",opacity:/^0.55$/.test(f.style.opacity),cssFloat:!!f.style.cssFloat,checkOn:i.value==="on",optSelected:h.selected,deleteExpando:!0,optDisabled:!1,checkClone:!1,noCloneEvent:!0,noCloneChecked:!0,boxModel:null,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,
reliableHiddenOffsets:!0},i.checked=!0,d.support.noCloneChecked=i.cloneNode(!0).checked,g.disabled=!0,d.support.optDisabled=!h.disabled;var j=null;d.support.scriptEval=function(){if(j===null){var b=c.documentElement,e=c.createElement("script"),f="script"+d.now();try{e.appendChild(c.createTextNode("window."+f+"=1;"))}catch(g){}b.insertBefore(e,b.firstChild),a[f]?(j=!0,delete a[f]):j=!1,b.removeChild(e),b=e=f=null}return j};try{delete b.test}catch(k){d.support.deleteExpando=!1}!b.addEventListener&&
b.attachEvent&&b.fireEvent&&(b.attachEvent("onclick",function l(){d.support.noCloneEvent=!1,b.detachEvent("onclick",l)}),b.cloneNode(!0).fireEvent("onclick")),b=c.createElement("div"),b.innerHTML="<input type='radio' name='radiotest' checked='checked'/>";var m=c.createDocumentFragment();m.appendChild(b.firstChild),d.support.checkClone=m.cloneNode(!0).cloneNode(!0).lastChild.checked,d(function(){var a=c.createElement("div"),b=c.getElementsByTagName("body")[0];if(b){a.style.width=a.style.paddingLeft=
"1px",b.appendChild(a),d.boxModel=d.support.boxModel=a.offsetWidth===2,"zoom"in a.style&&(a.style.display="inline",a.style.zoom=1,d.support.inlineBlockNeedsLayout=a.offsetWidth===2,a.style.display="",a.innerHTML="<div style='width:4px;'></div>",d.support.shrinkWrapBlocks=a.offsetWidth!==2),a.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>";var e=a.getElementsByTagName("td");d.support.reliableHiddenOffsets=e[0].offsetHeight===0,e[0].style.display="",e[1].style.display=
"none",d.support.reliableHiddenOffsets=d.support.reliableHiddenOffsets&&e[0].offsetHeight===0,a.innerHTML="",b.removeChild(a).style.display="none",a=e=null}});var n=function(a){var b=c.createElement("div");a="on"+a;if(!b.attachEvent)return!0;var d=a in b;d||(b.setAttribute(a,"return;"),d=typeof b[a]==="function"),b=null;return d};d.support.submitBubbles=n("submit"),d.support.changeBubbles=n("change"),b=e=f=null}})();var e=/^(?:\{.*\}|\[.*\])$/;d.extend({cache:{},uuid:0,expando:"jQuery"+(d.fn.jquery+
Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){a=a.nodeType?d.cache[a[d.expando]]:a[d.expando];return!!a&&!g(a)},data:function(a,c,e,f){if(d.acceptData(a)){var g=d.expando,h=typeof c==="string",i,j=a.nodeType,k=j?d.cache:a,l=j?a[d.expando]:a[d.expando]&&d.expando;if((!l||f&&l&&!k[l][g])&&h&&e===b)return;l||(j?a[d.expando]=l=++d.uuid:l=d.expando),k[l]||(k[l]={},j||(k[l].toJSON=d.noop));if(typeof c==="object"||typeof c===
"function")f?k[l][g]=d.extend(k[l][g],c):k[l]=d.extend(k[l],c);i=k[l],f&&(i[g]||(i[g]={}),i=i[g]),e!==b&&(i[c]=e);if(c==="events"&&!i[c])return i[g]&&i[g].events;return h?i[c]:i}},removeData:function(b,c,e){if(d.acceptData(b)){var f=d.expando,h=b.nodeType,i=h?d.cache:b,j=h?b[d.expando]:d.expando;if(!i[j])return;if(c){var k=e?i[j][f]:i[j];if(k){delete k[c];if(!g(k))return}}if(e){delete i[j][f];if(!g(i[j]))return}var l=i[j][f];d.support.deleteExpando||i!=a?delete i[j]:i[j]=null,l?(i[j]={},h||(i[j].toJSON=
d.noop),i[j][f]=l):h&&(d.support.deleteExpando?delete b[d.expando]:b.removeAttribute?b.removeAttribute(d.expando):b[d.expando]=null)}},_data:function(a,b,c){return d.data(a,b,c,!0)},acceptData:function(a){if(a.nodeName){var b=d.noData[a.nodeName.toLowerCase()];if(b)return b!==!0&&a.getAttribute("classid")===b}return!0}}),d.fn.extend({data:function(a,c){var e=null;if(typeof a==="undefined"){if(this.length){e=d.data(this[0]);if(this[0].nodeType===1){var g=this[0].attributes,h;for(var i=0,j=g.length;i<
j;i++)h=g[i].name,h.indexOf("data-")===0&&(h=h.substr(5),f(this[0],h,e[h]))}}return e}if(typeof a==="object")return this.each(function(){d.data(this,a)});var k=a.split(".");k[1]=k[1]?"."+k[1]:"";if(c===b){e=this.triggerHandler("getData"+k[1]+"!",[k[0]]),e===b&&this.length&&(e=d.data(this[0],a),e=f(this[0],a,e));return e===b&&k[1]?this.data(k[0]):e}return this.each(function(){var b=d(this),e=[k[0],c];b.triggerHandler("setData"+k[1]+"!",e),d.data(this,a,c),b.triggerHandler("changeData"+k[1]+"!",e)})},
removeData:function(a){return this.each(function(){d.removeData(this,a)})}}),d.extend({queue:function(a,b,c){if(a){b=(b||"fx")+"queue";var e=d._data(a,b);if(!c)return e||[];!e||d.isArray(c)?e=d._data(a,b,d.makeArray(c)):e.push(c);return e}},dequeue:function(a,b){b=b||"fx";var c=d.queue(a,b),e=c.shift();e==="inprogress"&&(e=c.shift()),e&&(b==="fx"&&c.unshift("inprogress"),e.call(a,function(){d.dequeue(a,b)})),c.length||d.removeData(a,b+"queue",!0)}}),d.fn.extend({queue:function(a,c){typeof a!=="string"&&
(c=a,a="fx");if(c===b)return d.queue(this[0],a);return this.each(function(b){var e=d.queue(this,a,c);a==="fx"&&e[0]!=="inprogress"&&d.dequeue(this,a)})},dequeue:function(a){return this.each(function(){d.dequeue(this,a)})},delay:function(a,b){a=d.fx?d.fx.speeds[a]||a:a,b=b||"fx";return this.queue(b,function(){var c=this;setTimeout(function(){d.dequeue(c,b)},a)})},clearQueue:function(a){return this.queue(a||"fx",[])}});var h=/[\n\t\r]/g,i=/\s+/,j=/\r/g,k=/^(?:href|src|style)$/,l=/^(?:button|input)$/i,
m=/^(?:button|input|object|select|textarea)$/i,n=/^a(?:rea)?$/i,o=/^(?:radio|checkbox)$/i;d.props={"for":"htmlFor","class":"className",readonly:"readOnly",maxlength:"maxLength",cellspacing:"cellSpacing",rowspan:"rowSpan",colspan:"colSpan",tabindex:"tabIndex",usemap:"useMap",frameborder:"frameBorder"},d.fn.extend({attr:function(a,b){return d.access(this,a,b,!0,d.attr)},removeAttr:function(a,b){return this.each(function(){d.attr(this,a,""),this.nodeType===1&&this.removeAttribute(a)})},addClass:function(a){if(d.isFunction(a))return this.each(function(b){var c=
d(this);c.addClass(a.call(this,b,c.attr("class")))});if(a&&typeof a==="string"){var b=(a||"").split(i);for(var c=0,e=this.length;c<e;c++){var f=this[c];if(f.nodeType===1)if(f.className){var g=" "+f.className+" ",h=f.className;for(var j=0,k=b.length;j<k;j++)g.indexOf(" "+b[j]+" ")<0&&(h+=" "+b[j]);f.className=d.trim(h)}else f.className=a}}return this},removeClass:function(a){if(d.isFunction(a))return this.each(function(b){var c=d(this);c.removeClass(a.call(this,b,c.attr("class")))});if(a&&typeof a===
"string"||a===b){var c=(a||"").split(i);for(var e=0,f=this.length;e<f;e++){var g=this[e];if(g.nodeType===1&&g.className)if(a){var j=(" "+g.className+" ").replace(h," ");for(var k=0,l=c.length;k<l;k++)j=j.replace(" "+c[k]+" "," ");g.className=d.trim(j)}else g.className=""}}return this},toggleClass:function(a,b){var c=typeof a,e=typeof b==="boolean";if(d.isFunction(a))return this.each(function(c){var e=d(this);e.toggleClass(a.call(this,c,e.attr("class"),b),b)});return this.each(function(){if(c==="string"){var f,
g=0,h=d(this),j=b,k=a.split(i);while(f=k[g++])j=e?j:!h.hasClass(f),h[j?"addClass":"removeClass"](f)}else if(c==="undefined"||c==="boolean")this.className&&d._data(this,"__className__",this.className),this.className=this.className||a===!1?"":d._data(this,"__className__")||""})},hasClass:function(a){var b=" "+a+" ";for(var c=0,d=this.length;c<d;c++)if((" "+this[c].className+" ").replace(h," ").indexOf(b)>-1)return!0;return!1},val:function(a){if(!arguments.length){var c=this[0];if(c){if(d.nodeName(c,
"option")){var e=c.attributes.value;return!e||e.specified?c.value:c.text}if(d.nodeName(c,"select")){var f=c.selectedIndex,g=[],h=c.options,i=c.type==="select-one";if(f<0)return null;for(var k=i?f:0,l=i?f+1:h.length;k<l;k++){var m=h[k];if(m.selected&&(d.support.optDisabled?!m.disabled:m.getAttribute("disabled")===null)&&(!m.parentNode.disabled||!d.nodeName(m.parentNode,"optgroup"))){a=d(m).val();if(i)return a;g.push(a)}}if(i&&!g.length&&h.length)return d(h[f]).val();return g}if(o.test(c.type)&&!d.support.checkOn)return c.getAttribute("value")===
null?"on":c.value;return(c.value||"").replace(j,"")}return b}var n=d.isFunction(a);return this.each(function(b){var c=d(this),e=a;if(this.nodeType===1){n&&(e=a.call(this,b,c.val())),e==null?e="":typeof e==="number"?e+="":d.isArray(e)&&(e=d.map(e,function(a){return a==null?"":a+""}));if(d.isArray(e)&&o.test(this.type))this.checked=d.inArray(c.val(),e)>=0;else if(d.nodeName(this,"select")){var f=d.makeArray(e);d("option",this).each(function(){this.selected=d.inArray(d(this).val(),f)>=0}),f.length||
(this.selectedIndex=-1)}else this.value=e}})}}),d.extend({attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(a,c,e,f){if(!a||a.nodeType===3||a.nodeType===8||a.nodeType===2)return b;if(f&&c in d.attrFn)return d(a)[c](e);var g=a.nodeType!==1||!d.isXMLDoc(a),h=e!==b;c=g&&d.props[c]||c;if(a.nodeType===1){var i=k.test(c);if(c==="selected"&&!d.support.optSelected){var j=a.parentNode;j&&(j.selectedIndex,j.parentNode&&j.parentNode.selectedIndex)}if((c in a||a[c]!==b)&&
g&&!i){h&&(c==="type"&&l.test(a.nodeName)&&a.parentNode&&d.error("type property can't be changed"),e===null?a.nodeType===1&&a.removeAttribute(c):a[c]=e);if(d.nodeName(a,"form")&&a.getAttributeNode(c))return a.getAttributeNode(c).nodeValue;if(c==="tabIndex"){var o=a.getAttributeNode("tabIndex");return o&&o.specified?o.value:m.test(a.nodeName)||n.test(a.nodeName)&&a.href?0:b}return a[c]}if(!d.support.style&&g&&c==="style"){h&&(a.style.cssText=""+e);return a.style.cssText}h&&a.setAttribute(c,""+e);if(!a.attributes[c]&&
a.hasAttribute&&!a.hasAttribute(c))return b;var p=!d.support.hrefNormalized&&g&&i?a.getAttribute(c,2):a.getAttribute(c);return p===null?b:p}h&&(a[c]=e);return a[c]}});var p=/\.(.*)$/,q=/^(?:textarea|input|select)$/i,r=/\./g,s=/ /g,t=/[^\w\s.|`]/g,u=function(a){return a.replace(t,"\\$&")};d.event={add:function(c,e,f,g){if(c.nodeType!==3&&c.nodeType!==8){try{d.isWindow(c)&&c!==a&&!c.frameElement&&(c=a)}catch(h){}if(f===!1)f=v;else if(!f)return;var i,j;f.handler&&(i=f,f=i.handler),f.guid||(f.guid=d.guid++);
var k=d._data(c);if(!k)return;var l=k.events,m=k.handle;l||(k.events=l={}),m||(k.handle=m=function(){return typeof d!=="undefined"&&!d.event.triggered?d.event.handle.apply(m.elem,arguments):b}),m.elem=c,e=e.split(" ");var n,o=0,p;while(n=e[o++]){j=i?d.extend({},i):{handler:f,data:g},n.indexOf(".")>-1?(p=n.split("."),n=p.shift(),j.namespace=p.slice(0).sort().join(".")):(p=[],j.namespace=""),j.type=n,j.guid||(j.guid=f.guid);var q=l[n],r=d.event.special[n]||{};if(!q){q=l[n]=[];if(!r.setup||r.setup.call(c,
g,p,m)===!1)c.addEventListener?c.addEventListener(n,m,!1):c.attachEvent&&c.attachEvent("on"+n,m)}r.add&&(r.add.call(c,j),j.handler.guid||(j.handler.guid=f.guid)),q.push(j),d.event.global[n]=!0}c=null}},global:{},remove:function(a,c,e,f){if(a.nodeType!==3&&a.nodeType!==8){e===!1&&(e=v);var g,h,i,j,k=0,l,m,n,o,p,q,r,s=d.hasData(a)&&d._data(a),t=s&&s.events;if(!s||!t)return;c&&c.type&&(e=c.handler,c=c.type);if(!c||typeof c==="string"&&c.charAt(0)==="."){c=c||"";for(h in t)d.event.remove(a,h+c);return}c=
c.split(" ");while(h=c[k++]){r=h,q=null,l=h.indexOf(".")<0,m=[],l||(m=h.split("."),h=m.shift(),n=new RegExp("(^|\\.)"+d.map(m.slice(0).sort(),u).join("\\.(?:.*\\.)?")+"(\\.|$)")),p=t[h];if(!p)continue;if(!e){for(j=0;j<p.length;j++){q=p[j];if(l||n.test(q.namespace))d.event.remove(a,r,q.handler,j),p.splice(j--,1)}continue}o=d.event.special[h]||{};for(j=f||0;j<p.length;j++){q=p[j];if(e.guid===q.guid){if(l||n.test(q.namespace))f==null&&p.splice(j--,1),o.remove&&o.remove.call(a,q);if(f!=null)break}}if(p.length===
0||f!=null&&p.length===1)(!o.teardown||o.teardown.call(a,m)===!1)&&d.removeEvent(a,h,s.handle),g=null,delete t[h]}if(d.isEmptyObject(t)){var w=s.handle;w&&(w.elem=null),delete s.events,delete s.handle,d.isEmptyObject(s)&&d.removeData(a,b,!0)}}},trigger:function(a,c,e){var f=a.type||a,g=arguments[3];if(!g){a=typeof a==="object"?a[d.expando]?a:d.extend(d.Event(f),a):d.Event(f),f.indexOf("!")>=0&&(a.type=f=f.slice(0,-1),a.exclusive=!0),e||(a.stopPropagation(),d.event.global[f]&&d.each(d.cache,function(){var b=
d.expando,e=this[b];e&&e.events&&e.events[f]&&d.event.trigger(a,c,e.handle.elem)}));if(!e||e.nodeType===3||e.nodeType===8)return b;a.result=b,a.target=e,c=d.makeArray(c),c.unshift(a)}a.currentTarget=e;var h=d._data(e,"handle");h&&h.apply(e,c);var i=e.parentNode||e.ownerDocument;try{e&&e.nodeName&&d.noData[e.nodeName.toLowerCase()]||e["on"+f]&&e["on"+f].apply(e,c)===!1&&(a.result=!1,a.preventDefault())}catch(j){}if(!a.isPropagationStopped()&&i)d.event.trigger(a,c,i,!0);else if(!a.isDefaultPrevented()){var k,
l=a.target,m=f.replace(p,""),n=d.nodeName(l,"a")&&m==="click",o=d.event.special[m]||{};if((!o._default||o._default.call(e,a)===!1)&&!n&&!(l&&l.nodeName&&d.noData[l.nodeName.toLowerCase()])){try{l[m]&&(k=l["on"+m],k&&(l["on"+m]=null),d.event.triggered=!0,l[m]())}catch(q){}k&&(l["on"+m]=k),d.event.triggered=!1}}},handle:function(c){var e,f,g,h,i,j=[],k=d.makeArray(arguments);c=k[0]=d.event.fix(c||a.event),c.currentTarget=this,e=c.type.indexOf(".")<0&&!c.exclusive,e||(g=c.type.split("."),c.type=g.shift(),
j=g.slice(0).sort(),h=new RegExp("(^|\\.)"+j.join("\\.(?:.*\\.)?")+"(\\.|$)")),c.namespace=c.namespace||j.join("."),i=d._data(this,"events"),f=(i||{})[c.type];if(i&&f){f=f.slice(0);for(var l=0,m=f.length;l<m;l++){var n=f[l];if(e||h.test(n.namespace)){c.handler=n.handler,c.data=n.data,c.handleObj=n;var o=n.handler.apply(this,k);o!==b&&(c.result=o,o===!1&&(c.preventDefault(),c.stopPropagation()));if(c.isImmediatePropagationStopped())break}}}return c.result},props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" "),
fix:function(a){if(a[d.expando])return a;var e=a;a=d.Event(e);for(var f=this.props.length,g;f;)g=this.props[--f],a[g]=e[g];a.target||(a.target=a.srcElement||c),a.target.nodeType===3&&(a.target=a.target.parentNode),!a.relatedTarget&&a.fromElement&&(a.relatedTarget=a.fromElement===a.target?a.toElement:a.fromElement);if(a.pageX==null&&a.clientX!=null){var h=c.documentElement,i=c.body;a.pageX=a.clientX+(h&&h.scrollLeft||i&&i.scrollLeft||0)-(h&&h.clientLeft||i&&i.clientLeft||0),a.pageY=a.clientY+(h&&h.scrollTop||
i&&i.scrollTop||0)-(h&&h.clientTop||i&&i.clientTop||0)}a.which==null&&(a.charCode!=null||a.keyCode!=null)&&(a.which=a.charCode!=null?a.charCode:a.keyCode),!a.metaKey&&a.ctrlKey&&(a.metaKey=a.ctrlKey),!a.which&&a.button!==b&&(a.which=a.button&1?1:a.button&2?3:a.button&4?2:0);return a},guid:1E8,proxy:d.proxy,special:{ready:{setup:d.bindReady,teardown:d.noop},live:{add:function(a){d.event.add(this,F(a.origType,a.selector),d.extend({},a,{handler:E,guid:a.handler.guid}))},remove:function(a){d.event.remove(this,
F(a.origType,a.selector),a)}},beforeunload:{setup:function(a,b,c){d.isWindow(this)&&(this.onbeforeunload=c)},teardown:function(a,b){this.onbeforeunload===b&&(this.onbeforeunload=null)}}}},d.removeEvent=c.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){a.detachEvent&&a.detachEvent("on"+b,c)},d.Event=function(a){if(!this.preventDefault)return new d.Event(a);a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||
a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault()?w:v):this.type=a,this.timeStamp=d.now(),this[d.expando]=!0},d.Event.prototype={preventDefault:function(){this.isDefaultPrevented=w;var a=this.originalEvent;a&&(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=w;var a=this.originalEvent;a&&(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=w,this.stopPropagation()},
isDefaultPrevented:v,isPropagationStopped:v,isImmediatePropagationStopped:v};var x=function(a){var b=a.relatedTarget;try{if(b!==c&&!b.parentNode)return;while(b&&b!==this)b=b.parentNode;b!==this&&(a.type=a.data,d.event.handle.apply(this,arguments))}catch(e){}},y=function(a){a.type=a.data,d.event.handle.apply(this,arguments)};d.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){d.event.special[a]={setup:function(c){d.event.add(this,b,c&&c.selector?y:x,a)},teardown:function(a){d.event.remove(this,
b,a&&a.selector?y:x)}}}),d.support.submitBubbles||(d.event.special.submit={setup:function(a,b){if(this.nodeName&&this.nodeName.toLowerCase()!=="form")d.event.add(this,"click.specialSubmit",function(a){var b=a.target,c=b.type;(c==="submit"||c==="image")&&d(b).closest("form").length&&C("submit",this,arguments)}),d.event.add(this,"keypress.specialSubmit",function(a){var b=a.target,c=b.type;(c==="text"||c==="password")&&d(b).closest("form").length&&a.keyCode===13&&C("submit",this,arguments)});else return!1},
teardown:function(a){d.event.remove(this,".specialSubmit")}});if(!d.support.changeBubbles){var z,A=function(a){var b=a.type,c=a.value;b==="radio"||b==="checkbox"?c=a.checked:b==="select-multiple"?c=a.selectedIndex>-1?d.map(a.options,function(a){return a.selected}).join("-"):"":a.nodeName.toLowerCase()==="select"&&(c=a.selectedIndex);return c},B=function B(a){var c=a.target,e,f;if(q.test(c.nodeName)&&!c.readOnly){e=d._data(c,"_change_data"),f=A(c),(a.type!=="focusout"||c.type!=="radio")&&d._data(c,
"_change_data",f);if(e===b||f===e)return;if(e!=null||f)a.type="change",a.liveFired=b,d.event.trigger(a,arguments[1],c)}};d.event.special.change={filters:{focusout:B,beforedeactivate:B,click:function(a){var b=a.target,c=b.type;(c==="radio"||c==="checkbox"||b.nodeName.toLowerCase()==="select")&&B.call(this,a)},keydown:function(a){var b=a.target,c=b.type;(a.keyCode===13&&b.nodeName.toLowerCase()!=="textarea"||a.keyCode===32&&(c==="checkbox"||c==="radio")||c==="select-multiple")&&B.call(this,a)},beforeactivate:function(a){var b=
a.target;d._data(b,"_change_data",A(b))}},setup:function(a,b){if(this.type==="file")return!1;for(var c in z)d.event.add(this,c+".specialChange",z[c]);return q.test(this.nodeName)},teardown:function(a){d.event.remove(this,".specialChange");return q.test(this.nodeName)}},z=d.event.special.change.filters,z.focus=z.beforeactivate}c.addEventListener&&d.each({focus:"focusin",blur:"focusout"},function(a,b){function c(a){a=d.event.fix(a),a.type=b;return d.event.handle.call(this,a)}d.event.special[b]={setup:function(){this.addEventListener(a,
c,!0)},teardown:function(){this.removeEventListener(a,c,!0)}}}),d.each(["bind","one"],function(a,c){d.fn[c]=function(a,e,f){if(typeof a==="object"){for(var g in a)this[c](g,e,a[g],f);return this}if(d.isFunction(e)||e===!1)f=e,e=b;var h=c==="one"?d.proxy(f,function(a){d(this).unbind(a,h);return f.apply(this,arguments)}):f;if(a==="unload"&&c!=="one")this.one(a,e,f);else for(var i=0,j=this.length;i<j;i++)d.event.add(this[i],a,h,e);return this}}),d.fn.extend({unbind:function(a,b){if(typeof a!=="object"||
a.preventDefault)for(var e=0,f=this.length;e<f;e++)d.event.remove(this[e],a,b);else for(var c in a)this.unbind(c,a[c]);return this},delegate:function(a,b,c,d){return this.live(b,c,d,a)},undelegate:function(a,b,c){return arguments.length===0?this.unbind("live"):this.die(b,null,c,a)},trigger:function(a,b){return this.each(function(){d.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0]){var c=d.Event(a);c.preventDefault(),c.stopPropagation(),d.event.trigger(c,b,this[0]);return c.result}},
toggle:function(a){var b=arguments,c=1;while(c<b.length)d.proxy(a,b[c++]);return this.click(d.proxy(a,function(e){var f=(d._data(this,"lastToggle"+a.guid)||0)%c;d._data(this,"lastToggle"+a.guid,f+1),e.preventDefault();return b[f].apply(this,arguments)||!1}))},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}});var D={focus:"focusin",blur:"focusout",mouseenter:"mouseover",mouseleave:"mouseout"};d.each(["live","die"],function(a,c){d.fn[c]=function(a,e,f,g){var h,i=0,j,k,l,m=g||this.selector,
n=g?this:d(this.context);if(typeof a==="object"&&!a.preventDefault){for(var o in a)n[c](o,e,a[o],m);return this}d.isFunction(e)&&(f=e,e=b),a=(a||"").split(" ");while((h=a[i++])!=null){j=p.exec(h),k="",j&&(k=j[0],h=h.replace(p,""));if(h==="hover"){a.push("mouseenter"+k,"mouseleave"+k);continue}l=h,h==="focus"||h==="blur"?(a.push(D[h]+k),h=h+k):h=(D[h]||h)+k;if(c==="live")for(var q=0,r=n.length;q<r;q++)d.event.add(n[q],"live."+F(h,m),{data:e,selector:m,handler:f,origType:h,origHandler:f,preType:l});
else n.unbind("live."+F(h,m),f)}return this}}),d.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error".split(" "),function(a,b){d.fn[b]=function(a,c){c==null&&(c=a,a=null);return arguments.length>0?this.bind(b,a,c):this.trigger(b)},d.attrFn&&(d.attrFn[b]=!0)}),function(){function u(a,b,c,d,e,f){for(var g=0,h=d.length;g<h;g++){var i=d[g];if(i){var j=!1;i=i[a];
while(i){if(i.sizcache===c){j=d[i.sizset];break}if(i.nodeType===1){f||(i.sizcache=c,i.sizset=g);if(typeof b!=="string"){if(i===b){j=!0;break}}else if(k.filter(b,[i]).length>0){j=i;break}}i=i[a]}d[g]=j}}}function t(a,b,c,d,e,f){for(var g=0,h=d.length;g<h;g++){var i=d[g];if(i){var j=!1;i=i[a];while(i){if(i.sizcache===c){j=d[i.sizset];break}i.nodeType===1&&!f&&(i.sizcache=c,i.sizset=g);if(i.nodeName.toLowerCase()===b){j=i;break}i=i[a]}d[g]=j}}}var a=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,
e=0,f=Object.prototype.toString,g=!1,h=!0,i=/\\/g,j=/\W/;[0,0].sort(function(){h=!1;return 0});var k=function(b,d,e,g){e=e||[],d=d||c;var h=d;if(d.nodeType!==1&&d.nodeType!==9)return[];if(!b||typeof b!=="string")return e;var i,j,n,o,q,r,s,t,u=!0,w=k.isXML(d),x=[],y=b;do{a.exec(""),i=a.exec(y);if(i){y=i[3],x.push(i[1]);if(i[2]){o=i[3];break}}}while(i);if(x.length>1&&m.exec(b))if(x.length===2&&l.relative[x[0]])j=v(x[0]+x[1],d);else{j=l.relative[x[0]]?[d]:k(x.shift(),d);while(x.length)b=x.shift(),l.relative[b]&&
(b+=x.shift()),j=v(b,j)}else{!g&&x.length>1&&d.nodeType===9&&!w&&l.match.ID.test(x[0])&&!l.match.ID.test(x[x.length-1])&&(q=k.find(x.shift(),d,w),d=q.expr?k.filter(q.expr,q.set)[0]:q.set[0]);if(d){q=g?{expr:x.pop(),set:p(g)}:k.find(x.pop(),x.length===1&&(x[0]==="~"||x[0]==="+")&&d.parentNode?d.parentNode:d,w),j=q.expr?k.filter(q.expr,q.set):q.set,x.length>0?n=p(j):u=!1;while(x.length)r=x.pop(),s=r,l.relative[r]?s=x.pop():r="",s==null&&(s=d),l.relative[r](n,s,w)}else n=x=[]}n||(n=j),n||k.error(r||
b);if(f.call(n)==="[object Array]")if(u)if(d&&d.nodeType===1)for(t=0;n[t]!=null;t++)n[t]&&(n[t]===!0||n[t].nodeType===1&&k.contains(d,n[t]))&&e.push(j[t]);else for(t=0;n[t]!=null;t++)n[t]&&n[t].nodeType===1&&e.push(j[t]);else e.push.apply(e,n);else p(n,e);o&&(k(o,h,e,g),k.uniqueSort(e));return e};k.uniqueSort=function(a){if(r){g=h,a.sort(r);if(g)for(var b=1;b<a.length;b++)a[b]===a[b-1]&&a.splice(b--,1)}return a},k.matches=function(a,b){return k(a,null,null,b)},k.matchesSelector=function(a,b){return k(b,
null,null,[a]).length>0},k.find=function(a,b,c){var d;if(!a)return[];for(var e=0,f=l.order.length;e<f;e++){var g,h=l.order[e];if(g=l.leftMatch[h].exec(a)){var j=g[1];g.splice(1,1);if(j.substr(j.length-1)!=="\\"){g[1]=(g[1]||"").replace(i,""),d=l.find[h](g,b,c);if(d!=null){a=a.replace(l.match[h],"");break}}}}d||(d=typeof b.getElementsByTagName!=="undefined"?b.getElementsByTagName("*"):[]);return{set:d,expr:a}},k.filter=function(a,c,d,e){var f,g,h=a,i=[],j=c,m=c&&c[0]&&k.isXML(c[0]);while(a&&c.length){for(var n in l.filter)if((f=
l.leftMatch[n].exec(a))!=null&&f[2]){var o,p,q=l.filter[n],r=f[1];g=!1,f.splice(1,1);if(r.substr(r.length-1)==="\\")continue;j===i&&(i=[]);if(l.preFilter[n]){f=l.preFilter[n](f,j,d,i,e,m);if(f){if(f===!0)continue}else g=o=!0}if(f)for(var s=0;(p=j[s])!=null;s++)if(p){o=q(p,f,s,j);var t=e^!!o;d&&o!=null?t?g=!0:j[s]=!1:t&&(i.push(p),g=!0)}if(o!==b){d||(j=i),a=a.replace(l.match[n],"");if(!g)return[];break}}if(a===h)if(g==null)k.error(a);else break;h=a}return j},k.error=function(a){throw"Syntax error, unrecognized expression: "+
a;};var l=k.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,
PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(a){return a.getAttribute("href")},type:function(a){return a.getAttribute("type")}},relative:{"+":function(a,b){var c=typeof b==="string",d=c&&!j.test(b),e=c&&!d;d&&(b=b.toLowerCase());for(var f=0,g=a.length,h;f<g;f++)if(h=a[f]){while((h=h.previousSibling)&&h.nodeType!==1);a[f]=e||h&&h.nodeName.toLowerCase()===b?h||!1:h===b}e&&k.filter(b,
a,!0)},">":function(a,b){var c,d=typeof b==="string",e=0,f=a.length;if(d&&!j.test(b)){b=b.toLowerCase();for(;e<f;e++){c=a[e];if(c){var g=c.parentNode;a[e]=g.nodeName.toLowerCase()===b?g:!1}}}else{for(;e<f;e++)c=a[e],c&&(a[e]=d?c.parentNode:c.parentNode===b);d&&k.filter(b,a,!0)}},"":function(a,b,c){var d,f=e++,g=u;typeof b==="string"&&!j.test(b)&&(b=b.toLowerCase(),d=b,g=t),g("parentNode",b,f,a,d,c)},"~":function(a,b,c){var d,f=e++,g=u;typeof b==="string"&&!j.test(b)&&(b=b.toLowerCase(),d=b,g=t),g("previousSibling",
b,f,a,d,c)}},find:{ID:function(a,b,c){if(typeof b.getElementById!=="undefined"&&!c){var d=b.getElementById(a[1]);return d&&d.parentNode?[d]:[]}},NAME:function(a,b){if(typeof b.getElementsByName!=="undefined"){var c=[],d=b.getElementsByName(a[1]);for(var e=0,f=d.length;e<f;e++)d[e].getAttribute("name")===a[1]&&c.push(d[e]);return c.length===0?null:c}},TAG:function(a,b){if(typeof b.getElementsByTagName!=="undefined")return b.getElementsByTagName(a[1])}},preFilter:{CLASS:function(a,b,c,d,e,f){a=" "+
a[1].replace(i,"")+" ";if(f)return a;for(var g=0,h;(h=b[g])!=null;g++)h&&(e^(h.className&&(" "+h.className+" ").replace(/[\t\n\r]/g," ").indexOf(a)>=0)?c||d.push(h):c&&(b[g]=!1));return!1},ID:function(a){return a[1].replace(i,"")},TAG:function(a,b){return a[1].replace(i,"").toLowerCase()},CHILD:function(a){if(a[1]==="nth"){a[2]||k.error(a[0]),a[2]=a[2].replace(/^\+|\s*/g,"");var b=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(a[2]==="even"&&"2n"||a[2]==="odd"&&"2n+1"||!/\D/.test(a[2])&&"0n+"+a[2]||a[2]);a[2]=
b[1]+(b[2]||1)-0,a[3]=b[3]-0}else a[2]&&k.error(a[0]);a[0]=e++;return a},ATTR:function(a,b,c,d,e,f){var g=a[1]=a[1].replace(i,"");!f&&l.attrMap[g]&&(a[1]=l.attrMap[g]),a[4]=(a[4]||a[5]||"").replace(i,""),a[2]==="~="&&(a[4]=" "+a[4]+" ");return a},PSEUDO:function(b,c,d,e,f){if(b[1]==="not")if((a.exec(b[3])||"").length>1||/^\w/.test(b[3]))b[3]=k(b[3],null,null,c);else{var g=k.filter(b[3],c,d,!0^f);d||e.push.apply(e,g);return!1}else if(l.match.POS.test(b[0])||l.match.CHILD.test(b[0]))return!0;return b},
POS:function(a){a.unshift(!0);return a}},filters:{enabled:function(a){return a.disabled===!1&&a.type!=="hidden"},disabled:function(a){return a.disabled===!0},checked:function(a){return a.checked===!0},selected:function(a){a.parentNode&&a.parentNode.selectedIndex;return a.selected===!0},parent:function(a){return!!a.firstChild},empty:function(a){return!a.firstChild},has:function(a,b,c){return!!k(c[3],a).length},header:function(a){return/h\d/i.test(a.nodeName)},text:function(a){return"text"===a.getAttribute("type")},
radio:function(a){return"radio"===a.type},checkbox:function(a){return"checkbox"===a.type},file:function(a){return"file"===a.type},password:function(a){return"password"===a.type},submit:function(a){return"submit"===a.type},image:function(a){return"image"===a.type},reset:function(a){return"reset"===a.type},button:function(a){return"button"===a.type||a.nodeName.toLowerCase()==="button"},input:function(a){return/input|select|textarea|button/i.test(a.nodeName)}},setFilters:{first:function(a,b){return b===
0},last:function(a,b,c,d){return b===d.length-1},even:function(a,b){return b%2===0},odd:function(a,b){return b%2===1},lt:function(a,b,c){return b<c[3]-0},gt:function(a,b,c){return b>c[3]-0},nth:function(a,b,c){return c[3]-0===b},eq:function(a,b,c){return c[3]-0===b}},filter:{PSEUDO:function(a,b,c,d){var e=b[1],f=l.filters[e];if(f)return f(a,c,b,d);if(e==="contains")return(a.textContent||a.innerText||k.getText([a])||"").indexOf(b[3])>=0;if(e==="not"){var g=b[3];for(var h=0,i=g.length;h<i;h++)if(g[h]===
a)return!1;return!0}k.error(e)},CHILD:function(a,b){var c=b[1],d=a;switch(c){case "only":case "first":while(d=d.previousSibling)if(d.nodeType===1)return!1;if(c==="first")return!0;d=a;case "last":while(d=d.nextSibling)if(d.nodeType===1)return!1;return!0;case "nth":var e=b[2],f=b[3];if(e===1&&f===0)return!0;var g=b[0],h=a.parentNode;if(h&&(h.sizcache!==g||!a.nodeIndex)){var i=0;for(d=h.firstChild;d;d=d.nextSibling)d.nodeType===1&&(d.nodeIndex=++i);h.sizcache=g}var j=a.nodeIndex-f;return e===0?j===0:
j%e===0&&j/e>=0}},ID:function(a,b){return a.nodeType===1&&a.getAttribute("id")===b},TAG:function(a,b){return b==="*"&&a.nodeType===1||a.nodeName.toLowerCase()===b},CLASS:function(a,b){return(" "+(a.className||a.getAttribute("class"))+" ").indexOf(b)>-1},ATTR:function(a,b){var c=b[1],d=l.attrHandle[c]?l.attrHandle[c](a):a[c]!=null?a[c]:a.getAttribute(c),e=d+"",f=b[2],g=b[4];return d==null?f==="!=":f==="="?e===g:f==="*="?e.indexOf(g)>=0:f==="~="?(" "+e+" ").indexOf(g)>=0:g?f==="!="?e!==g:f==="^="?e.indexOf(g)===
0:f==="$="?e.substr(e.length-g.length)===g:f==="|="?e===g||e.substr(0,g.length+1)===g+"-":!1:e&&d!==!1},POS:function(a,b,c,d){var e=b[2],f=l.setFilters[e];if(f)return f(a,c,b,d)}}},m=l.match.POS,n=function(a,b){return"\\"+(b-0+1)};for(var o in l.match)l.match[o]=new RegExp(l.match[o].source+/(?![^\[]*\])(?![^\(]*\))/.source),l.leftMatch[o]=new RegExp(/(^(?:.|\r|\n)*?)/.source+l.match[o].source.replace(/\\(\d+)/g,n));var p=function(a,b){a=Array.prototype.slice.call(a,0);if(b){b.push.apply(b,a);return b}return a};
try{Array.prototype.slice.call(c.documentElement.childNodes,0)[0].nodeType}catch(q){p=function(a,b){var c=0,d=b||[];if(f.call(a)==="[object Array]")Array.prototype.push.apply(d,a);else if(typeof a.length==="number")for(var e=a.length;c<e;c++)d.push(a[c]);else for(;a[c];c++)d.push(a[c]);return d}}var r,s;c.documentElement.compareDocumentPosition?r=function(a,b){if(a===b){g=!0;return 0}if(!a.compareDocumentPosition||!b.compareDocumentPosition)return a.compareDocumentPosition?-1:1;return a.compareDocumentPosition(b)&
4?-1:1}:(r=function(a,b){var c,d,e=[],f=[],h=a.parentNode,i=b.parentNode,j=h;if(a===b){g=!0;return 0}if(h===i)return s(a,b);if(!h)return-1;if(!i)return 1;while(j)e.unshift(j),j=j.parentNode;j=i;while(j)f.unshift(j),j=j.parentNode;c=e.length,d=f.length;for(var k=0;k<c&&k<d;k++)if(e[k]!==f[k])return s(e[k],f[k]);return k===c?s(a,f[k],-1):s(e[k],b,1)},s=function(a,b,c){if(a===b)return c;var d=a.nextSibling;while(d){if(d===b)return-1;d=d.nextSibling}return 1}),k.getText=function(a){var b="",c;for(var d=
0;a[d];d++)c=a[d],c.nodeType===3||c.nodeType===4?b+=c.nodeValue:c.nodeType!==8&&(b+=k.getText(c.childNodes));return b},function(){var a=c.createElement("div"),d="script"+(new Date).getTime(),e=c.documentElement;a.innerHTML="<a name='"+d+"'/>",e.insertBefore(a,e.firstChild),c.getElementById(d)&&(l.find.ID=function(a,c,d){if(typeof c.getElementById!=="undefined"&&!d){var e=c.getElementById(a[1]);return e?e.id===a[1]||typeof e.getAttributeNode!=="undefined"&&e.getAttributeNode("id").nodeValue===a[1]?
[e]:b:[]}},l.filter.ID=function(a,b){var c=typeof a.getAttributeNode!=="undefined"&&a.getAttributeNode("id");return a.nodeType===1&&c&&c.nodeValue===b}),e.removeChild(a),e=a=null}(),function(){var a=c.createElement("div");a.appendChild(c.createComment("")),a.getElementsByTagName("*").length>0&&(l.find.TAG=function(a,b){var c=b.getElementsByTagName(a[1]);if(a[1]==="*"){var d=[];for(var e=0;c[e];e++)c[e].nodeType===1&&d.push(c[e]);c=d}return c}),a.innerHTML="<a href='#'></a>",a.firstChild&&typeof a.firstChild.getAttribute!==
"undefined"&&a.firstChild.getAttribute("href")!=="#"&&(l.attrHandle.href=function(a){return a.getAttribute("href",2)}),a=null}(),c.querySelectorAll&&function(){var a=k,b=c.createElement("div"),d="__sizzle__";b.innerHTML="<p class='TEST'></p>";if(!b.querySelectorAll||b.querySelectorAll(".TEST").length!==0){k=function(b,e,f,g){e=e||c;if(!g&&!k.isXML(e)){var h=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(b);if(h&&(e.nodeType===1||e.nodeType===9)){if(h[1])return p(e.getElementsByTagName(b),f);if(h[2]&&l.find.CLASS&&
e.getElementsByClassName)return p(e.getElementsByClassName(h[2]),f)}if(e.nodeType===9){if(b==="body"&&e.body)return p([e.body],f);if(h&&h[3]){var i=e.getElementById(h[3]);if(!i||!i.parentNode)return p([],f);if(i.id===h[3])return p([i],f)}try{return p(e.querySelectorAll(b),f)}catch(j){}}else if(e.nodeType===1&&e.nodeName.toLowerCase()!=="object"){var m=e,n=e.getAttribute("id"),o=n||d,q=e.parentNode,r=/^\s*[+~]/.test(b);n?o=o.replace(/'/g,"\\$&"):e.setAttribute("id",o),r&&q&&(e=e.parentNode);try{if(!r||
q)return p(e.querySelectorAll("[id='"+o+"'] "+b),f)}catch(s){}finally{n||m.removeAttribute("id")}}}return a(b,e,f,g)};for(var e in a)k[e]=a[e];b=null}}(),function(){var a=c.documentElement,b=a.matchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.msMatchesSelector,d=!1;try{b.call(c.documentElement,"[test!='']:sizzle")}catch(e){d=!0}b&&(k.matchesSelector=function(a,c){c=c.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!k.isXML(a))try{if(d||!l.match.PSEUDO.test(c)&&!/!=/.test(c))return b.call(a,
c)}catch(e){}return k(c,null,null,[a]).length>0})}(),function(){var a=c.createElement("div");a.innerHTML="<div class='test e'></div><div class='test'></div>";if(a.getElementsByClassName&&a.getElementsByClassName("e").length!==0){a.lastChild.className="e";if(a.getElementsByClassName("e").length===1)return;l.order.splice(1,0,"CLASS"),l.find.CLASS=function(a,b,c){if(typeof b.getElementsByClassName!=="undefined"&&!c)return b.getElementsByClassName(a[1])},a=null}}(),c.documentElement.contains?k.contains=
function(a,b){return a!==b&&(a.contains?a.contains(b):!0)}:c.documentElement.compareDocumentPosition?k.contains=function(a,b){return!!(a.compareDocumentPosition(b)&16)}:k.contains=function(){return!1},k.isXML=function(a){var b=(a?a.ownerDocument||a:0).documentElement;return b?b.nodeName!=="HTML":!1};var v=function(a,b){var c,d=[],e="",f=b.nodeType?[b]:b;while(c=l.match.PSEUDO.exec(a))e+=c[0],a=a.replace(l.match.PSEUDO,"");a=l.relative[a]?a+"*":a;for(var g=0,h=f.length;g<h;g++)k(a,f[g],d);return k.filter(e,
d)};d.find=k,d.expr=k.selectors,d.expr[":"]=d.expr.filters,d.unique=k.uniqueSort,d.text=k.getText,d.isXMLDoc=k.isXML,d.contains=k.contains}();var G=/Until$/,H=/^(?:parents|prevUntil|prevAll)/,I=/,/,J=/^.[^:#\[\.,]*$/,K=Array.prototype.slice,L=d.expr.match.POS,M={children:!0,contents:!0,next:!0,prev:!0};d.fn.extend({find:function(a){var b=this.pushStack("","find",a),c=0;for(var e=0,f=this.length;e<f;e++){c=b.length,d.find(a,this[e],b);if(e>0)for(var g=c;g<b.length;g++)for(var h=0;h<c;h++)if(b[h]===
b[g]){b.splice(g--,1);break}}return b},has:function(a){var b=d(a);return this.filter(function(){for(var a=0,c=b.length;a<c;a++)if(d.contains(this,b[a]))return!0})},not:function(a){return this.pushStack(O(this,a,!1),"not",a)},filter:function(a){return this.pushStack(O(this,a,!0),"filter",a)},is:function(a){return!!a&&d.filter(a,this).length>0},closest:function(a,b){var c=[],e,f,g=this[0];if(d.isArray(a)){var h,i,j={},k=1;if(g&&a.length){for(e=0,f=a.length;e<f;e++)i=a[e],j[i]||(j[i]=d.expr.match.POS.test(i)?
d(i,b||this.context):i);while(g&&g.ownerDocument&&g!==b){for(i in j)h=j[i],(h.jquery?h.index(g)>-1:d(g).is(h))&&c.push({selector:i,elem:g,level:k});g=g.parentNode,k++}}return c}var l=L.test(a)?d(a,b||this.context):null;for(e=0,f=this.length;e<f;e++){g=this[e];while(g){if(l?l.index(g)>-1:d.find.matchesSelector(g,a)){c.push(g);break}g=g.parentNode;if(!g||!g.ownerDocument||g===b)break}}c=c.length>1?d.unique(c):c;return this.pushStack(c,"closest",a)},index:function(a){if(!a||typeof a==="string")return d.inArray(this[0],
a?d(a):this.parent().children());return d.inArray(a.jquery?a[0]:a,this)},add:function(a,b){var c=typeof a==="string"?d(a,b):d.makeArray(a),e=d.merge(this.get(),c);return this.pushStack(N(c[0])||N(e[0])?e:d.unique(e))},andSelf:function(){return this.add(this.prevObject)}}),d.each({parent:function(a){var b=a.parentNode;return b&&b.nodeType!==11?b:null},parents:function(a){return d.dir(a,"parentNode")},parentsUntil:function(a,b,c){return d.dir(a,"parentNode",c)},next:function(a){return d.nth(a,2,"nextSibling")},
prev:function(a){return d.nth(a,2,"previousSibling")},nextAll:function(a){return d.dir(a,"nextSibling")},prevAll:function(a){return d.dir(a,"previousSibling")},nextUntil:function(a,b,c){return d.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return d.dir(a,"previousSibling",c)},siblings:function(a){return d.sibling(a.parentNode.firstChild,a)},children:function(a){return d.sibling(a.firstChild)},contents:function(a){return d.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:d.makeArray(a.childNodes)}},
function(a,b){d.fn[a]=function(c,e){var f=d.map(this,b,c),g=K.call(arguments);G.test(a)||(e=c),e&&typeof e==="string"&&(f=d.filter(e,f)),f=this.length>1&&!M[a]?d.unique(f):f,(this.length>1||I.test(e))&&H.test(a)&&(f=f.reverse());return this.pushStack(f,a,g.join(","))}}),d.extend({filter:function(a,b,c){c&&(a=":not("+a+")");return b.length===1?d.find.matchesSelector(b[0],a)?[b[0]]:[]:d.find.matches(a,b)},dir:function(a,c,e){var f=[],g=a[c];while(g&&g.nodeType!==9&&(e===b||g.nodeType!==1||!d(g).is(e)))g.nodeType===
1&&f.push(g),g=g[c];return f},nth:function(a,b,c,d){b=b||1;var e=0;for(;a;a=a[c])if(a.nodeType===1&&++e===b)break;return a},sibling:function(a,b){var c=[];for(;a;a=a.nextSibling)a.nodeType===1&&a!==b&&c.push(a);return c}});var P=/ jQuery\d+="(?:\d+|null)"/g,Q=/^\s+/,R=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,S=/<([\w:]+)/,T=/<tbody/i,U=/<|&#?\w+;/,V=/<(?:script|object|embed|option|style)/i,W=/checked\s*(?:[^=]|=\s*.checked.)/i,X={option:[1,"<select multiple='multiple'>",
"</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]};X.optgroup=X.option,X.tbody=X.tfoot=X.colgroup=X.caption=X.thead,X.th=X.td,d.support.htmlSerialize||(X._default=[1,"div<div>","</div>"]),d.fn.extend({text:function(a){if(d.isFunction(a))return this.each(function(b){var c=
d(this);c.text(a.call(this,b,c.text()))});if(typeof a!=="object"&&a!==b)return this.empty().append((this[0]&&this[0].ownerDocument||c).createTextNode(a));return d.text(this)},wrapAll:function(a){if(d.isFunction(a))return this.each(function(b){d(this).wrapAll(a.call(this,b))});if(this[0]){var b=d(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&a.firstChild.nodeType===1)a=a.firstChild;return a}).append(this)}return this},
wrapInner:function(a){if(d.isFunction(a))return this.each(function(b){d(this).wrapInner(a.call(this,b))});return this.each(function(){var b=d(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){return this.each(function(){d(this).wrapAll(a)})},unwrap:function(){return this.parent().each(function(){d.nodeName(this,"body")||d(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,
!0,function(a){this.nodeType===1&&this.insertBefore(a,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this)});if(arguments.length){var a=d(arguments[0]);a.push.apply(a,this.toArray());return this.pushStack(a,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this.nextSibling)});if(arguments.length){var a=this.pushStack(this,
"after",arguments);a.push.apply(a,d(arguments[0]).toArray());return a}},remove:function(a,b){for(var c=0,e;(e=this[c])!=null;c++)if(!a||d.filter(a,[e]).length)!b&&e.nodeType===1&&(d.cleanData(e.getElementsByTagName("*")),d.cleanData([e])),e.parentNode&&e.parentNode.removeChild(e);return this},empty:function(){for(var a=0,b;(b=this[a])!=null;a++){b.nodeType===1&&d.cleanData(b.getElementsByTagName("*"));while(b.firstChild)b.removeChild(b.firstChild)}return this},clone:function(a,b){a=a==null?!1:a,b=
b==null?a:b;return this.map(function(){return d.clone(this,a,b)})},html:function(a){if(a===b)return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(P,""):null;if(typeof a!=="string"||V.test(a)||!d.support.leadingWhitespace&&Q.test(a)||X[(S.exec(a)||["",""])[1].toLowerCase()])d.isFunction(a)?this.each(function(b){var c=d(this);c.html(a.call(this,b,c.html()))}):this.empty().append(a);else{a=a.replace(R,"<$1></$2>");try{for(var c=0,e=this.length;c<e;c++)this[c].nodeType===1&&(d.cleanData(this[c].getElementsByTagName("*")),
this[c].innerHTML=a)}catch(f){this.empty().append(a)}}return this},replaceWith:function(a){if(this[0]&&this[0].parentNode){if(d.isFunction(a))return this.each(function(b){var c=d(this),e=c.html();c.replaceWith(a.call(this,b,e))});typeof a!=="string"&&(a=d(a).detach());return this.each(function(){var b=this.nextSibling,c=this.parentNode;d(this).remove(),b?d(b).before(a):d(c).append(a)})}return this.pushStack(d(d.isFunction(a)?a():a),"replaceWith",a)},detach:function(a){return this.remove(a,!0)},domManip:function(a,
c,e){var f,g,h,i,j=a[0],k=[];if(!d.support.checkClone&&arguments.length===3&&typeof j==="string"&&W.test(j))return this.each(function(){d(this).domManip(a,c,e,!0)});if(d.isFunction(j))return this.each(function(f){var g=d(this);a[0]=j.call(this,f,c?g.html():b),g.domManip(a,c,e)});if(this[0]){i=j&&j.parentNode,d.support.parentNode&&i&&i.nodeType===11&&i.childNodes.length===this.length?f={fragment:i}:f=d.buildFragment(a,this,k),h=f.fragment,h.childNodes.length===1?g=h=h.firstChild:g=h.firstChild;if(g){c=
c&&d.nodeName(g,"tr");for(var l=0,m=this.length,n=m-1;l<m;l++)e.call(c?Y(this[l],g):this[l],f.cacheable||m>1&&l<n?d.clone(h,!0,!0):h)}k.length&&d.each(k,ba)}return this}}),d.buildFragment=function(a,b,e){var f,g,h,i=b&&b[0]?b[0].ownerDocument||b[0]:c;a.length===1&&typeof a[0]==="string"&&a[0].length<512&&i===c&&a[0].charAt(0)==="<"&&!V.test(a[0])&&(d.support.checkClone||!W.test(a[0]))&&(g=!0,h=d.fragments[a[0]],h&&h!==1&&(f=h)),f||(f=i.createDocumentFragment(),d.clean(a,i,f,e)),g&&(d.fragments[a[0]]=
h?f:1);return{fragment:f,cacheable:g}},d.fragments={},d.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){d.fn[a]=function(c){var e=[],f=d(c),g=this.length===1&&this[0].parentNode;if(g&&g.nodeType===11&&g.childNodes.length===1&&f.length===1){f[b](this[0]);return this}for(var h=0,i=f.length;h<i;h++){var j=(h>0?this.clone(!0):this).get();d(f[h])[b](j),e=e.concat(j)}return this.pushStack(e,a,f.selector)}}),d.extend({clone:function(a,
b,c){var e=a.cloneNode(!0),f,g,h;if((!d.support.noCloneEvent||!d.support.noCloneChecked)&&(a.nodeType===1||a.nodeType===11)&&!d.isXMLDoc(a)){$(a,e),f=_(a),g=_(e);for(h=0;f[h];++h)$(f[h],g[h])}if(b){Z(a,e);if(c){f=_(a),g=_(e);for(h=0;f[h];++h)Z(f[h],g[h])}}return e},clean:function(a,b,e,f){b=b||c,typeof b.createElement==="undefined"&&(b=b.ownerDocument||b[0]&&b[0].ownerDocument||c);var g=[];for(var h=0,i;(i=a[h])!=null;h++){typeof i==="number"&&(i+="");if(!i)continue;if(typeof i!=="string"||U.test(i)){if(typeof i===
"string"){i=i.replace(R,"<$1></$2>");var j=(S.exec(i)||["",""])[1].toLowerCase(),k=X[j]||X._default,l=k[0],m=b.createElement("div");m.innerHTML=k[1]+i+k[2];while(l--)m=m.lastChild;if(!d.support.tbody){var n=T.test(i),o=j==="table"&&!n?m.firstChild&&m.firstChild.childNodes:k[1]==="<table>"&&!n?m.childNodes:[];for(var p=o.length-1;p>=0;--p)d.nodeName(o[p],"tbody")&&!o[p].childNodes.length&&o[p].parentNode.removeChild(o[p])}!d.support.leadingWhitespace&&Q.test(i)&&m.insertBefore(b.createTextNode(Q.exec(i)[0]),
m.firstChild),i=m.childNodes}}else i=b.createTextNode(i);i.nodeType?g.push(i):g=d.merge(g,i)}if(e)for(h=0;g[h];h++)!f||!d.nodeName(g[h],"script")||g[h].type&&g[h].type.toLowerCase()!=="text/javascript"?(g[h].nodeType===1&&g.splice.apply(g,[h+1,0].concat(d.makeArray(g[h].getElementsByTagName("script")))),e.appendChild(g[h])):f.push(g[h].parentNode?g[h].parentNode.removeChild(g[h]):g[h]);return g},cleanData:function(a){var b,c,e=d.cache,f=d.expando,g=d.event.special,h=d.support.deleteExpando;for(var i=
0,j;(j=a[i])!=null;i++){if(j.nodeName&&d.noData[j.nodeName.toLowerCase()])continue;c=j[d.expando];if(c){b=e[c]&&e[c][f];if(b&&b.events){for(var k in b.events)g[k]?d.event.remove(j,k):d.removeEvent(j,k,b.handle);b.handle&&(b.handle.elem=null)}h?delete j[d.expando]:j.removeAttribute&&j.removeAttribute(d.expando),delete e[c]}}}});var bb=/alpha\([^)]*\)/i,bc=/opacity=([^)]*)/,bd=/-([a-z])/ig,be=/([A-Z])/g,bf=/^-?\d+(?:px)?$/i,bg=/^-?\d/,bh={position:"absolute",visibility:"hidden",display:"block"},bi=
["Left","Right"],bj=["Top","Bottom"],bk,bl,bm,bn=function(a,b){return b.toUpperCase()};d.fn.css=function(a,c){if(arguments.length===2&&c===b)return this;return d.access(this,a,c,!0,function(a,c,e){return e!==b?d.style(a,c,e):d.css(a,c)})},d.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=bk(a,"opacity","opacity");return c===""?"1":c}return a.style.opacity}}},cssNumber:{zIndex:!0,fontWeight:!0,opacity:!0,zoom:!0,lineHeight:!0},cssProps:{"float":d.support.cssFloat?"cssFloat":"styleFloat"},
style:function(a,c,e,f){if(a&&a.nodeType!==3&&a.nodeType!==8&&a.style){var g,h=d.camelCase(c),i=a.style,j=d.cssHooks[h];c=d.cssProps[h]||h;if(e===b){if(j&&"get"in j&&(g=j.get(a,!1,f))!==b)return g;return i[c]}if(typeof e==="number"&&isNaN(e)||e==null)return;typeof e==="number"&&!d.cssNumber[h]&&(e+="px");if(!j||!("set"in j)||(e=j.set(a,e))!==b)try{i[c]=e}catch(k){}}},css:function(a,c,e){var f,g=d.camelCase(c),h=d.cssHooks[g];c=d.cssProps[g]||g;if(h&&"get"in h&&(f=h.get(a,!0,e))!==b)return f;if(bk)return bk(a,
c,g)},swap:function(a,b,c){var d={};for(var e in b)d[e]=a.style[e],a.style[e]=b[e];c.call(a);for(e in b)a.style[e]=d[e]},camelCase:function(a){return a.replace(bd,bn)}}),d.curCSS=d.css,d.each(["height","width"],function(a,b){d.cssHooks[b]={get:function(a,c,e){var f;if(c){a.offsetWidth!==0?f=bo(a,b,e):d.swap(a,bh,function(){f=bo(a,b,e)});if(f<=0){f=bk(a,b,b),f==="0px"&&bm&&(f=bm(a,b,b));if(f!=null)return f===""||f==="auto"?"0px":f}if(f<0||f==null){f=a.style[b];return f===""||f==="auto"?"0px":f}return typeof f===
"string"?f:f+"px"}},set:function(a,b){if(!bf.test(b))return b;b=parseFloat(b);if(b>=0)return b+"px"}}}),d.support.opacity||(d.cssHooks.opacity={get:function(a,b){return bc.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?parseFloat(RegExp.$1)/100+"":b?"1":""},set:function(a,b){var c=a.style;c.zoom=1;var e=d.isNaN(b)?"":"alpha(opacity="+b*100+")",f=c.filter||"";c.filter=bb.test(f)?f.replace(bb,e):c.filter+" "+e}}),c.defaultView&&c.defaultView.getComputedStyle&&(bl=function(a,c,e){var f,
g,h;e=e.replace(be,"-$1").toLowerCase();if(!(g=a.ownerDocument.defaultView))return b;if(h=g.getComputedStyle(a,null))f=h.getPropertyValue(e),f===""&&!d.contains(a.ownerDocument.documentElement,a)&&(f=d.style(a,e));return f}),c.documentElement.currentStyle&&(bm=function(a,b){var c,d=a.currentStyle&&a.currentStyle[b],e=a.runtimeStyle&&a.runtimeStyle[b],f=a.style;!bf.test(d)&&bg.test(d)&&(c=f.left,e&&(a.runtimeStyle.left=a.currentStyle.left),f.left=b==="fontSize"?"1em":d||0,d=f.pixelLeft+"px",f.left=
c,e&&(a.runtimeStyle.left=e));return d===""?"auto":d}),bk=bl||bm,d.expr&&d.expr.filters&&(d.expr.filters.hidden=function(a){var b=a.offsetWidth,c=a.offsetHeight;return b===0&&c===0||!d.support.reliableHiddenOffsets&&(a.style.display||d.css(a,"display"))==="none"},d.expr.filters.visible=function(a){return!d.expr.filters.hidden(a)});var bp=/%20/g,bq=/\[\]$/,br=/\r?\n/g,bs=/#.*$/,bt=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,bu=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,
bv=/(?:^file|^widget|\-extension):$/,bw=/^(?:GET|HEAD)$/,bx=/^\/\//,by=/\?/,bz=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,bA=/^(?:select|textarea)/i,bB=/\s+/,bC=/([?&])_=[^&]*/,bD=/(^|\-)([a-z])/g,bE=function(a,b,c){return b+c.toUpperCase()},bF=/^([\w\+\.\-]+:)\/\/([^\/?#:]*)(?::(\d+))?/,bG=d.fn.load,bH={},bI={},bJ,bK;try{bJ=c.location.href}catch(bL){bJ=c.createElement("a"),bJ.href="",bJ=bJ.href}bK=bF.exec(bJ.toLowerCase()),d.fn.extend({load:function(a,c,e){if(typeof a!=="string"&&bG)return bG.apply(this,
arguments);if(!this.length)return this;var f=a.indexOf(" ");if(f>=0){var g=a.slice(f,a.length);a=a.slice(0,f)}var h="GET";c&&(d.isFunction(c)?(e=c,c=b):typeof c==="object"&&(c=d.param(c,d.ajaxSettings.traditional),h="POST"));var i=this;d.ajax({url:a,type:h,dataType:"html",data:c,complete:function(a,b,c){c=a.responseText,a.isResolved()&&(a.done(function(a){c=a}),i.html(g?d("<div>").append(c.replace(bz,"")).find(g):c)),e&&i.each(e,[c,b,a])}});return this},serialize:function(){return d.param(this.serializeArray())},
serializeArray:function(){return this.map(function(){return this.elements?d.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||bA.test(this.nodeName)||bu.test(this.type))}).map(function(a,b){var c=d(this).val();return c==null?null:d.isArray(c)?d.map(c,function(a,c){return{name:b.name,value:a.replace(br,"\r\n")}}):{name:b.name,value:c.replace(br,"\r\n")}}).get()}}),d.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,
b){d.fn[b]=function(a){return this.bind(b,a)}}),d.each(["get","post"],function(a,c){d[c]=function(a,e,f,g){d.isFunction(e)&&(g=g||f,f=e,e=b);return d.ajax({type:c,url:a,data:e,success:f,dataType:g})}}),d.extend({getScript:function(a,c){return d.get(a,b,c,"script")},getJSON:function(a,b,c){return d.get(a,b,c,"json")},ajaxSetup:function(a,b){b?d.extend(!0,a,d.ajaxSettings,b):(b=a,a=d.extend(!0,d.ajaxSettings,b));for(var c in{context:1,url:1})c in b?a[c]=b[c]:c in d.ajaxSettings&&(a[c]=d.ajaxSettings[c]);
return a},ajaxSettings:{url:bJ,isLocal:bv.test(bK[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":a.String,"text html":!0,"text json":d.parseJSON,"text xml":d.parseXML}},ajaxPrefilter:bM(bH),ajaxTransport:bM(bI),
ajax:function(a,c){function v(a,c,l,n){if(r!==2){r=2,p&&clearTimeout(p),o=b,m=n||"",u.readyState=a?4:0;var q,t,v,w=l?bP(e,u,l):b,x,y;if(a>=200&&a<300||a===304){if(e.ifModified){if(x=u.getResponseHeader("Last-Modified"))d.lastModified[k]=x;if(y=u.getResponseHeader("Etag"))d.etag[k]=y}if(a===304)c="notmodified",q=!0;else try{t=bQ(e,w),c="success",q=!0}catch(z){c="parsererror",v=z}}else{v=c;if(!c||a)c="error",a<0&&(a=0)}u.status=a,u.statusText=c,q?h.resolveWith(f,[t,c,u]):h.rejectWith(f,[u,c,v]),u.statusCode(j),
j=b,s&&g.trigger("ajax"+(q?"Success":"Error"),[u,e,q?t:v]),i.resolveWith(f,[u,c]),s&&(g.trigger("ajaxComplete",[u,e]),--d.active||d.event.trigger("ajaxStop"))}}typeof a==="object"&&(c=a,a=b),c=c||{};var e=d.ajaxSetup({},c),f=e.context||e,g=f!==e&&(f.nodeType||f instanceof d)?d(f):d.event,h=d.Deferred(),i=d._Deferred(),j=e.statusCode||{},k,l={},m,n,o,p,q,r=0,s,t,u={readyState:0,setRequestHeader:function(a,b){r||(l[a.toLowerCase().replace(bD,bE)]=b);return this},getAllResponseHeaders:function(){return r===
2?m:null},getResponseHeader:function(a){var c;if(r===2){if(!n){n={};while(c=bt.exec(m))n[c[1].toLowerCase()]=c[2]}c=n[a.toLowerCase()]}return c===b?null:c},overrideMimeType:function(a){r||(e.mimeType=a);return this},abort:function(a){a=a||"abort",o&&o.abort(a),v(0,a);return this}};h.promise(u),u.success=u.done,u.error=u.fail,u.complete=i.done,u.statusCode=function(a){if(a){var b;if(r<2)for(b in a)j[b]=[j[b],a[b]];else b=a[u.status],u.then(b,b)}return this},e.url=((a||e.url)+"").replace(bs,"").replace(bx,
bK[1]+"//"),e.dataTypes=d.trim(e.dataType||"*").toLowerCase().split(bB),e.crossDomain||(q=bF.exec(e.url.toLowerCase()),e.crossDomain=q&&(q[1]!=bK[1]||q[2]!=bK[2]||(q[3]||(q[1]==="http:"?80:443))!=(bK[3]||(bK[1]==="http:"?80:443)))),e.data&&e.processData&&typeof e.data!=="string"&&(e.data=d.param(e.data,e.traditional)),bN(bH,e,c,u);if(r===2)return!1;s=e.global,e.type=e.type.toUpperCase(),e.hasContent=!bw.test(e.type),s&&d.active++===0&&d.event.trigger("ajaxStart");if(!e.hasContent){e.data&&(e.url+=
(by.test(e.url)?"&":"?")+e.data),k=e.url;if(e.cache===!1){var w=d.now(),x=e.url.replace(bC,"$1_="+w);e.url=x+(x===e.url?(by.test(e.url)?"&":"?")+"_="+w:"")}}if(e.data&&e.hasContent&&e.contentType!==!1||c.contentType)l["Content-Type"]=e.contentType;e.ifModified&&(k=k||e.url,d.lastModified[k]&&(l["If-Modified-Since"]=d.lastModified[k]),d.etag[k]&&(l["If-None-Match"]=d.etag[k])),l.Accept=e.dataTypes[0]&&e.accepts[e.dataTypes[0]]?e.accepts[e.dataTypes[0]]+(e.dataTypes[0]!=="*"?", */*; q=0.01":""):e.accepts["*"];
for(t in e.headers)u.setRequestHeader(t,e.headers[t]);if(e.beforeSend&&(e.beforeSend.call(f,u,e)===!1||r===2)){u.abort();return!1}for(t in{success:1,error:1,complete:1})u[t](e[t]);o=bN(bI,e,c,u);if(o){u.readyState=1,s&&g.trigger("ajaxSend",[u,e]),e.async&&e.timeout>0&&(p=setTimeout(function(){u.abort("timeout")},e.timeout));try{r=1,o.send(l,v)}catch(y){status<2?v(-1,y):d.error(y)}}else v(-1,"No Transport");return u},param:function(a,c){var e=[],f=function(a,b){b=d.isFunction(b)?b():b,e[e.length]=
encodeURIComponent(a)+"="+encodeURIComponent(b)};c===b&&(c=d.ajaxSettings.traditional);if(d.isArray(a)||a.jquery&&!d.isPlainObject(a))d.each(a,function(){f(this.name,this.value)});else for(var g in a)bO(g,a[g],c,f);return e.join("&").replace(bp,"+")}}),d.extend({active:0,lastModified:{},etag:{}});var bR=d.now(),bS=/(\=)\?(&|$)|()\?\?()/i;d.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return d.expando+"_"+bR++}}),d.ajaxPrefilter("json jsonp",function(b,c,e){var f=typeof b.data==="string";if(b.dataTypes[0]===
"jsonp"||c.jsonpCallback||c.jsonp!=null||b.jsonp!==!1&&(bS.test(b.url)||f&&bS.test(b.data))){var g,h=b.jsonpCallback=d.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,i=a[h],j=b.url,k=b.data,l="$1"+h+"$2",m=function(){a[h]=i,g&&d.isFunction(i)&&a[h](g[0])};b.jsonp!==!1&&(j=j.replace(bS,l),b.url===j&&(f&&(k=k.replace(bS,l)),b.data===k&&(j+=(/\?/.test(j)?"&":"?")+b.jsonp+"="+h))),b.url=j,b.data=k,a[h]=function(a){g=[a]},e.then(m,m),b.converters["script json"]=function(){g||d.error(h+" was not called");
return g[0]},b.dataTypes[0]="json";return"script"}}),d.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(a){d.globalEval(a);return a}}}),d.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),d.ajaxTransport("script",function(a){if(a.crossDomain){var d,e=c.head||c.getElementsByTagName("head")[0]||c.documentElement;
return{send:function(f,g){d=c.createElement("script"),d.async="async",a.scriptCharset&&(d.charset=a.scriptCharset),d.src=a.url,d.onload=d.onreadystatechange=function(a,c){if(!d.readyState||/loaded|complete/.test(d.readyState))d.onload=d.onreadystatechange=null,e&&d.parentNode&&e.removeChild(d),d=b,c||g(200,"success")},e.insertBefore(d,e.firstChild)},abort:function(){d&&d.onload(0,1)}}}});var bT=d.now(),bU,bV;d.ajaxSettings.xhr=a.ActiveXObject?function(){return!this.isLocal&&bX()||bY()}:bX,bV=d.ajaxSettings.xhr(),
d.support.ajax=!!bV,d.support.cors=bV&&"withCredentials"in bV,bV=b,d.support.ajax&&d.ajaxTransport(function(a){if(!a.crossDomain||d.support.cors){var c;return{send:function(e,f){var g=a.xhr(),h,i;a.username?g.open(a.type,a.url,a.async,a.username,a.password):g.open(a.type,a.url,a.async);if(a.xhrFields)for(i in a.xhrFields)g[i]=a.xhrFields[i];a.mimeType&&g.overrideMimeType&&g.overrideMimeType(a.mimeType),(!a.crossDomain||a.hasContent)&&!e["X-Requested-With"]&&(e["X-Requested-With"]="XMLHttpRequest");
try{for(i in e)g.setRequestHeader(i,e[i])}catch(j){}g.send(a.hasContent&&a.data||null),c=function(e,i){var j,k,l,m,n;try{if(c&&(i||g.readyState===4)){c=b,h&&(g.onreadystatechange=d.noop,delete bU[h]);if(i)g.readyState!==4&&g.abort();else{j=g.status,l=g.getAllResponseHeaders(),m={},n=g.responseXML,n&&n.documentElement&&(m.xml=n),m.text=g.responseText;try{k=g.statusText}catch(o){k=""}j||!a.isLocal||a.crossDomain?j===1223&&(j=204):j=m.text?200:404}}}catch(p){i||f(-1,p)}m&&f(j,k,m,l)},a.async&&g.readyState!==
4?(bU||(bU={},bW()),h=bT++,g.onreadystatechange=bU[h]=c):c()},abort:function(){c&&c(0,1)}}}});var bZ={},b$=/^(?:toggle|show|hide)$/,b_=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,ca,cb=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]];d.fn.extend({show:function(a,b,c){var e,f;if(a||a===0)return this.animate(cc("show",3),a,b,c);for(var g=0,h=this.length;g<h;g++)e=this[g],f=e.style.display,!d._data(e,"olddisplay")&&
f==="none"&&(f=e.style.display=""),f===""&&d.css(e,"display")==="none"&&d._data(e,"olddisplay",cd(e.nodeName));for(g=0;g<h;g++){e=this[g],f=e.style.display;if(f===""||f==="none")e.style.display=d._data(e,"olddisplay")||""}return this},hide:function(a,b,c){if(a||a===0)return this.animate(cc("hide",3),a,b,c);for(var e=0,f=this.length;e<f;e++){var g=d.css(this[e],"display");g!=="none"&&!d._data(this[e],"olddisplay")&&d._data(this[e],"olddisplay",g)}for(e=0;e<f;e++)this[e].style.display="none";return this},
_toggle:d.fn.toggle,toggle:function(a,b,c){var e=typeof a==="boolean";d.isFunction(a)&&d.isFunction(b)?this._toggle.apply(this,arguments):a==null||e?this.each(function(){var b=e?a:d(this).is(":hidden");d(this)[b?"show":"hide"]()}):this.animate(cc("toggle",3),a,b,c);return this},fadeTo:function(a,b,c,d){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,e){var f=d.speed(b,c,e);if(d.isEmptyObject(a))return this.each(f.complete);return this[f.queue===
!1?"each":"queue"](function(){var b=d.extend({},f),c,e=this.nodeType===1,g=e&&d(this).is(":hidden"),h=this;for(c in a){var i=d.camelCase(c);c!==i&&(a[i]=a[c],delete a[c],c=i);if(a[c]==="hide"&&g||a[c]==="show"&&!g)return b.complete.call(this);if(e&&(c==="height"||c==="width")){b.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY];if(d.css(this,"display")==="inline"&&d.css(this,"float")==="none")if(d.support.inlineBlockNeedsLayout){var j=cd(this.nodeName);j==="inline"?this.style.display=
"inline-block":(this.style.display="inline",this.style.zoom=1)}else this.style.display="inline-block"}d.isArray(a[c])&&((b.specialEasing=b.specialEasing||{})[c]=a[c][1],a[c]=a[c][0])}b.overflow!=null&&(this.style.overflow="hidden"),b.curAnim=d.extend({},a),d.each(a,function(c,e){var f=new d.fx(h,b,c);if(b$.test(e))f[e==="toggle"?g?"show":"hide":e](a);else{var i=b_.exec(e),j=f.cur();if(i){var k=parseFloat(i[2]),l=i[3]||(d.cssNumber[c]?"":"px");l!=="px"&&(d.style(h,c,(k||1)+l),j=(k||1)/f.cur()*j,d.style(h,
c,j+l)),i[1]&&(k=(i[1]==="-="?-1:1)*k+j),f.custom(j,k,l)}else f.custom(j,e,"")}});return!0})},stop:function(a,b){var c=d.timers;a&&this.queue([]),this.each(function(){for(var a=c.length-1;a>=0;a--)c[a].elem===this&&(b&&c[a](!0),c.splice(a,1))}),b||this.dequeue();return this}}),d.each({slideDown:cc("show",1),slideUp:cc("hide",1),slideToggle:cc("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){d.fn[a]=function(a,c,d){return this.animate(b,a,c,
d)}}),d.extend({speed:function(a,b,c){var e=a&&typeof a==="object"?d.extend({},a):{complete:c||!c&&b||d.isFunction(a)&&a,duration:a,easing:c&&b||b&&!d.isFunction(b)&&b};e.duration=d.fx.off?0:typeof e.duration==="number"?e.duration:e.duration in d.fx.speeds?d.fx.speeds[e.duration]:d.fx.speeds._default,e.old=e.complete,e.complete=function(){e.queue!==!1&&d(this).dequeue(),d.isFunction(e.old)&&e.old.call(this)};return e},easing:{linear:function(a,b,c,d){return c+d*a},swing:function(a,b,c,d){return(-Math.cos(a*
Math.PI)/2+0.5)*d+c}},timers:[],fx:function(a,b,c){this.options=b,this.elem=a,this.prop=c,b.orig||(b.orig={})}}),d.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(d.fx.step[this.prop]||d.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null))return this.elem[this.prop];var a,b=d.css(this.elem,this.prop);return isNaN(a=parseFloat(b))?!b||b==="auto"?0:b:a},custom:function(a,b,c){function g(a){return e.step(a)}
var e=this,f=d.fx;this.startTime=d.now(),this.start=a,this.end=b,this.unit=c||this.unit||(d.cssNumber[this.prop]?"":"px"),this.now=this.start,this.pos=this.state=0,g.elem=this.elem,g()&&d.timers.push(g)&&!ca&&(ca=setInterval(f.tick,f.interval))},show:function(){this.options.orig[this.prop]=d.style(this.elem,this.prop),this.options.show=!0,this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur()),d(this.elem).show()},hide:function(){this.options.orig[this.prop]=d.style(this.elem,this.prop),
this.options.hide=!0,this.custom(this.cur(),0)},step:function(a){var b=d.now(),c=!0;if(a||b>=this.options.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),this.options.curAnim[this.prop]=!0;for(var e in this.options.curAnim)this.options.curAnim[e]!==!0&&(c=!1);if(c){if(this.options.overflow!=null&&!d.support.shrinkWrapBlocks){var f=this.elem,g=this.options;d.each(["","X","Y"],function(a,b){f.style["overflow"+b]=g.overflow[a]})}this.options.hide&&d(this.elem).hide();if(this.options.hide||
this.options.show)for(var h in this.options.curAnim)d.style(this.elem,h,this.options.orig[h]);this.options.complete.call(this.elem)}return!1}var i=b-this.startTime;this.state=i/this.options.duration;var j=this.options.specialEasing&&this.options.specialEasing[this.prop],k=this.options.easing||(d.easing.swing?"swing":"linear");this.pos=d.easing[j||k](this.state,i,0,1,this.options.duration),this.now=this.start+(this.end-this.start)*this.pos,this.update();return!0}},d.extend(d.fx,{tick:function(){var a=
d.timers;for(var b=0;b<a.length;b++)a[b]()||a.splice(b--,1);a.length||d.fx.stop()},interval:13,stop:function(){clearInterval(ca),ca=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){d.style(a.elem,"opacity",a.now)},_default:function(a){a.elem.style&&a.elem.style[a.prop]!=null?a.elem.style[a.prop]=(a.prop==="width"||a.prop==="height"?Math.max(0,a.now):a.now)+a.unit:a.elem[a.prop]=a.now}}}),d.expr&&d.expr.filters&&(d.expr.filters.animated=function(a){return d.grep(d.timers,function(b){return a===
b.elem}).length});var ce=/^t(?:able|d|h)$/i,cf=/^(?:body|html)$/i;"getBoundingClientRect"in c.documentElement?d.fn.offset=function(a){var b=this[0],c;if(a)return this.each(function(b){d.offset.setOffset(this,a,b)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return d.offset.bodyOffset(b);try{c=b.getBoundingClientRect()}catch(e){}var f=b.ownerDocument,g=f.documentElement;if(!c||!d.contains(g,b))return c?{top:c.top,left:c.left}:{top:0,left:0};var h=f.body,i=cg(f),j=g.clientTop||
h.clientTop||0,k=g.clientLeft||h.clientLeft||0,l=i.pageYOffset||d.support.boxModel&&g.scrollTop||h.scrollTop,m=i.pageXOffset||d.support.boxModel&&g.scrollLeft||h.scrollLeft,n=c.top+l-j,o=c.left+m-k;return{top:n,left:o}}:d.fn.offset=function(a){var b=this[0];if(a)return this.each(function(b){d.offset.setOffset(this,a,b)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return d.offset.bodyOffset(b);d.offset.initialize();var c,e=b.offsetParent,f=b,g=b.ownerDocument,h=g.documentElement,
i=g.body,j=g.defaultView,k=j?j.getComputedStyle(b,null):b.currentStyle,l=b.offsetTop,m=b.offsetLeft;while((b=b.parentNode)&&b!==i&&b!==h){if(d.offset.supportsFixedPosition&&k.position==="fixed")break;c=j?j.getComputedStyle(b,null):b.currentStyle,l-=b.scrollTop,m-=b.scrollLeft,b===e&&(l+=b.offsetTop,m+=b.offsetLeft,d.offset.doesNotAddBorder&&(!d.offset.doesAddBorderForTableAndCells||!ce.test(b.nodeName))&&(l+=parseFloat(c.borderTopWidth)||0,m+=parseFloat(c.borderLeftWidth)||0),f=e,e=b.offsetParent),
d.offset.subtractsBorderForOverflowNotVisible&&c.overflow!=="visible"&&(l+=parseFloat(c.borderTopWidth)||0,m+=parseFloat(c.borderLeftWidth)||0),k=c}if(k.position==="relative"||k.position==="static")l+=i.offsetTop,m+=i.offsetLeft;d.offset.supportsFixedPosition&&k.position==="fixed"&&(l+=Math.max(h.scrollTop,i.scrollTop),m+=Math.max(h.scrollLeft,i.scrollLeft));return{top:l,left:m}},d.offset={initialize:function(){var a=c.body,b=c.createElement("div"),e,f,g,h,i=parseFloat(d.css(a,"marginTop"))||0,j=
"<div style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;'><div></div></div><table style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;' cellpadding='0' cellspacing='0'><tr><td></td></tr></table>";d.extend(b.style,{position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",height:"1px",visibility:"hidden"}),b.innerHTML=j,a.insertBefore(b,a.firstChild),e=b.firstChild,f=e.firstChild,h=e.nextSibling.firstChild.firstChild,
this.doesNotAddBorder=f.offsetTop!==5,this.doesAddBorderForTableAndCells=h.offsetTop===5,f.style.position="fixed",f.style.top="20px",this.supportsFixedPosition=f.offsetTop===20||f.offsetTop===15,f.style.position=f.style.top="",e.style.overflow="hidden",e.style.position="relative",this.subtractsBorderForOverflowNotVisible=f.offsetTop===-5,this.doesNotIncludeMarginInBodyOffset=a.offsetTop!==i,a.removeChild(b),a=b=e=f=g=h=null,d.offset.initialize=d.noop},bodyOffset:function(a){var b=a.offsetTop,c=a.offsetLeft;
d.offset.initialize(),d.offset.doesNotIncludeMarginInBodyOffset&&(b+=parseFloat(d.css(a,"marginTop"))||0,c+=parseFloat(d.css(a,"marginLeft"))||0);return{top:b,left:c}},setOffset:function(a,b,c){var e=d.css(a,"position");e==="static"&&(a.style.position="relative");var f=d(a),g=f.offset(),h=d.css(a,"top"),i=d.css(a,"left"),j=e==="absolute"&&d.inArray("auto",[h,i])>-1,k={},l={},m,n;j&&(l=f.position()),m=j?l.top:parseInt(h,10)||0,n=j?l.left:parseInt(i,10)||0,d.isFunction(b)&&(b=b.call(a,c,g)),b.top!=
null&&(k.top=b.top-g.top+m),b.left!=null&&(k.left=b.left-g.left+n),"using"in b?b.using.call(a,k):f.css(k)}},d.fn.extend({position:function(){if(!this[0])return null;var a=this[0],b=this.offsetParent(),c=this.offset(),e=cf.test(b[0].nodeName)?{top:0,left:0}:b.offset();c.top-=parseFloat(d.css(a,"marginTop"))||0,c.left-=parseFloat(d.css(a,"marginLeft"))||0,e.top+=parseFloat(d.css(b[0],"borderTopWidth"))||0,e.left+=parseFloat(d.css(b[0],"borderLeftWidth"))||0;return{top:c.top-e.top,left:c.left-e.left}},
offsetParent:function(){return this.map(function(){var a=this.offsetParent||c.body;while(a&&!cf.test(a.nodeName)&&d.css(a,"position")==="static")a=a.offsetParent;return a})}}),d.each(["Left","Top"],function(a,c){var e="scroll"+c;d.fn[e]=function(c){var f=this[0],g;if(!f)return null;if(c!==b)return this.each(function(){g=cg(this),g?g.scrollTo(a?d(g).scrollLeft():c,a?c:d(g).scrollTop()):this[e]=c});g=cg(f);return g?"pageXOffset"in g?g[a?"pageYOffset":"pageXOffset"]:d.support.boxModel&&g.document.documentElement[e]||
g.document.body[e]:f[e]}}),d.each(["Height","Width"],function(a,c){var e=c.toLowerCase();d.fn["inner"+c]=function(){return this[0]?parseFloat(d.css(this[0],e,"padding")):null},d.fn["outer"+c]=function(a){return this[0]?parseFloat(d.css(this[0],e,a?"margin":"border")):null},d.fn[e]=function(a){var f=this[0];if(!f)return a==null?null:this;if(d.isFunction(a))return this.each(function(b){var c=d(this);c[e](a.call(this,b,c[e]()))});if(d.isWindow(f)){var g=f.document.documentElement["client"+c];return f.document.compatMode===
"CSS1Compat"&&g||f.document.body["client"+c]||g}if(f.nodeType===9)return Math.max(f.documentElement["client"+c],f.body["scroll"+c],f.documentElement["scroll"+c],f.body["offset"+c],f.documentElement["offset"+c]);if(a===b){var h=d.css(f,e),i=parseFloat(h);return d.isNaN(i)?h:i}return this.css(e,typeof a==="string"?a:a+"px")}}),a.jQuery=a.$=d})(window);
(function(undef){var rl=/^\s+/,rs=/\S/;jQuery.trim=function(str){if(str===undef||str===null)return"";str=(str+"").replace(rl,"");for(var i=str.length-1;i>=0;i--)if(rs.test(str.charAt(i))){str=str.substring(0,i+1);break}return str}})();var RubaXa={},jsCore={version:3,build:window.jsBuild},returnTrue=function(){return true},returnFalse=function(){return false},_array_=Array.prototype,_join_=_array_.join,_slice_=_array_.slice;window.$R=function(files,fn){jQuery(function(){jsLoader.require(files,fn)})};
(function(_slice,_fn){if(!_fn.bind)_fn.bind=function(T){var a=_slice.call(arguments,1),S=this;return function(){return S.apply(T,a.concat(_slice.call(arguments)))}}})(Array.prototype.slice,Function.prototype);var undef,undefined,defined=function(val,def){return typeof def=="undefined"?typeof val!="undefined":typeof val=="undefined"?def:val};
var jsCore={F:function(a){return a},random:Math.random(),time:+new Date,version:2,local:!!window.IS_LOCAL,loaded:false,disabled:false,build:jsCore.build,currentId:0,unloadConfirm:0,_wList:{},emailRegExp:/^.+@.+\..{2,4}$/i,saveMode:false,getHEAD:function(){return document.head||document.getElementsByTagName("HTML")[0].firstChild},getNextId:function(){return jsCore.getCounter()},getCounter:function(){return jsCore.currentId++},getUniqId:function(o){return o?o.uniqId?o.uniqId:o.uniqId=this.getUniqId():
this.time+this.getCounter()},getTimer:function(){return(new Date).getTime()-this.time},$:function(id){var r=typeof id=="string"?document.getElementById(id.replace(/^#/,"")):id&&id.jquery?id[0]:id;return jsCore.saveMode&&(r===null||r===undefined)?{}:r},crc32:function(str,c){var x=0,y=0,crc=0^-1,table="00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D";
for(var i=0,iTop=str.length;i<iTop;i++){y=(crc^str.charCodeAt(i))&255;x="0x"+table.substr(y*9,8);crc=crc>>>8^x}return crc^-1+""},each:function(o,fn,a){if(o)if(o.constructor==Array||a)for(var i=0,n=o.length;i<n;i+=1)fn(i,o[i],o);else for(var i in o)fn(i,o[i],o)},extend:function(d,s){var v,i=1,n=arguments.length,p,a;for(;i<n;i++)if(a=arguments[i])for(p in a)if((v=a[p])!=null&&typeof v!="undefined")d[p]=v;v=a=null;return d},cloneObject:function(o){var c={};for(var k in o)c[k]=o[k];return c},elm:function(e,
a,v){if(e){if(e.jquery)e=e[0];if(e.target||e.srcElement)e=e.target||e.srcElement;if(!a||e==document.body||!e)return e;var _a,_v,_r=v&&v.test;do{_v=typeof v!="undefined";_a=e[a]||"getAttribute"in e&&e.getAttribute(a)||"";if(_v&&(_a==v||_a==v||_r&&v.test(_a))||!_v&&_a!==""&&_a!==null)return e}while(e&&(e=e.parentNode)&&e!==document.body)}return false},wait:function(w,c){if(!c||c.constructor!=Function)throw new Error("Second argument must be function in jsCore.wait or jsCore.require");if(typeof w=="string")w=
w.split(",");var w=Array.filter(w,function(v){if(!this._wList[v=v.toLowerCase()])this._wList[v]={r:0,l:[]};return!this._wList[v].r},this),i=0,_i=0,_c=w.length,n,p,wc;if(!_c){c();return}else wc=function(o){if(++_i>=_c)c(o)};for(;w[i];i++){p=w[i].split(":");n=w[i].toLowerCase();this._wList[n].l.push(wc);if(p[0]=="file"||p[0]=="include"||p[0]=="require")jsLoader.require(p[1],wc)}},notify:function(w,o){if(typeof w=="string")w=w.split(",");var j=0,p,n,j=w.length,_wList=this._wList;while(j--){p=w[j].split(":");
n=w[j].toLowerCase();if(!(n in _wList))_wList[n]={r:false,l:[]};if(p[0]!="event")_wList[n].r=true;if(_wList[n].l)for(var i=0,ni=this._wList[n].l.length;i<ni;i++)_wList[n].l[i](o)}},namespace:function(name){name=name.split(".");var o=window,i=0,n=name.length;for(i=0;i<n;i++){if(o[name[i]]===undef)o[name[i]]={};o=o[name[i]]}return o}};
(function(){var numberChars="0123456789",lowerChars="abcdefghijklmnopqrstuvwxyz",upperChars="ABCDEFGHIJKLMNOPQRSTUVWXYZ",otherChars="`~!@#$%^&*()-_=+[{]}\\|;:'\",<.>/? ";function getRandomNum(lbound,ubound){return Math.floor(Math.random()*(ubound-lbound))+lbound}function getRandomChar(number,lower,upper,other){var charSet="";if(number)charSet+=numberChars;if(lower)charSet+=lowerChars;if(upper)charSet+=upperChars;if(other)charSet+=otherChars;return charSet.charAt(getRandomNum(0,charSet.length))}jsCore.getRandomHash=
function(length,number,lower,upper,other){for(var l=0,s="";l<length;++l)s+=getRandomChar(number,lower,upper,other);return s}})();var $onClick=function(Node,save){Node=jsCore.$(Node);var value=Node.onclick&&Node.onclick();if(!save&&Node.removeAttribute){Node.onclick=null;Node.removeAttribute("onclick")}return value};jsCore.uniqId=jsCore.getUniqId();Object.extend=jsCore.extend;Object.clone=jsCore.cloneObject;
Object.forEach=function(object,callback,context){if(typeof callback!=="function")throw new TypeError(callback+" is not a function");var __own__=Object.prototype.hasOwnProperty,key;if(object)for(key in object)if(__own__.call(object,key))if(callback.call(context,object[key],key,object)===false)break};
var jsClass={classes:{},__m:{},methods:{},dependence:{},instance:{},collector:[],create:function(n,singleton){var classUniqId=jsCore.getUniqId();var NewClass=function(){var self=this.constructor;if(singleton&&self.instance!==undef)return self.instance;this.uniqId=jsCore.getUniqId();this.uniqName=(n||"").substr(7);this.parentClassUniqId=0;if(this.__construct)this.__construct.apply(this,arguments);if(singleton)self.instance=this};jsCore.each(jsClass.Base,function(k,m){if(k!="prototype")NewClass[k]=
m});NewClass.uniqName=n;NewClass.classUniqId=NewClass.prototype.classUniqId=classUniqId;jsClass.classes[classUniqId]=NewClass;jsClass.__m[classUniqId]={};jsClass.methods[classUniqId]={};jsClass.dependence[classUniqId]=[];NewClass.extend(jsClass.Base);NewClass.prototype.inherit=function(K,m,args){return K.prototype[m].apply(this,args)};NewClass.prototype.constructor=NewClass;NewClass.prototype.parent=jsClass.Base.prototype.parent;if(n){n="window."+n;jsCore.namespace(n.substr(0,n.lastIndexOf(".")))[n.substr(n.lastIndexOf(".")+
1)]=jsClass.classes[classUniqId]}return jsClass.classes[classUniqId]},inherit:function(F,T,m){return F.prototype[m].apply(T,_slice_.call(arguments,3)||[])},destroy:function(){while(this.collector.length)try{this.collector.shift()()}catch(e){}this.collector=null}};jsClass.Base=function(){};jsClass.Base.classUniqId=jsCore.getUniqId();
jsClass.Base.prototype={parent:function(name){var i=--jsClass.__m[this.classUniqId][name],r=jsClass.classes[jsClass.methods[this.classUniqId][name][i<0?jsClass.methods[this.classUniqId][name].length-1:i]].prototype[name].apply(this,_slice_.call(arguments,1));jsClass.__m[this.classUniqId][name]++;return r},callMethod:function(n){if(typeof this[n]!="undefined")return this[n].apply(this,_slice_.call(arguments,1))},destroy:function(){}};
Object.extend(jsClass.Base,{getInstance:function(){if(!jsClass.instance[this.classUniqId])jsClass.instance[this.classUniqId]=new this;return jsClass.instance[this.classUniqId]},extend:function(E){var c=0,cId,eK,eP,P=this.prototype;for(;eK=arguments[c];c++){cId=eK.classUniqId;eP=eK.prototype;for(var m in eP)if(m!="classUniqId"&&m!="uniqId"&&m!="parent"&&m!="inherit"&&m!="constructor"){P[m]=eP[m];if(!jsClass.methods[this.classUniqId][m]||jsClass.methods[this.classUniqId][m].constructor!=Array)jsClass.methods[this.classUniqId][m]=
[];if(jsClass.methods[cId]&&jsClass.methods[cId][m])jsClass.methods[this.classUniqId][m]=Array.uniq(jsClass.methods[this.classUniqId][m].concat(jsClass.methods[cId][m]));if(Array.indexOf(jsClass.methods[this.classUniqId][m],cId)==-1)jsClass.methods[this.classUniqId][m].push(cId);jsClass.__m[this.classUniqId][m]=jsClass.methods[this.classUniqId][m].length}this.Super=eP;P.parentClassUniqId=cId}return this},statics:function(m){Object.extend(this,m);return this},methods:function(m){Object.extend(this.prototype,
m.constructor===Object?m:m(this));return this}});var jsCEvents={pool:{},name:function(n){return"on"+n.substr(0,1).toUpperCase()+n.substr(1)}};
jsClass.Base.methods({addEventListener:function(n,h){n=n.toLowerCase();if(!this.__ce_uniqId)this.__ce_uniqId=jsCore.getUniqId();if(!jsCEvents.pool[this.__ce_uniqId])jsCEvents.pool[this.__ce_uniqId]={};if(!jsCEvents.pool[this.__ce_uniqId][n])jsCEvents.pool[this.__ce_uniqId][n]=[];jsCEvents.pool[this.__ce_uniqId][n].push(h);return this},removeEventListener:function(n,h){n=n.toLowerCase();if(jsCEvents.pool[this.__ce_uniqId]&&jsCEvents.pool[this.__ce_uniqId][n])jsCEvents.pool[this.__ce_uniqId][n]=Array.remove(jsCEvents.pool[this.__ce_uniqId][n],
h,1);return this},dispatchEvent:function(n){var r=1,pN=jsCEvents.name(n),a;if(this[pN]&&this[pN].apply(this,a=_slice_.call(arguments,1))===false)r=0;else if(this.__ce_uniqId&&jsCEvents.pool[this.__ce_uniqId][n=n.toLowerCase()]){var i=0,h=jsCEvents.pool[this.__ce_uniqId][n],il=h.length,a=a||_slice_.call(arguments,1);try{for(;i<il;i++)if(h[i]&&h[i].apply(this,a)===false)r=0}catch(e){h[i]=null;debug.log("CE->dispatchEvent:",pN,a,e)}}return!!r}});
(function(window,document){var _aliases=window.jsCoreAlias||{},_filesAliases=window.jsLoaderFiles||{},_exists={},_listeners={},_loadedData={},isLocal=patron.IsWinDev;function _getFilename(name){var filename=_filesAliases[name];if(isLocal&&typeof filename==="string"&&filename.indexOf("{patron.build}")!=-1)filename=void 0;if(filename===void 0)filename=name;if(filename.indexOf("{")!=-1){name=filename.match(/\{(.+)\}(.+)/);if(name)filename=(_aliases[name[1]]||_aliases["common"]+name[1]+"/")+name[2]}return filename+
(filename.indexOf(".js")==-1?".js":"")}function _load(name,callback){if(name&&_loadedData[name]===void 0){if(_listeners[name]===void 0)_listeners[name]=[];_listeners[name].push(callback);var filename=_getFilename(name);if(!_exists[filename]){_exists[filename]=true;window.jsLoader.loadFile(filename)}}else callback()}function _getLoadedData(names){var i=names.length;names=names.slice();while(i--)names[i]=_loadedData[names[i]];return names}function _error(name,args){debug.log("jsLoader.onError:",name,
args);if(window.jsLoader.onError)window.jsLoader.onError(name,args);if(name.indexOf("xhr-")!=-1){patron.radar("XHRLoader_"+args[0],name.substr(4)+"=1");patron.gstat("XHRLoader",{attempt:args[0],status:args[1].status,filename:args[2],error:args[3]+""})}}window.jsLoader={_exists:_exists,_listeners:_listeners,_loadedData:_loadedData,use:function(names,callback){if(typeof names==="string")names=names.trim().split(/,\s*/);callback&&callback.apply(window,_getLoadedData(names))},require:function(names,callback){if(typeof names===
"string")names=names.trim().split(/,\s*/);var i=names.length,remain=i,progressFn=function(){if(--remain===0)try{patron.restoreJquery();callback&&callback.apply(window,_getLoadedData(names))}catch(err){_error("require-callback",[names,err])}};try{if(remain==0){remain=1;progressFn()}while(i--)_load(names[i],progressFn)}catch(err){_error("_load",err)}},loadFile:function(filename){if(patron.UseXHRLoader){var ts=new Date,attempt=0;(function _load(filename,remainAttempts,bust){attempt++;var xhr=jQuery.ajax(filename+
(bust?"?bust="+Math.random():""),{method:"get",timeout:5E3,dataType:"text",complete:function(){var source=xhr.responseText;patron.radar("XHRLoader_"+attempt,xhr.status+"=1"+(filename.indexOf("build")?"&"+filename.split("/").pop()+"="+(new Date-ts):""));if(source)try{(new Function(source))();return}catch(err){_error("xhr-eval",[attempt,xhr,filename,err])}else _error("xhr-empty",[attempt,xhr,filename]);if(remainAttempts){_load(filename,--remainAttempts,true);_error("xhr-retry",[attempt,xhr,filename])}else _error("xhr-retry-fail",
[attempt,xhr,filename])}})})(filename,patron.XHRLoaderAttempts,isLocal)}else{var head=document.head||document.getElementsByTagName("head")[0],script=document.createElement("script");script.src=filename+(IS_LOCAL?"?bust="+Math.random():"");script.async=true;head.insertBefore(script,head.firstChild);head=script=null}},loaded:function(name,data){if(_loadedData[name]!==void 0)_error("duplicate-loaded",name);else{var callbacks=_listeners[name]||[],i=callbacks.length;patron.restoreJquery();_listeners[name]=
null;_loadedData[name]=data||{};while(i--)callbacks[i]();jsCore.notify(name)}},getLoadedData:function(name){return _loadedData[name]},getQueue:function(){var list=[],key;for(key in _listeners)if(_listeners[key]!==null)list.push(key);return list}}})(window,document);window.require=function(deps,callback){if(typeof deps==="string"&&callback===void 0)return jsLoader.getLoadedData(deps);else jsLoader.require(deps,callback)};
window.define=function(name,deps,fn){var R_REQUIRE=/\brequire\(["']([^'"]+)["']\)/g;var R_COMMENT=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg;function _convert(str){return str.charAt(0)=="{"?str:str.replace(/^([^/]+)\/(.+)$/,"{$1}$2")}if(deps[0]=="require"){deps=[];var code=fn.toString().replace(R_COMMENT,""),matches;while(matches=R_REQUIRE.exec(code))deps.push(matches[1]);fn=fn.bind(null,require)}if(typeof fn==="undefined"){fn=deps;if(name instanceof Array){deps=name;name=null}else deps=[]}deps=Array.map(deps,
_convert);name=_convert(name);var success=function(){success=function(){ajs.log("error:",name,deps,fn)};var data=fn.apply(this,arguments);if(name)jsLoader.loaded(name,data)};if(deps.length)jsLoader.require(deps,success);else success()};
var jsCookie={DAY:86400,WEEK:86400*7,MONTH:86400*30,YEAR:86400*365,set:function(k,v,e,p){if(!v)v=0;if(typeof e!="undefined"&&e!==true)e="expires="+(new Date((new Date).getTime()+e*1E3)).toGMTString()+";";else e="";this.remove(k);document.cookie=k+"="+v+"; path="+(p||"/")+"; "+e;return this},get:function(k,d){if(!k)return document.cookie;var re=new RegExp(k+"="),c=jsCookie.get().split(/;\s+/);for(var i=c.length;i--;)if(re.test(c[i]))return c[i].split("=")[1];return d},has:function(k){var v=this.get(k);
return v&&!(v=="false"||v=="null"||v=="")},remove:function(k){var e=(new Date(1)).toGMTString();document.cookie=k+"=null; expires="+e;document.cookie=k+"=null; path=/; expires="+e;return this}};
(function(win,debug,enabled){try{if(/debug/.test(location)){enabled=!/debug=n/.test(location);if(win.localStorage)localStorage.setItem("ajs.debug",+enabled)}if(!enabled&&win.localStorage)enabled=localStorage.getItem("ajs.debug")==1}catch(er){}var _join=[].join,_console=enabled&&(win.console||win.opera),msie=_console&&typeof _console.log=="object";jsCore.debugMode=enabled;jsCore.each("log,info,warn,error,dir,assert,profile,profileEnd,clear,group,groupEnd,groupCollapsed".split(","),function(i,method){if(_console)if(_console[method])debug[method]=
msie?Function.prototype.call.bind(_console[method],_console):function(){_console[method].apply(_console,arguments)};else if(method=="log")if(_console.postError)debug.log=function(){_console.postError(_join.call(arguments," "))};else debug.log=jsCore.F;else debug[method]=function(){debug.log.apply(ajs,arguments)};else debug[method]=jsCore.F})})(window,window.debug={},jsCore.local||window.CONSOLE_ON);
var jsEvent={invert:{focus:"blur",keydown:"keyup",mouseover:"mouseout",mouseenter:"mouseleave"},Key:{"up":38,"down":40,"left":37,"right":39,"esc":27,"home":36,"end":35,"pageup":33,"pagedown":34,"ins":45,"del":46,"insert":45,"delete":46,"back":8,"backspace":8,"space":32,"bar":32,"spacebar":32,"enter":13,"cmd":224,"pause":19,"break":3,"alt":18,"ctrl":17,"shift":16,"tab":9,"caps":20,"capslock":20,"plus":107,"minus":109,isControl:function(c){return c<47}},Mouse:{isLeft:function(e){return e.which<2},isMiddle:function(e){return e.which==
2},isRight:function(e){return e.which>2}}};Object.forEach(jsEvent.invert,function(v,k){jsEvent.invert[v]=k});Object.extend(Math,{KB:1024,MB:Math.pow(1024,2),GB:Math.pow(1024,3),TB:Math.pow(1024,4),rand:function(min,max){if(min!==undefined)return max!==undefined?min+Math.round(Math.random()*(max-min)):Math.round(Math.random()*min);return Math.random()}});jQuery(function(){jsCore.notify("jsCore:ready,jsCore:loaded,document:loaded".split(","))});
jsCore.each({"ajs":ajs,"{toolkit.common}ajs/ajs":ajs,"{toolkit.common}ajs/__array/ajs__array":Array,"{toolkit.common}ajs/__string/ajs__string":String,"{jquery}jquery":jQuery,"{jQuery}jquery":jQuery,"{jsCore}jsCore":jsCore,"{toolkit.common}ajs/__ui__operands/ajs__ui__operands":ajs.ui.operands},function(key,obj){this.loaded(key,obj)}.bind(jsLoader));if(!Object.isObject)Object.isObject=function(object){return Object.prototype.toString.call(object)==="[object Object]"};
(function(jQuery){var $=jQuery;if(!this.JSON)this.JSON={};(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=
new RegExp("[\x00\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]","g");var escapable=new RegExp('[\\"\x00-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]',"g");var gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=
meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function")value=value.toJSON(key);if(typeof rep==="function")value=rep.call(holder,key,value);switch(typeof value){case "string":return quote(value);case "number":return isFinite(value)?String(value):"null";case "boolean":case "null":return String(value);
case "object":if(!value)return"null";gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1)partial[i]=str(i,value)||"null";v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v)partial.push(quote(k)+(gap?": ":":")+v)}}}else for(k in value)if(Object.hasOwnProperty.call(value,
k)){v=str(k,value);if(v)partial.push(quote(k)+(gap?": ":":")+v)}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function")JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number")for(i=0;i<space;i+=1)indent+=" ";else if(typeof space==="string")indent=space;rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!==
"number"))throw new Error("JSON.stringify");return str("",{"":value})};if(typeof JSON.parse!=="function")JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object")for(k in value)if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined)value[k]=v;else delete value[k]}return reviver.call(holder,key,value)}cx.lastIndex=0;if(cx.test(text))text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)});
try{j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}catch(er){}throw new SyntaxError("JSON.parse");}})();jsLoader.loaded("{jsCore}JSON");jsLoader.use(["{jsCore}JSON","{toolkit.common}ajs/__string/ajs__string"],function(){window.Lang={data:{},vars:{},locals:[],def:"",path:"",init:function(){this.setLocal(window["LANG_DEFAULT"]||"RU");return this},setDataPath:function(p){this.path=p},addLocal:function(l,nl){if(typeof l=="string")l=l.split(",");for(var i=0;i<l.length;i++)if(!this.data[l[i]=
l[i].toUpperCase()]){this.locals.push(l[i]);this.data[l[i]]={}}if(nl=defined(nl,true))this.load(false,nl.constructor===Function?nl:0);return this},setLocal:function(l){this.def=l.toUpperCase();this.addLocal(l);return this},load:function(v,s){if(v){if(typeof v=="string")v=v.split(",");for(var i=0,n=v.length;i<n;i++)if(!this.vars[v[i]])this.vars[v[i]]=1}var r=0,w="";for(var v in this.vars)for(var j=0,nl=this.locals.length;j<nl;j++)if(!this.data[this.locals[j]][v]){this.data[this.locals[j]][v]=1;if(!r)r=
{};if(!r[this.locals[j]])r[this.locals[j]]=[];r[this.locals[j]].push(v)}if(0&&r);else if(s)s()},add:function(d){var n=[];for(var l in d)for(var v in d[l]){this.data[l][v]=d[l][v];n.push("lang:"+l+"-"+v)}jsCore.notify(n);return this},get:function(v,l){if(v.indexOf("/")>-1){v=v.split("/");l=v[0];v=v[1]}return defined(this.data[l||this.def][v],{})},str:function(key,def){var val=Lang.data[Lang.def][key];return typeof val==="undefined"?typeof def==="undefined"?"":Lang.str(def):val+""},fileSize:function(s,
L){var x=Math.floor(Math.log(s||1)/Math.log(1024));return L?String.num(Math.round(s/Math.pow(1024,x)),L[x]," "):x}}.init();jsLoader.loaded("{utils}Lang")});jsLoader.use(["{toolkit.common}ajs/__string/ajs__string","{utils}Lang"],function(){Object.extend(Date,{is:function(d){if(d)return d.setTime||/(^\d+$|^((\d{1,4}[-:\s\/]?)+)$)/.test(d+"");return!1},_timer:(new Date).getTime(),timeZone:window.timeZone||window.TIMEZONE||4,getTime:function(){return this.changeNow().getNow().getTime()},getUnixtime:function(){return Math.round(this.getTime()/
1E3)},setNow:function(time){this._now_=new Date(time);this._today_=new Date(time);this._yesterday_=new Date(time);this._today_.setHours(0);this._today_.setMinutes(0);this._yesterday_.setTime(this._today_.getTime());this._yesterday_.setDate(this._yesterday_.getDate()-1);return this},getNow:function(){return this.changeNow()._now_},changeNow:function(){var n=Date.now();Date.setNow(Date._now_.getTime()+(n-Date._timer));Date._timer=n;return this},_f:function(n){return n>9?n:"0"+n},_parse:Date.parse,parse:function(s){if(s&&
s.setTime)return s;try{var D=/^\d+$/.test(s)?new Date(s):Date._parse(s);if(D.constructor!=Date)D=new Date(String(s).replace(/^(\d{4})-(\d{2})-(\d{2})/,"$2/$3/$1"))}catch(e){debug.log("Date",e)}return D}});if(!Date.now)Date.now=function(){return(new Date).getTime()};Object.extend(Date.prototype,{timeZone:Date.timeZone,getLocalToday:function(){var date=new Date;date.setHours(0);date.setMinutes(0);date.setSeconds(0);return date},getLocalYesterday:function(){var date=this.getLocalToday();date.setDate(date.getDate()-
1);return date},isNow:function(interval){Date.changeNow();return Date._now_.getTime()-this.getTime()<=interval},isToday:function(){return this.toDateString()===this.getLocalToday().toDateString()},isYesterday:function(){return this.toDateString()===this.getLocalYesterday().toDateString()},isThisYear:function(){return this.getFullYear()===this.getLocalToday().getFullYear()},setTimeZone:function(z){this.timeZone=z*1;return this},format:function(f){var t=this.getTime(),r="",f=f.split("");for(var i=0,
n=f.length;i<n;i++)switch(f[i]){case "Y":r+=this.getFullYear();break;case "y":r+=Date._f(this.getFullYear()%100);break;case "N":r+=String.ucfirst(Lang.get("Date").months[1][this.getMonth()]);break;case "n":r+=Lang.get("Date").months[1][this.getMonth()];break;case "M":r+=Date._f(this.getMonth()+1);break;case "m":r+=this.getMonth()+1;break;case "D":r+=Date._f(this.getDate());break;case "d":r+=this.getDate();break;case "H":r+=Date._f(this.getHours());break;case "h":r+=this.getHours();break;case "I":r+=
Date._f(this.getMinutes());break;case "i":r+=this.getMinutes();break;case "S":r+=Date._f(this.getSeconds());break;case "s":r+=this.getSeconds();break;default:r+=f[i];break}this.setTime(t);return r},getLocaleDateShort:function(){var str="";if(this.isToday())str=this.getLocaleTime();else if(this.isThisYear())str=this.getLocaleShortDayMonth();else str=this.getLocaleShortDayMonthYear();return str},getLocaleDateFull:function(){var str="";if(this.isToday())str=this.getLocaleTodayTime();else if(this.isYesterday())str=
this.getLocaleYesterdayTime();else if(this.isThisYear())str=this.getLocaleDayMonthTime();else str=this.getLocaleDayMonthYearTime();return str},getLocaleFullDate:function(){var day=String.ucfirst(Lang.get("Date").weekdays_full[this.getDay()]);var timezoneOffset=-this.getTimezoneOffset(),gmtStr="";if(timezoneOffset>0)gmtStr+="+";else if(timezoneOffset<0)gmtStr+="-";gmtStr+=Date._f(timezoneOffset/60)+":"+Date._f(timezoneOffset%60);if(patron.LANG=="en_US")return this.format("n d, Y")+" "+this.getLocaleTime();
return this.format("d n Y")+", "+this.getLocaleTime()},getLocaleTodayTime:function(){return String.ucfirst(Lang.get("Date").today)+", "+this.getLocaleTime()},getLocaleYesterdayTime:function(){return String.ucfirst(Lang.get("Date").yesterday)+", "+this.getLocaleTime()},getLocaleDayMonthTime:function(){if(patron.LANG=="en_US")return this.format("N d")+", "+this.getLocaleTime();return this.format("d n")+", "+this.getLocaleTime()},getLocaleDayMonthYearTime:function(){if(patron.LANG=="en_US")return this.format("N d, Y")+
" "+this.getLocaleTime();return this.format("d n Y")+", "+this.getLocaleTime()},getLocaleTime:function(){if(patron.LANG=="en_US")return(this.getHours()%12||12)+":"+this.format("I")+" "+(this.getHours()<12?"AM":"PM");return this.format("h:I")},getLocaleShortDayMonth:function(){var month=Lang.get("Date").months[2][this.getMonth()];if(patron.LANG=="en_US")return month+" "+this.format("d");return this.format("d")+" "+month},getLocaleShortDayMonthYear:function(){if(patron.LANG=="en_US")return this.format("M/D/y");
return this.format("D.M.y")},diffYears:function(Y,M,D){if(isNaN(Y)){Y=Date.parse(Y);D=Y.getDate();M=Y.getMonth()+1;Y=Y.getFullYear()}var cM=this.getMonth()+1;Y=this.getFullYear()-Y;if(M>cM||D>this.getDate()&&M==cM)Y--;return Y}});Date.setNow(window.time||window.TIME||Date.now());setInterval(function(){Date.changeNow()},6E4);if(!Date.prototype.toISOString)(function(){function pad(number){return number<10?"0"+number:number}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+pad(this.getUTCMonth()+
1)+"-"+pad(this.getUTCDate())+"T"+pad(this.getUTCHours())+":"+pad(this.getUTCMinutes())+":"+pad(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1E3).toFixed(3)).slice(2,5)+"Z"}})();jsLoader.loaded("{jsCore}Date")});(function(global,_document,jsCore){var _toString=Object.prototype.toString,_Func=Function.prototype,isCSS1=_document.compatMode==="CSS1Compat",docEl=_document.documentElement,ajs=jsCore.extend(global["ajs"]||{},{F:jsCore.F,Event:jsEvent,Mouse:jsEvent.Mouse,now:function(){return+new Date},
uniqId:function(){return jsCore.getUniqId.apply(jsCore,arguments)},wait:function(){jsCore.wait.apply(jsCore,arguments)},notify:function(){jsCore.notify.apply(jsCore,arguments)},extend:jsCore.extend,clone:function _clone(obj){var res={},key,val;for(key in obj)if(obj.hasOwnProperty(key)){val=obj[key];res[key]=val!==null&&typeof val==="object"?_clone(val):val}return res},encode:function(s){return encodeURIComponent(s)},retFalse:function(){return false},retTrue:function(){return true},isset:defined,unset:function(obj,
key){obj[key]=void 0;return delete obj[key]},css:function(node,css){node&&ajs.extend(node.style||{},css)},map:Array.map,each:function(o,I,a){if(o)if(o.constructor===Array||a===true||a===1)for(var i=0,n=o.length;i<n;i++)I.call(a,o[i],i,o);else for(var i in o)I.call(a,o[i],i,o)},filter:Array.filter,remove:Array.remove,indexOf:Array.indexOf,require:function(){jsLoader["require"].apply(jsLoader,arguments)},loaded:function(){jsLoader["loaded"].apply(jsLoader,arguments)},log:debug.log,plural:function(num,
lang,glue){if(typeof lang=="string")lang=Lang.get(lang);return String.num(num,lang,glue)},htmlEncode:function(str){return ajs.Html.escape(str)},toObject:String.toObject,toQuery:String.toQuery,createClass:function(name,Ext,methods){var NewClass;if(ajs.isObject(name)||ajs.isFunction(name))if(!name.classUniqId&&(name.statics||name.methods))NewClass=jsClass.create(name.name,name);else if(ajs.isFunction(name)||Array.isArray(name))NewClass=jsClass.create().extend(name).methods(Ext);else NewClass=jsClass.create().methods(name);
else{NewClass=Array.isArray(name)?jsClass.create(name[0],name[1]):jsClass.create(name);if(methods)NewClass.extend.apply(NewClass,Ext).methods(methods);else if(Ext)NewClass.methods(Ext)}return NewClass},stacktrace:function(){var halt,stack=[];try{halt()}catch(error){ajs.each(error.stack.split("\n").slice(2),function(row,i){var match=row.match(/at\s+([^\s]+)\s+\((.+):(\d+):/);if(match===null)match=row.match(/^([^@]+)@(.*):(\d+)$/);if(match!=null)stack.push((i?"  ":"")+'"'+match[1]+'": line '+match[3]+
" in "+match[2])})}return stack.join("\n")}});if(_Func.gap===void 0)_Func.gap=function(context,delay){if(context>=0){delay=context;context={}}var self=this;return function(){var a=arguments;setTimeout(function(){self.apply(context,a)},delay||0)}};Array.forEach(["String","Number","Array","Object","Function"],function(type){if(!ajs["is"+type])ajs["is"+type]=function(arg){return _toString.call(arg)==="[object "+type+"]"}});ajs.windowWidth=function(){return global.innerWidth?global.innerWidth:docEl?docEl.clientWidth||
_document.body&&_document.body.clientWidth||0:0};ajs.windowHeight=function(){return global.innerHeight?global.innerHeight:docEl?docEl.clientHeight||_document.body&&_document.body.clientHeight||0:0};ajs.scrollTop=function(){return typeof pageYOffset!=="undefined"?pageYOffset:(docEl.clientHeight?docEl:_document.body).scrollTop};ajs.scrollLeft=function(){return typeof pageXOffset!=="undefined"?pageXOffset:(docEl.clientHeight?docEl:_document.body).scrollLeft};ajs.uuid=function(key){var S4=function(){return Math.floor(Math.random()*
65536).toString(16)};if(key!==void 0)return ajs.uuids[key]||(ajs.uuids[key]=ajs.uuid());return S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4()};ajs.uuids={};ajs.openWindow=function(url,opts){opts=ajs.extend({name:"window"+ajs.now(),fullscreen:0,location:1,menubar:1,resizable:1,scrollbars:1,status:1,titlebar:1,toolbar:1,left:"",top:"",width:"",height:""},opts);if(opts.left==""&&opts.width>0)opts.left=Math.max(0,(screen.width-opts.width)/2);if(opts.top==""&&opts.height>0)opts.top=Math.max(0,
(screen.height-opts.height)/2);var _p=[];ajs.each(opts,function(v,k){if(v!=="")_p.push(k+"="+v)});return window.open(url,opts.name,_p.join(","))};ajs.openPopUp=function(url,opts){return ajs.openWindow(url,ajs.extend({location:0,menubar:0,resizable:0,toolbar:0},opts))};ajs.exports=function(filename,object){var namespace=filename.replace(/^.+\}(.+\/)?/,"").split("."),name=namespace.pop();if(namespace.length>0)jsCore.namespace(namespace.join("."))[name]=object;else window[name]=object;object.__exports__=
filename;ajs.loaded(filename,object);return object};ajs.get=function(ctx,path){path=path.split(/"?]?(?:\.|\["?|\])/);var i=0;for(i;i<path.length;++i){var key=path[i];if(key==="")break;if(key in ctx)ctx=ctx[key];else return}return ctx};global["ajs"]=ajs})(window,document,jsCore);jsLoader.loaded("{jsCore}jsCore.ajs");if(!window.swfobject){var swfobject=window.swfobject=function(){var UNDEF="undefined",OBJECT="object",SHOCKWAVE_FLASH="Shockwave Flash",SHOCKWAVE_FLASH_AX="ShockwaveFlash.ShockwaveFlash",
FLASH_MIME_TYPE="application/x-shockwave-flash",EXPRESS_INSTALL_ID="SWFObjectExprInst",ON_READY_STATE_CHANGE="onreadystatechange",win=window,doc=document,nav=navigator,plugin=false,domLoadFnArr=[main],regObjArr=[],objIdArr=[],listenersArr=[],storedAltContent,storedAltContentId,storedCallbackFn,storedCallbackObj,isDomLoaded=false,isExpressInstallActive=false,dynamicStylesheet,dynamicStylesheetMedia,autoHideShow=true,ua=function(){var w3cdom=typeof doc.getElementById!=UNDEF&&typeof doc.getElementsByTagName!=
UNDEF&&typeof doc.createElement!=UNDEF,u=nav.userAgent.toLowerCase(),p=nav.platform.toLowerCase(),windows=p?/win/.test(p):/win/.test(u),mac=p?/mac/.test(p):/mac/.test(u),webkit=/webkit/.test(u)?parseFloat(u.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,ie=!+"\v1",playerVersion=[0,0,0],d=null;if(typeof nav.plugins!=UNDEF&&typeof nav.plugins[SHOCKWAVE_FLASH]==OBJECT){d=nav.plugins[SHOCKWAVE_FLASH].description;if(d&&!(typeof nav.mimeTypes!=UNDEF&&nav.mimeTypes[FLASH_MIME_TYPE]&&!nav.mimeTypes[FLASH_MIME_TYPE].enabledPlugin)){plugin=
true;ie=false;d=d.replace(/^.*\s+(\S+\s+\S+$)/,"$1");playerVersion[0]=parseInt(d.replace(/^(.*)\..*$/,"$1"),10);playerVersion[1]=parseInt(d.replace(/^.*\.(.*)\s.*$/,"$1"),10);playerVersion[2]=/[a-zA-Z]/.test(d)?parseInt(d.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else if(typeof win.ActiveXObject!=UNDEF)try{var a=new ActiveXObject(SHOCKWAVE_FLASH_AX);if(a){d=a.GetVariable("$version");if(d){ie=true;d=d.split(" ")[1].split(",");playerVersion=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10)]}}}catch(e){}return{w3:w3cdom,
pv:playerVersion,wk:webkit,ie:ie,win:windows,mac:mac}}(),onDomLoad=function(){if(!ua.w3)return;if(typeof doc.readyState!=UNDEF&&doc.readyState=="complete"||typeof doc.readyState==UNDEF&&(doc.getElementsByTagName("body")[0]||doc.body))callDomLoadFunctions();if(!isDomLoaded){if(typeof doc.addEventListener!=UNDEF)doc.addEventListener("DOMContentLoaded",callDomLoadFunctions,false);if(ua.ie&&ua.win){doc.attachEvent(ON_READY_STATE_CHANGE,function(){if(doc.readyState=="complete"){doc.detachEvent(ON_READY_STATE_CHANGE,
arguments.callee);callDomLoadFunctions()}});if(win==top)(function(){if(isDomLoaded)return;try{doc.documentElement.doScroll("left")}catch(e){setTimeout(arguments.callee,0);return}callDomLoadFunctions()})()}if(ua.wk)(function(){if(isDomLoaded)return;if(!/loaded|complete/.test(doc.readyState)){setTimeout(arguments.callee,0);return}callDomLoadFunctions()})();addLoadEvent(callDomLoadFunctions)}}();function callDomLoadFunctions(){if(isDomLoaded)return;try{var t=doc.getElementsByTagName("body")[0].appendChild(createElement("span"));
t.parentNode.removeChild(t)}catch(e){return}isDomLoaded=true;var dl=domLoadFnArr.length;for(var i=0;i<dl;i++)domLoadFnArr[i]()}function addDomLoadEvent(fn){if(isDomLoaded)fn();else domLoadFnArr[domLoadFnArr.length]=fn}function addLoadEvent(fn){if(typeof win.addEventListener!=UNDEF)win.addEventListener("load",fn,false);else if(typeof doc.addEventListener!=UNDEF)doc.addEventListener("load",fn,false);else if(typeof win.attachEvent!=UNDEF)addListener(win,"onload",fn);else if(typeof win.onload=="function"){var fnOld=
win.onload;win.onload=function(){fnOld();fn()}}else win.onload=fn}function main(){if(plugin)testPlayerVersion();else matchVersions()}function testPlayerVersion(){var b=doc.getElementsByTagName("body")[0];var o=createElement(OBJECT);o.setAttribute("type",FLASH_MIME_TYPE);var t=b.appendChild(o);if(t){var counter=0;(function(){if(typeof t.GetVariable!=UNDEF){var d=t.GetVariable("$version");if(d){d=d.split(" ")[1].split(",");ua.pv=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10)]}}else if(counter<
10){counter++;setTimeout(arguments.callee,10);return}b.removeChild(o);t=null;matchVersions()})()}else matchVersions()}function matchVersions(){var rl=regObjArr.length;if(rl>0)for(var i=0;i<rl;i++){var id=regObjArr[i].id;var cb=regObjArr[i].callbackFn;var cbObj={success:false,id:id};if(ua.pv[0]>0){var obj=getElementById(id);if(obj)if(hasPlayerVersion(regObjArr[i].swfVersion)&&!(ua.wk&&ua.wk<312)){setVisibility(id,true);if(cb){cbObj.success=true;cbObj.ref=getObjectById(id);cb(cbObj)}}else if(regObjArr[i].expressInstall&&
canExpressInstall()){var att={};att.data=regObjArr[i].expressInstall;att.width=obj.getAttribute("width")||"0";att.height=obj.getAttribute("height")||"0";if(obj.getAttribute("class"))att.styleclass=obj.getAttribute("class");if(obj.getAttribute("align"))att.align=obj.getAttribute("align");var par={};var p=obj.getElementsByTagName("param");var pl=p.length;for(var j=0;j<pl;j++)if(p[j].getAttribute("name").toLowerCase()!="movie")par[p[j].getAttribute("name")]=p[j].getAttribute("value");showExpressInstall(att,
par,id,cb)}else{displayAltContent(obj);if(cb)cb(cbObj)}}else{setVisibility(id,true);if(cb){var o=getObjectById(id);if(o&&typeof o.SetVariable!=UNDEF){cbObj.success=true;cbObj.ref=o}cb(cbObj)}}}}function getObjectById(objectIdStr){var r=null;var o=getElementById(objectIdStr);if(o&&o.nodeName=="OBJECT")if(typeof o.SetVariable!=UNDEF)r=o;else{var n=o.getElementsByTagName(OBJECT)[0];if(n)r=n}return r}function canExpressInstall(){return!isExpressInstallActive&&hasPlayerVersion("6.0.65")&&(ua.win||ua.mac)&&
!(ua.wk&&ua.wk<312)}function showExpressInstall(att,par,replaceElemIdStr,callbackFn){isExpressInstallActive=true;storedCallbackFn=callbackFn||null;storedCallbackObj={success:false,id:replaceElemIdStr};var obj=getElementById(replaceElemIdStr);if(obj){if(obj.nodeName=="OBJECT"){storedAltContent=abstractAltContent(obj);storedAltContentId=null}else{storedAltContent=obj;storedAltContentId=replaceElemIdStr}att.id=EXPRESS_INSTALL_ID;if(typeof att.width==UNDEF||!/%$/.test(att.width)&&parseInt(att.width,10)<
310)att.width="310";if(typeof att.height==UNDEF||!/%$/.test(att.height)&&parseInt(att.height,10)<137)att.height="137";doc.title=doc.title.slice(0,47)+" - Flash Player Installation";var pt=ua.ie&&ua.win?"ActiveX":"PlugIn",fv="MMredirectURL="+win.location.toString().replace(/&/g,"%26")+"&MMplayerType="+pt+"&MMdoctitle="+doc.title;if(typeof par.flashvars!=UNDEF)par.flashvars+="&"+fv;else par.flashvars=fv;if(ua.ie&&ua.win&&obj.readyState!=4){var newObj=createElement("div");replaceElemIdStr+="SWFObjectNew";
newObj.setAttribute("id",replaceElemIdStr);obj.parentNode.insertBefore(newObj,obj);obj.style.display="none";(function(){if(obj.readyState==4)obj.parentNode.removeChild(obj);else setTimeout(arguments.callee,10)})()}createSWF(att,par,replaceElemIdStr)}}function displayAltContent(obj){if(ua.ie&&ua.win&&obj.readyState!=4){var el=createElement("div");obj.parentNode.insertBefore(el,obj);el.parentNode.replaceChild(abstractAltContent(obj),el);obj.style.display="none";(function(){if(obj.readyState==4)obj.parentNode.removeChild(obj);
else setTimeout(arguments.callee,10)})()}else obj.parentNode.replaceChild(abstractAltContent(obj),obj)}function abstractAltContent(obj){var ac=createElement("div");if(ua.win&&ua.ie)ac.innerHTML=obj.innerHTML;else{var nestedObj=obj.getElementsByTagName(OBJECT)[0];if(nestedObj){var c=nestedObj.childNodes;if(c){var cl=c.length;for(var i=0;i<cl;i++)if(!(c[i].nodeType==1&&c[i].nodeName=="PARAM")&&!(c[i].nodeType==8))ac.appendChild(c[i].cloneNode(true))}}}return ac}function createSWF(attObj,parObj,id){var r,
el=getElementById(id);if(ua.wk&&ua.wk<312)return r;if(el){if(typeof attObj.id==UNDEF)attObj.id=id;if(ua.ie&&ua.win){var att="";for(var i in attObj)if(attObj[i]!=Object.prototype[i])if(i.toLowerCase()=="data")parObj.movie=attObj[i];else if(i.toLowerCase()=="styleclass")att+=' class="'+attObj[i]+'"';else if(i.toLowerCase()!="classid")att+=" "+i+'="'+attObj[i]+'"';var par="";for(var j in parObj)if(parObj[j]!=Object.prototype[j])par+='<param name="'+j+'" value="'+parObj[j]+'" />';el.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+
att+">"+par+"</object>";objIdArr[objIdArr.length]=attObj.id;r=getElementById(attObj.id)}else{var o=createElement(OBJECT);o.setAttribute("type",FLASH_MIME_TYPE);for(var m in attObj)if(attObj[m]!=Object.prototype[m])if(m.toLowerCase()=="styleclass")o.setAttribute("class",attObj[m]);else if(m.toLowerCase()!="classid")o.setAttribute(m,attObj[m]);for(var n in parObj)if(parObj[n]!=Object.prototype[n]&&n.toLowerCase()!="movie")createObjParam(o,n,parObj[n]);el.parentNode.replaceChild(o,el);r=o}}return r}
function createObjParam(el,pName,pValue){var p=createElement("param");p.setAttribute("name",pName);p.setAttribute("value",pValue);el.appendChild(p)}function removeSWF(id){var obj=getElementById(id);if(obj&&obj.nodeName=="OBJECT")if(ua.ie&&ua.win){obj.style.display="none";(function(){if(obj.readyState==4)removeObjectInIE(id);else setTimeout(arguments.callee,10)})()}else obj.parentNode.removeChild(obj)}function removeObjectInIE(id){var obj=getElementById(id);if(obj){for(var i in obj)if(typeof obj[i]==
"function")obj[i]=null;obj.parentNode.removeChild(obj)}}function getElementById(id){var el=null;try{el=doc.getElementById(id)}catch(e){}return el}function createElement(el){return doc.createElement(el)}function addListener(target,eventType,fn){target.attachEvent(eventType,fn);listenersArr[listenersArr.length]=[target,eventType,fn]}function hasPlayerVersion(rv){var pv=ua.pv,v=rv.split(".");v[0]=parseInt(v[0],10);v[1]=parseInt(v[1],10)||0;v[2]=parseInt(v[2],10)||0;return pv[0]>v[0]||pv[0]==v[0]&&pv[1]>
v[1]||pv[0]==v[0]&&pv[1]==v[1]&&pv[2]>=v[2]?true:false}function createCSS(sel,decl,media,newStyle){if(ua.ie&&ua.mac)return;var h=doc.getElementsByTagName("head")[0];if(!h)return;var m=media&&typeof media=="string"?media:"screen";if(newStyle){dynamicStylesheet=null;dynamicStylesheetMedia=null}if(!dynamicStylesheet||dynamicStylesheetMedia!=m){var s=createElement("style");s.setAttribute("type","text/css");s.setAttribute("media",m);dynamicStylesheet=h.appendChild(s);if(ua.ie&&ua.win&&typeof doc.styleSheets!=
UNDEF&&doc.styleSheets.length>0)dynamicStylesheet=doc.styleSheets[doc.styleSheets.length-1];dynamicStylesheetMedia=m}if(ua.ie&&ua.win){if(dynamicStylesheet&&typeof dynamicStylesheet.addRule==OBJECT)dynamicStylesheet.addRule(sel,decl)}else if(dynamicStylesheet&&typeof doc.createTextNode!=UNDEF)dynamicStylesheet.appendChild(doc.createTextNode(sel+" {"+decl+"}"))}function setVisibility(id,isVisible){if(!autoHideShow)return;var v=isVisible?"visible":"hidden";if(isDomLoaded&&getElementById(id))getElementById(id).style.visibility=
v;else createCSS("#"+id,"visibility:"+v)}function urlEncodeIfNecessary(s){var regex=/[\\\"<>\.;]/;var hasBadChars=regex.exec(s)!=null;return hasBadChars&&typeof encodeURIComponent!=UNDEF?encodeURIComponent(s):s}var cleanup=function(){if(ua.ie&&ua.win)window.attachEvent("onunload",function(){try{var ll=listenersArr.length;for(var i=0;i<ll;i++)listenersArr[i][0].detachEvent(listenersArr[i][1],listenersArr[i][2]);var il=objIdArr.length;for(var j=0;j<il;j++)removeSWF(objIdArr[j]);for(var k in ua)ua[k]=
null;ua=null;for(var l in swfobject)swfobject[l]=null}catch(er){}swfobject=null})}();return{registerObject:function(objectIdStr,swfVersionStr,xiSwfUrlStr,callbackFn){if(ua.w3&&objectIdStr&&swfVersionStr){var regObj={};regObj.id=objectIdStr;regObj.swfVersion=swfVersionStr;regObj.expressInstall=xiSwfUrlStr;regObj.callbackFn=callbackFn;regObjArr[regObjArr.length]=regObj;setVisibility(objectIdStr,false)}else if(callbackFn)callbackFn({success:false,id:objectIdStr})},getObjectById:function(objectIdStr){if(ua.w3)return getObjectById(objectIdStr)},
embedSWF:function(swfUrlStr,replaceElemIdStr,widthStr,heightStr,swfVersionStr,xiSwfUrlStr,flashvarsObj,parObj,attObj,callbackFn){var callbackObj={success:false,id:replaceElemIdStr};if(ua.w3&&!(ua.wk&&ua.wk<312)&&swfUrlStr&&replaceElemIdStr&&widthStr&&heightStr&&swfVersionStr){setVisibility(replaceElemIdStr,false);addDomLoadEvent(function(){widthStr+="";heightStr+="";var att={};if(attObj&&typeof attObj===OBJECT)for(var i in attObj)att[i]=attObj[i];att.data=swfUrlStr;att.width=widthStr;att.height=heightStr;
var par={};if(parObj&&typeof parObj===OBJECT)for(var j in parObj)par[j]=parObj[j];if(flashvarsObj&&typeof flashvarsObj===OBJECT)for(var k in flashvarsObj)if(typeof par.flashvars!=UNDEF)par.flashvars+="&"+k+"="+flashvarsObj[k];else par.flashvars=k+"="+flashvarsObj[k];if(hasPlayerVersion(swfVersionStr)){var obj=createSWF(att,par,replaceElemIdStr);if(att.id==replaceElemIdStr)setVisibility(replaceElemIdStr,true);callbackObj.success=true;callbackObj.ref=obj}else if(xiSwfUrlStr&&canExpressInstall()){att.data=
xiSwfUrlStr;showExpressInstall(att,par,replaceElemIdStr,callbackFn);return}else setVisibility(replaceElemIdStr,true);if(callbackFn)callbackFn(callbackObj)})}else if(callbackFn)callbackFn(callbackObj)},switchOffAutoHideShow:function(){autoHideShow=false},ua:ua,getFlashPlayerVersion:function(){return{major:ua.pv[0],minor:ua.pv[1],release:ua.pv[2]}},hasFlashPlayerVersion:hasPlayerVersion,createSWF:function(attObj,parObj,replaceElemIdStr){if(ua.w3)return createSWF(attObj,parObj,replaceElemIdStr);else return undefined},
showExpressInstall:function(att,par,replaceElemIdStr,callbackFn){if(ua.w3&&canExpressInstall())showExpressInstall(att,par,replaceElemIdStr,callbackFn)},removeSWF:function(objElemIdStr){if(ua.w3)removeSWF(objElemIdStr)},createCSS:function(selStr,declStr,mediaStr,newStyleBoolean){if(ua.w3)createCSS(selStr,declStr,mediaStr,newStyleBoolean)},addDomLoadEvent:addDomLoadEvent,addLoadEvent:addLoadEvent,getQueryParamValue:function(param){var q=doc.location.search||doc.location.hash;if(q){if(/\?/.test(q))q=
q.split("?")[1];if(param==null)return urlEncodeIfNecessary(q);var pairs=q.split("&");for(var i=0;i<pairs.length;i++)if(pairs[i].substring(0,pairs[i].indexOf("="))==param)return urlEncodeIfNecessary(pairs[i].substring(pairs[i].indexOf("=")+1))}return""},expressInstallCallback:function(){if(isExpressInstallActive){var obj=getElementById(EXPRESS_INSTALL_ID);if(obj&&storedAltContent){obj.parentNode.replaceChild(storedAltContent,obj);if(storedAltContentId){setVisibility(storedAltContentId,true);if(ua.ie&&
ua.win)storedAltContent.style.display="block"}if(storedCallbackFn)storedCallbackFn(storedCallbackObj)}isExpressInstallActive=false}},callDomLoadFunctions:callDomLoadFunctions}}();window.SWF={defParams:{allowScriptAccess:"always",menu:false},build:function(Elm,p){if(typeof Elm=="string")Elm=jsCore.$(Elm);else if(Elm.append)Elm=Elm[0];var m=p.movie,v=p.vars||{},p=Object.extend(this.defParams,p.params),fId=m.name||jsCore.getUniqId();Elm.id=jsCore.getUniqId();swfobject.embedSWF(m.url,Elm.id,m.width||
"100%",m.height||"100%",m.ver||m.version||"9.0.0","expressInstall.swf",v,p,{id:fId,name:fId,bgcolor:m.bg||m.bgColor||m.background});return $("#"+fId)[0]}}}jsLoader.loaded("{jsCore}swfobject");define("toolkit.common/callstack/callstack",function(){(function(factory){if(typeof define==="function"&&define.amd)define("callStack",[],factory);else if(typeof module!="undefined"&&typeof module.exports!="undefined")module.exports=factory();else window["callStack"]=factory()})(function(){var _pid;var _order=
["default"];var _pause=false;var _stacks={};var _tickFns=[];var _mathMax=Math.max;var _simpleSort=function(arr){var n=arr.length,swap;if(n>1)while(n-- >1)if(arr[n].weight>arr[n-1].weight){swap=arr[n];arr[n]=arr[n-1];arr[n-1]=swap}else break};var _setImmediate=window.setImmediate||function(fn){window.setTimeout(fn,0)};var _clearImmediate=window.clearImmediate||window.clearTimeout;function _ifNotInStack(stack,fn,args,uniq){var i=stack.length,callee;while(i--){callee=stack[i];if(callee.fn===fn)if(uniq===
"once"){stack.splice(i,1);return true}else return _argsNotEqual(callee.args,args)}return true}function _argsNotEqual(left,right){if(left.length!==right.length)return true;else{var i=_mathMax(left.length,right.length);while(i--)if(left[i]!==right[i])return true;return false}}function _walkStackTick(){if(_pid===void 0||callStack.debounce===true){_clearImmediate(_pid);_pid=_setImmediate(_walkStack)}}function _walkStack(){_pid=void 0;if(_pause===false){var name,stack,i,n,callee,s=0,sn=_order.length,ctx,
fn,args;for(;s<sn;s++){name=_order[s];stack=_stacks[name];if(stack!==void 0&&stack.paused===false){stack=stack.calls;_stacks[name].calls=[];i=0;n=stack.length;for(;i<n;i++){callee=stack[i];ctx=callee.ctx;fn=callee.fn;args=callee.args;switch(args.length){case 0:fn.call(ctx);break;case 1:fn.call(ctx,args[0]);break;case 2:fn.call(ctx,args[0],args[1]);break;case 3:fn.call(ctx,args[0],args[1],args[2]);break;case 4:fn.call(ctx,args[0],args[1],args[2],args[3]);break;default:fn.apply(ctx,args);break}}}}i=
_tickFns.length;while(i--)_tickFns[i]()}}function _wrapCall(ctx,fn,opts){var stack=this;if(typeof fn==="string")return ctx[fn]=this.wrap(ctx,ctx[fn],opts);else if(fn===void 0||!(fn instanceof Function)){opts=fn;fn=ctx;ctx=null}opts=opts||{uniq:false,weight:0};if(callStack.disabled)return fn;return function(){if(!opts.uniq||_ifNotInStack(stack.calls,fn,arguments,opts.uniq)){var calls=stack.calls;calls.push({fn:fn,ctx:ctx,args:arguments,weight:opts.weight|0});if(opts.weight!==0)_simpleSort(calls);_walkStackTick()}}}
function callStack(name){if(_stacks[name]==void 0){_stacks[name]={calls:[],paused:false,wrap:_wrapCall,add:function(ctx,fn,opts){this.wrap(ctx,fn,opts)()},pause:function(){this.paused=true},unpause:function(){this.paused=false},clear:function(){this.calls=[]}};_order.push(name)}return _stacks[name]}callStack.wrap=function(ctx,fn,opts){return callStack("default").wrap(ctx,fn,opts)};callStack.add=function(ctx,fn,opts){callStack("default").add(ctx,fn,opts)};callStack.tick=function(fn){_tickFns.push(fn)};
callStack.untick=function(fn){var i=_tickFns.length;while(i--)if(_tickFns[i]===fn){_tickFns.splice(i,1);break}};callStack.tick.one=function(fn){callStack.tick(function _(){callStack.untick(_);fn()})};callStack.order=function(){var args=arguments,i=args.length,j;while(i--){j=_order.length;while(j--)if(_order[j]===args[i]){_order.splice(j,1);break}}_order.splice.apply(_order,[1,0].concat([].slice.call(args)))};callStack.pause=function(){_pause=true};callStack.unpause=function(){_pause=false;_walkStackTick()};
callStack.clear=function(name){callStack(name||"default").clear()};callStack.override=function(ctx,fn,callback){if(typeof fn==="string")return ctx[fn]=callStack.override(ctx,ctx[fn],callback);else if(callback===void 0){callback=fn;fn=ctx}return callback(fn)};callStack.debounce=false;callStack.version="0.4.1";return callStack})});define("toolkit.common/modernizr/modernizr",[],function(){window.Modernizr=function(a,b,c){function y(a){i.cssText=a}function z(a,b){return y(l.join(a+";")+(b||""))}function A(a,
b){return typeof a===b}function B(a,b){return!!~(""+a).indexOf(b)}function C(a,b){for(var d in a){var e=a[d];if(!B(e,"-")&&i[e]!==c)return b=="pfx"?e:!0}return!1}function D(a,b,d){for(var e in a){var f=b[a[e]];if(f!==c)return d===!1?a[e]:A(f,"function")?f.bind(d||b):f}return!1}function E(a,b,c){var d=a.charAt(0).toUpperCase()+a.slice(1),e=(a+" "+n.join(d+" ")+d).split(" ");return A(b,"string")||A(b,"undefined")?C(e,b):(e=(a+" "+o.join(d+" ")+d).split(" "),D(e,b,c))}var d="2.8.3",e={},f=b.documentElement,
g="modernizr",h=b.createElement(g),i=h.style,j,k={}.toString,l=" -webkit- -moz- -o- -ms- ".split(" "),m="Webkit Moz O ms",n=m.split(" "),o=m.toLowerCase().split(" "),p={},q={},r={},s=[],t=s.slice,u,v=function(a,c,d,e){var h,i,j,k,l=b.createElement("div"),m=b.body,n=m||b.createElement("body");if(parseInt(d,10))while(d--)j=b.createElement("div"),j.id=e?e[d]:g+(d+1),l.appendChild(j);return h=["&#173;",'<style id="s',g,'">',a,"</style>"].join(""),l.id=g,(m?l:n).innerHTML+=h,n.appendChild(l),m||(n.style.background=
"",n.style.overflow="hidden",k=f.style.overflow,f.style.overflow="hidden",f.appendChild(n)),i=c(l,a),m?l.parentNode.removeChild(l):(n.parentNode.removeChild(n),f.style.overflow=k),!!i},w={}.hasOwnProperty,x;!A(w,"undefined")&&!A(w.call,"undefined")?x=function(a,b){return w.call(a,b)}:x=function(a,b){return b in a&&A(a.constructor.prototype[b],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(b){var c=this;if(typeof c!="function")throw new TypeError;var d=t.call(arguments,1),
e=function(){if(this instanceof e){var a=function(){};a.prototype=c.prototype;var f=new a,g=c.apply(f,d.concat(t.call(arguments)));return Object(g)===g?g:f}return c.apply(b,d.concat(t.call(arguments)))};return e}),p.touch=function(){var c;return"ontouchstart"in a||a.DocumentTouch&&b instanceof DocumentTouch?c=!0:v(["@media (",l.join("touch-enabled),("),g,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(a){c=a.offsetTop===9}),c};for(var F in p)x(p,F)&&(u=F.toLowerCase(),e[u]=p[F](),
s.push((e[u]?"":"no-")+u));return e.addTest=function(a,b){if(typeof a=="object")for(var d in a)x(a,d)&&e.addTest(d,a[d]);else{a=a.toLowerCase();if(e[a]!==c)return e;b=typeof b=="function"?b():b,typeof enableClasses!="undefined"&&enableClasses&&(f.className+=" "+(b?"":"no-")+a),e[a]=b}return e},y(""),h=j=null,e._version=d,e._prefixes=l,e._domPrefixes=o,e._cssomPrefixes=n,e.testProp=function(a){return C([a])},e.testAllProps=E,e.testStyles=v,e}(this,this.document);Modernizr.addTest("keyframes",function(){return Modernizr.testAllProps("animationName")})});
jsLoader.use(["{toolkit.common}ajs/__array/ajs__array","{jQuery}jquery"],function(){(function(w,d,l,$){var RE_NORMALIZE_URL=new RegExp("^(https?://[^/]+)?/(.+?"+l.host+"/)?(cgi-bin/)?","g");var pid,_useHistoryAPI=patron.v2&&history.pushState,hash=_hash(),iFrame=$.browser.msie&&(d.documentMode<8||!d.documentMode),self={},url=(l.pathname+l.search).replace(/#.*/,""),$win=$(w),canUnloadConfirm=true,evt=false,evtName="hashchange",_listener=[],_urlData={},_urlLocalData={},_hcf,initialFire=l.href;function normalizeUrl(hash){hash=
hash.replace(RE_NORMALIZE_URL,"");if(!/^\//.test(hash))hash="/"+hash;return hash}function fistPopStateChange_bug(e){if(initialFire===l.href){if(e.stopImmediatePropagation)e.stopImmediatePropagation();else if(e.stopPropagation)e.stopPropagation();initialFire=0}w.removeEventListener("popstate",fistPopStateChange_bug,false);fistPopStateChange_bug=null}if(_useHistoryAPI){if($.browser.webkit){var version=/(chrome|crios|version)\/(.*)\s+safari\//.exec(navigator.appVersion.toLowerCase());if(version){var isChrome=
version[1]==="chrome"||version[1]==="crios",intVersion=parseInt(version[2],10);if(!isChrome||intVersion<34)w.addEventListener("popstate",fistPopStateChange_bug,false)}}w.addEventListener("popstate",_hcf=function(){_changed(l.toString())},false)}else if("on"+evtName in w&&!iFrame){evt=true;_hcf=function(){_changed(_hash(l.toString()))};$.event.add(w,evtName,_hcf)}else if($.browser.opera||iFrame)jQuery(function(){iFrame=iFrame?$('<iframe src="javascript:0;" />').insertAfter("BODY")[0].contentWindow:
false;if(iFrame)_fixIE(hash,true);if($.browser.opera){history.navigationMode="compatible";w.__jsHistory__=function(){_check();clearInterval(pid);pid=setInterval(_check,100)};$("<img src=\"javascript:location.href='javascript:window.__jsHistory__();';\" />").css({position:"absolute",width:1,height:1}).appendTo("BODY")}pid=setInterval(_check,100)});else pid=setInterval(_check,100);function _hash(h){if(_useHistoryAPI)h=h||normalizeUrl(l.toString());else{h=("#"+(h||normalizeUrl(l.toString())).replace(/^[^#]*#/,
"").toString()).split("?");if(h[1])h=h[0]+"?"+ajs.toQuery(ajs.toObject(h[1]));else h=h[0]}return h}function _unload(){canUnloadConfirm=false;var txt=$win.triggerHandler("beforeunload");return!txt||confirm(txt)}function _changed(h,f){var local=_urlLocalData[self.get()];if(f||h!==hash){if(f||local||!canUnloadConfirm||_unload()){if(!f)self.previous=self.get();if(h!==undefined)hash=h;h=self.get();for(var i=_listener.length;i--;)_listener[i](h,f,_urlData[h],local);if(!evt)$win.triggerHandler(evtName)}else self.set(hash);
canUnloadConfirm=true}}function _check(){var h=_hash();if(h!==hash){_changed(h);if(iFrame)_fixIE(h,true)}else if(iFrame&&iFrame.document){h=_hash(iFrame.document.location.toString());if(h!==hash){l.hash=h;_changed(h)}}}function _fixIE(h,write){try{var doc=iFrame.document;if(write)doc.open().close();doc.location.hash=_hash(h)}catch(err){setTimeout(function(){_fixIE(h,write)},10)}}Object.extend(self,{trust:{test:ajs.retTrue},setModifier:normalizeUrl,normalizeUrl:normalizeUrl,destroy:function(){_check=
$.noop;$.event.remove(w,evtName,_hcf)},get:function(){var h=hash.replace(/^#/,"");return h!=""&&self.trust.test(h)?h:url},setHard:function(nHash,data,local){self.previous=self.previous===void 0?"":self.get();if(iFrame)_fixIE(nHash,true);hash=nHash;var s=nHash.replace(/^#/,"");if(data)_urlData[s]=data;if(local)_urlLocalData[s]=1;_changed(nHash,true);if(_useHistoryAPI)history.pushState(null,null,hash);else{l.hash=hash;patron.restoreJquery()}},getData:function(hash){return _urlData[_hash(normalizeUrl(hash))]},
set:function(nHash,data,local){if(self.disabled){l.href=nHash;return false}nHash=_hash(normalizeUrl(nHash));if(normalizeUrl(hash)==nHash)return true;else if(local||_unload()){self.setHard(nHash,data,local);return true}return false},realUrl:function(){return url},change:function(func,force){if(!force)func(this.get());_listener.unshift(func);return this},unbind:function(func){_listener=Array.remove(_listener,func);return this},one:function(func){return this.change(function(hash){func(hash);self.unbind(arguments.callee)},
true)},changeTop:function(func,force){if(!force)func(this.get());_listener.push(func);return this},oneTop:function(func){return this.changeTop(function(hash){func(hash);self.unbind(arguments.callee)},true)},buildParams:function(add,remove,url){var params=ajs.toObject((url||this.get()).split("?")[1]||"");if(remove)ajs.each(remove,function(value){delete params[value]});return ajs.toQuery(ajs.extend(params,add))},buildUrl:function(add,remove,url){return(url||this.get()).split("?")[0]+"?"+self.buildParams(add,
remove,url)},build:function(add,remove,url){this.set(self.buildUrl(add,remove,url))},useHistoryAPI:_useHistoryAPI});Array.forEach(["go","back","forward"],function(n){self[n]=function(x){w.history[n](x);return self}});w.jsHistory=self})(window,document,location,jQuery);jsLoader.loaded("{utils}jsHistory")});jsLoader.use("{toolkit.common}callstack/callstack",function(){(function(){var _newImage=callStack("rb").wrap(function(src){(new Image).src=src});jsClass.create("Counter").statics({d:function(i){_newImage("//rs."+
patron.SingleDomainName+"/d"+i+".gif?rnd="+Math.random())},sb:function(i){_newImage("//rs."+patron.SingleDomainName+"/sb"+i+".gif?rnd="+Math.random())},gstat:function(str){_newImage("//gstat."+patron.staticDomainName+"/gstat?"+str+"&rnd="+Math.random())},count:_newImage})})();jsLoader.loaded("{utils}Counter")});jsLoader.use(["{toolkit.common}ajs/__array/ajs__array","{jQuery}jquery"],function(){(function($){var _rplus=/\s*\+\s*/,keyCode=window.jsEvent&&jsEvent.Key||{};var HK=$.hotkeys={};function _toHotKey(str){var tmp=
str.split(_rplus);var key=(tmp[tmp.length-1]+"").toLowerCase();var res={"name":key,"meta":tmp[tmp.length-2]||"","code":keyCode[key]||key.toUpperCase().charCodeAt(0)};res.combo=res.meta?res.meta+"+"+key:key;res.mnemo=res.meta?res.meta+"+"+res.code:res.code;return res}$.hotkeys.on=$.hotkeys.bind=function(keys,func){Array.forEach($.trim(keys).split(/\s+/),function(key){key=_toHotKey(key);if(!HK[key.mnemo])HK[key.mnemo]=[];HK[key.mnemo].push([key,func])})};$.hotkeys.off=$.hotkeys.unbind=function(keys,
func){Array.forEach($.trim(keys).split(/\s+/),function(key){key=_toHotKey(key);var idx=Array.search(HK[key.mnemo]||[],function(X){return X&&X[1]===func});if(idx>-1)HK[key.mnemo]=Array.removeAt(HK[key.mnemo],idx)})};$(document).keydown(function(evt){var code=evt.keyCode,meta="",HK=$.hotkeys,fire=[code],ret=true;if(evt.ctrlKey)meta="ctrl";else if(evt.shiftKey)meta="shift";else if(evt.altKey)meta="alt";else if(evt.metaKey)meta="meta";if(meta)fire.push(meta,meta+"+"+code);Array.forEach(fire,function(key){if(HK[key])for(var i=
0,n=HK[key].length,X;i<n;i++){X=HK[key][i];try{if(X[1](evt,X[0])===false)ret=false}catch(err){}}});if(!ret)return false});$.fn.setHotKey=function(keys,fn){$.hotkeys.bind(keys,fn);return this};$.fn.hotKey=function(keys,fn){var type;this.bind("focus blur",function(evt){if(type!==evt.type){type=evt.type;$.hotkeys[evt.type=="focus"?"on":"off"](keys,fn)}});return this}})(jQuery);jsLoader.loaded("{utils}HotKeys")});(function(window,$){var gid=0,undef=void 0,noop=function(){},_rhttp=/^https?/i,_timers={},
_time=function(name){_timers[name]=new Date},_timeEnd=function(name){_timers[name]=new Date-_timers[name]};var Class=function(methods){var New=function(){if(New.fn.singleton){if(New.__inst__)return New.__inst__;New.__inst__=this}this.uniqId=++gid;this.__lego.apply(this,arguments)};New.fn=New.prototype=methods||{};New.fn.__self=New.fn.constructor=New;New.extend=function(methods){var Ext=Class();noop.prototype=this.fn;Ext.prototype=new noop;_extend(Ext,this);_extend(Ext.fn=Ext.prototype,methods);Ext.fn.__self=
New.fn.constructor=Ext;return Ext};return New};var EventEmitter=Class({__lego:function(){var $emitter=$(this);_each({on:"bind",off:"unbind",fire:"triggerHandler"},function(name,method){this[method]=function(){$emitter[name].apply($emitter,arguments);return this}},this)},emit:function(name,args){var method=("on-"+name).replace(/-(.)/g,function(a,b){return b.toUpperCase()}),evt=$.Event(name.replace(/-/g,""));evt.target=this;if(this[method]===undef||this[method].apply(this,[evt].concat(args))!==false)if(!evt.isImmediatePropagationStopped())return this.fire(evt,
args)}});var Router=EventEmitter.extend({__lego:function(path){EventEmitter.fn.__lego.call(this);this.path=path||"/";this.items=[];this.itemsIdx={};this.request=this.referrer=this.__self.parseURL(location.toString());this.history=[];this.historyIdx=0},route:function(id,path,unit,options,isGroup){var router=this.addRoute(id,path,unit,options,isGroup);return isGroup?router:this},addRoute:function(id,path,unit,options,isGroup){if(!~"string regexp".indexOf($.type(path))){options=unit;unit=path;path=id;
id=undef}if(unit&&!unit.fn){var fn=unit;unit=Router.Unit.extend(typeof fn!="function"?fn:{init:function(){this.on("routestart routechange"+(options===true?" routeend":""),fn)}})}if($.type(path)!="regexp")path=(this.path+(path=="."?"":path)).replace(/\/\//,"/");var keys=[],router=this,idx;if(isGroup){router=new Router(path);router.items=this.items;router.itemsIdx=this.itemsIdx;router.parentRouter=this;path+="*"}if(unit){idx=this.items.push({id:id,path:path,keys:keys,regexp:_pathRegexp(path,keys),unit:unit||
Router.View,options:options});if(id)this.itemsIdx[id]=idx-1}return isGroup?router:idx},removeRoute:function(id){id=this.itemsIdx[id]||id;this.items.splice(id,1)},createGroup:function(id,path,unit,options){return this.route(id,path,unit,options,true)},closeGroup:function(){return this.parentRouter||this},_getUnits:function(req,items){var units=[],params=[],sm=0,sl=0,ts;_each(items,function(item){var unit=item.unit;ts=new Date;if(_matchRoute(req.path,item.regexp,item.keys,params)){sm+=new Date-ts;ts=
new Date;if(unit.__self===undef)item.unit=unit=new unit(_extend({id:item.id,inited:false},item.options));unit.requestParams=params;units.push(unit);sl+=new Date-ts}},this);_timers["_getUnits.match"]=sm;_timers["_getUnits.lego"]=sl;return units},_loadUnits:function(req,units){var queue=[],unit,dfd,production=Router.production;units=units.concat();while(unit=units.shift())if(unit&&unit.isActive()){unit.failStatus=false;_each(unit.units,function(unit){units.push(unit)});if(unit.loadData){req.params=
unit.requestParams;if(production)try{dfd=unit.loadData(req)}catch(err){dfd=$.Deferred().reject(err);err.name="loadData";this.emit("error",[err,req])}else dfd=unit.loadData(req);delete req.params}if($.isArray(dfd))units.push.apply(units,dfd);else if(dfd){queue.push(dfd);dfd.fail(this._failUnit.bind(this,unit))}}return $.when.apply($,queue)},_failUnit:function(unit,err){unit.failStatus=err||true},_doRouteUnits:function(request,items){var production=Router.production,sum={match:0,init:0,start:0,change:0,
route:0};_each(items,function(item){var unit=item.unit,routeChange=true,params=[],req=_extend({},request),ts=new Date;req.params=params;if(_matchRoute(req.path,item.regexp,item.keys,params)){sum.match+=new Date-ts;ts=new Date;unit.request=req;if(unit.inited!==true){_time("__init."+unit.uniqId);unit.__init();_timeEnd("__init."+unit.uniqId)}sum.init+=new Date-ts;ts=new Date;if(unit.active!==true){routeChange=false;unit.active=true;if(production)try{unit.emit("route-start",req)}catch(err){err.name="routestart";
unit.failStatus=err;this.emit("error",[err,req])}else unit.emit("route-start",req)}sum.start+=new Date-ts;ts=new Date;if(production)try{unit.emit("route",req)}catch(err){err.name="route";unit.failStatus=err;this.emit("error",[err,req])}else unit.emit("route",req);sum.route+=new Date-ts;ts=new Date;if(routeChange)if(production)try{unit.emit("route-change",req)}catch(err){err.name="routechange";unit.failStatus=err;this.emit("error",[err,req])}else unit.emit("route-change",req);sum.change+=new Date-
ts}else if(unit.active===true&&!~$.inArray(unit,this.activeUnits)){unit.active=false;unit.request=req;if(production)try{unit.emit("route-end",req)}catch(err){err.name="routeend";unit.failStatus=err;this.emit("error",[err,req])}else unit.emit("route-end",req)}},this);_timers["_doRouteUnits."+this.uniqId+".match"]=sum.match;_timers["_doRouteUnits."+this.uniqId+".init"]=sum.init;_timers["_doRouteUnits."+this.uniqId+".start"]=sum.start;_timers["_doRouteUnits."+this.uniqId+".route"]=sum.route;_timers["_doRouteUnits."+
this.uniqId+".change"]=sum.change},_doRouteDone:function(req){if(this.activeRequest===req){if(this.request.url!=req.url)this.referrer=this.request;this.request=req;if(!this._navByHistory){this.history=this.history.slice(0,this.historyIdx+1);this.historyIdx=this.history.push(req.url)-1}_timeEnd("nav._loadUnitsDefer");_time("_doRouteDone.routestart");this.emit("routestart",[req]);_timeEnd("_doRouteDone.routestart");if(this.items.length){_time("_doRouteDone._doRouteUnits");this._doRouteUnits(req,this.items);
_timeEnd("_doRouteDone._doRouteUnits")}var delta=new Date-this.__ts;_time("_doRouteDone.route");this.emit("route",[req,delta]);_timeEnd("_doRouteDone.route");_time("_doRouteDone.routeend");this.emit("routeend",[req,delta]);_timeEnd("_doRouteDone.routeend");this.log("Router.nav:",delta+"ms","("+req.url+")");ajs.each(_timers,function(ms,name){console.info(name+": "+ms+"ms")})}},_doRouteFail:function(req){if(this.activeRequest===req){this.activeRequest=null;this.emit("route-fail",req)}},log:function(){if(ajs.log)ajs.log.apply(ajs,
arguments)},getFailUnits:function(){return ajs.filter(this.activeUnits,function(unit){return unit.failStatus})},getByUniqId:function(id){return ajs.filter(this.items,function(item){return item.unit.uniqId==id})[0].unit},get:function(id){return this.items[this.itemsIdx[id]]},getUrl:function(id,params){var route=this.get(id),keys,path,idx=0;if(route){params=params||{};keys=route.keys;path=route.path.replace(/:(\w+)\??(\/?)/g,function(_,key,slash,val){key=keys[idx++];val=key&&params[key.name];return val?
val+(slash||""):"("+_+")"}).replace(/\(.*?:[^)]+\)+\??/g,"").replace(/\(|\)\??/g,"").replace(/\/+/g,"/")}return path},nav:function(url,force,callback){_timers={};if($.isFunction(force)){callback=force;force=false}var req=this.__self.parseURL(url.href||url.url||url);if(force||!this.activeRequest||this.activeRequest.url!=req.url){_time("nav.before-route");this.__ts=+new Date;this.emit("before-route",[req,this.__ts]);_timeEnd("nav.before-route");_time("nav._getUnits");var units=this._getUnits(req,this.items);
_timeEnd("nav._getUnits");req.referrer=this.request.url;this.activeUnits=units;this.activeRequest=req;if(units.length){_time("nav._loadUnitsDefer");this._loadUnits(req,units).done(this._doRouteDone.bind(this,req)).fail(this._doRouteFail.bind(this,req)).then(callback,callback)}else{this._doRouteDone(req);this.emit("404",req)}this._navByHistory=false}},go:function(id,params){var url=this.getUrl(id,params);if(url)this.nav(url)},hasBack:function(){return this.historyIdx>0},back:function(){if(this.hasBack()){this._navByHistory=
true;this.nav(this.history[--this.historyIdx])}},hasForward:function(){return!!this.history[this.historyIdx+1]},forward:function(){if(this.hasForward()){this._navByHistory=true;this.nav(this.history[++this.historyIdx])}}});Router.parseURL=function(url){if(!_rhttp.test(url)){if("/"==url.charAt(0))url="//"+location.hostname+url;else url=location.pathname.substr(0,location.pathname.lastIndexOf("/")+1)+url;if("//"==url.substr(0,2))url=location.protocol+url;else url=location.hostname+url;if(!_rhttp.test(url))url=
location.protocol+"//"+url}url=url.substr(0,7)+url.substr(7).replace(/\/+/g,"/");var search=(url.split("?")[1]||"").replace(/#.*/,""),query={},path=url.substr(url.indexOf("/",8)).replace(/\?.*/,"");if(search)_each(search.split("&"),function(part,tmp){tmp=part.split("=");query[tmp[0]]=decodeURIComponent(typeof tmp[1]==="undefined"?"":tmp[1])});return{url:url,query:query,search:search,path:path,pathname:path,hash:url.replace(/^[^#]+#/,"")}};var Unit=EventEmitter.extend({units:{},boundAll:[],__lego:function(options){EventEmitter.fn.__lego.call(this);
_extend(this,options);_each(this.boundAll,function(name){this[name]=this.bound(name)},this);if(this.inited!==false)this.__init()},__init:function(){this.inited=true;this.init();this.emit("init")},_exception:function(method,text){throw"["+this.uniqId+"."+method+"]: "+text;},isActive:function(){return true},bound:function(fn){if(typeof fn==="string"){if(this[fn]===undef)this._exception("bound",fn+" -- method not found");fn=this[fn]}return fn.bind(this)},addUnit:function(name,unit){if(name in this.units)this._exception("addUnit",
name+" -- exists");this.units[name]=unit},getUnit:function(name){return this.units[name]},delUnit:function(name){if(name in this.units){this.units[name].destroy();delete this.units[name]}},init:noop,loadData:noop,destroy:noop});var View=Unit.extend({el:null,$el:$("#"+Math.round(Math.random()*1E8)),tagName:null,className:"",parentNode:null,cached:false,template:null,__init:function(){this.inited=true;if(this.el)this.setElement($(this.el,this.parentNode));else if(this.tagName){this.el=document.createElement(this.tagName);
this.$el=$(this.el);if(this.className)this.$el.addClass(this.className);if(this.parentNode)if($.isReady)this.$el.appendTo(this.parentNode);else $(function(){this.$el.appendTo(this.parentNode)}.bind(this))}this.on("routestart.view routeend.view",this.bound(function(evt){this._toggleView(evt.type!="routeend")}));this.init();this.emit("init")},_toggleView:function(vis){this.$el&&this.$el.css("display",vis?"":"none")},setElement:function(el){if(el)this.$el=el=$(el);else{this.$el=el=$();this.$el[0]=undef;
this.$el.length=0}this.el=el[0]},$:function(sel){var $el=this.$el;if(sel!==void 0)$el=typeof sel=="string"?$el.find(sel):$(sel);return $el},getTplData:noop,getHtml:function(data){var req=this.request||{};return this.template(_extend({$URL:req.url,$GET:req.query,widget:this},data||this.getTplData()))},render:function(){var html=this.getHtml();if(typeof html==="string"){this.emit("before-render");this.$el.prop("innerHTML",html);this.emit("render")}}});function _each(obj,fn,ctx){if(obj){var i=0,n=obj.length;
if(i in obj&&n!==undef)for(;i<n;i++)fn.call(ctx,obj[i],i,obj);else for(i in obj)if(obj.hasOwnProperty(i))fn.call(ctx,obj[i],i,obj)}}function _extend(dst,src){var args=arguments,i=1,n=args.length,key;dst=dst||{};for(;i<n;i++){src=args[i];if(src&&typeof src=="object")for(key in src)if(src.hasOwnProperty(key))dst[key]=src[key]}return dst}function _pathRegexp(path,keys,sensitive,strict){if(path instanceof RegExp)return path;if($.isArray(path))path="("+path.join("|")+")";path=path.concat(strict?"":"/?").replace(/(\/\(|\(\/)/g,
"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\([^?].*?\)))?(\?)?(\*)?/g,function(_,slash,format,key,capture,optional,star){keys.push({name:key,optional:!!optional});slash=slash||"";return""+(optional?"":slash)+"(?:"+(optional?slash:"")+(format||"")+(capture||format&&"([^/.]+?)"||"([^/]+?)")+")"+(optional||"")+(star?"(/*)?":"")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)");return new RegExp("^"+path+"$",sensitive?"":"i")}function _matchRoute(path,regexp,keys,params){if(keys){var i=1,l,key,val,m=regexp.exec(path);
if(!m)return false;for(l=m.length;i<l;++i){key=keys[i-1];val="string"==typeof m[i]?decodeURIComponent(m[i]):m[i];if(key)params[key.name]=val;else params.push(val)}return true}return regexp.test(path)}Router.Unit=Unit;Router.View=View;Router.production=false;if(!window.ajs)window.ajs={};window.ajs.Router=Router})(window,jQuery);define("toolkit.common/ajs/__router/ajs__router",jQuery.noop);define("toolkit.common/store/store",function(){var store={};(function(win){var doc=win.document,localStorageName=
patron.NoSaveLogin?"sessionStorage":"localStorage",storage;store.disabled=false;store.set=function(key,value){};store.get=function(key){};store.remove=function(key){};store.clear=function(){};store.transact=function(key,defaultVal,transactionFn){var val=store.get(key);if(transactionFn==null){transactionFn=defaultVal;defaultVal=null}if(typeof val=="undefined")val=defaultVal||{};transactionFn(val);store.set(key,val)};store.getAll=function(){};store.forEach=function(){};store.serialize=function(value){return JSON.stringify(value)};
store.deserialize=function(value){if(typeof value!="string")return undefined;try{return JSON.parse(value)}catch(e){return value||undefined}};function isLocalStorageNameSupported(){try{return localStorageName in win&&win[localStorageName]}catch(err){return false}}if(isLocalStorageNameSupported()){storage=win[localStorageName];store.set=function(key,val){if(val===undefined)return store.remove(key);storage.setItem(key,store.serialize(val));return val};store.get=function(key){return store.deserialize(storage.getItem(key))};
store.remove=function(key){storage.removeItem(key)};store.clear=function(){storage.clear()};store.getAll=function(){var ret={};store.forEach(function(key,val){ret[key]=val});return ret};store.forEach=function(callback){for(var i=0;i<storage.length;i++){var key=storage.key(i);callback(key,store.get(key))}}}else if(doc.documentElement.addBehavior){var storageOwner,storageContainer;try{storageContainer=new ActiveXObject("htmlfile");storageContainer.open();storageContainer.write("<s"+"cript>document.w=window</s"+
'cript><iframe src="/favicon.ico"></frame>');storageContainer.close();storageOwner=storageContainer.w.frames[0].document;storage=storageOwner.createElement("div")}catch(e){storage=doc.createElement("div");storageOwner=doc.body}function withIEStorage(storeFunction){return function(){try{var args=Array.prototype.slice.call(arguments,0);args.unshift(storage);storageOwner.appendChild(storage);storage.addBehavior("#default#userData");storage.load(localStorageName);var result=storeFunction.apply(store,
args);storageOwner.removeChild(storage);return result}catch(e){}}}var forbiddenCharsRegex=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");function ieKeyFix(key){return key.replace(/^\d/,"___$&").replace(forbiddenCharsRegex,"___")}store.set=withIEStorage(function(storage,key,val){key=ieKeyFix(key);if(val===undefined)return store.remove(key);storage.setAttribute(key,store.serialize(val));storage.save(localStorageName);return val});store.get=withIEStorage(function(storage,key){key=ieKeyFix(key);
return store.deserialize(storage.getAttribute(key))});store.remove=withIEStorage(function(storage,key){key=ieKeyFix(key);storage.removeAttribute(key);storage.save(localStorageName)});store.clear=withIEStorage(function(storage){var attributes=storage.XMLDocument.documentElement.attributes;storage.load(localStorageName);for(var i=0,attr;attr=attributes[i];i++)storage.removeAttribute(attr.name);storage.save(localStorageName)});store.getAll=function(storage){var ret={};store.forEach(function(key,val){ret[key]=
val});return ret};store.forEach=withIEStorage(function(storage,callback){var attributes=storage.XMLDocument.documentElement.attributes;for(var i=0,attr;attr=attributes[i];++i)callback(attr.name,store.deserialize(storage.getAttribute(attr.name)))})}try{var testKey="__storejs__";store.set(testKey,testKey);if(store.get(testKey)!=testKey)store.disabled=true;store.remove(testKey)}catch(e){store.disabled=true}store.enabled=!store.disabled;if(typeof module!="undefined"&&module.exports&&this.module!==module)module.exports=
store;else if(typeof define==="function"&&define.amd)define(store);else win.store=store})(Function("return this")());store.disabled&&function(store,storage){store.get=function(key){return storage[key]};store.set=function(key,val){storage[key]=val};store.remove=function(key){delete storage[key]};store.getAll=function(){return storage};store.clear=function(){storage={}}}(store,{});return store});define("toolkit.common/jinn/jinn",function(){(function(window,document,undef){var F=function(){},api=function(api){this._api=
api},_agent=navigator.userAgent.toLowerCase(),_opts={scope:"OS"},_scope={},_listeners={},_prefix="__jinn.",_eprefix="__event.",_pid,_lock,_emit=function(){if(!_lock){_lock=1;clearTimeout(_pid);_pid=setTimeout(__emit,10)}},__emit=function(){var name,val,i;for(name in _listeners){val=Jinn["store"](_eprefix+name);for(i=_listeners[name].length;i--;)_listeners[name][i](val)}_lock=0};api["ext"]=function(methods){var New=function(){this["__lego"].apply(this,arguments)},name;F.prototype=this["fn"];New.prototype=
New["fn"]=new F;New["ext"]=api["ext"];New["methods"]=api["methods"];for(name in methods)New["fn"][name]=methods[name];return New};api["methods"]=function(methods){for(var key in methods)this["fn"][key]=methods[key];return this};api.prototype=api["fn"]={"ALLOWED":0,"NOT_ALLOWED":1,"DENIED":2,"_opts":{},"__lego":F,"_check":function(){return this["ALLOWED"]},"_request":function(fn){fn()},"_ext":function(obj){for(var key in this["_opts"])if(obj[key]===undef)obj[key]=this["_opts"][key];return obj},"opt":function(key,
val){var ret=this;if(val!==undef)ret["_opts"][key]=val;else if(typeof key=="object")for(val in key)ret["_opts"][val]=key[val];else ret=ret["_opts"][key];return ret},"access":function(fn){if(fn){if(!fn.j){var _this=this;fn.j=function(){fn.call(_this)}}this["hasRight"]()?fn.j():this["_request"](fn.j)}else return this["_check"]()},"hasRight":function(){return this["access"]()==this["ALLOWED"]},"hasAccessDenied":function(){return this["access"]()==this["DENIED"]},"add":F,"say":function(){return this.add.apply(this,
arguments)},"bubble":function(){},"end":function(){return Jinn}};var Jinn={"API":api,"opt":function(name,val){if(val===undef)return _opts[name];_opts[name]=val;return Jinn},"on":function(name,fn){if(!_listeners[name])_listeners[name]=[];_listeners[name].push(fn);return Jinn},"off":function(name,fn){if(name in _listeners){var list=_listeners[name],i=list.length;for(;i--;)if(list[i]===fn){list.splice(i,1);break}}return Jinn},"emit":function(name,val){Jinn["store"](_eprefix+name,val);_emit()},"scope":function(name,
scope){var ret=Jinn;if(name==undef)ret=Jinn.scope(_opts["scope"]);else if(scope!==undef)_scope[name]=scope;else if(name in _scope)ret=_scope[name];else throw'Jinn: scope "'+name+'" is undefined';return ret},addEvent:function(node,name,fn){if(node){var on=node.addEventListener?"":"on";node[on?"attachEvent":"addEventListener"](on+name,fn,false)}}},_jinn="hasRight hasAccessDenied access bubble add say".split(" "),i=_jinn.length;while(i--)(function(name){Jinn[name]=function(){var scope=Jinn.scope(),ret=
scope[name].apply(scope,arguments);return ret===scope?Jinn:ret}})(_jinn[i]);Jinn["store"]=function(key,val){var ret=Jinn,store=Jinn.scope("__store");if(val===null)store.remove(_prefix+key);else if(val===undef)ret=store["get"](_prefix+key);else store["set"](_prefix+key,val);return ret};(function(){var storage,obj={};try{storage=window.localStorage}catch(e){}Jinn.scope("__store",{"get":function(key){return storage?storage.getItem(key):obj[key]},"set":function(key,val){storage?storage.setItem(key,val):
obj[key]=val},"remove":function(key){delete obj[key];if(storage)storage.removeItem(key)}})})();Jinn[(_agent.match(/webkit/)||_agent.match(/opera/)||_agent.match(/msie/)||_agent.indexOf("compatible")<0&&_agent.match(/mozilla/)||[])[0]]=true;if(Jinn["webkit"])Jinn[(_agent.match(/chrome/)||_agent.match(/safari/)||[])[0]]=true;Jinn.addEvent(window,"storage",_emit);window["Jinn"]=Jinn})(window,document)});define("toolkit.common/jinn/__os/jinn__os",["toolkit.common/jinn/jinn"],function(){(function(window,
document,Jinn,Notifications,undef){var api=Jinn["API"]["ext"]({"_tpl":"#JinnOSTpl","_opts":{"title":"","text":"","delay":60},"tpl":function(tpl){this["_tpl"]=tpl;return this},"add":function(notify){if(typeof notify=="string")notify={title:notify};this["_ext"](notify);var Notify=this["_create"](notify);Notify.show();if(notify["delay"])setTimeout(function(){Notify.cancel()},notify["delay"]*1E3);return Notify}});if(Notifications)api["methods"]({"_check":function(){return Notifications.checkPermission()},
"_request":function(fn){Notifications.requestPermission(fn)},"_create":function(notify){try{var notify=Notifications.createNotification(notify["icon"],notify["title"],notify["text"])}catch(err){throw"Notifications.createNotification \u2014 access denied";}return notify}});else{var _pad=5,_rvar=/\{\{(.*?)\}\}/g,_queue=[],Notify=function(tpl,notify){if(/^#/.test(tpl)){tpl=document.getElementById(tpl.substr(1));if(tpl)tpl=tpl.innerHTML}if(tpl){this.el=document.createElement("div");this.el.innerHTML=
tpl.replace(_rvar,function(a,key){return(new Function("notify,v,u","try{v="+key+'}catch(e){} return v===u?"":v'))(notify)});document.body.appendChild(this.el)}};Notify.redraw=function(){for(var y=_pad,i=0,n=_queue.length;i<n;i++){_queue[i].el.style.top=y+"px";y+=_queue[i].el.offsetHeight+_pad}};Notify.prototype={"show":function(){if(this.el){var _this=this,style=_this.el.style;_queue.push(_this);style.right="5px";style.position="fixed";style.display="block";Notify.redraw();_this.el.onclick=function(){_this["onclick"].call(_this,
{type:"click",target:_this,currentTarget:_this})}}},"cancel":function(){if(this.el){for(var i=0,n=_queue.length;i<n;i++)if(_queue[i]===this){_queue.splice(i,1);Notify.redraw()}this.el.onclick=null;this.el.parentNode.removeChild(this.el);this.el=null}},"onclick":function(){}};api["methods"]({"hasRight":function(){return!!this["_tpl"]},"_create":function(notify){return new Notify(this["_tpl"],notify)}})}Jinn.scope("OS",new (Jinn["OS"]=api))})(window,document,Jinn,window.webkitNotifications)});define("toolkit.common/jinn/__bubble/jinn__bubble",
["toolkit.common/jinn/__os/jinn__os"],function(){(function(window,document,Jinn,undef){var noop=function(){},_ricon=/(^|\s)icon(\s|$)/,_rdata=/^data/,_pid,_oSrc,_val=null,_img=new Image,_frame=0,_opts={"val":_val,"fps":2,"iconX":0,"iconY":0,"iconW":16,"iconH":16},_links=function(fn){var links=document.getElementsByTagName("link"),i=links.length;while(i--)if(_ricon.test(links[i].getAttribute("rel"))&&fn(links[i])===true)return links[i]},_setIcon=function(src){api.init();_links(function(node){node.parentNode.removeChild(node)});
var link=document.createElement("link");link.rel="icon";link.type="image/png";link.href=src;document.getElementsByTagName("head")[0].appendChild(link)},_canvas=document.createElement("canvas"),_support=function(){try{return!!~_canvas.toDataURL("image/png").indexOf("data:image/png")}catch(e){}}(),_redrawBubble=function(val){if(_support&&(_img["src"]!=_opts["src"]||_val!=val)){api.init();_canvas.width=_canvas.height=16;_img.src=_opts["src"];_img.onload=function(){function _draw(){var ctx=_canvas.getContext("2d");
ctx.clearRect(0,0,16,16);ctx.drawImage(_img,0,0,_img.width,_img.height,_opts["iconX"],_opts["iconY"],_opts["iconW"],_opts["iconH"]);_opts.shape(ctx,val,_frame,_opts);_setIcon(_canvas.toDataURL());if(_opts["fps"]<=++_frame)_frame=0}clearInterval(_pid);if(val===null||val===undef||!_opts["fps"])_frame=0;else _pid=setInterval(_draw,~~(1E3/_opts["fps"]+0.5));if(val===null||val===undef)_setIcon(_opts["src"]);else _draw()};if(!_rdata.test(_img.src))_img.crossOrigin="anonymous";else{_img.crossOrigin=null;
_img.removeAttribute("crossOrigin")}if(_img.width)_img.onload()}};_opts["shape"]=function(ctx,val,frame,opts){var x=15.5,y=15;val=val>99?(x+=0.5,"99+"):val;ctx.font=(Jinn.webkit?"bold ":"")+"9px arial";ctx.shadowOffsetX=0;ctx.shadowOffsetY=0;ctx.shadowBlur=2;ctx.shadowColor="rgba(0,0,0,.5)";ctx.fillStyle=frame?"#fc3":"#fff";ctx.textAlign="right";ctx.fillText(val,x,y);ctx.fillText(val,x,y);ctx.fillText(val,x,y)};var api={init:function(){api.init=noop;api.ready=1;var icon=_links(function(){return true});
if(icon){_oSrc=icon.href;api["opt"]("src",_opts.src||_oSrc)}},"src":function(src){return api["opt"]("src",src)},"shape":function(fn){api["opt"]("shape",fn);return this},"opt":function(key,val){var redraw=api.ready||_opts["val"]||key=="shape",emit;if(typeof key=="string"){if(val===undef)return _opts[key];_opts[key]=val}else for(var k in key){_opts[k]=key[k];redraw=redraw||k=="shape"}val=_opts["val"];if(redraw)_redrawBubble(val);if(val!==_val)Jinn["emit"]("bubble:val",val);_val=val},"set":function(val){api.init();
api["opt"]("val",val)},"revert":function(){api["opt"]("src",_oSrc)},"reset":function(){api["opt"]({"src":_oSrc,"val":null})},"clear":function(){api["opt"]("val",null)}};Jinn["OS"]["Bubble"]=api;Jinn.scope("OS")["bubble"]=function(name,val){if(typeof name=="object"&&name!==null)api["opt"](name);else if(name in api)api[name](val);else api.set(name);return Jinn};Jinn["on"]("bubble:val",function(val){api.set(val)})})(window,document,Jinn)});define("toolkit.common/jquery/__fn-ext/jquery__fn-ext",function(){(function(){$.fn.toggleClassSiblings=
function(name,selector){if(name)this.addClass(name).siblings(selector).removeClass(name);return this}})()});define("toolkit.common/jquery/__event-tap/jquery__event-tap",function(){(function(window,$){var support=window.TapSupportEnabled&&"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,TOUCH_DELTA=15,CLICK_DELTA=100,abs=Math.abs,clickCoordinates=[],dispatch=$.event.handle||$.event.dispatch;$.support.touch=support;$.event.touchStart=support?"touchstart":"mousedown";
$.event.touchEnd=support?"touchend":"mouseup";function preventGhostClick(point){var lastPoint=clickCoordinates[clickCoordinates.length-1];if(!lastPoint||lastPoint.x!==point.x||lastPoint.y!==point.y){clickCoordinates.push(point);window.setTimeout(preventGhostClickShift,2500)}}function preventGhostClickShift(){clickCoordinates.shift()}function getTouchXY(evt){evt=evt.originalEvent||evt;var touches=evt.touches.length?evt.touches:evt.changedTouches,touch=touches[0]||{};return{x:touch.clientX,y:touch.clientY}}
if(document.addEventListener)document.addEventListener("click",function(evt){for(var point,i=0,n=clickCoordinates.length;i<n;i++){point=clickCoordinates[i];if(abs(evt.clientX-point.x)<CLICK_DELTA&&abs(evt.clientY-point.y)<CLICK_DELTA){evt.stopPropagation();evt.preventDefault()}}},true);$.event.special.tap={setup:function(){var startPoint={};function onClick(evt){var retVal,type=evt.type;evt.type="tap";retVal=dispatch.apply(this,arguments);evt.type=type;return retVal}function onTouchStart(evt){var touches=
evt.originalEvent.touches;if(!/input|select|textarea/i.test(touches[0].target.nodeName)){startPoint=getTouchXY(evt);$(this).bind("touchend.tapEvent",onTouchEnd)}}function onTouchEnd(evt){$(this).unbind("touchend.tapEvent",onTouchEnd);var endPoint=getTouchXY(evt),retVal;if(abs(endPoint.x-startPoint.x)<TOUCH_DELTA&&abs(endPoint.y-startPoint.y)<TOUCH_DELTA){retVal=onClick.call(this,evt);if(retVal!==void 0&&!retVal||evt.isDefaultPrevented()||evt.isPropagationStopped())preventGhostClick(startPoint)}return retVal}
$(this).bind("click.tapEvent",onClick);if(support&&!$.touchSupportDisabled)$(this).bind("touchstart.tapEvent",onTouchStart)},teardown:function(){$(this).unbind(".tapEvent")}};$.fn.tap=function(fn){return this.bind("tap",fn)}})(window,jQuery)});define("toolkit.common/jquery/__event-special-input/jquery__event-special-input",function(){(function($){if("oninput"in document.documentElement)return 0;var input="input",ns=".inputEvent ",dataBnd="bound.inputEvent",dataVal="value.inputEvent",dataDlg="delegated.inputEvent",
bindTo=["textInput","propertychange","paste","cut","keydown","drop",""].join(ns),dlgtTo=["focusin","mouseover","dragstart",""].join(ns),supported={TEXTAREA:null,INPUT:null},delay={paste:null,cut:null,keydown:null,drop:null,textInput:null},timer=null;$.event.special[input]={setup:function(data,namespaces,handler){var bndCount,elem=this,$elem=$(this),triggered=false;if(typeof handler!=="function")return-1;if(supported[elem.tagName]!==void 0){bndCount=$.data(elem,dataBnd)||0;if(!bndCount)$elem.bind(bindTo,
handler);$.data(elem,dataBnd,++bndCount);$.data(elem,dataVal,elem.value)}else $elem.bind(dlgtTo,function(e){var target=e.target;if(supported[target.tagName]!==void 0&&!$.data(elem,dataDlg)){bndCount=$.data(target,dataBnd)||0;if(!bndCount)$(target).bind(bindTo,handler);$.data(elem,dataDlg,true);$.data(target,dataBnd,++bndCount);$.data(target,dataVal,target.value)}});function handler(e){var elem=e.target;window.clearTimeout(timer),timer=null;if(triggered)return;if(delay[e.type]!==void 0&&!timer)timer=
window.setTimeout(function(){if(elem.value!==$.data(elem,dataVal)){$(elem).trigger(input);$.data(elem,dataVal,elem.value)}},0);else if(e.type=="propertychange"){if(e.originalEvent.propertyName=="value"){$(elem).trigger(input);$.data(elem,dataVal,elem.value);triggered=true;window.setTimeout(function(){triggered=false},0)}}else{$(elem).trigger(input);$.data(elem,dataVal,elem.value);triggered=true;window.setTimeout(function(){triggered=false},0)}}},teardown:function(){var elem=$(this),bndCount;elem.unbind(dlgtTo);
elem.find("input, textarea").andSelf().each(function(){bndCount=$.data(this,dataBnd,($.data(this,dataBnd)||1)-1);if(!bndCount)elem.unbind(bindTo)})}}})(jQuery)});define("toolkit.common/jquery/__iframe-transport/jquery__iframe-transport",function(){(function($){var counter=0;$.ajaxTransport("iframe",function(options){if(options.async&&(options.type==="POST"||options.type==="GET")){var form,iframe;return{send:function(_,completeCallback){form=$('<form style="display:none;"></form>');form.attr("accept-charset",
options.formAcceptCharset);iframe=$('<iframe src="javascript:false;" name="iframe-transport-'+(counter+=1)+'"></iframe>');iframe.bind("load",function(){var fileInputClones,paramNames=$.isArray(options.paramName)?options.paramName:[options.paramName];iframe.unbind("load").bind("load",function(){var response;try{response=iframe.contents();if(!response.length||!response[0].firstChild)throw new Error;}catch(e){response=undefined}completeCallback(200,"success",{"iframe":response});$('<iframe src="javascript:false;"></iframe>').appendTo(form);
form.remove()});form.attr({target:iframe.attr("name"),action:options.url,method:options.type});if(options.formData){var inputs="";$.each(options.formData||{},function(name,value){inputs+='<input type="hidden" name="'+name+'"  value="'+value+'" />'});$(inputs).appendTo(form)}if(options.fileInput&&options.fileInput.length&&options.type==="POST"){fileInputClones=options.fileInput.clone();options.fileInput.after(function(index){return fileInputClones[index]});if(options.paramName)options.fileInput.each(function(index){$(this).attr("name",
paramNames[index]||options.paramName)});form.append(options.fileInput).attr("enctype","multipart/form-data").attr("encoding","multipart/form-data")}form.submit();if(fileInputClones&&fileInputClones.length)options.fileInput.each(function(index,input){var clone=$(fileInputClones[index]);$(input).attr("name",clone.attr("name"));clone.replaceWith(input)})});form.append(iframe).appendTo(document.body)},abort:function(){if(iframe)iframe.unbind("load").attr("src","javascript".concat(":false;"));if(form)form.remove()}}}});
$.ajaxSetup({converters:{"iframe text":function(iframe){return $(iframe[0].body).text()},"iframe json":function(iframe){return $.parseJSON($(iframe[0].body).text())},"iframe jsonp":function(iframe){var match=$(iframe[0].body).text().match(/^[\w\d-]*\((\{.*\})\)$/);if(match)return $.parseJSON(match[1])},"iframe html":function(iframe){return $(iframe[0].body).html()},"iframe script":function(iframe){return $.globalEval($(iframe[0].body).text())}}})})(jQuery)});define("toolkit.common/jquery/__placeholder/jquery__placeholder",
function(){(function($){function Placeholder(input){this.input=input;if(input.attr("type")=="password")this.handlePassword();$(input[0].form).submit(function(){if(input.hasClass("placeholder")&&input[0].value==input.attr("placeholder"))input[0].value=""})}Placeholder.prototype={show:function(loading){if(this.input[0].value===""||loading&&this.valueIsPlaceholder()){if(this.isPassword)try{this.input[0].setAttribute("type","text")}catch(e){this.input.before(this.fakePassword.show()).hide()}this.input.addClass("placeholder");
this.input[0].value=this.input.attr("placeholder")}},hide:function(){if(this.valueIsPlaceholder()&&this.input.hasClass("placeholder")){this.input.removeClass("placeholder");this.input[0].value="";if(this.isPassword){try{this.input[0].setAttribute("type","password")}catch(e){}this.input.show();this.input[0].focus()}}},valueIsPlaceholder:function(){return this.input[0].value==this.input.attr("placeholder")},handlePassword:function(){var input=this.input;input.attr("realType","password");this.isPassword=
true;if($.browser.msie&&input[0].outerHTML){var fakeHTML=$(input[0].outerHTML.replace(/type=(['"])?password\1/gi,"type=$1text$1"));this.fakePassword=fakeHTML.val(input.attr("placeholder")).addClass("placeholder").focus(function(){input.trigger("focus");$(this).hide()});$(input[0].form).submit(function(){fakeHTML.remove();input.show()})}}};var NATIVE_SUPPORT=!!("placeholder"in document.createElement("input"));$.fn.placeholder=function(){return NATIVE_SUPPORT?this:this.each(function(){var input=$(this);
var placeholder=new Placeholder(input);placeholder.show(true);input.focus(function(){placeholder.hide()});input.blur(function(){placeholder.show(false)});if($.browser.msie){$(window).load(function(){if(input.val())input.removeClass("placeholder");placeholder.show(true)});input.focus(function(){if(this.value==""){var range=this.createTextRange();range.collapse(true);range.moveStart("character",0);range.select()}})}})}})(jQuery)});define("toolkit.common/jquery/__param-fix/jquery__param-fix",function(){function buildParams(prefix,
obj,traditional,add){if(jQuery.isArray(obj)&&obj.length)jQuery.each(obj,function(i,v){if(traditional||rbracket.test(prefix))add(prefix,v);else buildParams(prefix+"["+(typeof v==="object"||jQuery.isArray(v)?i:"")+"]",v,traditional,add)});else if(!traditional&&obj!=null&&typeof obj==="object")if(jQuery.isArray(obj)||jQuery.isEmptyObject(obj))add(prefix,"");else for(var name in obj)buildParams(prefix+"["+name+"]",obj[name],traditional,add);else add(prefix,obj)}$.param=function(a,traditional){var s=[],
add=function(key,value){value=$.isFunction(value)?value():value;s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value)};if(traditional===undefined)traditional=$.ajaxSettings.traditional;if($.isArray(a)||a.jquery&&!jQuery.isPlainObject(a))$.each(a,function(){add(this.name,this.value)});else for(var prefix in a)buildParams(prefix,a[prefix],traditional,add);return s.join("&")}});jsLoader.use(["{jQuery}jquery","{toolkit.common}jquery/__fn-ext/jquery__fn-ext","{toolkit.common}jquery/__event-tap/jquery__event-tap",
"{toolkit.common}jquery/__event-special-input/jquery__event-special-input","{toolkit.common}jquery/__iframe-transport/jquery__iframe-transport","{toolkit.common}jquery/__placeholder/jquery__placeholder","{toolkit.common}jquery/__param-fix/jquery__param-fix","{toolkit.common}ajs/__array/ajs__array"],function(){(function($){$.browser.intVersion=parseInt($.browser.version,10);$.each($.browser,function(name,val){if(~"webkit opera mozilla msie".indexOf(name)&&val)$.browser.name=name});if($.browser.webkit){$.browser.chrome=
/Chrome|CriOS/.test(navigator.userAgent);$.browser.safari=!$.browser.chrome}if($.browser.msie)$.browser.label="IE"+$.browser.intVersion;else if($.browser.opera)$.browser.label="OPR"+$.browser.intVersion;else if($.browser.mozilla)$.browser.label="MOZ";else if($.browser.webkit)$.browser.label=$.browser.chrome?"CHR":"SFR";else $.browser.label="UNK";if(!$.browser.msie&&/trident\/\d+/i.test(navigator.userAgent)){$.browser.msie=true;$.browser.mozilla=false;$.browser.name="IE";$.browser.label="IE"+parseInt((/\brv[\s:]+(\d+(\.\d+)?)/g.exec(navigator.userAgent)||
[])[1]|0)}if(navigator.userAgent.match(/Opera (Mini|Mobi)[^;]*/))$.browser["opera"+RegExp.$1.toLowerCase()]=true;if(navigator.userAgent.match(/iPhone|iPod|iPad|iOS/i)){$.browser.ios=true;$.browser.label+="IOS"}if(/Android/.test(navigator.userAgent)){$.browser.android=true;$.browser.label+="AND"}$.event.props.push("dataTransfer");$.support.cssPrefix=$.browser.webkit?"Webkit":$.browser.mozilla?"Moz":$.browser.opera?"O":$.browser.msie?"ms":"";$.support.dnd=function(){var div=document.createElement("div");
if("draggable"in div||"ondragstart"in div&&"ondrop"in div){$("html").addClass("draganddrop");return true}}();$.support.animation=function(){var elm=document.createElement("x"),animation=false,animationstring="animation",keyframeprefix="",domPrefixes="Webkit Moz O ms Khtml".split(" "),pfx="";if(elm.style.animationName)animation=true;if(animation===false)for(var i=0;i<domPrefixes.length;i++)if(elm.style[domPrefixes[i]+"AnimationName"]!==undefined){pfx=domPrefixes[i];animationstring=pfx+"Animation";
keyframeprefix="-"+pfx.toLowerCase()+"-";animation=true;break}return animation}();$.support.transform=function(){var elm=document.createElement("x"),transformation=false,transformstring="transform",keyframeprefix="",domPrefixes="Webkit Moz O ms Khtml".split(" "),pfx="";if(elm.style.transform)transformation=true;if(transformation===false)for(var i=0;i<domPrefixes.length;i++)if(elm.style[domPrefixes[i]+"Transform"]!==undefined){pfx=domPrefixes[i];transformstring=pfx+"Transform";transformation=true;
break}return transformation}();function makeUnselectable(on,node){if(node.nodeType==1){var style=node.style;style["userSelect"]=style[$.support.cssPrefix+"UserSelect"]=on?"none":"";node.setAttribute("unselectable",on?"on":"off")}if($.browser.msie){node=node.firstChild;while(node){makeUnselectable(on,node);node=node.nextSibling}}}$.fn.extend({F:function(){return this},elm:function(n){return $(this[0].elements[n])},css3:function(props){this.css(props);if($.support.cssPrefix)this.each(function(){for(var key in props)this.style[$.camelCase($.support.cssPrefix+
"-"+key)]=isNaN(props[key])?props[key]:props[key]+"px"});return this},getSize:function(real){var rw,rh;if(real){rw=this.width();rh=this.height();this.css({width:"",height:""})}var w=this.outerWidth(),h=this.outerHeight();if(real&&(rw||rh))this.css({width:rw,height:rh});return{width:w,height:h}},replaceClass:function(s,r){for(var i=0,n=this.length;i<n;i++)this[i].className=this[i].className.replace(s,r);return this},item:$.fn.eq,unselectable:function(on){if(on!==undef)return this.each(function(){makeUnselectable(on,
this)});else return(this.attr("unselectable")||"").toLowerCase()=="on"},hitTest:function(el){if(typeof el=="string")el=$(el)[0];else if(el[0])el=el[0];else if(el.target)el=el.target;for(var i=0,a,x;i<this.length;i++){a=this[i];x=el;do if(a==x)return true;while(x=x.parentNode)}return false},insertFirst:$.fn.prependTo,toObject:function(f){var data={};this.find("INPUT,TEXTAREA,SELECT").each(function(){try{if(this.name&&(!this.disabled||f))switch(this.tagName){case "INPUT":case "TEXTAREA":if(this.type==
"checkbox"){if(f||this.checked)if(this.name.indexOf("[]")>0){if(!data[this.name])data[this.name]=[];data[this.name].push(this.checked?this.value:"")}else data[this.name]=this.checked?this.value:""}else if(this.type=="radio"){if(this.checked)data[this.name]=this.value}else data[this.name]=((window.InputValidator?InputValidator.get(this):0)||this).value;break;case "SELECT":data[this.name]=this.options[this.selectedIndex].value;break}}catch(e){debug.log(e)}});return data},scrollWidth:function(){return this[0]&&
this[0].scrollWidth?this[0].scrollWidth:0},scrollHeight:function(){return this[0]&&this[0].scrollHeight?this[0].scrollHeight:0},setPositionFixed:function(x,y){if($.browser.msie&&$.browser.version<9&&(!$.boxModel||$.browser.version<7)){var c=("IEPositionFixed"+x+"x"+y).replace(/%/g,"pr");if(!window[c]){$.iePositionFixed=true;var prX=true,prY=true;if(typeof x!="number"&&x.indexOf("%")>0)x=parseFloat(x)/100;else{x=parseFloat(x);prX=false}if(typeof y!="number"&&y.indexOf("%")>0)y=parseFloat(y)/100;else{y=
parseFloat(y);prY=false}window[c]=function(elm){var S=elm.style;S.position="absolute";S.left=Math.max((prX?ajs.windowWidth():1)*x+ajs.scrollLeft(),0)+"px";S.top=Math.max((prY?ajs.windowHeight():1)*y+ajs.scrollTop(),0)+"px"}}this.removePositionFixed().each(function(){this.ieFixed=1;this.style.setExpression("wordWrap",c+"(this)")})}else this.css({position:"fixed",top:y,left:x});return this},removePositionFixed:function(){return this.each(function(){if(this.ieFixed)this.style.removeExpression("wordWrap");
this.ieFixed=0})},innerHTML:function(h){if(h===undef)return this.attr("innerHTML");else return this.each(function(){this.innerHTML=h})},display:function(type){if(type!==undef&&typeof type!=="string")type=!type?"none":"";return this.css("display",type)},findWithRoot:function(selector){return this.filter(selector).add(this.find(selector))},form__select:function(){return this.each(function(){var container=$(this);if(container.data("inited"))return;var select=container.find("select"),text=container.find(".js-text");
select.bind("change keyup",function(){var option=select.children(":selected");text.text(option.attr("data-name")||option.text())});select.trigger("change");select.bind("focus",function(){container.addClass("form__select_focus")});select.bind("blur",function(){container.removeClass("form__select_focus")});container.data("inited",true)})},form__switcher:function(){return this.each(function(){var switcher=$(this),inputs=switcher.find("input");inputs.click(function(){switcher.find(".form__switcher").replaceClass(/form__switcher_\w+_selected/,
"");if(inputs.filter(":checked").val()==="on")switcher.find(".form__switcher_options_positive").addClass("form__switcher_options_positive_selected");else switcher.find(".form__switcher_options_negative").addClass("form__switcher_options_negative_selected")})})},form__time:function(){return this.each(function(){$(this).find(".form__spinbox").form__spinbox()})},form__spinbox:function(){var repeatInterval=250;return this.each(function(){function pad(value){if(zeropad)return("000000"+value).slice(-zeropad);
else return value}function increase(){var value=Number(input.val())+step;if(value<=max)input.val(pad(value))}function decrease(){var value=Number(input.val())-step;if(value>=min)input.val(pad(value))}function stop(){clearInterval(timer);timer=null}var container=$(this),input=container.find(".js-number"),min=input.data("min")!=="undefined"?Number(input.data("min")):-Infinity,max=input.data("max")!=="undefined"?Number(input.data("max")):Infinity,step=Number(input.data("step")||1),zeropad=Number(input.data("zeropad")),
inc=container.find(".js-inc"),dec=container.find(".js-dec"),timer;inc.bind("mousedown",function(){if($(this).attr("disabled"))return;increase();timer=setInterval(increase,repeatInterval);return false});inc.bind("mouseup",stop);dec.bind("mousedown",function(){if($(this).attr("disabled"))return;decrease();timer=setInterval(decrease,repeatInterval);return false});dec.bind("mouseup",stop);input.bind("keydown",function(e){if(e.keyCode===38)increase();else if(e.keyCode===40)decrease()})})},form__disable:function(){return this.each(function(){var container=
$(this);container.addClass("form_disabled");container.findWithRoot("input,textarea,select,a,button").attr("disabled","disabled");container.findWithRoot(".form__field").addClass("form__field_disabled");container.findWithRoot(".form__field__wrapper").addClass("form__field__wrapper_disabled");container.findWithRoot(".form__select").addClass("form__select_disabled");container.findWithRoot(".form__spinbox").addClass("form__spinbox_disabled");container.findWithRoot(".form__button").addClass("form__button_disabled");
container.findWithRoot(".btn").addClass("btn_disabled");container.findWithRoot("a").bind("click.form__disable",function(){return false})})},form__enable:function(){return this.each(function(){var container=$(this);container.removeClass("form_disabled");container.findWithRoot("input,textarea,select,a,button").removeAttr("disabled");container.findWithRoot(".form__field").removeClass("form__field_disabled");container.findWithRoot(".form__field__wrapper").removeClass("form__field__wrapper_disabled");
container.findWithRoot(".form__select").removeClass("form__select_disabled");container.findWithRoot(".form__spinbox").removeClass("form__spinbox_disabled");container.findWithRoot(".form__button").removeClass("form__button_disabled");container.findWithRoot(".btn").removeClass("btn_disabled");container.findWithRoot("a").unbind("click.form__disable")})},form__toggle:function(condition){var action="form__"+(condition?"enable":"disable");return this[action]()},toggleSiblings:function(name,selector){if(name)this.addClass(name).siblings(selector).removeClass(name);
return this}});var _bind=$.fn.bind,qName="eventQueue"+$.expando+"_";function _check($el,type,func){var queue=$el.data(qName+type);if(queue){var evt=$.Event(queue[0]);evt.preventDefault();evt.stopPropagation();func.call($el[0],evt,queue[1])}}$.fn.dispatch=function(evt,data,queue){var key=qName+($.type(evt)==="string"?evt:evt.type);if(queue)this.data(key,[evt,data]);else if(this.data(key))this.removeData(key);return this.triggerHandler(evt,data)};$.fn.bind=function(events,data,func){if(this[0]){if($.isFunction(data)){func=
data;data=undef}if($.type(events)!=="object"){var names=events.split(/\s+/),i=0,n=names.length;for(;i<n;i++)_check(this,names[i],func)}}return _bind.call(this,events,data,func)};ajs.offline=!!patron["OfflineMode"];if(!patron["ForceOfflineMode"])$(window).bind("online offline",function(evt){var offline=evt.type=="offline";if(ajs.offline!=offline)$(window).triggerHandler("offlinechange",[ajs.offline=offline])});(function(){var prop,eventName,vis={hidden:"visibilitychange",mozHidden:"mozvisibilitychange",
webkitHidden:"webkitvisibilitychange",msHidden:"msvisibilitychange",oHidden:"ovisibilitychange"};for(prop in vis)if(vis.hasOwnProperty(prop)&&prop in document){eventName=vis[prop];break}if(eventName)document.addEventListener(eventName,onchange);else if($.browser.msie&&$.browser.intVersion<10)$(document).bind("focusin focusout",onchange);else $(window).bind("focus blur",onchange);function onchange(evt){var hidden;if(evt.type=="focus"||evt.type=="focusin")hidden=false;else if(evt.type=="blur"||evt.type==
"focusout")hidden=true;else hidden=!!document[prop];if(ajs.blurred!==hidden){ajs.blurred=hidden;$(window).triggerHandler("visibilitychange",[hidden])}}})();(function(){var _clickFn={};$.click=function(name,fn){if(!fn){fn=name;name="default"}if(!_clickFn[name])_clickFn[name]=[];_clickFn[name].push(fn)};$(document).tap(function(evt){var node=evt.target,name,clickFn,res;if(node){do if(node.nodeType==1){name=node.getAttribute("data-click");evt.currentTarget=node;if(name===null&&node.tagName=="A")name=
"default";clickFn=_clickFn[name];if(typeof clickFn!=="undefined"){for(var i=0,n=clickFn.length;i<n;i++){res=clickFn[i].call(node,evt);if(evt.isImmediatePropagationStopped())return}if(evt.isPropagationStopped())return}}while((node=node.parentNode)&&node!==document.body)}})})();$.scrollbarWidth=0;$(function(){var $el=$('<div style="overflow: scroll;"><div></div></div>').appendTo("body");$.scrollbarWidth=$el.width()-$el.children().width();$el.remove()});$.hideScrollbar=function(){$ScrollElement.last().css({overflow:"hidden",
marginRight:$.scrollbarWidth})};$.showScrollbar=function(){$ScrollElement.last().css({overflow:"",marginRight:""})};(function(Deferred){jQuery.Deferred=function(){var dfd=Deferred.apply(jQuery,arguments);dfd.always=function(fn){return dfd.done(fn).fail(fn)};return dfd}})(jQuery.Deferred)})(jQuery);jsLoader.loaded("{jQuery}extensions")});jsLoader.use("{jQuery}jquery",function(){(function(window,document,jQuery){var head=document.getElementsByTagName("head")[0],loadedCompleteRegExp=/loaded|complete/,
callbacks={},callbacksNb=0,timer,cache={};var _init=function(){_init=jQuery.noop;var s=document.styleSheets,i=s.length,h;for(;i--;)if(h=s[i].href)cache[h.split("?")[0]]=true};jQuery.getCSS=function(url,options,callback){_init();if(jQuery.isFunction(options)){callback=options;options={}}if(typeof url!=="string"){var i=0,c=url.length,t=0,func=function(){if(++t==c)callback()};for(;i<c;i++)jQuery.getCSS(url[i],options,func);return}var href=url.split("?")[0];if(!options.noCache&&cache[href]){callback();
return}var link;cache[href]=true;if(document.createStyleSheet){link=document.createStyleSheet(url);if(options.check){var pidFail,pidDone=setInterval(function(){if(options.check()){clearTimeout(pidFail);clearInterval(pidDone);callback(link,"success")}},30);pidFail=setTimeout(function(){callback(link,"error");clearInterval(pidDone)},1E4)}else callback(link,"success");return}else link=document.createElement("link");link.rel="stylesheet";link.type="text/css";link.media=options.media||"screen";link.href=
url;if(options.charset)link.charset=options.charset;if(options.title)callback=function(callback){return function(){link.title=options.title;callback(link,"success")}}(callback);if(link.readyState)link.onreadystatechange=function(){if(loadedCompleteRegExp.test(link.readyState)){link.onreadystatechange=null;callback(link,"success")}};else if(link.onload===null&&link.all)link.onload=function(){link.onload=null;callback(link,"success")};else{callbacks[link.href]=function(){callback(link,"success")};if(!callbacksNb++)timer=
window.setInterval(function(){var callback,stylesheet,stylesheets=document.styleSheets,href,i=stylesheets.length;while(i--){stylesheet=stylesheets[i];if((href=stylesheet.href)&&(callback=callbacks[href]))try{callback.r=stylesheet.cssRules;throw"SECURITY";}catch(e){if(/SECURITY/i.test(e)){callback(link,"success");delete callbacks[href];if(!--callbacksNb)timer=window.clearInterval(timer)}}}},13)}try{head.appendChild(link)}catch(er){}}})(this,this.document,this.jQuery);jsLoader.loaded("{jQuery}jquery.getCSS")});
(function($){if(window.XDomainRequest&&$.ajaxSettings.xhr().withCredentials===undefined)$.ajaxTransport(function(s){if(s.crossDomain&&s.async){if(s.timeout){s.xdrTimeout=s.timeout;delete s.timeout}var xdr;return{send:function(headers,completeCallback){function callback(status,statusText,responses,responseHeaders){xdr.onload=xdr.onerror=xdr.ontimeout=$.noop;xdr=null;completeCallback(status,statusText,responses,responseHeaders)}xdr=new XDomainRequest;if(s.type==="DELETE"){s.url=s.url+(/\?/.test(s.url)?
"&":"?")+"_method=DELETE";s.type="POST"}else if(s.type==="PUT"){s.url=s.url+(/\?/.test(s.url)?"&":"?")+"_method=PUT";s.type="POST"}xdr.open(s.type,s.url);xdr.onload=function(){callback(200,"OK",{text:xdr.responseText},"Content-Type: "+xdr.contentType)};xdr.onerror=function(){callback(404,"Not Found")};if(s.xdrTimeout){xdr.ontimeout=function(){callback(0,"timeout")};xdr.timeout=s.xdrTimeout}xdr.send(s.hasContent&&s.data||null)},abort:function(){if(xdr){xdr.onerror=$.noop();xdr.abort()}}}}})})(jQuery);
jsLoader.loaded("{jQuery}jquery.xdr-transport");jsLoader.use(["{jQuery}jquery","{utils}Lang","{jsCore}Date"],function(){(function($){var _func={},_ra=/'/g,_rtxt=/((^|%>).*?(<%|$))/g;function tmpl(str,id){var source="with(ctx){__buf.push('"+str.replace(/[\r\t\n]/g," ").replace(_rtxt,function(a){return a.replace(_ra,"\\'")}).split("<%").join("\t").replace(/\t-(.*?)%>/g,"', $1,'").replace(/\t=(.*?)%>/g,"', htmlEscape($1),'").split("\t").join("');").split("%>").join("__buf.push('")+"');}";return new Function("ctx",
'var __buf = [], htmlEscape = function (text) { return text == null ? "" : ajs.Html.escape(text.toString()); }; try {\n'+source+"\n} catch (err) { ajs.log('[tpl.error] \""+id+"\" -- runtime'); ajs.log(err); } "+'return __buf.join("");')}$.preloadTpl=function(id,html){if(!(id in _func)){_func[id]=$.noop;if(!html)html=$(id).remove().attr("innerHTML");else if(html.jquery)html=html.attr("innerHTML")||html.val();if(html)try{_func[id]=tmpl(html,id)}catch(err){ajs.log('[tpl.error]: "'+id+'" -- compile fail');
ajs.log(err)}else ajs.log('[tpl.error]: "'+id+'" -- not found')}};$.tpl=function(id,data){$.preloadTpl(id);return _func[id](data)};$.fn.tpl=function(id,data){return this.innerHTML($.tpl(id,data))}})(jQuery);window.TPL={def:{},date:function(date,format){return Date.parse(date).format(format)},or:function(x,t,f){return!!x?t:f},getDef:function(key,opts){return ajs.extend(TPL.def[key]||{},opts)}};jsLoader.loaded("{jQuery}jquery.tpl")});define("toolkit.common/jquery/__fest/jquery__fest",function(){$.fest=
function(url,data,callback){var success=function(){var html;if(window.fest[url])html=window.fest[url](data);else $(window).triggerHandler("fest.notDefinedTemplateMethod",[url]);if(typeof callback==="function")callback(html);return html};if(window.fest&&window.fest[url]!==undefined)return success();else{var script="/fest/"+url+".js";$(window).triggerHandler("fest.connection.progress",[script]);$.getScript(script).done(function(response,status,jqXHR){$(window).triggerHandler("fest.connection.success",
[script]);window.setTimeout(success,1)}).fail(function(jqXHR,settings,exception){$(window).triggerHandler("fest.connection.error",[script,exception])})}};$.fn.fest=function(url,data,callback){$.fest(url,data,function(html){this.trigger("destroy.view");this.each(function(){while(this.firstChild)this.removeChild(this.firstChild);this.innerHTML=html});if(typeof html==="string"&&html.indexOf('data-rb="show"')>-1)this.find('[data-rb="show"]').trigger("rb-show");if(callback&&callback instanceof Function)callback.call()}.bind(this));
return this}});jsLoader.use(["{toolkit.common}jquery/__fest/jquery__fest"],function(){$(window).bind({"fest.connection.progress":function(event,url){$.fest.state=$.fest.state||setTimeout(function(){patron.Notify.add("load",{delay:0,text:Lang.get("notify.load.still"),group:"fest"})},1E3*1);ajs.log("[fest] the template",url,"is loading")},"fest.connection.error":function(event,url,exception){clearTimeout($.fest.state);patron.Notify.add("error",{delay:0,text:Lang.get("notify.connection.error"),group:"fest"});
ajs.log("[fest] cannot load the template",url,"\n",exception)},"fest.connection.success":function(event,url){clearTimeout($.fest.state);ajs.log("[fest] the template",url,"loaded");patron.Notify.hide("fest")},"fest.notDefinedTemplateMethod":function(url){ajs.log("jQuery.fest.error: "+url+" not found")}});jsLoader.loaded("{jQuery}jquery.fest-x")});jsLoader.use(["{jQuery}jquery","{toolkit.common}ajs/__string/ajs__string"],function(){(function($){$.fn.extend({autocomplete:function(urlOrData,options){var isUrl=
typeof urlOrData=="string";options=$.extend({},$.Autocompleter.defaults,{url:isUrl?urlOrData:null,data:isUrl?null:urlOrData,delay:isUrl?$.Autocompleter.defaults.delay:10,max:options&&!options.scroll?10:150},options);options.highlight=options.highlight||function(value){return value};options.formatMatch=options.formatMatch||options.formatItem;return this.each(function(){new $.Autocompleter(this,options)})},result:function(handler){return this.bind("result",handler)},search:function(handler){return this.trigger("search",
[handler])},flushCache:function(){return this.trigger("flushCache")},setOptions:function(options){return this.trigger("setOptions",[options])},setData:function(data){return this.trigger("setData",[data])},unautocomplete:function(){return this.trigger("unautocomplete")}});$.Autocompleter=function(input,options){var KEY={UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8};var $input=$(input).attr("autocomplete","off").addClass(options.inputClass);var timeout;var previousValue=
"";var cache=$.Autocompleter.Cache(options);var hasFocus=0;var caretPos={start:0,end:0};var lastKeyPressCode;var config={mouseDownOnSelect:false};var select=$.Autocompleter.Select(options,input,selectCurrent,config);$input.bind("keydown.autocomplete",function(event){lastKeyPressCode=event.keyCode;switch(event.keyCode){case KEY.UP:if(select.visible()){event.preventDefault();select.prev()}else onChange(0,true);break;case KEY.DOWN:if(select.visible()){event.preventDefault();select.next()}else onChange(0,
true);break;case KEY.PAGEUP:if(select.visible()){event.preventDefault();select.pageUp()}else onChange(0,true);break;case KEY.PAGEDOWN:if(select.visible()){event.preventDefault();select.pageDown()}else onChange(0,true);break;case KEY.TAB:case KEY.RETURN:if(selectCurrent(event)){event.preventDefault();return false}break;case KEY.ESC:select.hide();break;default:caretPos=$.Autocompleter.getCaretPosition(input);clearTimeout(timeout);timeout=setTimeout(onChange,options.delay);break}}).focus(function(){caretPos=
$.Autocompleter.getCaretPosition(input);hasFocus++;if(options.multiple){var list=$.grep(trimWords($input.val()),$.trim);if(list.length){var value=list.join(options.multipleSeparator);$input.val(value+options.multipleSeparator);if(caretPos.start==caretPos.end&&caretPos.start==value.length)caretPos.start=caretPos.end=caretPos.start+options.multipleSeparator.length;$.Autocompleter.Selection(input,caretPos.start,caretPos.end);$input.change()}}}).blur(function(){hasFocus=0;if(!config.mouseDownOnSelect)hideResults();
if(options.multiple){var list=$.grep(trimWords($input.val()),$.trim);$input.val(list.join(options.multipleSeparator)).change()}}).click(function(){caretPos=$.Autocompleter.getCaretPosition(input);if(hasFocus++>1&&!select.visible())onChange(0,true)}).bind("search",function(){var fn=arguments.length>1?arguments[1]:null;function findValueCallback(q,data){var result;if(data&&data.length)for(var i=0;i<data.length;i++)if(data[i].result.toLowerCase()==q.toLowerCase()){result=data[i];break}if(typeof fn==
"function")fn(result);else $input.trigger("result",result&&[result.data,result.value])}$.each(trimWords($input.val()),function(i,value){request(value,findValueCallback,findValueCallback)})}).bind("clearPreviousValue",function(){previousValue=""}).bind("flushCache",function(){cache.flush()}).bind("setOptions",function(){$.extend(options,arguments[1]);if("data"in arguments[1])cache.populate();if(hasFocus)$input.click()}).bind("setData",function(){options.data=arguments[1];if(options.data.length)cache.populate();
else cache.flush()}).bind("unautocomplete",function(){select.unbind();$input.unbind();$(input.form).unbind(".autocomplete")});function selectCurrent(event){var current=select.current();var selected=select.selected();if(!selected)return false;var v=selected.result;previousValue=v;var inputValue=$input.val();if(options.multiple){var value=$input.val();var a=$.grep(trimWords(value.substr(0,caretPos.start)),$.trim);var b=$.grep(trimWords(value.substr(caretPos.end)),$.trim);a[a.length-1]=v;var c=a.concat(b);
v=c.join(options.multipleSeparator)+options.multipleSeparator}$input.triggerHandler("selectvalue",[v,current]);$input.val(v);$.Autocompleter.Selection(input,input.value.length,input.value.length);hideResultsNow();$input.trigger("result",[selected.data,selected.value,event,inputValue]);return true}function onChange(crap,skipPrevCheck){if(lastKeyPressCode==KEY.DEL){select.hide();return}var currentValue=$input.val();if(!skipPrevCheck&&currentValue==previousValue)return;previousValue=currentValue;if(options.multiple)currentValue=
lastWordByCaretPosition(currentValue);else currentValue=lastWord(currentValue);if(currentValue&&currentValue.length>=options.minChars){$input.addClass(options.loadingClass);if(!options.matchCase)currentValue=currentValue.toLowerCase();request(currentValue,receiveData,hideResultsNow)}else{stopLoading();select.hide()}}function trimWords(value){var a=value.match(/".*?"/g)||[];var r=[];var o,i,l;for(i=0,l=a.length;i<l;i++){o={"from":a[i],"to":a[i].replace(options.multipleSeparatorPattern,"_")};value=
value.replace(o.from,o.to);r.push(o)}var r2=value.split(options.multipleSeparatorPattern);for(i=0,l=r2.length;i<l;i++){for(var i2=0,l2=r.length;i2<l2;i2++)r2[i]=r2[i].replace(r[i2].to,r[i2].from);r2[i]=$.trim(r2[i])}return r2}$.Autocompleter.trimWords=trimWords;function lastWordByCaretPosition(value){caretPos=$.Autocompleter.getCaretPosition(input);return lastWord(value.substr(0,caretPos.start))}function lastWord(value){if(!options.multiple)return value;var words=trimWords(value);return words[words.length-
1]}function autoFill(q,sValue){if(options.autoFill&&lastWord($input.val()).toLowerCase()==q.toLowerCase()&&lastKeyPressCode!=KEY.BACKSPACE){$input.val($input.val()+sValue.substring(lastWord(previousValue).length));$.Autocompleter.Selection(input,previousValue.length,previousValue.length+sValue.length)}}function hideResults(){clearTimeout(timeout);timeout=setTimeout(hideResultsNow,200)}function hideResultsNow(){var wasVisible=select.visible();select.hide();clearTimeout(timeout);stopLoading();if(options.mustMatch)$input.search(function(result){if(!result)if(options.multiple){var words=
trimWords($input.val()).slice(0,-1);$input.val(words.join(options.multipleSeparator)+(words.length?options.multipleSeparator:""))}else $input.val("")});if(hasFocus&&wasVisible);}function receiveData(q,data){if(data){if(options.filter)data=$.grep(data,options.filter,false);if(data.length&&hasFocus){stopLoading();select.display(data,q);autoFill(q,data[0].value);select.show()}else hideResultsNow()}else hideResultsNow()}function request(term,success,failure){if(!options.matchCase)term=term.toLowerCase();
var data=cache.load(term);$input.triggerHandler("beforesearch",[term,data]);if($.isArray(data))success(term,data);else if(typeof options.url=="string"&&options.url.length>0){var extraParams={timestamp:+new Date};$.each(options.extraParams,function(key,param){extraParams[key]=typeof param=="function"?param():param});var params={mode:"abort",port:"autocomplete"+input.name,dataType:options.dataType,url:options.url,data:$.extend({limit:options.max},extraParams),success:function(data){var parsed=options.parse&&
options.parse(data)||parse(data);cache.add(term,parsed);success(term,parsed)}};params.data[options.queryVarName]=options.prepareQuery(lastWord(term));$.ajax(params)}else{select.emptyList();$input.triggerHandler("failsearch",[term]);failure(term)}}function parse(data){var parsed=[];var rows=data.split("\n");for(var i=0;i<rows.length;i++){var row=$.trim(rows[i]);if(row){row=row.split("|");parsed[parsed.length]={data:row,value:row[0],result:options.formatResult&&options.formatResult(row,row[0])||row[0]}}}return parsed}
function stopLoading(){$input.removeClass(options.loadingClass)}};$.Autocompleter.defaults={prepareQuery:function(term){return term},queryVarName:"q",parent:$(document.body),inputClass:"ac_input",resultsClass:"ac_results",resultListClass:"",resultListItem:"",resultsActiveClass:"ac_over",loadingClass:"ac_loading",minChars:1,delay:400,matchCase:false,matchSubset:true,matchContains:false,cacheLength:10,max:100,mustMatch:false,extraParams:{},selectFirst:true,formatItem:function(row){return row[0]},formatMatch:null,
autoFill:false,width:0,multiple:false,multipleSeparator:", ",highlight:function(value,term){return value.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+String.preg_quote(term)+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>")},scroll:true,scrollHeight:180};$.Autocompleter.Cache=function(options){var data={},length=0;function matchSubset(s,sub){if(!options.matchCase){s=s.toLowerCase();sub=sub.toLowerCase()}var i=s.indexOf(sub);if(options.matchContains=="word")s.replace(/^"?(.*?)"?\s+<(.*?)>$/,function(m0,
m1,m2){var p=/[\.\s]/,a=m1.split(p).concat(m2.split(/@/)[0].split(p)).concat([m1,m2]);for(var l=a.length;l--;)if((i=a[l].indexOf(sub))===0)break});return i===0}function add(q,value){if(length>options.cacheLength)flush();if(!data[q])length++;data[q]=value}function populate(){if(!options.data)return false;var stMatchSets={},nullData=0;if(!options.url)options.cacheLength=1;stMatchSets[""]=[];for(var i=0,ol=options.data.length;i<ol;i++){var rawValue=options.data[i];rawValue=typeof rawValue=="string"?
[rawValue]:rawValue;var value=options.formatMatch(rawValue,i+1,options.data.length);if(value===false)continue;var firstChar=value.charAt(0).toLowerCase();if(options.rawList)firstChar="_";if(!stMatchSets[firstChar])stMatchSets[firstChar]=[];var row={value:value,data:rawValue,result:options.formatResult&&options.formatResult(rawValue)||value};stMatchSets[firstChar].push(row);if(nullData++<options.max)stMatchSets[""].push(row)}$.each(stMatchSets,function(i,value){options.cacheLength++;add(i,value)})}
setTimeout(populate,25);function flush(){data={};length=0}return{flush:flush,add:add,populate:populate,load:function(q){var result=[],c,k,i,regexp=$.Autocompleter.CreateFindRegExp(q);if(!options.cacheLength||!length)return result;if(!options.url&&options.matchContains)for(k in data){if(k.length>0){c=data[k];i=0;for(var len=c.length,x;i<len;i++){x=c[i];if($.Autocompleter.MatchSubsetByRegExp(x.value,regexp))result.push(x)}}}else if(data[q])result=data[q];else if(options.matchSubset)for(i=q.length-1;i>=
options.minChars;i--){c=data[q.substr(0,i)];if(c){result=[];$.each(c,function(i,x){if(matchSubset(x.value,q))result[result.length]=x})}}return result}}};$.Autocompleter.Select=function(options,input,select,config){var listItems,active=-1,data,term="",needsInit=true,element,list;function init(){if(!needsInit)return;element=$("<div/>").addClass(options.resultsClass).appendTo(options.parent);if(options.parent.is("BODY"))element.css("position","absolute").hide();else options.parent.hide();list=$('<ul class="'+
options.resultListClass+'"></ul>');list.appendTo(element);list.mouseover(function(event){if(target(event).nodeName&&target(event).nodeName.toUpperCase()=="LI"){active=$("li",list).removeClass(options.resultsActiveClass).index(target(event));$(target(event)).addClass(options.resultsActiveClass)}}).click(function(event){$(target(event)).addClass(options.resultsActiveClass);select(event);input.focus();return false}).mousedown(function(){config.mouseDownOnSelect=true}).mouseup(function(){config.mouseDownOnSelect=
false});if(options.width>0)element.css("width",options.width);needsInit=false}function target(event){var element=event.target;while(element&&element.tagName!="LI")element=element.parentNode;if(!element)return[];return element}function moveSelect(step){listItems.slice(active,active+1).removeClass(options.resultsActiveClass);movePosition(step);var activeItem=listItems.slice(active,active+1).addClass(options.resultsActiveClass);if(options.scroll){var offset=0;listItems.slice(0,active).each(function(){offset+=
this.offsetHeight});if(offset+activeItem[0].offsetHeight-list.scrollTop()>list[0].clientHeight)list.scrollTop(offset+activeItem[0].offsetHeight-list.innerHeight());else if(offset<list.scrollTop())list.scrollTop(offset)}}function movePosition(step){active+=step;if(active<0)active=listItems.size()-1;else if(active>=listItems.size())active=0}function limitNumberOfItems(available){return options.max&&options.max<available?options.max:available}function fillList(){list.empty();var max=limitNumberOfItems(data.length);
for(var i=0;i<max;i++){if(!data[i])continue;var formatted=options.formatItem(data[i].data,i+1,max,data[i].value,term);if(formatted===false)continue;var li=$('<li class="'+options.resultListItem+" "+(i%2==0?"ac_even":"ac_odd")+'">'+options.highlight(formatted,term)+"</li>");list.append(li);$.data(li[0],"ac_data",data[i])}listItems=list.find("li");if(options.selectFirst){listItems.slice(0,1).addClass(options.resultsActiveClass);active=0}if($.fn.bgiframe)list.bgiframe()}return{display:function(d,q){init();
data=d;term=q;fillList()},next:function(){moveSelect(1)},prev:function(){moveSelect(-1)},pageUp:function(){if(active!=0&&active-8<0)moveSelect(-active);else moveSelect(-8)},pageDown:function(){if(active!=listItems.size()-1&&active+8>listItems.size())moveSelect(listItems.size()-1-active);else moveSelect(8)},hide:function(){if(options.parent.is("BODY"))element&&element.hide();else options.parent.hide();listItems&&listItems.removeClass(options.resultsActiveClass);options.parent.parent().andSelf().css("zIndex",
"");active=-1},visible:function(){return element&&element.is(":visible")},current:function(){return this.visible()&&(listItems.filter("."+options.resultsActiveClass)[0]||options.selectFirst&&listItems[0])},show:function(){var offset=$(input).offset();if(options.parent.is("BODY"))element.css({width:typeof options.width=="string"||options.width>0?options.width:$(input).width(),top:offset.top+input.offsetHeight,left:offset.left}).show();else options.parent.show();options.parent.parent().andSelf().css("zIndex",
3E4);if(typeof options.onshow==="function")options.onshow();if(options.scroll){list.scrollTop(0);list.css({maxHeight:options.scrollHeight,overflow:"auto"});if($.browser.msie&&typeof document.body.style.maxHeight==="undefined"){var listHeight=0;listItems.each(function(){listHeight+=this.offsetHeight});var scrollbarsVisible=listHeight>options.scrollHeight;list.css("height",scrollbarsVisible?options.scrollHeight:listHeight);if(!scrollbarsVisible)listItems.width(list.width()-parseInt(listItems.css("padding-left"))-
parseInt(listItems.css("padding-right")))}}},selected:function(){var selected=listItems&&listItems.filter("."+options.resultsActiveClass).removeClass(options.resultsActiveClass);return selected&&selected.length&&$.data(selected[0],"ac_data")},emptyList:function(){list&&list.empty()},unbind:function(){element&&element.remove()}}};$.Autocompleter.Selection=function(field,start,end){if(end===undef)end=start;try{if(field.createTextRange){var selRange=field.createTextRange();selRange.collapse(true);selRange.moveStart("character",
start);selRange.moveEnd("character",end-start);selRange.select()}else if(field.setSelectionRange)field.setSelectionRange(start,end);else if(field.selectionStart){field.selectionStart=start;field.selectionEnd=end}field.focus()}catch(e){}};$.Autocompleter.getCaretPosition=function(field){var start=0,end=0;if(document.getSelection||window.getSelection){start=field.selectionStart;end=field.selectionEnd}else if(document.selection)try{field.focus();var sel=document.selection.createRange();var clone=sel.duplicate();
sel.collapse(true);clone.moveToElementText(field);clone.setEndPoint("EndToEnd",sel);start=clone.text.length;sel=document.selection.createRange();clone=sel.duplicate();sel.collapse(false);clone.moveToElementText(field);clone.setEndPoint("EndToEnd",sel);end=clone.text.length}catch(er){}return{start:start,end:end}};var _map;$.Autocompleter.Translit=function(str){if(!_map){_map={};var data=Lang.get("translit");$.each(data,function(k,v){if($.isArray(v))$.each(v,function(k2,v2){_map[v2]=k});else _map[v]=
_map[k]=v})}var a=str.split("");for(var i=a.length;i--;)a[i]=_map[a[i]]||a[i];return a.join("")};var RegExpFinder=function(){var _translit_ru,_translit_en,_spliter=/[\.\s]/,_email_spliter=/@/;function getSubstrValues(str){var isUpperCased,value=_translit_en[str]||_translit_ru[str]||(str=str.toLocaleLowerCase(),isUpperCased=true)&&(_translit_en[str]||_translit_ru[str]),result=[],len;if(value)result=result.concat(value,str);else if(str.length==1)result.push(str);for(len=result.length;len--;){str=result[len];
if($.trim(str)){str=result[len]=String.preg_quote(str);if(isUpperCased){str=str.charAt(0).toUpperCase()+str.substr(1,str.length);result[len]=str}}else result[len]="\\s+"}return result}function createCondition(parts,and){var result=parts.join(and?"":"|");if(parts.length>1)result="("+result+")";return result}function createRegExp(str){str=str===undef||str===null?"":str+"";if(!_translit_ru&&!_translit_en){var data=Lang.get("translit_smart");_translit_ru=data.ru;_translit_en=data.en}var result="";for(var i=
0,l=str.length;i<l;i++)for(var n=l;n>i;n--){var parts=[];var values=getSubstrValues(str.substring(i,n));if(values.length){parts.push(createCondition(values,0));if(n-i>1){var letters_parts=[];for(var x=i;x<n;x++)letters_parts.push(createCondition(getSubstrValues(str.charAt(x)),0));parts.push(createCondition(letters_parts,1));i+=n-i-1}result+=createCondition(parts,0)}}return result}function createFindRegExp(str){return new RegExp("^"+createRegExp(str),"i")}function createHighlightRegExp(str){return new RegExp('(^|"|&lt;|\\s|\\.)('+
createRegExp(str)+")","i")}function matchSubsetByRegExp(str,regexp){var result=false;var matches=str.match(/^(?:"?(.*?)"?\s+<)?(.*?)>?$/),name,email,index;if(matches){name=matches[1];email=matches[2];var parts=[];if(name)if(!(result=regexp.test(name)))parts.push.apply(parts,name.split(_spliter));if(!result&&email)if(!(result=regexp.test(email))){email=email.split(_email_spliter);parts.push.apply(parts,email[0].split(_spliter));if(email=email[1])result=regexp.test(email)}if(!result)for(index=parts.length;index--;)if(result=
regexp.test(parts[index]))break}return result}return{createRegExp:createRegExp,createFindRegExp:createFindRegExp,createHighlightRegExp:createHighlightRegExp,matchSubsetByRegExp:matchSubsetByRegExp}}();$.Autocompleter.CreateRegExpStr=function(str){return RegExpFinder.createRegExp(str)};$.Autocompleter.CreateFindRegExp=function(str){return RegExpFinder.createFindRegExp(str)};$.Autocompleter.CreateHighlightRegExp=function(str){return RegExpFinder.createHighlightRegExp(str)};$.Autocompleter.MatchSubsetByRegExp=
function(str,regexp){return RegExpFinder.matchSubsetByRegExp(str,regexp)};var fields=[];$.Autocompleter.abjs=function(field){fields.push(field);$R("{patron.utils}"+"patron.Utils",function(){patron.Utils.getAddressBook()})};$(window).bind("success.abjs",function(evt,data){if(fields&&fields.length)if(!Array.isArray(data)||data.length===0)Counter.d(2051326);$.each(fields,function(k,v){$(v).setOptions({data:data})})});$.Autocompleter.addressbook=function(node,loadAbjs,addCounters){var $input=$(node);
var options={"parent":$(".ac-layer",$input.parent()),"multiple":true,"matchContains":"word","cacheLength":1E3,"delay":100,"rawList":true,"max":100,"multipleSeparatorPattern":/(?:\s)?[,;](?:\s)?/g,"highlight":function(str,sub){str=str.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");sub=sub.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return str.replace($.Autocompleter.CreateHighlightRegExp(sub),"$1<strong>$2</strong>")},"filter":function(data){var items=$.Autocompleter.trimWords($input.val());
return $.inArray(data.value,$.map(items,$.trim))===-1}};if(addCounters===true){$input.bind("selectvalue",function(){Counter.sb(1833833)});options.onshow=function(){Counter.d(1833831)}}var _startTS=0,_selTS,_sel_pid,_val="",_data,_fail_pid,_abjs;$input.autocomplete(null,options).bind("keydown",function(){clearTimeout(_sel_pid);if(!_startTS)_startTS=ajs.now()}).bind("result",function(){setTimeout(function(){$(this).change();this.scrollTop=this.scrollHeight}.bind(this),10)}).bind("beforesearch",function(evt,
val,res){_val=val;_data=res;_abjs=$.isArray(patron.abjsData)?patron.abjsData.length:0;clearTimeout(_sel_pid);clearTimeout(_fail_pid);if(res.length==0)_fail_pid=setTimeout(_autoLog,500);else{_selTS=ajs.now();_sel_pid=setTimeout(_autoLog,15E3)}}).bind("selectvalue",function(evt,val,node){_suggestLog(val,$(node).index())});function _suggestLog(val,idx){if(_startTS){clearTimeout(_sel_pid);clearTimeout(_fail_pid);patron.Utils.suggestLog("email",{start_ts:_startTS,sel_ts:_selTS,val:_val,sel:val,data:_data||
[],idx:idx,abjs:_abjs});_val=_startTS=_selTS=_data=0}}function _autoLog(){_suggestLog("")}if(loadAbjs)this.abjs($input);return $input}})(jQuery);jsLoader.loaded("{jQuery}autocomplete")});Object.defineProperties&&function(document,$){var set=function(obj,prop,val){if(val!==undefined)Object.defineProperty(obj,prop,{value:val});return val},special={pageX:function(evt){var eventDoc=this.target.ownerDocument||document,doc=eventDoc.documentElement,body=eventDoc.body;return evt===void 0?0:evt.clientX+(doc&&
doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0)},pageY:function(evt){var eventDoc=this.target.ownerDocument||document,doc=eventDoc.documentElement,body=eventDoc.body;return evt===void 0?0:evt.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)},relatedTarget:function(evt){if(!evt)return;return evt.fromElement===this.target?evt.toElement:evt.fromElement},metaKey:function(evt){return evt&&evt.ctrlKey},which:function(evt){return evt&&
(evt.charCode!=null?evt.charCode:evt.keyCode)}};if(!$.event.keyHooks)$.event.keyHooks={props:[]};if(!$.event.mouseHooks)$.event.mouseHooks={props:[]};$.each($.event.keyHooks.props.concat($.event.mouseHooks.props,$.event.props),function(i,prop){if(prop!=="target")(function(){Object.defineProperty($.Event.prototype,prop,{get:function(){var originalValue=this.originalEvent&&this.originalEvent[prop];return this["_"+prop]!==undefined?this["_"+prop]:set(this,prop,special[prop]&&originalValue===undefined?
special[prop].call(this,this.originalEvent):originalValue)},set:function(newValue){this["_"+prop]=newValue}})})()});$.event.fix=function(evt){if(evt[$.expando])return evt;var original=evt,target=original.target;evt=$.Event(original);if(!target)target=original.srcElement||document;if(target.nodeType===3)target=target.parentNode;evt.target=target;return evt}}(document,jQuery);define("toolkit.common/jquery/__event-fix/jquery__event-fix",jQuery.noop);(function($){var ns=(new Date).getTime(),special=$.event.special,
dispatch=$.event.handle||$.event.dispatch,scroll="scroll",scrollStart=scroll+"start",scrollEnd=scroll+"end",nsScrollStart=scroll+"."+scrollStart+ns,nsScrollEnd=scroll+"."+scrollEnd+ns;special.scrollstart={setup:function(){var pid,handler=function(evt){if(pid==null){evt.type=scrollStart;dispatch.apply(this,arguments)}else clearTimeout(pid);pid=setTimeout(function(){pid=null},special.scrollend.delay)};$(this).bind(nsScrollStart,handler)},teardown:function(){$(this).unbind(nsScrollStart)}};special.scrollend=
{delay:300,setup:function(){var pid,handler=function(evt){var _this=this,args=arguments;clearTimeout(pid);pid=setTimeout(function(){evt.type=scrollEnd;dispatch.apply(_this,args)},special.scrollend.delay)};$(this).bind(nsScrollEnd,handler)},teardown:function(){$(this).unbind(nsScrollEnd)}};$.isScrolled=false;$(window).bind(scrollStart+" "+scrollEnd,function(evt){$.isScrolled=evt.type==scrollStart;$("body")[$.isScrolled?"addClass":"removeClass"]("is-scrolled")})})(jQuery);define("toolkit.common/jquery/__event-scroll/jquery__event-scroll",
jQuery.noop);define("toolkit.common/jquery/__event-mousewheel/jquery__event-mousewheel",function(){(function(factory){if(typeof define==="function"&&define.amd)define(["jquery"],factory);else if(typeof exports==="object")module.exports=factory;else factory(jQuery)})(function($){var toFix=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],toBind="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],slice=Array.prototype.slice,nullLowestDeltaTimeout,
lowestDelta;if($.event.fixHooks)for(var i=toFix.length;i;)$.event.fixHooks[toFix[--i]]=$.event.mouseHooks;var special=$.event.special.mousewheel={version:"3.1.9",setup:function(){if(this.addEventListener)for(var i=toBind.length;i;)this.addEventListener(toBind[--i],handler,false);else this.onmousewheel=handler;$.data(this,"mousewheel-line-height",special.getLineHeight(this));$.data(this,"mousewheel-page-height",special.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var i=
toBind.length;i;)this.removeEventListener(toBind[--i],handler,false);else this.onmousewheel=null},getLineHeight:function(elem){return parseInt($(elem)["offsetParent"in $.fn?"offsetParent":"parent"]().css("fontSize"),10)},getPageHeight:function(elem){return $(elem).height()},settings:{adjustOldDeltas:true}};$.fn.extend({mousewheel:function(fn){return fn?this.bind("mousewheel",fn):this.trigger("mousewheel")},unmousewheel:function(fn){return this.unbind("mousewheel",fn)}});function handler(event){var orgEvent=
event||window.event,args=slice.call(arguments,1),delta=0,deltaX=0,deltaY=0,absDelta=0;event=$.event.fix(orgEvent);event.type="mousewheel";if("detail"in orgEvent)deltaY=orgEvent.detail*-1;if("wheelDelta"in orgEvent)deltaY=orgEvent.wheelDelta;if("wheelDeltaY"in orgEvent)deltaY=orgEvent.wheelDeltaY;if("wheelDeltaX"in orgEvent)deltaX=orgEvent.wheelDeltaX*-1;if("axis"in orgEvent&&orgEvent.axis===orgEvent.HORIZONTAL_AXIS){deltaX=deltaY*-1;deltaY=0}delta=deltaY===0?deltaX:deltaY;if("deltaY"in orgEvent){deltaY=
orgEvent.deltaY*-1;delta=deltaY}if("deltaX"in orgEvent){deltaX=orgEvent.deltaX;if(deltaY===0)delta=deltaX*-1}if(deltaY===0&&deltaX===0)return;if(orgEvent.deltaMode===1){var lineHeight=$.data(this,"mousewheel-line-height");delta*=lineHeight;deltaY*=lineHeight;deltaX*=lineHeight}else if(orgEvent.deltaMode===2){var pageHeight=$.data(this,"mousewheel-page-height");delta*=pageHeight;deltaY*=pageHeight;deltaX*=pageHeight}absDelta=Math.max(Math.abs(deltaY),Math.abs(deltaX));if(!lowestDelta||absDelta<lowestDelta){lowestDelta=
absDelta;if(shouldAdjustOldDeltas(orgEvent,absDelta))lowestDelta/=40}if(shouldAdjustOldDeltas(orgEvent,absDelta)){delta/=40;deltaX/=40;deltaY/=40}delta=Math[delta>=1?"floor":"ceil"](delta/lowestDelta);deltaX=Math[deltaX>=1?"floor":"ceil"](deltaX/lowestDelta);deltaY=Math[deltaY>=1?"floor":"ceil"](deltaY/lowestDelta);event.deltaX=deltaX;event.deltaY=deltaY;event.deltaFactor=lowestDelta;event.deltaMode=0;args.unshift(event,delta,deltaX,deltaY);if(nullLowestDeltaTimeout)clearTimeout(nullLowestDeltaTimeout);
nullLowestDeltaTimeout=setTimeout(nullLowestDelta,200);return($.event.dispatch||$.event.handle).apply(this,args)}function nullLowestDelta(){lowestDelta=null}function shouldAdjustOldDeltas(orgEvent,absDelta){return special.settings.adjustOldDeltas&&orgEvent.type==="mousewheel"&&absDelta%120===0}})});(function($){var _rspace=/\s+/,_$cache=$("<div/>"),_div=_$cache[0],_classList=_div.classList,_supportsArgs;if(_classList){_classList.add("-a","b-");_supportsArgs=/-a/.test(_div.className)&&/b-/.test(_div.className);
$.fn.hasClass=function(className){className=$.trim(className);var i=this.length;while(i--)if(this[i].classList.contains(className))return true;return false};$.fn.addClass=_factory("add");$.fn.removeClass=_factory("remove")}function _factory(method){return function(value){var typeOf=typeof value,i=this.length;if("string"===typeOf){value=$.trim(value);if(""!==value){value=value.split(_rspace);var j,n=value.length,list;while(i--){list=this[i].classList;if(1===n)list[method](value[0]);else if(_supportsArgs)list[method].apply(list,
value);else for(j=0;j<n;j++)list[method](value[j])}}}else if(void 0===value&&"remove"===method)while(i--)this[i].className="";else if("function"===typeOf)_each(this,method+"Class",value);return this}}function _each($el,method,callback){$el.each(function(i){_$cache[0]=this;_$cache[method](callback.call(this,i,_$cache.attr("class")))})}_$cache[0]=_div=_classList=null})(jQuery);define("toolkit.common/jquery/__classList/jquery__classList",jQuery.noop);jsLoader.use(["{utils}HotKeys"],function(){jsClass.create("LightBox").statics({last:0,
open:[],count:0,active:0,hideAll:function(){Array.forEach(this.open,function(L){L.isVisible()&&L.hide()})}}).methods({__construct:function($Box,opts){LightBox.count++;Object.extend(this,{position:"fixed",pTop:"50%",pLeft:"50%",zIndex:3E4,fadeNode:0,fadeColor:"#000",fadeOpacity:0.6,scrollWidth:0,hideSelects:1,hideObjects:0,visible:0,disabledHide:0,disabledShow:0,disable:0,controls:0,lbControls:".lb-controls"},opts);this.top=this.pTop;this.left=this.pLeft;this.clickObserver=this.controlClick.bind(this);
this._dFire=this.fireControl.bind(this);this.$Fade=this.fadeNode?$(this.fadeNode):$("<div></div>").css({opacity:this.fadeOpacity,backgroundColor:this.fadeColor,width:"100%",height:"100%",display:"none"}).setPositionFixed(0,0).appendTo($(this.BODY)[0]||"BODY").bind("click",this.clickObserver);this.$Box=jQuery($Box).bind("click",this.clickObserver);this.$Layer=jQuery(".js-layer",this.$Box);if(this.position=="fixed")this.$Box.setPositionFixed(this.left,this.top);else if(this.position)this.$Box.css({position:this.position,
left:this.left,top:this.top});if(this.controls)this.initControls(this.controls.constructor==Array?this.controls:jQuery(this.controls));this.initControls(this.$Box);if($.browser.msie)this.$BODY=jQuery("body");if(this.showBy)jQuery(this.showBy).click(function(){this.show();return false}.bind(this));if(this.hideBy)jQuery(this.hideBy).click(function(){this.hide();return false}.bind(this));if(this.hideByFade)this.$Fade.bind(this.hideByFade,function(){this.hide();return false}.bind(this));this.callMethod("init");
if(this.visible)this.show(true)},custom:function(){var p=["customFunc"];Array.prototype.push.apply(p,arguments);return!(this.callMethod.apply(this,p)!==false)},initControls:function($X,s){for(var i=0,c;$X[i];i++)if($X[i]&&$X[i].getAttribute&&(c=$X[i].getAttribute("lightBox"))){c=c.indexOf("{")>-1?eval("("+(c||"{}")+")"):{m:c};if(c&&c.m&&this[c.m]){$X[i].___c=c;jQuery($X[i]).bind($X[i].tagName=="FORM"?"submit":"click",this.fireControl.bind(this))}$X[i].removeAttribute("lightBox");$X[i].lightBox=null}if(!s&&
!this.lbFast&&$X.find)this.initControls($X.find(".lb-control,A"),true)},fireControl:function(e){this.__e=e;this.__c=jsCore.elm(e,"___c");if(!(this._cDisable||e.disabled)&&this.__c.___c&&this.__c.___c.m&&this[this.__c.___c.m])return this[this.__c.___c.m].apply(this,this.__c.___c.p||[])===true},setCss:function(style){if(style.position==="fixed"){this.$Box.setPositionFixed(style.left,style.top);delete style.top;delete style.left;delete style.position}this.$Box.css(style)},controlClick:function(event){if(event.target===
event.currentTarget&&LightBox.active&&LightBox.last&&!LightBox.last.isDisabled())LightBox.last.hide()},getEvent:function(){return this.__e},getControl:function(){return this.__c},resize:function(w,h,f,speed){var s=this.$Box.getSize(true);this.fixPos();this.fixPos(!f,defined(w,s.width),defined(h,s.height),speed);return this},fixPos:function(anim,w,h,speed){var s={},boxSize=this.$Box.getSize(),layerSize=this.$Layer.getSize();Object.extend(this,this.$Box.getSize());if(w||h){this.$Box.css({width:this.width,
height:this.height});Object.extend(s,{width:w,height:h,marginLeft:w?"-"+w/2:"",marginTop:h?"-"+h/2:""});Object.extend(this,s)}this.dw=layerSize.width/2;this.dh=boxSize.height/2;s.marginTop=-this.dh;var xH=boxSize.height>ajs.windowHeight(),xW=layerSize.width>ajs.windowWidth(),x=xW||xH;if(jQuery.iePositionFixed===undef){this.top=s.top=x?Math.max(this.dh,ajs.windowHeight()/2)+ajs.scrollTop():ajs.windowHeight()/2;this.abs=x;s.position=x?"absolute":this.position}if(anim&&this.isVisible()){this.$Box.css("position",
s.position);if(s.position==="fixed")this.$Box.setPositionFixed(s.left,s.top);else this.$Box.css("position",s.position);s.marginTop=-h/2;this.$Box.animate(s,speed||"slow",this.fixPos.bind(this))}else this.setCss(s);return this},controlDisable:function(s){this._cDisable=!!s;return this},isDisabled:function(){return this._cDisable},html:function(html){this.$Box.css({visibility:"hidden"}).html(html);this.initControls(this.$Box);this.fixPos();this.$Box.css({visibility:""});return this},isVisible:function(){return this.visible},
toggle:function(f,s){var d=defined(s,!this.visible)?"":"none",e=!d?"show":"hide";if(this.dispatchEvent("before"+String.ucfirst(e),this)!==false){this.$Box.css({zIndex:this.zIndex+(LightBox.active+101)});if(!this.$Fade[0].__lb||this.$Fade[0].__lb==this.uniqId){this.$Fade[0].__lb=!d?this.uniqId:0;this.$Fade.css({zIndex:this.zIndex+LightBox.active+1,display:d})}LightBox.active+=!d?1:-1;if(!d){this.fixPos();this.$Box.css({display:""});LightBox.last=this;LightBox.open.push(this)}else{this.$Box.css({display:"none"});
if(LightBox.open)LightBox.open=Array.remove(LightBox.open,this);LightBox.last=LightBox.open[LightBox.active-1]}this._visible=this.visible;this.visible=!d;if(this.$BODY){if(this.hideSelects)this.$BODY[this.visible?"addClass":"removeClass"]("hidden-all-selects");if(this.hideObjects)this.$BODY[this.visible?"addClass":"removeClass"]("hidden-all-objects")}this.dispatchEvent(e,this)}return this},hide:function(f){return this.disabledHide?this:this.toggle(f,false)},show:function(f){return this.disabledShow?
this:this.toggle(f,true)},destroy:function(){LightBox.count--;LightBox.open=Array.remove(LightBox.open,this,1);if(this.isVisible)this.hide()}});jQuery.hotkeys.on("esc",function(){if(LightBox.active&&LightBox.last&&!LightBox.last.isDisabled())LightBox.last.hide()});jQuery(window).resize(function(){if(LightBox.active&&LightBox.last&&LightBox.last.isVisible())Array.forEach(LightBox.open,function(L){L.isVisible()&&L.fixPos()})});jsLoader.loaded("{plugins}LightBox")});jsLoader.use(["{jQuery}jquery"],function(){(function($){var namespace=
"dropdown."+$.expando;jsClass.create("Dropdown").statics({add:function(D){var g=D.options.group;if(!this[g])this[g]=[];this[g].push(D)},remove:function(D){var g=D.options.group;if(this[g]&&this[g]instanceof Array)this[g]=Array.filter(this[g],function(d){return D!==d})},hide:function(name,uniqId){if(name in this)Array.forEach(this[name],function(D){uniqId!=D.uniqId&&D.hide()})},destroy:function(name){if(name in this){Array.forEach(this[name],function(D){D.destroy()});delete this[name]}},defaultOptions:{group:"dropdown",
timeout:500,onClick:$.noop,onToggle:$.noop,onClosed:$.noop,orientation:false,openInsideBody:false,lazy:false,hideByMousedown:false,hideByBlur:false,wrapperWidth:function(){return ajs.windowWidth()}}}).methods({_beforeAccess:function(){if(!this._isTouched){this._isTouched=true;this.$link.bind("mouseenter."+namespace,this._cancelTimer.bind(this));this.$link.bind("mouseleave."+namespace,this._initTimer.bind(this));this.$container=typeof this._container==="string"?this._node.find(this._container):this._container;
this.$container.bind("tap."+namespace,this._click.bind(this));this.$container.bind("mouseenter."+namespace,this._cancelTimer.bind(this));this.$container.bind("mouseleave."+namespace,this._initTimer.bind(this))}},__construct:function(link,container,options,node){this.options=$.extend({},Dropdown.defaultOptions,options);Dropdown.add(this);this._node=node;this._container=container;if(this.options.hideByMousedown)this._documentMouseDownObserver=this._documentMouseDown.bind(this);if(this.options.hideByBlur)this._windowBlurObserver=
this._windowBlur.bind(this);this.$link=typeof link==="string"?node.find(link):link;this.$link.bind("tap."+namespace,function(evt){evt.preventDefault();if(this.options.lazy)this._beforeAccess();if(!this.$link.closest(".form_disabled").length)this.show()}.bind(this));if(!this.options.lazy)this._beforeAccess()},_documentMouseDown:function(evt){if(!this.$container.has(evt.target).length)this.hide()},_windowBlur:function(evt){this.hide()},destroy:function(){if(this.__removed)return;this._cancelTimer();
this.hide();if(this.$container)this.$container.unbind("."+namespace);this.$link.unbind("."+namespace);if(this.options.openInsideBody)this.$container.remove();delete this.$container;delete this.$link;delete this.$parent;Dropdown.remove(this);this.__removed=true},_click:function(evt){return this.options.onClick(evt,this)},_resize:function(){var o=this.options,or=o.orientation,$Box=this.$container;if(or){$Box.replaceClass(/\s+dd-orientation-\w+/,"");if(or=="auto")or=o.wrapperWidth()-($Box.offset().left+
$Box.outerWidth())<50?"left":"right";$Box.addClass("dd-orientation-"+or)}},show:function(){this._cancelTimer();if(this.$container.is(":visible")){this.options.onToggle(false,this);this.hide()}else if(this.options.onToggle(true,this)!==false){Dropdown.hide(this.options.group,this.uniqId);if(this.options.openInsideBody){if(!this.$parent){this.$parent=this.$container.parent();this.$parent.append(this.$container.clone());$("body").append(this.$container)}var pos=this.$parent.offset();this.$container.css({"left":pos.left,
"top":pos.top+this.$parent.height(),"min-width":this.$parent.width()})}if(this.options.hideByMousedown)$(document).one("mousedown",this._documentMouseDownObserver);if(this.options.hideByBlur)$(window).one("blur",this._windowBlurObserver);this.$container.show().offsetParent().andSelf().css({zIndex:65002});$(window).bind("resize.dropdown",this._resize.bind(this));this._resize()}},hide:function(callback){$(window).unbind("resize.dropdown");if(this.$container&&this.options.onToggle(false,this)!==false){this.$container.offsetParent().andSelf().css({zIndex:""});
this.$container.hide();if(this.options.hideByMousedown)$(document).unbind("mousedown",this._documentMouseDownObserver);if(this.options.hideByBlur)$(window).unbind("blur",this._windowBlurObserver);if(callback)callback()}},_cancelTimer:function(){clearTimeout(this._idTimer)},_initTimer:function(){if(this.options.timeout)this._idTimer=setTimeout(function(){this.options.onToggle(false,this);this.hide();this.options.onClosed()}.bind(this),this.options.timeout)}});$.fn.dropdown=function(object){if(!this.length)return this;
if(typeof object=="string"){var widget=this.data(namespace);if(widget)widget._beforeAccess();return object.toLowerCase()=="widget"?widget:this}return this.each(function(){var self=$(this);self.data(namespace,new Dropdown(object.link,object.container,object,self))})}})(jQuery);jsLoader.loaded("{plugins}Dropdown")});define("{plugins}LayerEffects",[],function(){return{slideDown:{layer:{show:{animation:"slide-down",duration:600},hide:{animation:"slide-up",duration:300}},overlay:{show:{animation:"fade-in",
duration:600},hide:{animation:"fade-out",duration:300}}},zoomIn:{layer:{show:{animation:"zoom-in",duration:300},hide:{animation:"zoom-out",duration:300}},overlay:{show:{animation:"fade-in",duration:300},hide:{animation:"fade-out",duration:300}}}}});jsLoader.use("{jQuery}jquery",function(){(function(){var y=0,a=0,i,item,$el;var speed=850,interval=Math.ceil(1E3/60),intervalSteps=32,angle=360/(speed/interval);var _spinners=[];var _active=false;var Spinner=function(){this.__construct.apply(this,arguments)};
Spinner.prototype={constructor:Spinner,__construct:function(){_spinners.push(this)},_set:function($el){if(!$el||!$el.length){this.destroy();return}this.$el=$el;this.clockwise=this.$el.hasClass("ico_loader_outer");if(!$.support.transform){interval=intervalSteps;if(this.clockwise)this.$el.removeClass("ico_loader_outer").addClass("ico_loader");else{this.$el.display(0);this.destroy();return}}spin();return this},destroy:function(){_spinners=ajs.remove(_spinners,this,true)}};ajs.extend(Spinner,{add:function($el){return(new this)._set($el)}});
function spin(){if(_active)return;_active=true;iterate()}function iterate(){for(i=_spinners.length-1;i>=0;i--){item=_spinners[i];$el=item.$el;if(!isInDom($el[0])){item.destroy();item=null;$el=null}else if($.support.transform){a=item._angle||0;a=(a+(item.clockwise?angle:-2*angle))%360;$el[0].style[$.support.cssPrefix+"Transform"]="rotate("+a+"deg)";item._angle=a}else{y=item._y||0;$el.css("backgroundPosition","0 -"+y+"px");y+=18;if(y>414)y=0;item._y=y}}if(_spinners.length)setTimeout(iterate,interval);
else _active=false}function isInDom(el){while(el=el.parentNode)if(el==document)return true;return false}patron.Spinner=Spinner})();jsLoader.loaded("{patron}patron.Spinner")});jsLoader.use(["{jQuery}jquery","{utils}Counter"],function(){(function(){var counters={};counters["toolbar-letters"]={"selectAll":{"ctrl":{"$ROOT":'!ui.$el.parent().attr("aria-expanded") && 1780457',"toggle":'!ui.$el.attr("aria-checked") ? 1780459 : 1780460'},"all":1780461,"unread":1780462,"read":1780463,"flagged":1780464,"attach":1780465,
"none":1780466},"remove":1780467,"spam":1780470,"nospam":0,"moveTo":{"ctrl":'!ui.$el.parent().attr("aria-expanded") && 1780481',0:1780482,950:1780485,5E5:1780483,500001:1780484,500002:1780486,"$ANY":1780487,"new_folder":{"$ANY":1780488}},"markAs":{"ctrl":'!ui.$el.parent().attr("aria-expanded") && 1780489',"read":{"$ANY":1780490},"unread":{"$ANY":1780493},"flag_yes":{"$ANY":1780496},"flag_no":{"$ANY":1780497}},"letters-more":{"ctrl":1893708,"read":{"$ANY":1893710},"unread":{"$ANY":1893711},"flag_yes":{"$ANY":1893712},
"flag_no":{"$ANY":1893718},"addressbook":1780498,"create_filter":1780499,"search":1780500,"forward":1780501},"b-paginator":{"$ROOT":1783321,"next":1780514,"prev":1780513},"view":{"ctrl":'!ui.$el.parent().attr("aria-expanded") && 1780521',"compact":1780522,"detail":1780523,"sort_date_asc":1780526,"sort_date_desc":1780524,"sort_to_asc":1780527,"sort_to_desc":1780528,"sort_from_asc":1780527,"sort_from_desc":1780528,"sort_subj_asc":1780529,"sort_subj_desc":1780530}};counters["toolbar-folders"]={"refresh":"patron.isReadMsgPage() ? 1785926 : 1780455"};
counters["letters"]={"unread":{"$ANY":"patron.Messages.getSafe(ui.id).isUnread() ? 1780534 : 1780535"},"flag":{"$ANY":"patron.Messages.getSafe(ui.id).isFlagged() ? 1780537 : 1780536"}};counters["collectors"]={};counters["nav-folders"]={"$drop":{"$ANY":1780539},"collector":1982674};counters["toolbar-letter"]={"letter_prev":1786134,"letter_next":1786137,"reply":1786138,"replyAll":1786141,"forward":1786143,"remove":1786144,"spam":1786146,"spam-more":{"ctrl":2009860,"spam":2009877,"unsubscribe":2009872},
"moveTo":{"ctrl":'!ui.$el.parent().attr("aria-expanded") && 1786147',0:1786148,950:1786756,5E5:1786149,500001:1786150,500002:1786758,"$ANY":1786760,"new_folder":{"$ANY":1786761}},"markAs":{"ctrl":'!ui.$el.parent().attr("aria-expanded") && 1786764',"read":{"$ANY":1786766},"unread":{"$ANY":1786767},"flag_yes":{"$ANY":1786781},"flag_no":{"$ANY":1786782}},"letter-more":{"ctrl":'!ui.$el.parent().attr("aria-expanded") && 1786784',"addressbook":1786789,"create_filter":1786797,"search":1786799,"translate":1786805,
"print":1786856,"download":1786858,"redirect":1786859,"forward":1786862,"headers":1786865},"print":1786931,"translate":1786932};counters["letter"]={"show":[1785921,"patron.Messages.getSafe(ui.id).getCountAttachments() > 0 && 1786891",'patron.Messages.getSafe(ui.id).ToList.split(",").length > 1 && 1786999',"patron.Messages.getSafe(ui.id).Cc && 1787007",'patron.Messages.getSafe(ui.id).Cc.split(",").length > 1 && 1787003',"patron.Messages.getSafe(ui.id).Forward && 1787011"],"print":1786856,"translate":1786805,
"unread":{"$ANY":"patron.Messages.getSafe(ui.id).isUnread() ? 1786872 : 1786869"},"flag":{"$ANY":"patron.Messages.getSafe(ui.id).isFlagged() ? 1786879 : 1786878"},"search":1786888,"go2attachments":1786897,"compose":{"mode":{"$ROOT":1787016,"reply":1787019,"replyAll":1787023,"forward":1787034},"form":{"open":1786965,"reply":1786983,"replyAll":1786986,"forward":1786988},"reply-addrs":1787047,"go2compose":1787040,"send":1787044,"cancel":1787046},"dmarc_warning":3360189,"dmarc_warning_details":3360189};
counters["slots"]={social:{$SHOW:2804090,service:2804090}};counters["search"]={search_in_trash:3128696,search_in_trash_found:3368476};counters["attachment"]={download:{all:0,"from-list":0,"from-thumbnails":0},preview:{"from-list":0,"from-thumbnails":0}};var radars={};radars["nav-folders"]={0:"inbox",950:"spam",5E5:"sent",500001:"drafts",500002:"trash",500006:"templates","show":function(ui){var folders=patron.Folders.getAll();if(folders&&folders.length!=radars["nav-folders"]["__foldersCount"]){radars["nav-folders"]["__foldersCount"]=
folders.length;var hasUserFolder=false;var hasTemplatesFolder=false;Array.forEach(folders,function(folder){if(!folder.isSystem())hasUserFolder=true;if(folder.isTemplates())hasTemplatesFolder=true});if(hasUserFolder)radar([ui.chain[0],"user","show"]);if(hasTemplatesFolder)radar([ui.chain[0],"templates","show"])}},"*":function(ui){if(ui.chain[ui.chain.length-1]>0)radar([ui.chain[0],"user"]);radar(ui.chain)}};radars["filters-processing"]={"get":function(ui){ui.chain.push(ui.res.isOK()?"success":"error");
radar(ui.chain)},"show":function(ui){ui.chain.push(ui.folder.id+"");radar(ui.chain)},"hide":function(ui){ui.chain.push(ui.folder.id+"");radar(ui.chain)}};radars["mass-operations"]={"selectAllLetters":true,"deselectAllLetters":true,"actions":function(ui){var resOpts=ui.data;if(resOpts.data&&resOpts.data.wholefolder!==void 0&&!resOpts.data.spam)(function(data){var _markState={2:["unread","unset"],1:["unread","set"],6:["flagged","set"],7:["flagged","unset"]},_foldersId={0:"inbox",950:"spam"},type,action;
if(data.mark){var mark=data.markmessage;type=_markState[mark][0];action=_markState[mark][1]}else if(data.remove===1){type="clear";action="delete"}else{type="move";action=_foldersId[+data.folder]?_foldersId[+data.folder]:"other"}radar([ui.chain[0],type,action])})(resOpts.data)}};radars["shortcut"]={"shift+&":"shift+?","shift+=":"+","=":"+"};radars["browserNotification"]={"click":function(ui){radar(ui.chain.concat("common"));radar(ui.chain.concat(ui.number>1?"moreThanOne":"one"))}};radars["search-in-files"]=
{"results":function(ui){ui.res=ui.res||{data:{}};var files={},exts=[];Array.forEach(ui.res.data.messages,function(message){if(message.AttachList)Array.forEach(message.AttachList,function(attach){var ext;if(attach&&attach.FileName){ext=attach.FileName.split(".").pop();if(!files[ext])files[ext]=1;else files[ext]+=1}})});Object.forEach(files,function(count,ext){exts.push([ext,count].join("|"))});radar(ui.chain.concat(exts))},"open":function(ui){radar(ui.chain.concat(ui.ext))}};radars["mailbox-sort"]=
{"plate":{"first":true,"second":{"close":true,"show":function(ui){radar(ui.chain.concat(ui.util.count.show))}}},"util":true,"settings":true};radars["folders_contextmenu"]={"*":function(ui){if(ui.id==undefined)radar(ui.chain);else radar(ui.chain.slice(0,ui.chain.length-1))}};radars["contextmenu"]={"remove":function(ui){if(patron.folderId==patron.Folder.TEMPLATES)radar(["letter","remove","template"]);radar(ui.chain)}};radars["portal-menu"]={"*":function(ui){var intervals={},key=ui.chain.slice(1).join("_");
if(patron.flatheader)ui.chain[0]="flat-"+ui.chain[0];intervals[key]=1;if(!key.indexOf("ph-")){$(".pm-toolbar__button","#portal-menu").each(function(i,el){key+=$(el).is(":visible")?"_1":"_0"});if(!intervals[key])intervals[key]=1}patron.radar(ui.chain[0],intervals)}};radars["letter"]={"*":function(ui){var chain=ui.chain;if(patron.isThreadPage())chain[0]="thread_letter";var mark_state={2:["unread","unset"],1:["unread","set"],6:["flagged","set"],7:["flagged","unset"]},state;if(chain[1]==="more"){state=
mark_state[chain[2]];if(state){chain=chain.slice(0,2);chain=chain.concat(state)}}else{var model=patron.Messages.getSafe(ui.id);if(model)if(chain[1]==="unread"){state=mark_state[model.isUnread()?2:1];chain=chain.slice(0,1);chain=chain.concat(state)}else if(chain[1]==="flag"){state=mark_state[model.isFlagged()?7:6];chain=chain.slice(0,1);chain=chain.concat(state)}}var new_chain=Array.filter(chain,function(value){return!/\d{7,}/.test(value)});if(new_chain.length>1)radar(new_chain)}};radars["toolbar-letter"]=
{"*":function(ui){var chain=ui.chain;if(patron.isThreadPage())chain[0]="toolbar-thread_letter";var mark_state={2:["unread","unset"],1:["unread","set"],6:["flagged","set"],7:["flagged","unset"]},state;if(chain[1]==="letter-more"){state=mark_state[chain[3]];if(state){chain=chain.slice(0,2);chain=chain.concat(state)}}var new_chain=Array.filter(chain,function(value){return!/\d{7,}/.test(value)});if(new_chain.length>1)radar(new_chain)}};radars["toolbar-letters"]={"remove":function(ui){if(patron.folderId==
patron.Folder.TEMPLATES)radar(["letter","remove","template"]);radar(ui.chain)},"moveTo":{500002:function(ui){if(patron.folderId==patron.Folder.TEMPLATES)radar(["letter","remove","template"]);radar(ui.chain)}}};$(document).bind("toolkitclick ui-abstract-action",function(evt,ui){var chain=ui.chain,value=ui.value,i=0,n=chain.length,name,cnt=counters,r=radars;for(;i<n;i++){name=chain[i];if(cnt){if(cnt["$"+ui.eventType])cnt=cnt["$"+ui.eventType];if(cnt[name]===void 0&&cnt[name.toLowerCase()]===void 0){cnt=
cnt["$ANY"];break}else cnt=cnt[name]||cnt[name.toLowerCase()]}}if(0)ajs.log(chain);if(typeof cnt==="object"&&!cnt[0])cnt=cnt[ui.eventType==="rb-show"?"$SHOW":"$ROOT"];ajs.each([].concat(cnt),function(cnt,i){if(typeof cnt==="string")cnt=new Function("ui","return ("+cnt+");");if($.isFunction(cnt))try{cnt=cnt(ui)}catch(err){cnt=0;ajs.log("counters.fn.error:",err)}if(cnt)if(ui.eventType==="rb-show"){ajs.log("rb.cnt.show."+i+":",cnt,ui.chain.join("."));Counter.d(cnt)}else{ajs.log("rb.cnt.click."+i+":",
cnt,ui.chain.join("."));Counter.sb(cnt)}});for(i=0;i<n;i++){name=chain[i];if(r)if(r[name]===void 0&&r[name.toLowerCase()]===void 0){r=r["*"];break}else r=r[name]||r[name.toLowerCase()]}if(r)if($.isFunction(r))try{r=r(ui)}catch(err){ajs.log("radars.fn.error:",err)}else if(r===true)radar(chain,value);else{chain[n-1]=r;radar(chain,value)}else if(r!==false)radar(chain,value)});function radar(chain,value){var radar=chain.join("_");if(patron.ToolkitClickToRadar&&chain.length>1&&!/\d{7,}/.test(radar)){ajs.log("radar.cnt"+
":",radar);patron.radar(chain[0],chain.slice(1).join("_")+"="+ajs.isset(value,1),1)}}ajs.exports("{patron.v2.utils}patron.utils.ui.counters",{inputTelephoneCounterTest:patron.inputTelephoneChangeCounterTest?function($el){var oldVal;$el.bind("input",function(){var newVal=$el.val().replace(/[^\d]/g,"");if(oldVal!==newVal){if(newVal.length>3)patron.radar("inputTelephoneCounterTest","change=1");oldVal=newVal}})}:$.noop})})()});jsLoader.use(["{toolkit.common}store/store","{patron}patron.Spinner","{patron.v2.utils}patron.utils.ui.counters"],
function(){(function(){var _sy=24,_y=_sy,_idx=3E4,_queue=[],_groups={};var counter=function(counter){(new Image).src="//rs."+patron.SingleDomainName+"/"+counter+".gif?"+Math.random()};function _log(options){var key="";if(options.group||options.type){key+=options.group?options.group:"nogroup";key+=options.type?"_"+options.type:"";if(options.radar_postfix)key+="_"+options.radar_postfix}if(key){key=key.replace(/\./g,"_");patron.log("notify.show",options);patron.radar("notify",key+"=1")}}var Notify=function(){this.__construct.apply(this,
arguments)};Notify.prototype={constructor:Notify,__construct:function(){this.$el=this.$Elm=$("#Notify").clone().removeAttr("id").prependTo("body");_queue.push(this)},_type:function(type){switch(type){case "load":case "send":case "move":case "load.still":case "send.still":case "move.still":type="load";break;case "error":case "connection.hello":case "connection.error":case "connection.still.error":type="error";break}return type},set:function(o){if(!this._exists){this._exists=true;this.$Elm.css({top:_y+
5,opacity:0,zIndex:_idx++})}if(typeof o.callback=="function")o.callback(this.$Elm);var txt=o.text||o.html||Lang.str("notify."+o.type+(o.subtype?"."+o.subtype:""));if(!txt||$.type(txt)!="string"){ajs.log("notify.error.empty.text:",o);return}switch(o.type){case "connection.hello":o.html=true;break}if(this.$Elm.hasClass("notify_black")){var mod=this._type(o.type)=="error"?"notify_error":o.type=="collector-blocked"||o.type=="collector-noauth"?"notify_wide":"";this.$Elm.removeClass("notify_error notify_wide").addClass(mod);
if(!$.support.animation&&this._type(o.type)=="load"){patron.Spinner.add(this.$Elm.children().filter(".js-load").find(".ico_loader_inner"));patron.Spinner.add(this.$Elm.children().filter(".js-load").find(".ico_loader_outer"))}}_log(o);this.$Elm.unbind().click(this.destroy.bind(this)).display(1).children().display(0).filter(".js-"+this._type(o.type)).display(1).find(".js-txt")[o.html?"html":"text"](txt);if(o.group)_groups[o.group]=this;clearTimeout(this._pid);if(o.delay)this._pid=setTimeout(this.destroy.bind(this),
o.delay*1E3);this._data=o;_redraw();return this},close:function(){this.destroy();return this},destroy:function(){if(this.onclose)this.onclose.call(this,this);_queue=ajs.remove(_queue,this,true);delete _groups[this._data.group];clearTimeout(this._pid);this.$Elm.delay(200).animate({top:"-=5",opacity:0},"fast",function(){$(this).remove()});_redraw()}};ajs.extend(Notify,{add:function(type,opts){if(typeof opts==="string")opts={text:opts};opts=ajs.extend({type:type,delay:3},opts);return this.find(opts&&
opts.group).set(opts)},hide:function(id){if(id in _groups)_groups[id].destroy()},find:function(id){return _groups[id]||new this}});function _redraw(){_y=_sy;ajs.each(_queue,function(notify){if(notify.__y!==_y){notify.__y=_y;notify.$Elm.animate({top:_y,opacity:1},"fast")}_y+=notify.$Elm.outerHeight()+2})}Notify.browserAlert=function(name){var $el=$("#browser-alert");if(name){$el.find(".js-alert").hide().filter(".js-"+name).show();$el.slideDown(100).delegate(".js-close","click",Notify.browserAlert.bind(this,
false))}else $el.slideUp(100)};Notify.collectorErrorAlert=function(collector){if(store.enabled){var helpers_data={blocked:{name:"attachExcel"},noauth:{name:"attachPowerPoint"}},type;$.each(helpers_data,function(k,v){helpers_data[k].index=patron["HelperIndex"][v.name];helpers_data[k].timestamp=patron["HelperTimestamp"][helpers_data[k].index]});switch(collector.state){case "blocked":type=collector.state;break;case "extra_auth":case "need_auth":type="noauth";break}if(type){var helper_data=helpers_data[type];
if(helper_data){if(helper_data.timestamp<1356984E3)patron.HelperStatus&=~(1<<helper_data.index);Notify.collectorErrorAlertByType(type,helper_data,collector)}}}};Notify.collectorErrorAlertByType=function(type,helper_data,collector){var __collector=new patron.Collector;var notify_key=__collector.namespace(collector.email,"notify.");var notify_id="collector-"+type,need_activation_by_user=collector.flags&&collector.flags.need_activation_by_user,store_go_to_setting_key=notify_key+"go_to_setting",store_last_hide_key=
notify_key+"last_hide",store_count_key=notify_key+"count",store_hide_key=notify_key+"hide",now=Math.round(+new Date/1E3),last_hide_expire=store.get(notify_key+"last_hide_expire")||86400,go_to_setting_expire=3600,max_try_count_hide=need_activation_by_user?0:3,ts_go_to_setting=store.get(store_go_to_setting_key)||0,ts_last_hide=Math.max(store.get(store_last_hide_key)||0,helper_data.timestamp),count_hide=store.get(store_count_key)||0,hide=store.get(store_hide_key)||patron.Balloon.isClosed(helper_data.index);
if(ts_last_hide+last_hide_expire>now)hide=true;if(type=="blocked")if(ts_go_to_setting+go_to_setting_expire>now)hide=true;if(!hide){try{var notify_key=patron.useremail+"|collector.notify",notify_value=store.get(notify_key)||{};if(!(collector.email in notify_value)){notify_value[collector.email]=notify_id;store.set(notify_key,notify_value)}}catch(error){ajs.log("Notify.collectorErrorAlertByType::collector.notify\n",error)}var host=__collector.host(patron.useremail);var used_oauth=patron.IsExternalAccount&&
__collector.oauth.has(host),notify_text="notify.collector.extra_auth";var last_update=collector.last_update?new Date(collector.last_update*1E3):new Date;if(used_oauth)notify_text+=".oauth";if(need_activation_by_user)notify_text="notify.collector.need_activation_by_user";if(!collector.last_update)notify_text+=".unknown_last_update";this.add(notify_id,{delay:0,html:Lang.str(notify_text).replace(/%email/g,"<b>"+collector.email+"</b>").replace(/%host/g,"<b>"+__collector.host(collector.email)+"</b>").replace(/%date/g,
"<nobr>"+last_update.format("d n Y")+"</nobr>"),group:notify_id,callback:function(element){var namespace="notify-message__noauth__icon__provider";var icon=namespace+" "+namespace+"_"+__collector.get_provider(collector.email);element.find("#js-"+namespace).attr("class",icon)}});var $container=this.find(notify_id).$el;$(".js-dont-show",$container).toggle(count_hide>max_try_count_hide-1);$(".js-remember-leter",$container).toggle(count_hide<max_try_count_hide);__collector.utils.counter("notify","show");
__collector.utils.counter("notify","show",collector.state);__collector.utils.counter("notify","show",collector.type);counter("d6848641");$container.unbind(".alert-collector_recovery").delegate(".js-change-password,"+".js-dont-show,"+".js-remember-leter,"+".js-close,"+".js-settings","click.alert-collector_recovery",function(event){var stop_event=true;var $target=$(event.currentTarget);if($target.hasClass("js-change-password")){if(used_oauth){counter("sb4017156",true);return window.setTimeout(function(){var back=
window.location.href;back+=~back.indexOf("?")?"&":"?";window.location.href=__collector.oauth.url.external({login:patron.useremail,domain:host,back:back+"oauth_token_restored=1"})},300)}else{var experiment=patron.CollectorConvertExperiment|0;ajs.require("{plugins}"+"LayerManager",function(){var layer=function(convert){var method=convert?"convert":"edit",name=method;if(!convert)name+="-password";var params={collector:collector,group:notify_id,experiment:experiment,complete:function(){__collector.utils.counter("notify",
"layer",method,"success",collector.type,experiment);__collector.utils.counter("notify","layer",method,"success");if(collector.type=="imap")counter("d6848720");patron.Notify.hide(notify_id)},failback:function(error,response){if(error=="conflict")__collector.utils.counter("notify","layer","convert","conflict",experiment)}};if(experiment)params.convert=true;LayerManager.show("collector_"+name,params);__collector.utils.counter("notify","layer",method,"show",convert?"imap":collector.type,experiment);if(convert||
collector.type=="imap")counter("d6848676")};if(collector.type=="pop3")__collector.type(collector.email,function(type,response){try{var body=response.getBody(),imap=body.protocols.imap.available;var convert=imap&&experiment!==1;layer(convert)}catch(error){ajs.log("Notify",error)}});else layer()})}__collector.utils.counter("notify","click","edit")}else if($target.hasClass("js-settings")){store.set(store_go_to_setting_key,now);stop_event=false;__collector.utils.counter("notify","click","settings")}else{if($target.hasClass("js-remember-leter")){store.set(store_count_key,
++count_hide);LayerManager.saveHelper(helper_data.name);__collector.utils.counter("notify","click","later");__collector.utils.counter("notify","click","later",collector.state)}else if($target.hasClass("js-dont-show")){__collector.state({id:collector.id,email:collector.email,type:collector.type,state:"pause"},function(){});__collector.utils.counter("notify","click","pause")}else if($target.hasClass("js-close"))__collector.utils.counter("notify","click","close");__collector.utils.counter("notify","click",
collector.state);patron.Notify.hide(notify_id)}if(stop_event){event.stopPropagation();event.preventDefault()}})}};patron.Notify=Notify})();jsLoader.loaded("{patron}patron.Notify",patron.Notify)});(function(){jsClass.create("patron.Login.OAuth").methods({__construct:function(options){if(patron.YandexOAuthEnabled)this.path["yandex.ru"]="oauth2_yandex";Object.extend(this,options)},host:/@(.{4,})$/,name:/(.*)@.{4,}$/,email:/^\S+@\S+\.\S+/,interval:1E3,timeout:1E3*60*5,path:{"gmail.com":"oauth2_google",
"outlook.com":"oauth2_outlook"},domain:function(email){var domain=email.match(this.host);if(domain)domain=domain[1];return domain||email},url:function(login,domain,params){if(login&&!/@/.test(login))login+="@"+domain;var query=this._getQuery(login,domain,params);return patron.AuthUrl+this.path[domain]+"?"+ajs.toQuery(query)},_getQuery:function(login,domain,params){var makeQuery={"default":function(){return Object.extend({login:login,lang:patron.LANG},params)},"yandex.ru":function(){return Object.extend({login:login},
params)}};return typeof makeQuery[domain]==="function"?makeQuery[domain]():makeQuery["default"]()},show:function(login,host,callback){var url=this.url(login,host);var frame=window.open(url,"_blank");frame.focus();this.wait(frame,callback.bind(this))},wait:function(frame,callback){var timer=window.setInterval(function(){try{var data=frame.oauth;if(data){data=ajs.toObject(data);if(data.state=="ok")callback(frame);window.clearInterval(timer);frame.close()}}catch(error){ajs.log(error)}}.bind(this),this.interval);
window.setTimeout(function(){window.clearInterval(timer)},this.timeout)},redirect:function(page){window.location.href=page}});jsLoader.loaded("{patron.login}patron.Login.OAuth")})();jsLoader.use(["{plugins}LayerEffects","{jQuery}jquery","{patron}patron.Notify","{patron.login}patron.Login.OAuth","{utils}Counter"],function(effectsConfig,$){var FestLayer=function(name,options,callback,settings){ajs.require(["{plugins}Layer","{jQuery}jquery.fest-x"],function(){$.fest("layers/"+name.replace(/_/g,"/"),
options,function(html){Layer.set(name,html);if(typeof callback=="function")Layer.get(name,callback,options,settings)})})};function selectAuth(email){$.ajax({url:"https://auth."+patron.SingleDomainName+"/cgi-bin/auth?mac=1",data:{Login:email},dataType:"jsonp",jsonp:"JSONP_call",timeout:5E3,success:function(response){if(response.status=="ok")location.href="/messages/inbox"}})}function formSubmitRadarLog(radarName,radarSection,onRadarDone){var radarObj=patron.radar(radarName,radarSection!=void 0?radarSection:
1,radarSection!=void 0?void 0:1),checkRadarObj=function checkRadarObj(onDone,forseOnDone){if(!radarObj)return;if(radarObj.complete||forseOnDone){onDone();radarObj.onload=radarObj.onerror=radarObj.onabort=null;radarObj=null}else if((this.timeout-=this.step)>0)setTimeout(checkRadarObj.bind(this,onDone),this.step);else checkRadarObj(onDone,true)};setTimeout(radarObj.onload=radarObj.onerror=radarObj.onabort=checkRadarObj.bind({timeout:100,step:10},onRadarDone,false),10)}jsClass.create("LayerManager").statics({effects:effectsConfig,
show:function(name,vars){if($.isFunction(this[name]))this[name](name,vars||{})},isExpire:function(name,expire){var index=patron.HelperIndex[name],lastTS=patron.HelperTimestamp[index];return patron.CurrentTimestamp-lastTS>=expire},saveHelper:function(name){var index=patron.HelperIndex[name],ts=patron.HelperTimestamp[index]=patron.CurrentTimestamp;$.post("/cgi-bin/ajax_helper?ajax_call=1&func_name=set_helper_timestamp&token="+window.mailru_api_token,{helper:index,helper_timestamp:ts})},getMaxTimestamp:function(){var ts=
0,name;for(var i=arguments.length;i--;){name=arguments[i];if(name in patron.HelperIndex)ts=Math.max(ts,patron.HelperTimestamp[patron.HelperIndex[name]])}return ts},verifyPhoneNotify:function(id){$R("{utils}"+"Counter",function(){Counter.d(606317);$(id).show().find(".js-act").click(function(evt){var $node=$(evt.currentTarget);if(!$node.hasClass("js-close")){Counter.sb(606320);ajs.require("{patron}patron.PhoneManager",function(){var Manager=new patron.PhoneManager({"user":{"name":patron.username,"domain":patron.userdomain}});
Manager.bind("verifySuccess",function(){Counter.d(606322);if(patron.isMailboxPage())LayerMainDiv.getInstance().hide();else location.reload()});Manager.addPhone()})}else{Counter.sb(606318);this.saveHelper("VerifyPhoneNotify")}$node.closest(".js-parent").slideUp("fast")}.bind(this))}.bind(this))},noAuth:function(name,vars){vars=vars||{};var _log_params={status:"noauth",username:patron.username,userdomain:patron.userdomain,useremail:patron.useremail};var isChangeAccount=!!vars.changeAccount;if(vars.checkLayerMainDiv===
true){delete vars.checkLayerMainDiv;ajs.require("{plugins}"+"Layer",function(){if(!LayerMainDiv.getInstance().visible)LayerManager.show("noAuth",vars)});return}if(patron.phAuthFormEnabled){__PH.authForm.show(vars);if(!isChangeAccount)var timer=setInterval(function(){$.ajax({url:"//swa."+patron.SingleDomainName+"/cgi-bin/counters?mac=1",dataType:"jsonp",jsonp:"JSONP_call",success:function(response){if(response.status=="ok"){var data=response.data;if(data&&data.email==patron.useremail){clearInterval(timer);
var host=location.protocol+"//"+location.host;var currentUrl=jsHistory.get().replace(new RegExp("^"+String.preg_quote(host)),"");if(currentUrl.indexOf("/")===0)currentUrl=host+currentUrl;else currentUrl=host+"/"+currentUrl;location.href=currentUrl}}}})},2E4);$(window).unbind("beforeunload");(new Image).src="//gstat."+patron.staticDomainName+"/gstat?ph_noauth=1&logme="+encodeURIComponent($.param(_log_params));return}$R("{plugins}"+"Layer",function(){Layer.get(name,function(layer){var host=location.protocol+
"//"+location.host;var currentUrl=jsHistory.get().replace(new RegExp("^"+String.preg_quote(host)),"");if(currentUrl.indexOf("/")===0)currentUrl=host+currentUrl;else currentUrl=host+"/"+currentUrl;var defaultUrl=host+"/messages/inbox";var $form=$("form",layer.$div).unbind("submit");var $newOneEmailContainer=$(".js-newOneEmailContainer",layer.$div).hide();var $newOneEmailLink=$(".js-newEmail",$newOneEmailContainer);var $newMultiEmailContainer=$(".js-newMultiEmailContainer",layer.$div).hide();var $registerNewEmail=
$(".js-registerNewEmail",layer.$div);var $newMultiEmailSelect=$("select",$newMultiEmailContainer).empty();var $domainSelect=$('select[name="Domain"]',layer.$div);var $domainSelectOption;var $login=$(".js-field-login",layer.$div);$(".js-messageNoAuth",layer.$div).toggle(!isChangeAccount);$(".js-messageChangeAccount",layer.$div).toggle(isChangeAccount);layer.one("show",function(){$newOneEmailContainer.bind("click.layer",function(evt){selectAuth($newOneEmailLink.text());evt.preventDefault()});$newMultiEmailSelect.bind("change.layer",
function(){var value=$newMultiEmailSelect.val();if(value)selectAuth(value)});$form.bind("submit.layer",function(){var email=$login.val();if(email.indexOf("@")===-1)if(!$domainSelect.length){email+="@"+patron.userdomain;$login.val(email)}else email+="@"+$domainSelect.val();if(patron.IS_PREVIEW)defaultUrl+=(defaultUrl.indexOf("?")===-1?"?":"&")+"hlpreview=1&preview=2";else if(email==patron.useremail)defaultUrl=currentUrl;$(".js-field-page",this).val(defaultUrl)})});layer.one("hide",function(){$newOneEmailContainer.unbind(".layer");
$newMultiEmailSelect.unbind(".layer");$form.unbind(".layer")});function changeDomainSelectOption(){$domainSelectOption=$('option[value="'+patron.userdomain+'"]',$domainSelect);if(!$domainSelectOption.length)$domainSelect.append('<option value="'+patron.userdomain+'">@'+patron.userdomain+"</option>");$domainSelect.val(patron.userdomain).triggerHandler("change")}$.ajax({url:"//swa.mail.ru/domains",dataType:"jsonp",jsonp:"JSONP_call",success:function(data){$domainSelect.empty();Array.forEach(data.Domain,
function(domain,k){$domainSelect.append('<option value="'+domain+'"'+(k==0?" selected":"")+">@"+domain+"</option>")});changeDomainSelectOption()}});if(isChangeAccount)layer.show();else{$login.val(patron.username);changeDomainSelectOption();if(!patron.IsMyCom&&(patron.OldMultiAuthLayerLogic||patron.newMultiAuthLogic))$.ajax({url:"//swa."+patron.SingleDomainName+"/cgi-bin/counters?mac=1",dataType:"jsonp",jsonp:"JSONP_call",success:function(layer,response){if(response.status=="ok"){var data=response.data;
if(data&&data.list&&data.list.length)if(data.list.length>1){$newMultiEmailSelect.append('<option value="">'+Lang.get("layers.choise")+"</option>");$.each(data.list,function(k,v){$newMultiEmailSelect.append('<option value="'+v+'">'+v+"</option>")});$newMultiEmailSelect.trigger("change");$newMultiEmailContainer.show();$registerNewEmail.hide()}else{$newOneEmailLink.text(data.list[0]);$newOneEmailContainer.show();$registerNewEmail.hide()}}}.bind(this,layer)});layer.disableHide().show();var timer=setInterval(function(){$.ajax({url:"//swa."+
patron.SingleDomainName+"/cgi-bin/counters?mac=1",dataType:"jsonp",jsonp:"JSONP_call",success:function(response){if(response.status=="ok"){var data=response.data;if(data&&data.email==patron.useremail){clearInterval(timer);location.href=currentUrl}}}})},2E4)}$(window).unbind("beforeunload");(new Image).src="//gstat."+patron.staticDomainName+"/gstat?show_noauth=1&logme="+encodeURIComponent($.param(_log_params))})})},changeAccount:function(name,vars){var _log_params={email:vars.email,username:patron.username,
userdomain:patron.userdomain,useremail:patron.useremail};if(patron.phAuthFormEnabled){vars.formType="restore";__PH.authForm.show(vars);var timer=setInterval(function(){$.ajax({url:"//swa."+patron.SingleDomainName+"/cgi-bin/counters?mac=1",dataType:"jsonp",jsonp:"JSONP_call",success:function(response){if(response.status=="ok"){var data=response.data;if(data&&data.email==patron.useremail){clearInterval(timer);var host=location.protocol+"//"+location.host;var currentUrl=jsHistory.get().replace(new RegExp("^"+
String.preg_quote(host)),"");if(currentUrl.indexOf("/")===0)currentUrl=host+currentUrl;else currentUrl=host+"/"+currentUrl;location.href=currentUrl}}}})},3E4);$(window).unbind("beforeunload");(new Image).src="//gstat."+patron.staticDomainName+"/gstat?ph_change_account=1&logme="+encodeURIComponent($.param(_log_params));return}$R("{plugins}"+"Layer",function(){Layer.get(name,function(layer){var host=location.protocol+"//"+location.host;var currentUrl=jsHistory.get().replace(new RegExp("^"+String.preg_quote(host)),
"");if(currentUrl.indexOf("/")===0)currentUrl=host+currentUrl;else currentUrl=host+"/"+currentUrl;$(".js-field-login",layer.$div).val(patron.useremail);$(".js-field-page",layer.$div).val(currentUrl);$(".js-oldEmail",layer.$div).text(patron.useremail);$(".js-newEmail",layer.$div).text(vars.email);$("form",layer.$div).unbind("submit");layer.disableHide().show();var timer=setInterval(function(){$.ajax({url:"//swa."+patron.SingleDomainName+"/cgi-bin/counters?mac=1",dataType:"jsonp",jsonp:"JSONP_call",
success:function(response){if(response.status=="ok"){var data=response.data;if(data&&data.email==patron.useremail){clearInterval(timer);location.href=currentUrl}}}})},3E4);$(window).unbind("beforeunload");(new Image).src="//gstat."+patron.staticDomainName+"/gstat?show_change_account=1&logme="+encodeURIComponent($.param(_log_params))},{effects:this.effects.zoomIn})}.bind(this))},passexpire:function(name,vars){var currentTime=patron.CurrentTimestamp,ts=patron.HelperTimestamp,index=patron.HelperIndex.passExpire,
lastShowTime=ts[index],lastShowTimeLimit=60*60*24,expTime=patron.PasswordExpireDate,expTimeLimit=60*60*24*7,force=vars[0];if(force||lastShowTime<currentTime-lastShowTimeLimit&&expTime&&expTime<currentTime+expTimeLimit)$R("{plugins}"+"Layer",function(){Layer.get(name,function(layer){var date=Date.parse(expTime*1E3),dateFormat=date.format("d n");$(".js-PasswordExpireDate",layer.$div).html(dateFormat);layer.one("callback",function(evt,status){if(status)location.href=patron.SettingsOn?"/settings/security?changepass":
"/cgi-bin/editpass"})[0].show();this.saveHelper("passExpire")}.bind(this))}.bind(this))},phonesync:function(name,vars){var currentTime=patron.CurrentTimestamp,ts=patron.HelperTimestamp,index=patron.HelperIndex.phoneSync,lastShowTime=ts[index],lastShowTimeLimit=60*60*24*5,force=vars[0];if(force||lastShowTime<currentTime-lastShowTimeLimit)$R(["{plugins}"+"Layer","{patron}"+"patron.PhoneManager"],function(){Layer.get(name,function(layer){var phoneManager=new patron.PhoneManager({user:{name:patron.username,
domain:patron.userdomain}});phoneManager.bind({verifySuccess:function(evt,data){Layer.get("phoneaddsuccess",function(layer){$(".js-RemindPhone",layer.$div).html(data.readable_phone);layer.unbind(".counters")[0].show();(new Image).src="//rs."+patron.SingleDomainName+"/d544944.gif?"+Math.random()})}});$(".js-RemindPhone",layer.$div).text(vars[1]);layer.one("callback",function(evt,status){if(status===true){phoneManager.check("",vars[1]);(new Image).src="//rs."+patron.SingleDomainName+"/sb544946.gif?"+
Math.random()}else if(status===false)Layer.get("phoneDeleteSuccess",function(layer){$(".js-phone",layer.$div).text(vars[1]);layer.bind("callback",function(evt,status){if(status){phoneManager.addPhone();(new Image).src="//rs."+patron.SingleDomainName+"/sb544947.gif?"+Math.random()}})[0].show();phoneManager.deleteRemindPhone(vars[1])})});layer.bind("callback.counters",function(evt,status){if(status===null&&evt.target.type!="is-phoneaddsuccess"){layer.unbind(".counters");(new Image).src="//rs."+patron.SingleDomainName+
"/sb544945.gif?"+Math.random()}});layer.show();(new Image).src="//rs."+patron.SingleDomainName+"/d544943.gif?"+Math.random();this.saveHelper("phoneSync")}.bind(this))}.bind(this))},noAuthOffline:function(name,options){$R("{plugins}"+"Layer",function(){Layer.get(name,function(layer){var $form=$("form",layer.$div).unbind("submit");var $error=$(".js-formError",$form);var $login=$(".js-login",$form);var $domain=$(".js-domain",$form);var $password=$(".js-password",$form);layer.one("show",function(){var email=
options.active_email;if($.type(email)=="string"){var parts=email.split("@");if(parts.length==2){$login.val(parts[0]);var $domainSelectOption=$('option[value="'+parts[1]+'"]',$domain);if(!$domainSelectOption.length)$domain.append('<option value="'+parts[1]+'">@'+parts[1]+"</option>");$domain.val(parts[1]).triggerHandler("change")}}$error.hide();$password.val("")});layer.func=function(status){if(status){var login=$login.val();var domain=$domain.val();var password=$password.val();var email=login;if(!~email.indexOf("@"))email+=
"@"+domain;return options.success(layer,email,password)}};layer.disableHide().show(options.layer_options)})})},enableOffline:function(name,options){$R("{plugins}"+"Layer",function(){Layer.get(name,function(layer){var $form=$("form",layer.$div).unbind("submit");var $error=$(".js-formError",$form);var $password=$(".js-password",$form);layer.one("show",function(){$password.val("");$error.hide()});layer.func=function(status){if(status){var password=$password.val();if($.trim(password))options.success(password);
else{$error.text(Lang.get("password.wrong")).show();return false}}};layer.show()},{effects:this.effects.zoomIn})}.bind(this))},disableOffline:function(name,opts){$R("{plugins}"+"Layer",function(){Layer.get(name,function(layer){layer.func=function(status){if(status)if(opts.success)opts.success()};layer.show()},{effects:this.effects.zoomIn})}.bind(this))},removeMrimDisabled:function(name){$R("{plugins}"+"Layer",function(){Layer.get(name,function(layer){layer.show()},{effects:this.effects.zoomIn})}.bind(this))},
changeLang:function(name,opts){$R("{plugins}"+"Layer",function(){Layer.get(name,function(layer){var $lang=$(".js-langSelect",layer.$div).val(opts.lang||patron.LANG);$lang.trigger("change");layer.func=function(status){if(status){var lang=$lang.val();if(opts.modifyprofile)$R("{patron}"+"patron.Ajax",function(){patron.Ajax({type:"POST",url:"/cgi-bin/ajax_modifyprofile?ajax_call=1&func_name=set_lang",data:{lang:lang},complete:function(){location.href=jsHistory.get().replace(/(^|(\?)|&)?(setLang|lang)=[^&]*/g,
"$2")}})});else{var url=jsHistory.get().replace(/(^|(\?)|&)?(setLang|lang)=[^&]*/g,"$2");url+=(url.indexOf("?")===-1?"?":"&")+"lang="+lang;location.href=url}$(window).triggerHandler("langChange.lang",[lang]);return false}};if(opts.setLang)layer.one("hide",function(){location.href=jsHistory.get().replace(/(^|(\?)|&)?(setLang|lang)=[^&]*/g,"$2")});layer.show()},{effects:this.effects.zoomIn})}.bind(this))},settings__folders__edit:function(name,opts){$R("{plugins}"+"Layer",function(){Layer.get(name,function(layer){var newFolder=
typeof opts.folderName!=="string";opts.parentId=parseInt(opts.parentId,10);opts.isSecret=opts.isSecret||false;layer.$div.find('input[name="Name"]').form__enable();if(opts.folderId==0||opts.folderId==950||opts.folderId==5E5||opts.folderId==500001||opts.folderId==500002)layer.$div.find('input[name="Name"]').form__disable();function togglePopCheckbox(condition){if(condition){popUserValue=popCheckbox.attr("checked");popWrapper.form__disable();popCheckbox.attr("checked","checked")}else{popWrapper.form__enable();
popCheckbox.attr("checked",popUserValue)}}function initConfirmBtn(){var $confirmBtn=layer.$div.find(".js-confirm-ok"),$confirmBtnText=$confirmBtn.find(".js-btn__text"),btnText=newFolder?Lang.get("options.folders.add"):Lang.get("options.folders.edit"),btnData=newFolder?"add":"save";if($confirmBtn.length){$confirmBtnText.length?$confirmBtnText.text(btnText):$confirmBtn.val(btnText);$confirmBtn.attr("data-name",btnData)}}var protectedCheckbox=layer.$div.find('input[name="secret"]'),popWrapper=layer.$div.find(".js-pop"),
popCheckbox=popWrapper.find('input[name="pop"]'),popUserValue;var canHidePassword=!opts.isSecret;layer.$div.find('input[type="text"],input[type="password"]').val("");layer.$div.find('input[type="checkbox"]').removeAttr("checked");if(!newFolder){layer.$div.find(".js-folder").text(opts.folderName);layer.$div.find('input[name="Name"]').val(opts.folderName);popCheckbox.attr("checked",opts.isPop?"":"checked");protectedCheckbox.attr("checked",opts.isSecret?"checked":"")}layer.$div.find('input[name="new"]').val(newFolder?
"1":"");layer.$div.find('input[name="folder"]').val(opts.folderId);var parentSelect=layer.$div.find('select[name="parentid"]'),foldersList=opts.foldersList;if($.isArray(foldersList))foldersList="<option>"+Lang.get("options.folders.topfolder")+"</option>"+ajs.map(foldersList,function(folder){return'<option value="'+(folder.id||folder.Id)+'">'+ajs.Html.escape(folder.name||folder.Name)+"</option>"}).join("");parentSelect.html(foldersList);parentSelect.val(isNaN(opts.parentId)?"":opts.parentId);parentSelect.triggerHandler("change");
parentSelect.closest(".form__row").toggle(!opts.isParent&&opts.canBeSubfolder);if(opts.secretQuestion){layer.$div.find('input[name="secret_question"]').val(opts.secretQuestion);layer.$div.find('input[name="secret_answer"]').val("**********")}if(newFolder){layer.$div.find(".js-new").show();layer.$div.find(".js-edit").hide()}else{layer.$div.find(".js-edit").show();layer.$div.find(".js-new").hide()}initConfirmBtn();layer.$div.find(".js-password-container").show().form__enable();var passwordContainer=
canHidePassword?layer.$div.find(".js-password-container"):layer.$div.find(".js-folder-password-question");protectedCheckbox.unbind(".settings__folders__edit").bind("change.settings__folders__edit",function(){var isPasswordProtected=protectedCheckbox.attr("checked");if(isPasswordProtected){passwordContainer.form__enable();layer.$div.find(".js-folder-password-question").toggle(true);layer.$div.find(".js-folder-password-question").form__toggle(true);passwordContainer.slideDown("fast",function(){layer.sizeChanged()});
togglePopCheckbox(true)}else{passwordContainer.slideUp("fast",function(){passwordContainer.form__disable();layer.sizeChanged()});if(opts.isPopEditable!==false)togglePopCheckbox(false)}});passwordContainer.toggle(opts.isSecret);passwordContainer.form__toggle(opts.isSecret);togglePopCheckbox(opts.isPopEditable!==false?opts.isSecret:true);layer.func=function(status){if(!status){if($.isFunction(opts.cancel))opts.cancel(form);return true}var requiredFields=[{name:"Name",prompt:Lang.get("options.folders.error.required")}];
var patternFields=[];if(protectedCheckbox.attr("checked")){requiredFields.push({name:"secret_question",prompt:Lang.get("options.folders.error.required")},{name:"secret_answer",prompt:Lang.get("options.folders.error.required")},{name:"Password",prompt:Lang.get("options.folders.error.required")});var password=layer.$div.find('input[name="secret_password_new"]').val();if(newFolder||canHidePassword){requiredFields.push({name:"secret_password_new",prompt:Lang.get("options.folders.error.required")},{name:"secret_password_retype",
prompt:Lang.get("options.folders.error.required")});patternFields.push({name:"secret_password_new",minLen:4,error:Lang.get("options.folders.error.shortpassword")},{name:"secret_password_retype",test:function(password2){return password===password2},error:Lang.get("options.folders.error.passwordsdontmatch")})}}else if(!canHidePassword)requiredFields.push({name:"Password",prompt:Lang.get("options.folders.error.required")});var form=layer.$div.find("form");if(CheckForm(form[0],requiredFields,patternFields)){popWrapper.find("[disabled]").removeAttr("disabled");
var token=opts.tokens;if($.isArray(token)){layer.$div.find('input[name="form_sign"]').val(token[0]);layer.$div.find('input[name="form_token"]').val(token[1])}$R("{patron}"+"patron.Ajax",function(){patron.Ajax({type:"POST",url:opts.url||"/settings/ajax_settings?ajax_call=1&func_name=edit",data:form.serialize(),complete:function(data){var responseData=data.getData();if(responseData&&responseData.Error){togglePopCheckbox(protectedCheckbox.attr("checked"));layer.showError(responseData.Error)}else{if($.isFunction(opts.success))opts.success(form,
responseData?responseData.newfolderid:null);layer.hide()}}})})}return false};layer.show()},{effects:this.effects.zoomIn})}.bind(this))},settings__folders__delete_imap:function(){$R("{plugins}"+"Layer",function(){Layer.get("settings__folders__delete_imap",function(layer){layer.func=function(status){if(!status)return true};layer.show()},{effects:this.effects.zoomIn})}.bind(this))},settings__folders__delete:function(name,opts){if(patron.EnableIMAP){var collector=patron.isCollectorFolder(opts.folderId);
if(collector)return this.settings__folders__delete_imap()}function deleteFolder(){$R("{patron}"+"patron.Ajax",function(){patron.API.post("folders/remove",{ids:[opts.folderId]},function(response){if(response.isOK()){if($.isFunction(opts.success))opts.success(response.getBody())}else patron.Notify.add("error",{text:Lang.get("notify.error")})})})}$R("{plugins}"+"Layer",function(){Layer.get(name,function(layer){layer.func=function(status){if(!status)return true;var F=patron.Folders.getSafe(parseInt(opts.folderId,
10));if(!F.isSecureOpen()){layer.hide();setTimeout(function(){patron.Layers.secure(opts.folderId,function(status){if(status)deleteFolder()})},patron.TestAnimations?this.effects.zoomIn.layer.hide.duration:0);return false}else deleteFolder();return true}.bind(this);layer.$div.find(".js-folder").text(opts.folderName);layer.show()}.bind(this),{effects:this.effects.zoomIn})}.bind(this))},settings__folders__clear:function(name,opts){function clearFolder(F){F.clear().done(function(){if($.isFunction(opts.success))opts.success()})}
$R("{plugins}"+"Layer",function(){Layer.get(name,function(layer){var isTrashFolder=opts.folderId==500002,isSpamFolder=opts.folderId==950;layer.$div.find(".js-default-message").toggle(!isTrashFolder&&!isSpamFolder).end().find(".js-trash-message").toggle(isTrashFolder).end().find(".js-spam-message").toggle(isSpamFolder);layer.$div.find(".js-folder").text(opts.folderName);layer.func=function(status){if(!status)return true;var F=patron.Folders.getSafe(opts.folderId);if(!F.isSecureOpen()){layer.hide();
setTimeout(function(){patron.Layers.secure(opts.folderId,function(status){if(status)clearFolder(F)})},patron.TestAnimations?this.effects.zoomIn.layer.hide.duration:0);return false}else clearFolder(F);return true}.bind(this);layer.show()}.bind(this),{effects:this.effects.zoomIn})}.bind(this))},settings__filters__delete:function(name,opts){$R("{plugins}"+"Layer",function(){Layer.get(name,function(layer){layer.$div.find(".js-filter").html(opts.filterText);var isFwd=!!opts.isFwd&&opts.isFwd=="1";layer.$div.find(".js-title-filter").toggle(!isFwd);
layer.$div.find(".js-text-filter").toggle(!isFwd);layer.$div.find(".js-title-fwd").toggle(isFwd);layer.$div.find(".js-text-fwd").toggle(isFwd);layer.func=function(status){if(!status)return true;patron.API.post("filters/remove",{"ids":[opts.filterId]},function(response){if($.isFunction(opts.success))opts.success(response.isOK());layer.hide()});return true};layer.show()},{effects:this.effects.zoomIn})}.bind(this))},settings__filters__confirmEmail:function(name,opts){$R("{plugins}"+"Layer",function(){Layer.get(name,
function(layer){function refreshCaptcha($captchaFrame){if($captchaFrame)$captchaFrame.attr("src",patron.captchaURL1+"?"+Math.random())}var form=layer.$div.find("form")[0],$codeInput=layer.$div.find('input[name="code"]'),$codeContainer=layer.$div.find(".js-confirmCode"),$passInput=layer.$div.find('input[name="password"]'),$captchaContainer=layer.$div.find(".js-captchaRow"),$captchaInput=layer.$div.find('input[name="security_image_answer"]'),$resendLink=layer.$div.find(".js-resend"),$resendLinkOk=$resendLink.parent().find(".js-resend-ok");
var useCaptcha=opts.useCaptcha;layer.$div.find(".js-email").html(opts.email);$codeInput.val("");$passInput.val("");$captchaInput.val("");$resendLinkOk.hide();$resendLink.show();if(opts.code){$codeInput.val(opts.code);$codeContainer.hide();layer.$div.find(".js-desc").hide();layer.$div.find(".js-confirmCode-desc").show();setTimeout(function(){$passInput.first().focus()},100)}else{$codeContainer.show();layer.$div.find(".js-desc").show();layer.$div.find(".js-confirmCode-desc").hide()}$captchaContainer.display(useCaptcha);
layer.$div.delegate(".js-refresh-captcha","click",function(evt){refreshCaptcha(layer.$div.find("#captcha_frame"));evt.preventDefault()});layer.func=function(status){if(!status)return true;var requiredFields=[{name:"code",prompt:Lang.get("options.folders.error.required")},{name:"password",prompt:Lang.get("options.folders.error.required")}];if(useCaptcha)requiredFields.push({name:"security_image_answer",prompt:Lang.get("options.folders.error.required")});if(!CheckForm(form,requiredFields))return false;
var data={id:opts.emailId,code:$codeInput.val(),password:$passInput.val()};if(useCaptcha)data.security_image_answer=$captchaInput.val();patron.Ajax({type:"POST",url:"/settings/ajax_settings?ajax_call=1&func_name=confirm_filter_email",data:data,complete:function(data){var responseData=data.getData();if(responseData&&responseData.Error!==undefined){layer.showError(responseData.Error);var patternFields=[{name:"code",test:function(val){return responseData.What!=="code"},error:Lang.get("options.filters.errors.bad_code")},
{name:"password",test:function(val){return responseData.What!=="pwd"},error:Lang.get("options.filters.errors.bad_password")},{name:"security_image_answer",test:function(val){return responseData.What!=="captcha"},error:Lang.get("options.filters.errors.bad_code")}];CheckForm(form,[],patternFields)}else{if($.isFunction(opts.success))opts.success();layer.hide()}if(useCaptcha){$captchaInput.val("");refreshCaptcha(layer.$div.find("#captcha_frame"))}}});return false};layer.$div.find(".js-resend").unbind("click").click(function(e){var link=
$(e.target);patron.Ajax({type:"POST",url:"/settings/ajax_settings?ajax_call=1&func_name=confirm_filter_email_resend",data:{id:opts.emailId},complete:function(data){var responseData=data.getData();if(responseData&&responseData.Error)layer.showError(responseData.Error);else{link.hide();link.parent().find(".js-resend-ok").show()}}});return false});layer.show()},{effects:this.effects.zoomIn})}.bind(this))},settings__filters__forceFilter:function(name,opts){$R("{plugins}"+"Layer",function(){Layer.get(name,
function(layer){layer.$div.find(".js-filter").html(opts.filterText);layer.$div.find(".js-folders").html(opts.foldersList);patron.ui.Options.checkedDropdown({container:layer.$div.find(".js-checked-dropdown"),allText:Lang.get("options.filters.all_folders")});layer.func=function(status){if(!status)return true;patron.Ajax({type:"POST",url:"/settings/ajax_settings?ajax_call=1&func_name=force_filter",data:{id:opts.filterId,folders:layer.$div.find('input[name="filters"]').val()},complete:function(data){var responseData=
data.getData();if(responseData&&responseData.Error)layer.showError(responseData.Error)}});if($.isFunction(opts.success))opts.success();layer.hide();return true};layer.show()},{effects:this.effects.zoomIn})}.bind(this))},secureRestore:function(name){$R("{plugins}"+"Layer",function(){Layer.get(name,function(layer){var step=1;layer.func=function(status){if(!status)return true;if(step===1){layer.$div.find(".js-step1").show();layer.$div.find(".js-step2").hide();var ok=true;if(ok){layer.$div.find('input[type="submit"]').val(Lang.get("layers.change"));
layer.$div.find(".js-step1").hide();layer.$div.find(".js-step2").show();layer.$div.find('input[name="password"]').focus();step=2}else{layer.$div.find('input[name="secret_answer"]').addClass("form__field_error").focus();layer.$div.find(".js-error-container").show()}return false}else{var requiredFields=[{name:"password",prompt:Lang.get("options.folders.error.required")},{name:"password2",prompt:Lang.get("options.folders.error.required")},{name:"secret_question",prompt:Lang.get("options.folders.error.required")},
{name:"secret_answer",prompt:Lang.get("options.folders.error.required")},{name:"Password",prompt:Lang.get("options.folders.error.required")}];var patternFields=[{name:"password",minLen:4,error:Lang.get("options.folders.error.shortpassword")},{name:"password2",test:function(password2){var password=layer.$div.find('input[type="password"]').val();return password===password2},error:Lang.get("options.folders.error.passwordsdontmatch")}];return CheckForm(layer.$div.find("form")[0],requiredFields,patternFields)}};
layer.show()},{effects:this.effects.zoomIn})}.bind(this))},settings__security__password:function(name,opts){$R("{plugins}"+"Layer",function(){Layer.get(name,function(layer){function refreshCaptcha($captchaFrame){if($captchaFrame)$captchaFrame.attr("src",patron.captchaURL1+"?"+Math.random());input.val("")}var sendRadar=function(ok){if(opts.fromAnnouncement)$.event.trigger("ui-abstract-action",{chain:["announcement","weak-password_compromised",ok?"password_change":"password_fail"]});else if(opts.fromAnnouncementSettings)$.event.trigger("ui-abstract-action",
{chain:["announcement","weak-password_compromised_settings",ok?"password_change":"password_fail"]})};var $form=layer.$div.find("form"),formError=layer.$div.find(".js-formError"),pass=layer.$div.find('input[name="Password"]'),row=pass.closest(".form__row"),input=layer.$div.find('input[name="security_image_answer"]');pass.val("");if(input)input.val("");layer.$div.find('input[name="oldPswd"]').val("");layer.$div.find('input[name="Password_Verify"]').val("");layer.$div.find(".js-mrimDisabled").display(opts.mrimDisabled&&
opts.mrimDisabled!=0);pass.bind("blur",function(){var bad=false;var value=pass.val();if(value=="**********")return;if(value=="")return;if(value.length<6)bad=true;if(!bad){var chars=new Array;var i;for(i=0;i<value.length;i++){var c=value.charAt(i);var j;for(j=0;j<chars.length;j++)if(chars[j]==c)break;if(j>=chars.length)chars[chars.length]=c}if(chars.length<3)bad=true}if(bad){if(row.length){if(pass.hasClass("form__field"))pass.addClass("form__field_error");var message=row.find(".form__message");if(message.length){if(!message.hasClass("form__message_error"))message.data("original-text",
message.text());message.html(Lang.get("settings.security.error.weakPassword"));message.css("padding-bottom","4px")}}}else if(row.length){row.find(".form__field").removeClass("form__field_error");row.find(".form__select").removeClass("form__select_error");var message=row.find(".form__message");if(message.length){var text=message.data("original-text");if(text!==undefined)message.html(text);message.css("padding-bottom","")}}});layer.$div.find(".js-refresh-captcha").bind("click",function(){refreshCaptcha(layer.$div.find("#captcha_frame"));
return false});layer.func=function(status){if(!status)return true;var requiredFields=[{name:"oldPswd",prompt:Lang.get("settings.security.error.required")},{name:"Password",prompt:Lang.get("settings.security.error.required")},{name:"Password_Verify",prompt:Lang.get("settings.security.error.required")}];if(input)requiredFields.push({name:"security_image_answer",prompt:Lang.get("options.folders.error.required")});layer.hideError();if(CheckForm($form[0],requiredFields,[]))if(CheckPassword($form[0],true)){if($.isFunction(opts.submit))if(!opts.submit(layer))return;
var data=$form.toObject();if(patron.JSTrapChangePassword){var parts=window["mailru_api_token_parts"];data["form_sign"]=parts["form_sign"];data["form_token"]=parts["form_token"];patron.JSTrapChangePassword(data)}var onRadarDone=$R.bind(null,"{patron}"+"patron.Ajax",function(){patron.Ajax({type:"POST",url:"/settings/ajax_settings?ajax_call=1&func_name=change_password",data:data,complete:function(data){if(data.isOK()){var responseData=data.getData();if(responseData&&responseData.Error){if($.isFunction(opts.error))opts.error(layer);
layer.showError(responseData.Error);sendRadar(false)}else if(responseData&&responseData.Error===null){if($.isFunction(opts.error))opts.error(layer);layer.showError(Lang.get("settings.security.error.ajaxDefaultError"));sendRadar(false)}else if(responseData&&responseData.Redirect){sendRadar(true);location.href=responseData.Redirect+"?result=password"}else{sendRadar(true);location.href=location.pathname+(location.search.match(/result=\w*\b/)?location.search.replace(/result=\w*\b/,"result=password"):
(location.search.substring(0,1)=="?"?"&":"?")+"result=password")+location.hash;layer.hide()}}else{sendRadar(false);if($.isFunction(opts.error))opts.error(layer);layer.showError(Lang.get("settings.security.error.ajaxDefaultError"))}if(input){input.val("");refreshCaptcha(layer.$div.find("#captcha_frame"))}},beforeSend:function(options){var data=options.data,tokens={form_sign:data.form_sign,form_token:data.form_token};patron.JSTrapChangePassword(tokens);data.form_sign=tokens.form_sign;data.form_token=
tokens.form_token}})});formSubmitRadarLog("submit","change_pass=1",onRadarDone)}else refreshCaptcha(layer.$div.find("#captcha_frame"));return false};layer.show()},{effects:this.effects.zoomIn})}.bind(this))},settings__security__additionalEmail:function(name,opts){$R("{plugins}"+"Layer",function(){Layer.get(name,function(layer){function refreshCaptcha($captchaFrame){if($captchaFrame)$captchaFrame.attr("src",patron.captchaURL1+"?"+Math.random())}var $form=layer.$div.find("form"),email=layer.$div.find('input[name="Email"]'),
input=layer.$div.find('input[name="security_image_answer"]');email.val(opts.email);if(input)input.val("");layer.$div.find('input[name="oldPswd"]').val("");layer.$div.find(".js-refresh-captcha").bind("click",function(){refreshCaptcha(layer.$div.find("#captcha_frame"));return false});layer.func=function(status){if(!status)return true;var requiredFields=[{name:"pswd",prompt:Lang.get("settings.security.error.required")}],patternFields=[{name:"email",maxLen:64,pattern:"^([-a-zA-Z0-9._+]+@[-_a-zA-Z0-9]+.[-_a-zA-Z0-9.]+)?$",
error:Lang.get("settings.security.error.invalidEmail")},{name:"pswd",maxLen:50,error:Lang.get("settings.security.error.pswd")}];if(input)requiredFields.push({name:"security_image_answer",prompt:Lang.get("options.folders.error.required")});if(CheckForm($form[0],requiredFields,patternFields))$R("{patron}"+"patron.Ajax",function(){patron.Ajax({type:"POST",url:"/settings/ajax_settings?ajax_call=1&func_name=change_additional_email",data:$form.serialize(),complete:function(data){if(data.isOK()){var responseData=
data.getData();if(responseData&&responseData.Error)layer.showError(responseData.Error);else if(responseData&&responseData.Error===null)layer.showError(Lang.get("settings.security.error.ajaxDefaultError"));else{opts.email=email.val();opts.success(email.val());if(input){input.val("");refreshCaptcha(layer.$div.find("#captcha_frame"))}layer.hide()}}else layer.showError(Lang.get("settings.security.error.ajaxDefaultError"));if(input){input.val("");refreshCaptcha(layer.$div.find("#captcha_frame"))}}})});
return false};layer.show()},{effects:this.effects.zoomIn})}.bind(this))},settings__security__addPasswordQuestion:function(name,opts){$R("{plugins}"+"Layer",function(){Layer.get(name,function(layer){function refreshCaptcha($captchaFrame){if($captchaFrame)$captchaFrame.attr("src",patron.captchaURL1+"?"+Math.random())}function updateOpts(){opts.question=select.html();opts.questionVal=select.val();opts.customQuestion=customQuestion.val();opts.answer=answer.val()}function updateForm(){select.html(opts.question).change();
if(opts.questionVal)select.val(opts.questionVal);select.triggerHandler("change");customQuestion.val(opts.customQuestion);answer.val(opts.answer)}function getCurrentQuestion(){if(select.val()!="Custom"&&select.val()!="")return select.val();else return customQuestion.val()}function checkQuestions(){layer.hideError();if(answer.val()&&answer.val()!=""&&getCurrentQuestion()==""){layer.showError(Lang.get("settings.security.error.noQuestion"));return false}return true}var $form=layer.$div.find("form"),select=
layer.$div.find("#passwordQuestionSelect"),customQuestion=layer.$div.find("#passwordCustomQuestion"),answer=layer.$div.find("#passwordAnswer"),input=layer.$div.find('input[name="security_image_answer"]');layer.$div.find('input[name="oldPswd"]').val("");if(input)input.val("");layer.$div.find(".form__select").form__select();updateForm();select.change(function(){if(select.val()!="Custom"){customQuestion.val("");if(select.val()=="")answer.val("")}});customQuestion.bind("input keyup",function(){if(customQuestion.val()!=
""){select.val("Custom");select.triggerHandler("change")}});layer.$div.find(".js-refresh-captcha").bind("click",function(){refreshCaptcha(layer.$div.find("#captcha_frame"));return false});layer.func=function(status){if(!status)return true;var requiredFields=[{name:"pswd",prompt:Lang.get("settings.security.error.required")}],patternFields=[{name:"Password_CustomQuestion",maxLen:64,error:Lang.get("settings.security.error.customQuestion")},{name:"Password_Answer",maxLen:64,error:Lang.get("settings.security.error.passwordAnswer")}];
if(input)requiredFields.push({name:"security_image_answer",prompt:Lang.get("options.folders.error.required")});if(CheckForm($form[0],requiredFields,patternFields)&&checkQuestions()){if(getCurrentQuestion()==customQuestion.val())select.val("Custom");var data=$form.toObject();if(patron.JSTrapChangePasswordQuestion){if(patron.tokens["ajax_settings"]){data["form_sign"]=patron.tokens["ajax_settings"]["form_sign"];data["form_token"]=patron.tokens["ajax_settings"]["form_token"]}patron.JSTrapChangePasswordQuestion(data)}var onRadarDone=
$R.bind(null,"{patron}"+"patron.Ajax",function(){patron.Ajax({type:"POST",url:"/settings/ajax_settings?ajax_call=1&func_name=change_password_question",data:data,saveTokens:!!patron.JSTrapChangePasswordQuestion,complete:function(data){if(data.isOK()){var responseData=data.getData();if(responseData&&responseData.Error)layer.showError(responseData.Error);else if(responseData&&responseData.Error===null)layer.showError(Lang.get("settings.security.error.ajaxDefaultError"));else{updateOpts();opts.success(getCurrentQuestion());
if(input){input.val("");refreshCaptcha(layer.$div.find("#captcha_frame"))}layer.hide()}}else layer.showError(Lang.get("settings.security.error.ajaxDefaultError"));if(input){input.val("");refreshCaptcha(layer.$div.find("#captcha_frame"))}}})});formSubmitRadarLog("submit","change_secret=1",onRadarDone)}return false};layer.show()},{effects:this.effects.zoomIn})}.bind(this))},settings__security__acca:function(name,opts){$R("{plugins}"+"Layer",function(){Layer.get(name,function(layer){function refreshCaptcha($captchaFrame){if($captchaFrame)$captchaFrame.attr("src",
patron.captchaURL1+"?"+Math.random())}var $form=layer.$div.find("form"),password=layer.$div.find('input[name="pswd"]'),input=layer.$div.find('input[name="security_image_answer"]');if(input)input.val("");password.val("");layer.$div.find(".js-is-"+(opts.isOn?"on":"off")).show();layer.$div.find(".js-is-"+(opts.isOn?"off":"on")).hide();if(opts.error)layer.$div.find(".js-error").html(opts.error).show();else layer.$div.find(".js-error").hide();layer.$div.find(".js-refresh-captcha").bind("click",function(){refreshCaptcha(layer.$div.find("#captcha_frame"));
return false});layer.func=function(status){if(!status)return true;var requiredFields=[{name:"pswd",prompt:Lang.get("settings.security.error.required")}],patternFields=[{name:"pswd",maxLen:50,error:Lang.get("settings.security.error.pswd")}];if(input)requiredFields.push({name:"security_image_answer",prompt:Lang.get("options.folders.error.required")});if(CheckForm($form[0],requiredFields,patternFields))opts.success(layer);return false};layer.show()},{effects:this.effects.zoomIn})}.bind(this))},clearFolderConfirm:function(name,
options){FestLayer(name,options,function(layer){layer.func=function(status){if($.isFunction(options.success))options.success(status);layer.hide()};layer.show()},{effects:this.effects.zoomIn})},copyToCloud:function(name,options){ajs.require(["{plugins}Layer"],function(){Object.extend(options,{effects:this.effects.slideDown},options);FestLayer(name,options,function(layer){layer.show();options.initCallback&&options.initCallback(layer)})}.bind(this))},confirmSpam:function(name,opts){$R("{plugins}"+"Layer",
function(){Layer.get(name,function(layer){var $oneuser=layer.$div.find(".js-oneuser"),$manyusers=layer.$div.find(".js-manyusers"),$emails=layer.$div.find(".js-emails"),$moreemails=layer.$div.find(".js-moreemails"),usersVisible=10,users=Array.map(opts.users||[],function(val){return ajs.Html.escape(val)});$moreemails.hide();if(users.length>0)if(users.length==1){$oneuser.show();$manyusers.hide();$emails.html("&nbsp;"+users.join(", "))}else if(users.length<=usersVisible){$oneuser.hide();$manyusers.show();
$emails.html(":<br>"+users.join("<br>"))}else{$oneuser.hide();$manyusers.show();var numHidden=users.length-usersVisible;$emails.html(":<br>"+users.slice(0,usersVisible).join("<br>"));$(".js-num",$moreemails).text(numHidden);$(".js-senders",$moreemails).text(ajs.plural(numHidden,Lang.get("checkspam.senders.plural"),""));$moreemails.show()}layer.func=function(status){if($.isFunction(opts.success))opts.success(status);layer.hide();return true};layer.show()},{effects:this.effects.zoomIn})}.bind(this))},
listUnsubscribe:function(name,options){$R("{plugins}"+"Layer",function(){Layer.get(name,function(layer){var from=ajs.Html.unescape(options.from);layer.$div.find(".js-from").text(from||"");layer.func=function(status){if($.isFunction(options.success))options.success(status);layer.hide();return true};layer.show()},{effects:this.effects.zoomIn})}.bind(this))},"__collector_edit-folder":function(layer,guest_form){var collector=new patron.Collector;var form={namespace:".js-popup-collector__edit-folder__",
get:function(value){return layer.$div.find(this.namespace+value)},append_folders:function(callback){collector.folders.get(function(folders){var options="";Array.forEach(folders,function(folder){options+='<option value="'+folder.id+'">'+folder.name+"</option>"});this.get("list_select").html(options);callback.call(this);this.folders=folders},function(folder){return folder.parent==-1},this)},post:function(callback){var state=this.get("text_radio").is(":checked"),value=this.get("text_folder").val();if(state&&
value){if(guest_form.error&&value.length>collector.utils.MAX_FOLDER_NAME_LENGTH){callback(null);return guest_form.error("folder_name")}this.create_folder(value,callback)}else{var folder=this.get("list_select").val()|0;callback(folder)}},create_folder:function(name,callback){collector.folders.add({name:name,parent:-1,only_web:false},function(folders){var id=folders[0];callback(id)},function(error){if(error=="exists")callback(this.folder_id(name),error);else{$.event.trigger("layer::collector_folder-edit",
{error:"internal"});if(guest_form.error)guest_form.error("folder_name")}},this)},folder_id:function(name){var id=0;if(!this.folders)$.event.trigger("layer.collector_folder-edit",{error:"internal"});else Object.forEach(this.folders,function(folder){if(folder.name==name){id=folder.id;return false}});return id},toggle_folder:function(){var prefix=this.namespace,folder=this;layer.$div.unbind(prefix).delegate(prefix+"text_folder","focus"+prefix,function(event,data){folder.get("text_radio").trigger("click")}).delegate("select",
"change"+prefix,function(){folder.get("list_radio").trigger("click")})}};form.append_folders(function(){this.toggle_folder()});return form.post.bind(form)},"collector_edit-password":function(name,options,callback){ajs.require("{patron}patron.Collector",function(){var collector=new patron.Collector,email=options.collector.email;var text=Lang.get("Collector");options=Object.extend({},options,{text:text.edit,email:email,logo:collector.get_provider(email)});if(options.convert)options.text=Object.extend({},
text.edit,{title:text.convert.title});try{if(options.collector.flags.need_activation_by_user)options.text=Object.extend({},lang.edit,lang.edit_need_activation)}catch(error){ajs.log("collector_edit-password",error)}FestLayer(name,options,function(layer){var form={namespace:".js-popup-collector__edit__",get:function(value){return layer.$div.find(this.namespace+value)},api:function(name,params,options){collector[name](params,function(data,response){try{if(name=="convert")options.collector.type=data[0].type||
"imap"}catch(error){ajs.log(error)}this.complete(data,response,options)},function(error,response){this.fail(error,options,response)},this)},convert:function(options,checked){var checkbox=this.get("imap__checkbox");if(checkbox.is(":visible")||checked)return checkbox.is(":checked");if(options.experiment==1)options.convert=true;return options.convert||checkbox.is(":checked")},post:function(options,convert){var type={from:"pop3",to:"imap"};if(convert&&options.collector.type!=type.to)this.api("convert",
{from:{id:options.collector.id,type:type.from},to:{type:type.to,password:options.collector.password}},options);else this.api("edit",{id:options.collector.id,email:options.collector.email,password:options.collector.password,type:options.collector.type},options)},update:function(response){},state:function(state){layer.$div.find(".js-popup-collector__loading")[state?"show":"hide"]()},conflict:function(){this.get("imap__checkbox").attr("checked",false)},error:function(type,options){if(type){var text=
"";try{text=collector.utils.text("edit").error[type];if(options&&type=="conflict")try{this.conflict()}catch(error){ajs.log("Layer::collector_edit.error:",error)}}catch(error){ajs.log("Layer::collector_edit.error:",error)}var error=this.get("error");error.show().html(text)}else this.get("error").hide()},fail:function(error,options,response){switch(error){case "invalid":case "auth_limit":break;case "conflict":var experiment=options.experiment|=0,degrade;if(experiment){switch(experiment){case 1:if(degrade=
options.convert)delete options.convert;break;case 2:if(degrade=this.convert(options,true))this.conflict();break}if(degrade)return this.post(options)}break;default:error="system";break}this.error.apply(this,arguments);this.state(false);if(typeof options.failback=="function")options.failback(error,response);$(window).triggerHandler("collector.edit.fail")},complete:function(data,response,options){if(this.convert(options)){try{Object.extend(options.collector,data[0])}catch(error){ajs.log("Layer::collector_edit.complete:",
error)}var params={collector:options.collector};if(/[12]\b/.test(options.experiment)&&options.collector.type=="pop3")params.experiment=1;LayerManager.show("collector_set-folder",params)}else{if(options.complete)options.complete(layer,response);layer.hide()}this.state(false)}};if(!options.collector)form.error("internal");layer.func=function(state){if(state){var password=$.trim(form.get("password").val());if(!password)form.error("password");else{var convert=form.convert(options);options.collector.password=
password;form.state(true);form.post(options,convert)}}return false};layer.show()})})},collector_convert:function(name,options){this["collector_edit-password"](name,Object.extend(options,{convert:true}))},__collector_edit:function(layer,options){var collector=new patron.Collector;return{namespace:".js-popup-collector__edit-",cache:{},init:function(callback){if(callback)callback.call(this);this.toggle_type(this)},log:function(text){var data=Array.prototype.concat.apply(["LayerManager.collector__edit:"],
arguments);ajs.log.apply(null,data)},get:function(value){if(value)return layer.$div.find(this.namespace+value);return layer.$div},param:function(name){return this.get().find('[data-name="'+name+'"]')},value:function(name,value){var node=this.param(name);if(value===undefined){if(node.attr("type")=="checkbox")return node.is(":checked");return $.trim(node.val())}return node.val(value)},state:function(state){var method=state?"show":"hide";layer.$div.find(".js-popup-collector__loading")[method]();return state},
error:function(error,response){var form=this,fabric={DEFAULT_PARAMS:collector.utils.COLLECTOR_SETTINGS,type:function(error){return error.replace(/.*\./,"")},reset:function(){this.border();form.get("error").text("")},border:function(name){var border="popup-collector__form-error_input";if(!name)Object.forEach(this.DEFAULT_PARAMS,function(checkbox,name){if(!checkbox)form.param(name).removeClass(border)});else if(this.DEFAULT_PARAMS[name]===false)form.param(name).addClass(border)},iterate:function(callback){try{var errors=
[],params=response.body,simple_error=Object.keys(params).length==1;Object.forEach(params,function(value,key){var param=this.type(key);if(param in this.DEFAULT_PARAMS){var error=param;try{if(/exists|unsupported|conflict/.test(value.error))error=value.error;else if(/email|password|user_name/.test(param))error="auth"}catch(error){form.log("value.error",error)}errors.push({name:param,value:error});if(simple_error)this.text(error);callback.call(this,param)}else form.log("Unknown parameter")},this);var error=
"internal";if(errors.length<=1)try{error=errors[0].value}catch(error){}else Array.forEach(errors,function(param){var name=param.name;if(/port|server|protocol/.test(name))error="incoming";else if(/email|password|user_name/.test(name))error="auth";else if(/conflict|unsupported/.test(name))error="unsupported"});this.text(error)}catch(error){this.text("internal");form.log("could not parse a response",error)}},text:function(error){if(error)try{var type=Lang.get("Collector").edit.error,text=type[error]||
type.internal;if(text){var node=form.get("error");node.show().html(text)}else form.log("Could not find a text string")}catch(error){form.log(error)}else form.get("error").hide()}};fabric.reset();if(response&&response.status==400)fabric.iterate(fabric.border);else{fabric.border(error);fabric.text(error)}this.state(false)},data:function(){var default_params=collector.utils.COLLECTOR_SETTINGS,user_params={};Object.forEach(default_params,function(bool,name){var node=this.param(name);if(user_params&&node.length)if(bool)user_params[name]=
node.is(":checked");else{var value=node.val();switch(name){case "user_name":if(node.is(":hidden"))return 0;case "password":if(value==collector.utils.DEFAULT_PASSWORD)return 0}if(value)user_params[name]=value.trim();else{this.error(name);user_params=null;return false}}},this);if(user_params){Object.extend(user_params,{id:user_params.id,type:this.cache.type||options.collector.type});return user_params}},success:function(){if(options.callback){var params=Object.extend({__convert:this.cache.convert},
options.collector);options.callback(params)}this.state(false);layer.hide()},post:function(name,data){if(name===null)return this.error("folder_name");var params=Object.extend(data,{folder:name,apply_filters:this.value("apply_filters")});if(params.password==options.collector.password)delete params.password;if(this.cache.convert){var convert_params={from:{id:options.collector.id,type:"pop3"},to:{type:"imap",apply_filters:params.apply_filters}};if(params.password)convert_params.to.password=params.password;
collector.convert(convert_params,this.success,this.error,this)}else collector.edit(params,this.success,this.error,this)},toggle_type:function(self){var set_value=function(method,param){return{"convert":{server:"",port:collector.utils.ports.incoming[self.cache.type][1]},"default":{server:options.collector.server,port:options.collector.port}}[method][param]};this.get().delegate(this.namespace+"type","click",function(event){$(this).toggleSiblings("btn_fixed");var type=self.cache.type=$(this).data("type");
self.cache.convert=type==self.cache.type&&options.collector.type!=type;Array.forEach(["port","server"],function(param){var method="default";if(self.cache.convert)method="convert";self.value(param,set_value(method,param))});self.toggle_exchange(type);event.preventDefault()})},toggle_exchange:function(state){this.param("text-user_name").display(state=="exchange")}}},"collector_edit-extended":function(name,options){this.collector_edit(name,options)},collector_edit:function(name,options){ajs.require(["{patron}patron.Collector",
"{patron.ui}patron.ui.Options"],function(){var collector=new patron.Collector,text=Lang.get("Collector").edit;options=Object.extend({text:text},options);Object.extend(options.collector,{password:collector.utils.DEFAULT_PASSWORD});FestLayer(name,options,function(layer){var form=LayerManager.__collector_edit(layer,options);layer.$div.bind("layer::collector_folder-edit",function(event,data){try{form.error(data.error)}catch(error){ajs.log(event.type,error)}});var edit_folder=LayerManager["__collector_edit-folder"](layer,
form);form.init();layer.func=function(state){if(state){form.state(true);var data=form.data();if(!data)form.state(false);else edit_folder(function(folder){form.post(folder,Object.extend(data,{id:options.collector.id}))})}return false};layer.show()})})},__collector_add:function(layer,options){var collector=new patron.Collector;var form={namespace:".js-popup-collector__add__",get:function(name){if(name)return layer.$div.find(this.namespace+name);return layer.$div},param:function(name){return this.get().find('[data-name="'+
name+'"]')},value:function(name,value){var node=this.param(name);if(value===undefined){if(node.attr("type")=="checkbox")return node.is(":checked");return $.trim(node.val())}return node.val(value)},set_name:function(name){return this.namespace.slice(4)+name},stat:function(state){$(window).triggerHandler("collector.add."+state)},init:function(){Array.forEach(["buttons","select","input"],function(name){this.toggle[name](layer.$div)},this);var provider=options.provider||collector.supported[0];this.toggle.all(provider);
if(options.errors)this.error.apply(this,options.errors);if(options.tutorial)this.toggle.tutorial.click(layer.$div);return this},post:function(params){collector.add(params,function(collectors){if(options.callback)options.callback(params);if(options.tutorial)return this.toggle.tutorial.show(layer.$div);try{params.id=collectors[0].id;var edit="collector_edit-folder",experiment;if(options.convert||options.promo){edit="collector_set-folder";if(/[12]\b/.test(options.experiment))experiment=1}LayerManager.show(edit,
{collector:params,experiment:experiment})}catch(error){ajs.log("collector_edit-folder: could not edit a collector folder\n",error);layer.hide()}},this.error.bind(this),this)},degrade:function(){Object.extend(this.collector,{type:"pop3"});this.post(this.collector)},extended:function(){LayerManager.show("collector_add-extended",{collector:Object.extend(this.collector,{ssl:true,port:collector.utils.ports.incoming.imap[1]}),error:"extended",callback:options.callback})},error:function(type,response,unknown_server){if(type)if(!options.tutorial&&
unknown_server)this.extended();else{switch(type){case "auth_limit":this.stat("auth_limit");break;case "invalid":case "conflict":if(this.collector.type=="imap")return this.degrade();this.get("input__pop3").display(true);break}var text=collector.utils.text("edit");text=text.error[type]||"";var error=this.get("error"),desc=this.get("desc");error.show().html(text);desc.hide();this.state(false);return false}else{this.get("error").hide();this.get("desc").show()}},provider:function(host){var result=null;
Object.forEach(collector.providers,function(aliases,name){if(Array.contains(aliases,host))result=name});return result||"other"},toggle:{all:function(host){var providers=Object.keys(collector.providers);if(!Array.contains(providers,host))this.active=host;this.host(host);this.icons(host)},buttons:function($layer){$layer.delegate(form.namespace+"domains__item","click",function(event){var host=$(event.currentTarget).data("host");this.active=host;this.all(host);if(host!="other"){var email=collector.utils.parse_email(form.value("email"));
if(email)form.value("email",email.name)}form.error()}.bind(this))},select:function($layer){$layer.delegate(form.namespace+"input__host","change",function(event){form.toggle.icons(this.value)})},input:function($layer){$layer.delegate(form.namespace+"input__login","input",function(event){if(form.toggle.active!=="other"){var value=this.value;form.toggle.host(null,function(){return/@/.test(value)})}})},host:function(host,state){var toggle=state?state():host=="other";form.get("init").toggleClass(form.set_name("extended"),
toggle);if(Array.contains(options.list,host))form.get("input__host").val(host).change()},icons:function(host){var provider=form.provider(host),selected=form.set_name("domains__item_selected");host=Array.contains(collector.supported,provider)?provider:"other";form.get("domains").find('[data-host="'+host+'"]').toggleSiblings(selected)},tutorial:{show:function(){ajs.require("{patron.ui}tutorials/patron.ui.tutorials.InitialTuning",function(){var tutorial=new patron.ui.tutorials.InitialTuning;tutorial.init({scenario:1,
use_upload:true});layer.hide()})},click:function($layer){$layer.delegate(form.namespace+"upload","click",function(event){this.show();event.preventDefault()}.bind(this))}}},state:function(state){layer.$div.find(".js-popup-collector__loading")[state?"show":"hide"]()},collector:{},cache:{types:{}}};return form.init()},collector_add:function(name,options){ajs.require("{patron}patron.Collector",function(){var collector=new patron.Collector;collector.providers["hotmail.com"]=["hotmail.com"];options.list=
collector.supported;if(!patron.IsMyCom){var providers=Array.prototype.concat.apply(collector.providers["mail.ru"],collector.supported);options.list=Array.unique(providers)}var lang=Lang.get("Collector");Object.extend(options,{icons:collector.supported,list:options.list,text:lang.add,email:patron.useremail});try{if(options.tutorial)options.text=Object.extend({},options.text,lang.tutorial)}catch(error){ajs.log(error)}FestLayer(name,options,function(layer){var form=LayerManager.__collector_add(layer,
options);if(options.errors)form.error.apply(form,Array.prototype.concat.call(options.errors,options));layer.func=function(state){if(state){var email=form.value("email"),password=form.value("password"),domain=form.value("host");if(!email)return form.error("email");else if(!password)return form.error("password");else if(form.get("select").is(":hidden"))if(domain=email.match(collector.utils.host))domain=domain[1];else return form.error("domain");else if(!collector.utils.parse_email(email))email+="@"+
domain;form.state(true);Object.extend(form.collector,{email:email,password:password});var type=form.cache.types[domain]||"imap";var params=Object.extend(form.collector,{type:type});form.post(params)}return false};form.stat("show");layer.show()})})},"collector_add-extended":function(name,options){ajs.require(["{patron}patron.Collector","{patron.ui}patron.ui.Options"],function(){var text=Lang.get("Collector");text=Object.extend({},text.edit,{title:text.add.title});options.extended=true;FestLayer(name,
Object.extend({text:text},options),function(layer){var form_edit=LayerManager.__collector_edit(layer,options),form_add=LayerManager.__collector_add(layer,options);form_edit.init(function(){this.cache.type="imap"});layer.func=function(state){if(state){form_edit.state(true);var data=form_edit.data();if(!data)form_edit.state(false);else form_add.post.call(form_edit,data)}return false};layer.show()})})},"collector_set-folder":function(name,options){var text=Lang.get("Collector")["set_folder"];this["collector_edit-folder"](name,
Object.extend(options,{text:text}))},"collector_edit-folder":function(name,options){ajs.require(["{patron}patron.Collector","{patron.ui}patron.ui.Options"],function(){var collector=new patron.Collector,text=collector.utils.text("edit_folder"),logo=collector.get_provider(options.collector.email);options=Object.extend({text:text,logo:logo},options);if(options.experiment!==undefined)try{var experiment_text=["title","desc"];Array.forEach(experiment_text,function(name){var value=text.experiment[options.experiment][name];
options.text[name]=value.replace(/%email/,options.collector.email)})}catch(error){ajs.log("collector_edit-folder::experiment",error)}FestLayer(name,options,function(layer){var form={namespace:".js-popup-collector__edit-folder__",get:function(value){if(value)return layer.$div.find(this.namespace+value);return layer.$div},param:function(name){return this.get().find('[data-name="'+name+'"]')},value:function(name,value){var node=this.param(name);if(value===undefined){if(node.attr("type")=="checkbox")return node.is(":checked");
return $.trim(node.val())}return node.val(value)},state:function(state){layer.$div.find(".js-popup-collector__loading")[state?"show":"hide"]()},error:function(type){if(type){var log="LayerManager.collector__edit-folder: "+"Could not find a text string";try{var lang=Lang.get("Collector").edit,text=lang.error[type]||lang.error.internal;if(text){var error=this.get("error");error.show().html(text)}else ajs.log(log)}catch(error){ajs.log(log,error)}}else this.get("error").hide();this.state(false)},post:function(name){if(name===
null)return this.error("folder_name");var params={id:options.collector.id,email:options.collector.email,type:options.collector.type||"imap",folder:name,apply_filters:this.value("apply_filters")};if(this.param("mark").length&&params.type=="pop3")params.mark=this.value("mark");collector.edit(params,function(){if(options.callback)options.callback(options.collector);collector.list(function(data){try{patron.Settings.Collectors.collectors=data}catch(error){ajs.log(error)}},true);this.state(false);layer.hide()},
function(error,response){var text="internal";if(response.status==429)text="auth_limit";else if(error=="invalid")text="auth";this.error(text)},this)}};layer.$div.bind("layer::collector_folder-edit",function(event,data){try{form.error(data.error)}catch(error){ajs.log(event.type,error)}});var edit_folder=LayerManager["__collector_edit-folder"](layer,form);layer.func=function(state){if(state)edit_folder(function(folder){form.post(folder);form.state(true)});return false};layer.show()})})},external_account_salute:function(name){var counter=
{"yandex.ru":1702720,"gmail.com":1703299,"inbox.ru":1703327,"list.ru":1703328,"bk.ru":1703370,"rambler.ru":1703374,"qip.ru":1703376,"yahoo.com":1703380,"hotmail.com":1703381}[patron.userdomain];$R("{plugins}"+"Layer",function(){Layer.get(name,function(layer){layer.$div.delegate(".js-external_account__layer_submit","click",function(){$.post("/cgi-bin/ajax_helper",{"x-email":patron.useremail,func_name:"user_license_accepted"},function(){layer.enableHide().hide({complete:function(){if(counter)Counter.sb(counter);
Counter.sb(1703315)}})})});layer.disableHide().show({complete:function(){if(counter)Counter.d(counter);Counter.d(1703315)}})},{type:"external",effects:this.effects.slideDown})}.bind(this))},increaseSpace:function(name,success){$R(["{plugins}"+"Layer","{patron}"+"patron.API"],function(){Layer.get(name,function(layer){var $template=layer.$div.find("#js-increaseSpace"),templateId="#js-increaseSpace-tmpl",done=false;function render(data){var data=data||{};if(!data.done)data.done=null;if(!data.error)data.error=
null;$template.tpl(templateId,data)}layer.$div.undelegate(".js-refresh-captcha","click").delegate(".js-refresh-captcha","click",function(){layer.$div.find("#captcha_frame").attr("src",patron.captchaURL1+"?"+Math.random());return false});layer.$div.undelegate(".confirm-cancel","click").delegate(".confirm-cancel","click",function(){layer.hide();if(done&&$.isFunction(success))success();return false});layer.$div.undelegate(".confirm-ok","click").delegate(".confirm-ok","click",function(){patron.API.post("user/box/increase",
{capcha:layer.$div.find("#captcha").val()},function(response){var body=response.getBody(),$error=layer.$div.find(".js-formError");if(response.isOk()){done=true;patron["MailboxFree"]+=2*1024;render({done:{space:2}})}else if(body.capcha&&body.capcha.error=="invalid")$error.text(Lang.get("layer.increase_space.error.captcha.invalid")).show();else if(body.capcha&&body.capcha.error=="required")$error.text(Lang.get("layer.increase_space.error.captcha.required")).show();else if(body=="not_needed")render({error:{msg:Lang.get("layer.increase_space.error.not_needed")}});
else if(body=="too_big")render({error:{msg:Lang.get("layer.increase_space.error.too_big")}});else $error.text(Lang.get("layer.increase_space.error.unknown")).show()});return false});render();layer.show()},{effects:this.effects.zoomIn})}.bind(this))},translator:function(options){var defaultSourceLang="en",defaultTargetLang="en";$R("{plugins}"+"Layer",function(){Layer.get("translator",function(layer){var $saveBtn=layer.$div.find(".js-translator__save"),$cancelBtn=layer.$div.find(".js-translator__cancel"),
$sourceLangSelector=layer.$div.find(".js-translator__languages_source"),$targetLangSelector=layer.$div.find(".js-translator__languages_target"),$langSelectors=$sourceLangSelector.add($targetLangSelector),$iframe=layer.$div.find(".js-translator__iframe"),$errorMsg=layer.$div.find(".js-translator-error").text("").hide();$cancelBtn.bind("click",function(e){layer.hide();e.preventDefault()});if(options.setContent)$saveBtn.bind("click",function(e){options.setContent($iframe.contents().find("body").html());
layer.hide();e.preventDefault()});else $saveBtn.hide();patron.Translator.languages(defaultTargetLang,function(languages){var options="";for(var i=0,ii=languages.length;i<ii;i++)options+="<option value="+languages[i].language+(languages[i].language===defaultTargetLang?' selected="selected"':"")+">"+languages[i].name+"</option>";$langSelectors.append(options).trigger("keyup");$sourceLangSelector.attr("disabled","disabled");onLangSelectorsReady()},function(error){$errorMsg.text(error).show();layer.mainDiv.$innerDiv.width(layer.$div.width());
layer.show()});function onLangSelectorsReady(){patron.Translator.translate(options.getContent(),defaultTargetLang,function(translation,sourceLang){$iframe.contents().find("body").html(translation);$sourceLangSelector.val(sourceLang);$sourceLangSelector.removeAttr("disabled");$sourceLangSelector.trigger("keyup")},function(error){$errorMsg.text(error).show()});$langSelectors.bind("change.toTranslate",function(){patron.Translator.translate(options.getContent(),$targetLangSelector.find(":selected").val(),
$sourceLangSelector.find(":selected").val(),function(translation){$iframe.contents().find("body").html(translation)},function(error){$errorMsg.text(error).show()})});layer.mainDiv.$innerDiv.width(layer.$div.width());layer.show()}},{"isRefresh":true,effects:this.effects.slideDown})}.bind(this))},attachToCloud:function(name,files){$R(["{toolkit.mail}"+"b-toolkit/b-toolkit","{utils}"+"Lang","{plugins}"+"Layer","{patron}"+"patron.API","{patron.build}"+"Compose","{jQuery}"+"jquery.filename"],function(){Layer.get("attachToCloud",
function(layer){layer.func=function(status){var type=isInvite?"to-cloud-invite":"to-cloud",action="";var ids=$.map(files,function(file){return file.id});var isAgree=$(".js-agree",this.$div).is(":checked");if(status===true&&(isAgree||!isInvite)){var toCloud=function(){patron.API({url:"attaches/add/to-cloud",type:"POST",data:{folder:folder,ids:ids},complete:function(resp){var body=resp.getBody();if(resp.isOk())onSuccess(body);else onFail(body)}})};if(isInvite)patron.API({url:"user/agree-la",proxy:"cloud/v1/",
complete:toCloud});else toCloud();$(document).triggerHandler("ui-abstract-action",[{chain:[type,"save"]}]);if(folder==="/")action="save-default";else action="save-custom";$(document).triggerHandler("ui-abstract-action",[{chain:[type,action]}]);if(patron.isReadMsgPage()){var attachViewer;if(patron.v2)attachViewer=(new patron.view.letter.Content).attachViewer;else attachViewer=patron.ReadMsg.View.attachViewer;if(files.length>1)type="letter-mass_to-cloud";else if(attachViewer)type=attachViewer.isShort?
"letter-a-l_to-cloud":"letter-a-t_to-cloud"}else if(patron.isFileSearchPage())if(patron.MailFilesViewStyle)type="filesearch-l_to-cloud";else type="filesearch-t_to-cloud";else type="attaches-viewer_to-cloud";$(document).triggerHandler("ui-abstract-action",[{chain:[type,"save"]}])}else if(status===true&&isInvite&&!isAgree)return false;else if(status===false){$(document).triggerHandler("ui-abstract-action",[{chain:[type,"cancel"]}]);return true}};function checkCloudExistence(complete){patron.API({url:"folder",
proxy:"cloud/v1/",data:{kind:"folder",limit:1},complete:function(response){var status=response.getStatus();if(status==424)complete({isCloudExists:false,body:{}});else complete({isCloudExists:true,data:response.isOk()?response.getBody():{}})}})}function redraw(options){var type;if(patron.isReadMsgPage()){var attachViewer;if(patron.v2)attachViewer=(new patron.view.letter.Content).attachViewer;else attachViewer=patron.ReadMsg.View.attachViewer;if(files.length>1)type="letter-mass";else if(attachViewer)type=
attachViewer.isShort?"letter-a-l":"letter-a-t"}else if(patron.isFileSearchPage())if(patron.MailFilesViewStyle)type="filesearch-l";else type="filesearch-t";else type="attaches-viewer";if(type)$(document).triggerHandler("ui-abstract-action",[{chain:[type,"to-cloud"]}]);if(patron.isInviteToCloudWillBeShown||!options.isCloudExists){isInvite=true;Layer.get("inviteCloud",function(inviteLayer){inviteLayer.func=layer.func;$(".js-agree",inviteLayer.$div).change(function(){var $checkbox=$(this),checked=$checkbox.is(":checked"),
$button=$checkbox.parents(".popup_invite-cloud__control").find(".confirm-ok");$button.toggleClass("btn_disabled",!checked);$button.toggleClass("form__button_disabled",!checked)});inviteLayer.one("hide",function(){$(document).triggerHandler("ui-abstract-action",[{chain:["to-cloud-invite","close"]}])});inviteLayer.show();$(document).triggerHandler("ui-abstract-action",[{chain:["to-cloud-invite","show"]}])})}else{layer.one("hide",function(){$(document).triggerHandler("ui-abstract-action",[{chain:["to-cloud",
"close"]}])});layer.show();$(document).triggerHandler("ui-abstract-action",[{chain:["to-cloud","show"]}]);if(options.data.count&&options.data.count.sub_folders)$(document).triggerHandler("ui-abstract-action",[{chain:["to-cloud","has-custom-folder"]}])}}function onSuccess(body){if(isInvite)Layer.get("attachToCloudSuccess",function(successLayer){if(files.length>1){$(".js-title",successLayer.$div).hide();$(".js-title_mass",successLayer.$div).show();$(".js-description",successLayer.$div).text(String.sprintf(ajs.plural(files.length,
"notify.attachToCloud.complete_mass.plural"),files.length))}else{$(".js-title",successLayer.$div).show();$(".js-title_mass",successLayer.$div).hide();$(".js-description",successLayer.$div).html(String.sprintf(Lang.get("notify.attachToCloud.complete"),ajs.Html.escape(files[0].name)))}successLayer.func=function(status){if(status){var url="https://cloud.mail.ru",path=files.length>1?"/home/":"/home/"+encodeURIComponent(files[0].name);window.open(url+path);layer.hide()}};successLayer.show();if(files.length===
1)$(".js-description .js-filename",successLayer.$div).filename()});else{var notify=patron.Notify.add("ok",{html:files.length>1?String.sprintf(ajs.plural(files.length,"notify.attachToCloud.complete_mass.plural"),files.length):String.sprintf(Lang.get("notify.attachToCloud.complete"),ajs.Html.escape(files[0].name))});$(".js-filename",notify.$el).filename();layer.hide()}}function onFail(body){var notify=patron.Notify.add("error",{html:files.length>1?String.sprintf(Lang.get("notify.attachToCloud.error_mass")):
String.sprintf(Lang.get("notify.attachToCloud.error"),ajs.Html.escape(files[0].name))});if(files.length===1)$(".js-filename",notify.$el).filename()}var UI=layer.$div.data("ui"),folder="/",$navigation=layer.$div.find(".js-cloud-navigation"),isInvite=false;if(!UI){UI=new patron.ui.MultiAttachToCompose.loaders[0](layer.$div);layer.$div.data("ui",UI)}layer.$div.addClass("toolkit_cloud");UI.activate();UI.loadNavigation().done(checkCloudExistence.bind(this,redraw));var $description=$(".js-description",
layer.$div).css("visibility","hidden");layer.one("show",function(){if(files.length>1)$description.text(String.sprintf(Lang.get("notify.attachToCloud.description_mass"),files.length,ajs.plural(files.length,"files.plural")));else{$description.html(String.sprintf(Lang.get("notify.attachToCloud.description"),ajs.Html.escape(files[0].name)));$description.find(".js-filename").filename()}$description.css("visibility","");$navigation.delegate(".js-href","click.layer",function(evt){var $item=$(evt.currentTarget),
_folder=$item.data("id");if(_folder)folder=_folder;UI.loadNavigation()})});layer.one("hide",function(){$description.css("visibility","hidden");$navigation.unbind(".layer");UI.reset()})},{effects:this.effects.slideDown})}.bind(this))}});jsLoader.loaded("{plugins}LayerManager")});define("toolkit.mail/b-toolkit/b-toolkit",["toolkit.common/jquery/__fest/jquery__fest","toolkit.common/jquery/__classList/jquery__classList","toolkit.common/jquery/__event-fix/jquery__event-fix","toolkit.common/jquery/__event-tap/jquery__event-tap",
"toolkit.common/jquery/__event-scroll/jquery__event-scroll","toolkit.common/jquery/__event-mousewheel/jquery__event-mousewheel"],function(){var toolkit=window.patron?window.patron.toolkit=window.patron.toolkit||{}:{};(function(toolkit){var gid=0;var _rBEMName=/\b([a-z-]+(?:__[\da-z-]+)*)/ig;var _rBEMMods=/(?:\b|__)[a-z0-9\-]+[^_]_([a-z0-9\-]+)(?:_([a-z0-9\-]+))?/ig;var Block=function(opts){this.__lego.apply(this,arguments)};Block.fn=Block.prototype={constructor:Block,defaults:{},eventEmitTo:null,
eventEmitPrefix:"",template:null,templateBlock:null,__lego:function(opts){this.uniqId="toolkit-"+gid++;$.extend(this,{data:{}},this.defaults,opts);var $emitter=$(this);$.each({on:"bind",off:"unbind",fire:"triggerHandler"},function(myName,jName){this[myName]=function(){$emitter[jName].apply($emitter,arguments);return this}}.bind(this));if(this.boundAll)$.each(this.boundAll,function(i,name){this[name]=this[name].bind(this)}.bind(this));this.setElement(opts.el||opts.$el);this.init()},init:function(){},
bound:function(fn){if(typeof fn==="string")fn=this[fn];return fn.bind(this)},emit:function(name,args){var prefix=this.eventEmitPrefix,method=$.camelCase("on-"+(prefix?prefix+"-":"")+name),event=$.Event(name.replace(/-/g,"")),emmiter=this.eventEmitTo||this;event.target=this;if(emmiter[method]===void 0||emmiter[method].apply(emmiter,[event].concat(args))!==false)if(!event.isImmediatePropagationStopped())return emmiter.fire(event,args)},trigger:function(name,args){this.emit(name,args);this.$el.trigger(name,
args)},s:function(selector){if(typeof selector==="string"&&selector.substr(0,2)=="__")selector="."+this.bemName+selector;return selector},$:function(selector){return this.$el.find(this.s(selector))},toggleMod:function(mod,state){toolkit.toggleMod(this.$el,mod,state);return this},getMods:function(){return toolkit.getMods(this.$el)},hasMod:function(mod){return toolkit.hasMod(this.$el,mod)},setElement:function(el){if(this.$el)this.$el.unbind("."+this.uniqId);this.$el=el=$(el);this.el=el[0];return this},
setData:function(data){this.data=data;return this},getData:function(){return this.data},getHtml:function(data){var ctx=this.getData();if(data)ctx=$.extend({},ctx,data);if(this.templateBlock)ctx={block:this.templateBlock,params:ctx};return $.fest(this.template,ctx)},set:function(opts){$.extend(this,opts);return this},render:function(data){var html=this.getHtml(data);var triggerParams={el:this.$el,block:this,name:this.bemName,template:this.template,data:data};this.emit("before_render",triggerParams);
$(window).trigger("b-toolkit:before_render",triggerParams);this.$el.empty().each(function(){this.innerHTML=html});if(typeof html==="string"&&html.indexOf('data-rb="show"')>-1)this.$('[data-rb="show"]').trigger("rb-show");this.emit("render",triggerParams);this.$el.trigger("b-toolkit:render",triggerParams);return this},destroy:function(){this.$el.unbind("."+this.uniqId)}};Block.extend=function(methods){var Ext=function(){this.__lego.apply(this,arguments)};var Super=this;Ext.prototype=function(){var _toolkit=
function(){};_toolkit.prototype=Super.prototype;return new _toolkit}();Ext.wrap=Super.wrap;Ext.extend=Super.extend;Ext.prototype.__self=Ext.prototype.constructor=Ext;$.extend(Ext.fn=Ext.prototype,methods);return Ext};Block.wrap=function(el){var $el=$(el),sel="."+this.prototype.bemName;if($el.is(sel))return new this({el:el});else if(($el=$el.find(sel)).length)return new this({el:$el.first()})};toolkit.create=function(name,extend,methods){var NewBlock=(methods?toolkit[extend]:Block).extend(methods||
extend);toolkit[name]=NewBlock;NewBlock.prototype.bemName=name;return NewBlock};toolkit.toggleAria=function($el,mod,state){switch(mod){case "checked":case "disabled":case "expanded":case "hidden":case "invalid":$el[state?"attr":"removeAttr"]("aria-"+mod,mod);break}};toolkit.toggleMod=function($el,mod,state){if($el){if(!$el.jquery)$el=$($el);var evt=jQuery.Event("toggleMod");evt.mod=mod;evt.modState=!!state;$el.trigger(evt);if(!evt.isDefaultPrevented()){var name=($el.attr("class")+"").match(_rBEMName);
if(name){if(~name[0].indexOf("js"))name.shift();$el.toggleClass(name[0]+"_"+mod,!!state);toolkit.toggleAria($el,mod,state)}}}};$.fn.hasMod=function(mod){return toolkit.hasMod(this[0],mod)};$.fn.toggleMod=function(mod,state){return this.each(function(){toolkit.toggleMod(this,mod,state)})};toolkit.getMods=function($el){var mods={};if($el){if(!$el.jquery)$el=$($el);var className=$el.attr("class"),matches,mod;while(matches=_rBEMMods.exec(className)){mod=matches[1];mods[mod]=matches[2]||true}}return mods};
toolkit.hasMod=function(el,mod){return toolkit.getMods(el)[mod]!==void 0};toolkit.isDisabledElem=function(el){if(el&&el.jquery)el=el[0];return!el||!!($.attr(el,"disabled")||$.attr(el,"aria-disabled"))};toolkit.windowWidth=function(){return window.innerWidth?window.innerWidth:document.documentElement?document.documentElement.clientWidth||document.body&&document.body.clientWidth||0:0};toolkit.windowHeight=function(){return window.innerHeight?window.innerHeight:document.documentElement?document.documentElement.clientHeight||
document.body&&document.body.clientHeight||0:0};$(document).bind("mouseup drop rb-show",function(evt){var el=evt.target,meta=[],data,name,target;do{if(meta.id==null){meta.id=$.attr(el,"data-id")||null;if(meta.id!=null&&target===void 0)target=el}name=$.attr(el,"data-mnemo")||$.attr(el,"data-group")||$.attr(el,"data-name")||$.attr(el,"data-act");if(name){meta.push(name);if(target===void 0)target=el}}while((el=el.parentNode)&&el!==document);if(meta.length){meta.reverse();if(meta.id!=null)meta.push(meta.id);
$.event.trigger("toolkitclick",{el:target,$el:$(target),id:meta.id,root:meta[0],name:meta.join("."),chain:meta,last:meta[meta.length-1],eventType:evt.type})}});$.click&&$.click("bem.cbx.label.click",function(evt){var $cbx=$(evt.currentTarget).find(".cbx");toolkit.toggleMod($cbx,"checked")});var lang=toolkit.lang={};lang.get=function(key){var value=lang[key];if(value===void 0&&key.indexOf(".")!==-1){key=key.split(".");value=lang[key[0]];if(value)for(var i=1,n=key.length;i<n;i++){value=value[key[i]];
if(value==null)return""}}return value==null?"":value};toolkit["b-toolkit"]=Block})(toolkit);return toolkit});jsLoader.use(["{jQuery}jquery","{jsCore}swfobject"],function(){if(!patron.Utils)patron.Utils={};(function(win,Utils){var RE_EMAIL=/([\w.\u0430-\u044f\u0451\-+]+)@([\w.\u0430-\u044f\u0451\-]+)\.[\w\u0430-\u044f\u0451]+/,RE_EMAILS=/[\w.\u0430-\u044f\u0451\-+]+@[\w.\u0430-\u044f\u0451\-]+\.[\w\u0430-\u044f\u0451]+/gi,RE_NAME_AND_EMAIL_IN_LTGT=new RegExp("[\"']?(.*?)[\"']?\\s+(?:<|&lt;)("+RE_EMAIL.source+
")(?:>|&gt;)"),RE_NAME_AND_EMAIL_IN_LTGT_GLOBAL=/(?:[\"']?(.*?)[\"']?\s+(?:<|&lt;))?([\w.\u0430-\u044f\u0451\-+]+@[\w.\u0430-\u044f\u0451\-]+\.[\w\u0430-\u044f\u0451]+)(?:>|&gt;)?/g,_rebackgroundimage=/url\(["']?(.*?)["']?\)/,_re_email_matcher=/(.*?)\s<(.*?)>$/,_re_width_matcher=/([?&])width=[^&]+/,_re_height_matcher=/([?&])height=[^&]+/,_abjsTS=0,AVATAR_DEFAULT_WIDTH=32;Utils.abjsCountSuccess=Utils.abjsCountError=Utils.abjsTime=Utils.abjsCountXhr=0;Utils.maxAbjsXhrCount=10;Utils.maxAbjsXhrTimeout=
60*1E3;Utils.extractEmails=function(str){return(str+"").match(RE_EMAILS)||[]};Utils.extractEmailsAndNames=function(str){var list=[],match;while(match=RE_NAME_AND_EMAIL_IN_LTGT_GLOBAL.exec(str))list.push({name:(match[1]||"").replace(/\,\s+/i,""),email:match[2]});return list};Utils.getAddressBook=function(){var _retryCount=1,_xhr,_callbacks=[];function doCallbacks(error,data){while(_callbacks.length)_callbacks.shift()(error,data)}return function(fn){fn=fn||ajs.F;_callbacks.push(fn);if(!_abjsTS)_abjsTS=
Date.now();if(patron.abjsData){doCallbacks(null,patron.abjsData);$(win).triggerHandler("success.abjs",[patron.abjsData])}else if(!_xhr){if(++Utils.abjsCountXhr==Utils.maxAbjsXhrCount&&!patron["DoNotDisableAbjsMultipleLoad"]){patron.radar("abjsload","count="+Utils.abjsCountXhr);var log={log:"abjsloadcount",count:Utils.abjsCountXhr,email:window.patron&&patron.useremail?patron.useremail:""};(new Image).src="//gstat."+patron.staticDomainName+"/gstat?ua=1&logme="+encodeURIComponent($.param(log));Utils.getAddressBook=
Utils.getAddressBook.debounce(Utils.maxAbjsXhrTimeout)}_xhr=$.ajax({url:"/cgi-bin/abjs?token="+window.mailru_api_token,type:"GET",data:{nojs:1,id:patron.AbjsHash,r:Math.random(),show_version:true},dataType:"text",timeout:1E4,complete:function(jXHR){var response,data,newhash,retry,version=0;try{response=$.parseJSON(jXHR.responseText)}catch(e){}if(response)if(response.version){data=response.contacts;patron.abjsVersion=response.version}else if(response.AbjsHash)newhash=response.AbjsHash;else if(Array.isArray(response))data=
response;_xhr=null;Utils.abjsTime=Date.now()-_abjsTS;if(data){if(patron.ComposeLabels||patron.CanUseNewAddressbookSuggests)if(!Array.isArray(data)||data.length===0){patron.abjsDataEmpty=true;Counter.d(2051327)}Utils.abjsCountSuccess++;doCallbacks(false,data);$(win).triggerHandler("success.abjs",[patron.abjsData=data]);ajs.notify("abjs:loaded")}else if(newhash){Utils.abjsCountSuccess++;patron.AbjsHash=newhash}else Utils.abjsCountError++;if(!data)if(retry=_retryCount-- >0)Utils.getAddressBook();else{doCallbacks(true);
$(win).triggerHandler("error.abjs")}if(!retry)_retryCount=1;ajs.notify("abjs:complete")}})}}}();Utils.isInAddressBook=function(email,callback){$(window).one("success.abjs error.abjs",function(evt,data){if(!Array.isArray(data))data=[];if(Utils.inArray(email,data))callback(true);else callback(false)});Utils.getAddressBook()};Utils.inArray=function(str,data){for(var i=data.length;i--;)if(data[i].indexOf(str)!==-1)return true;return false};Utils.addToAddressBook=function(list){Utils.getAddressBook(function(err,
data){if(!err){if(typeof list=="string")list=list.split(",");var updated=false,newlyCreated=[];list.reverse();Array.forEach(list,function(nameAndEmail){var email,name,existingEmail,contactString;if(email=nameAndEmail.match(RE_NAME_AND_EMAIL_IN_LTGT)){name=email[1];email=email[2]}else if(email=nameAndEmail.match(RE_EMAIL))name=email=email[0];if(email){var i,f=1;email=email.toLowerCase();for(i=data.length;i--;){existingEmail=([].concat(data[i].match(RE_EMAIL))[0]||"").toLowerCase();if(email===existingEmail){f=
0;contactString=name+" <"+email+">";if(data[i]!==contactString){data[i]=contactString;updated=true}break}}if(f){updated=true;contactString=name+" <"+email+">";data.push(contactString);newlyCreated.push({name:name,email:email,contact:contactString})}}});var newlyCreatedLength=newlyCreated.length;if(newlyCreatedLength>0){newlyCreated=newlyCreated.sort(function(a,b){if(a.name>b.name)return 1;if(a.name<b.name)return-1;return a.email>b.email});data.splice(-newlyCreatedLength,newlyCreatedLength);Array.prototype.splice.apply(data,
[0,0].concat(Array.map(newlyCreated,function(item){return item.contact})))}if(updated)$(window).trigger("abjs:updated")}})};Utils.openAddressbookPopup=function(addto){var t=this,posX=(screen.width-700)/2,posY=(screen.height-500)/2;var url=patron.abjsVersion<2?"/cgi-bin/addressbook?template=quicklist.tmpl&from_sentmsg=1&addto="+addto:"/addressbook/quicklist/"+addto;var w=window.open(url,"sw_window","width=700,height=500,resizable=yes,scrollbars=yes,top="+posY+",left="+posX);w.focus()};Utils.suggestLog=
function(type,opts){if(!$.isArray(opts.data))opts.data=ajs.map(opts.data,function(X){return X.word});patron.gstat({time:opts.start_ts?ajs.now()-opts.start_ts:0,sel_ts:opts.sel_ts?ajs.now()-opts.sel_ts:0,email:patron.useremail,value:opts.val,selected:opts.sel,items:Math.random()<=0.01?opts.data.join("\t"):"",count:opts.data.length,index:opts.idx>-1?opts.idx+1:-1,abjs_time:Utils.abjsTime,abjs_error:patron.Utils.abjsCountError,abjs_success:patron.Utils.abjsCountSuccess,abjs_length:opts.abjs,press_enter:+!!opts.enter,
suggest:type},true)};Utils.catchAjaxError=function(event,jqXHR,options,thrownError){if(thrownError&&options&&options.url&&options.dataType=="json"&&jqXHR&&jqXHR.status==200&&jqXHR.readyState==4)if(/(^|\/)abjs(\?|$)/.test(options.url)){var txt="ajaxConvert: ",hdrs="";txt+=options.url+(options.data?(/\?/.test(options.url)?"&":"?")+options.data:"");if("patron"in window)txt+=" ~ "+(patron.useremail||"NotAuth");txt+=" ~ "+navigator.userAgent;if(jqXHR.getAllResponseHeaders)hdrs="<h>"+jqXHR.getAllResponseHeaders()+
"</h>";if(window.patron&&patron.saveError)patron.saveError("json2",txt);txt="<q>"+txt+"</q>"+hdrs+"<r>"+jqXHR.responseText+"</r>";$.ajax({url:"/cgi-bin/logthis",type:"POST",data:{"jQ.err":txt.replace(/[\r\n]/g,"\\n")},dataType:"text"})}else if(options.sentmsg){var log={log:"sentmsgparseerror5",readyState:jqXHR.readyState,status:jqXHR.status,statusText:jqXHR.statusText,error:thrownError.toString(),email:window.patron&&patron.useremail?patron.useremail:"",responseText:jqXHR.responseText};(new Image).src=
"//gstat."+patron.staticDomainName+"/gstat?ua=1&logme="+encodeURIComponent($.param(log))}};var __convertText=function(supportMultiCharSearch,source,returnMultiply){var table=this;var arrayResult=returnMultiply?[]:null,stringResult="";var letters=String(source).toLowerCase().split("");var letter,nextLetter;for(var i=0,l=letters.length;i<l;i++){letter=letters[i];if(supportMultiCharSearch){while((nextLetter=letters[i+1])&&table[nextLetter=letter+nextLetter]!==void 0){letter=nextLetter;i++}if(table[letter]===
null){i-=letter.length-1;letter=letter.charAt(0)}}if(table[letter]!==void 0){letter=table[letter];if(typeof letter!=="string")if(!returnMultiply)stringResult+=letter[0];else{if(stringResult)arrayResult.push(stringResult);stringResult="";arrayResult.push(letter)}else stringResult+=letter}else stringResult+=letter}if(returnMultiply)if(stringResult)arrayResult.push(stringResult);return returnMultiply?arrayResult:stringResult};var _char,_value;var _punto={"`":"\u0451","q":"\u0439","w":"\u0446","e":"\u0443",
"r":"\u043a","t":"\u0435","y":"\u043d","u":"\u0433","i":"\u0448","o":"\u0449","p":"\u0437","[":"\u0445","]":"\u044a","a":"\u0444","s":"\u044b","d":"\u0432","f":"\u0430","g":"\u043f","h":"\u0440","j":"\u043e","k":"\u043b","l":"\u0434",";":"\u0436","'":"\u044d","z":"\u044f","x":"\u0447","c":"\u0441","v":"\u043c","b":"\u0438","n":"\u0442","m":"\u044c",",":"\u0431",".":"\u044e"};for(_char in _punto)if(_punto.hasOwnProperty(_char)){_value=_punto[_char];if(!(_value in _punto))_punto[_value]=_char}Utils.punto=
__convertText.bind(_punto,false);var _translit={'"':"\u044a","'":"\u044c",".":":","a":"\u0430","b":"\u0431","c":["\u0446","\u043a"],"ts":"\u0446","ch":"\u0447","d":"\u0434","e":"\u0435","je":"\u0435","ye":["\u0435","\u0439\u0435"],"eh":"\u044d","f":"\u0444","ph":"\u0444","g":"\u0433","h":"\u0445","i":["\u0438","\u0439","\u044b"],"j":["\u0436","\u0439"],"ja":["\u044f","\u0439\u044f"],"ya":["\u044f","\u0439\u044f"],"jj":"\u0439","jo":"\u0451","yo":["\u0451","\u0439\u043e"],"ju":"\u044e","yu":["\u044e",
"\u0439\u0443"],"k":"\u043a","kh":"\u0445","l":"\u043b","m":"\u043c","n":"\u043d","o":"\u043e","p":"\u043f","q":"\u043a","r":"\u0440","s":["\u0441","\u0437"],"sc":null,"sch":["\u0448","\u0449"],"sh":"\u0448","shh":"\u0449","shc":null,"shch":"\u0449","t":"\u0442","u":["\u0443","\u044e"],"v":"\u0432","\u0432":"v","w":"\u0432","x":"\u043a\u0441","y":["\u044b","\u0439","\u044f","\u0438\u0439"],"\u0438\u0439":["iy"],"z":"\u0437","zh":"\u0436","\u0436":"zh"};for(_char in _translit)if(_translit.hasOwnProperty(_char)){_value=
_translit[_char];if(Array.isArray(_value))Array.forEach(_value,function(_value){var chars;chars=this[_value];if(chars===void 0)this[_value]=_char;else if(Array.isArray(chars)){if(!Array.contains(chars,_char))chars.push(_char)}else if(chars!==_char)this[_value]=[chars,_char]},_translit);else if(_translit[_value]){_value=_translit[_value];if(Array.isArray(_value)){if(!Array.contains(_value,_char))_value.push(_char)}else if(_value!==_char)_translit[_translit[_char]]=[_value,_char]}else if(_value)_translit[_value]=
_char}Utils.translit=__convertText.bind(_translit,true);_char=_value=_translit=_punto=__convertText=null;Utils.getAvatarSrc=function(email,name,width,height,avatars){var src;email=encodeURIComponent(email||"default@default");width=width||AVATAR_DEFAULT_WIDTH;height=height||width;if(patron.IsRetina&&width==AVATAR_DEFAULT_WIDTH){width=45;height=45}if(avatars)if(!(src=avatars[width+"x"+height]))if(src=avatars["default"]){src=src.replace(_re_width_matcher,"$1").replace(_re_height_matcher,"$1");src+="&width="+
width+"&height="+height}if(!src)src="//"+patron.avaHost+"/pic?width="+width+"&height="+(height||width)+"&email="+email;if(name){name=encodeURIComponent(name);src+="&name="+name}src+="&version="+patron["AvatarVersion"]+"&build="+patron["AvatarBuild"];return src};Utils.getAvatarDataByMessage=function(Message,onlyFrom){var data={email:"",name:"",avatars:null},Folder,tmp,correspondents,correspondent;if(Message){if(Message.correspondents)correspondents=Message.correspondents;Folder=patron.Folders.getSafe(Message.FolderId);
if(!onlyFrom&&(Folder.isSent()||Folder.isDrafts()))if(Message.Cc||Message.To.contains(","))data.email=patron.multiccEmail;else{data.email=ajs.Html.unescape(Message.To);data.name=Message.ToList;if(tmp=data.email.match(_re_email_matcher))data.email=tmp[2];if(correspondents&&correspondents.to)correspondent=correspondents.to[0]}else{data.email=Message.From;data.name=Message.FromShort;if(data.name)data.name=ajs.Html.unescape($.trim(data.name));else{data.name=Message.FromList;if(data.name){data.name=ajs.Html.unescape($.trim(data.name));
if(tmp=name.match(_re_email_matcher))data.name=tmp[1]}}if(correspondents&&correspondents.from)correspondent=correspondents.from[0]}}if(patron.UseAvatarFromCorrespondent&&correspondent&&correspondent.avatars)data.avatars=correspondent.avatars;return data};Utils.getAvatarEmailByMessage=function(Message,onlyFrom){var data=Utils.getAvatarDataByMessage(Message,onlyFrom);return data.email};Utils.getAvatarSrcByMessage=function(Message,width,height,onlyFrom){var src="",data;if(Object.isObject(Message)){data=
Utils.getAvatarDataByMessage(Message,onlyFrom);src=Utils.getAvatarSrc(data.email,data.name,width,height,data.avatars);if(!patron.AvatarNoTrust&&!Message.SPF)src+="&trust=false";if(patron.AvatarNoCache)src+="&uid="+Message.Id+patron.CurrentTimestamp}return src};Utils.getAvatarUrlByMessage=function(Message,onlyFrom){var url="",email;if(Object.isObject(Message)){email=Utils.getAvatarEmailByMessage(Message,onlyFrom);if(email!=patron.multiccEmail)url=patron.getUserUrl(email,"avatar")}return url};Utils.updateMessagelineAvatar=
function(Message,id,onlyFrom){var newSrc=Utils.getAvatarSrcByMessage(Message,AVATAR_DEFAULT_WIDTH,null,onlyFrom),image;image=new Image;image.onload=function(){$("#"+id).css("backgroundImage",'url("'+newSrc+'")');image=image.onload=null};image.src=newSrc};Utils.getMessagelineAvatar=function(Message,id,onlyFrom){var newSrc=Utils.getAvatarSrcByMessage(Message,AVATAR_DEFAULT_WIDTH,null,onlyFrom),image;var backgroundImage=$("#"+id).css("backgroundImage"),src=newSrc;if(backgroundImage){Utils.updateMessagelineAvatar(Message,
id,onlyFrom);src=backgroundImage.replace(_rebackgroundimage,"$1")}else if(patron&&patron.username&&patron.userdomain&&patron.NewMsglistAvatarStatistic){image=new Image;image.onload=function(){var fileSize,_log;try{fileSize=image.fileSize}catch(e){}if(fileSize){_log={log:"MAIL_13238_user_avatar_",useremail:patron.useremail,from:Utils.getAvatarEmailByMessage(Message,onlyFrom),messageid:Message.Id};if(fileSize<=650)_log.log+="default";else _log.log+="custom";patron.gstat(_log,"ua=1")}image=image.onload=
null};image.src=newSrc}return src};Utils.spinner=new function(){var key=patron.useremail+"|collector.spinner";return{show:function(){var id=patron.getFolderId(),empty=false;var collector=patron.getCollectorInfoByFolderId(id);var folder=patron.Folders.Map[id];var show=function(collector){return collector.state=="expected_activation"||collector.state=="create"||collector.error&&collector.state=="work"};if(folder)if(this.get(collector.id))return false;else if(!collector.error&&collector.state=="work"){this.set(collector.id);
return false}else if(!folder.Messages)if(patron.IsExternalAccount&&id==patron.Folder.INBOX)Object.forEach(patron.collectors,function(collector){if(show(collector))empty=true});else if(show(collector))return true;return empty},"set":function(id){if(id)try{var spinner=store.get(key)||{};spinner[id]=true;store.set(key,spinner)}catch(e){}},"get":function(id){var data={};try{data=store.get(key)||{}}catch(e){}return data[id]}}};Utils.browserData=function(value){var info={get:function(object){var result=
[];Object.forEach(object,function(value,id){if(!Object.isObject(value))result.push("`"+id+"`: `"+(value?value:"inaccessible")+"`")});return result},set:function(value){var flash=swfobject.getFlashPlayerVersion();value+="screen--"+this.get(window.screen).join(",")+"\n";value+="navigator--"+this.get(window.navigator).join(",")+"\n";value+="flash--"+"`version`:`"+flash.major+"."+flash.minor+"."+flash.release+"`"+"\n";return value}};return info.set(value||"")};Utils.logAPFRequest=patron["LogAPFRequest"]&&
jQuery.support.cors?function(){var timer,regexp=/^((?:https?:)?\/\/)(?:(ap?f)(?:\d+)?)(\..*)/i,replacer=function(m0,m1,m2,m3){return m1+m2+"test1"+m3};return function(url){if(regexp.test(url)){clearTimeout(timer);url=url.replace(regexp,replacer);timer=setTimeout(function(){$.ajax({type:"HEAD",url:url,xhrFields:{withCredentials:true}})},1E3)}}}():$.noop})(window,patron.Utils);jsLoader.loaded("{patron.utils}patron.Utils")});jsLoader.use(["{jQuery}jquery"],function(){(function(scope,_slice,undef){var Model=
function(){this.__construct.apply(this,arguments)};Model.prototype={constructor:Model,__self:Model,idAttr:"id",defaults:{},aliases:{},__construct:function(data,options){options=options||{};this._fns={};this.uid=this.uniqId;this.attrs=ajs.clone(this.defaults);this.changed={};this.prevAttrs={};if(data)this.set(data,options.silent);this.__lego()},__lego:ajs.F,getId:function(){return this.id},on:function(name,fn){if(!this._fns[name])this._fns[name]=[];this._fns[name].push(fn);return this},off:function(name,
fn){if(name in this._fns)this._fns[name]=ajs.remove(this._fns[name],fn,true);return this},emit:function(name,args){if(name in this._fns){var fns=this._fns[name],i=0,n=fns.length;for(;i<n;i++)fns[i].apply(this,args)}},trigger:function(name){this.emit(name,_slice.call(arguments,1));return this},has:function(name){return this.attrs[name]!==undef},get:function(name,def){var attrs=this.attrs,alias=this.aliases[name],value=attrs[name];if(alias!==void 0)value=alias(this.attrs);return value===undef?def:value},
set:function(name,val,silent){var attrs;if(typeof name==="string"){attrs={};attrs[name]=val}else{attrs=name;silent=val}if(this._set(attrs,silent)){this.id=this.get(this.idAttr);!silent&&this.emit("change",[this,this.changed])}return this},inc:function(key,num){var val=+this.get(key);return this.set(key,val+num||0)},prev:function(name){return this.prevAttrs[name]},_set:function(attrs,silent){return this._setter(this.attrs,attrs,this.changed={},this.prevAttrs={})},_setter:function(dst,src,changedAttrs,
prevAttrs){var key,newVal,oldVal,alias,aliases=this.aliases,changed=false;for(key in src)if(src.hasOwnProperty(key)){alias=aliases[key];newVal=src[key];oldVal=alias===void 0?dst[key]:alias(dst);if(_notEqual(oldVal,newVal)){changed=true;if(alias===void 0)dst[key]=newVal;else alias(dst,newVal);changedAttrs[key]=newVal;prevAttrs[key]=oldVal}}return changed},toJSON:function(){return ajs.clone(this.attrs)}};Model.extend=function(methods){var Ext=function(){this.__construct.apply(this,arguments)},F=function(){};
F.prototype=this.prototype;Ext.prototype=new F;Ext.extend=this.extend;if(methods)for(var key in methods)if(methods.hasOwnProperty(key))Ext.prototype[key]=methods[key];Ext.prototype.constructor=Ext;Ext.prototype.__self=Ext;return Ext};function _notEqual(actual,expected){var key,res=false,eType=typeof expected;if(typeof actual!==eType&&eType==="object")res=true;else if(eType==="object")if(expected instanceof Array)if(expected.length!=actual.length)res=true;else for(key=0;key<expected.length;key++){if(_notEqual(actual[key],
expected[key])){res=true;break}}else for(key in expected){if(expected.hasOwnProperty(key))if(_notEqual(actual[key],expected[key])){res=true;break}}else res=actual!=expected;return res}scope.Model=Model;scope.OldModel=Model.extend({idAttr:"Id",get:function(key){var val=this[key];return typeof val==="function"?void 0:val},prev:function(name){return name?this.prevAttrs[name]:this.prevAttrs},getChanges:function(){return this.changed},_set:function(attrs){return this._setter(this,attrs,this.changed={},
this.prevAttrs={})},toJSON:function(){return this}});jsLoader.loaded("{patron.model}patron.Model",Model)})(patron,[].slice)});jsLoader.use(["{patron.model}patron.Model","{utils}Lang"],function(){(function(){var Folder=patron.OldModel.extend({__lego:function(){this.Name=this.Name||Lang.str("folder.name."+this.id)},transaction:function(start){if(start){this.__copy={};ajs.each("Name Unread Messages Secure".split(" "),function(key){this.__copy[key]=this.get(key)},this)}else delete this.__copy;return this},
rollback:function(){if(this.__copy)this.set(this.__copy);return this.transaction(false)},getRoot:function(){return patron.Folders.get(this.ParentId)},isRoot:function(){return!this.IsSubfolder},isEmpty:function(){return!this.Messages},inFolder:function(id){return this.isRoot()?this.Id==id:this.ParentId==id||patron.Folders.getSafe(this.ParentId).inFolder(id)},isSecure:function(){return this.Secure>=Folder.SECURE},isSecureOpen:function(){return!this.isSecure()||this.Secure==Folder.SECURE_OPEN},isInbox:function(){return this.inFolder(Folder.INBOX)},
isBulk:function(){return this.inFolder(Folder.BULK)},isSpam:function(){return this.isBulk()},isSent:function(){return this.inFolder(Folder.SENT)},isDrafts:function(){return this.inFolder(Folder.DRAFTS)},isTemplates:function(){return this.Id==Folder.TEMPLATES},isTrash:function(){return this.inFolder(Folder.TRASH)},isMore:function(){return(this.isTrash()||this.isBulk())&&!patron.folders__more_state},isSystem:function(){return!!Folder.TYPES[this.Id]},isMRIM:function(){return this.inFolder(Folder.MRIM)},
isRemovable:function(){return!this.isSystem()&&!this.IsParent},getType:function(){return Folder.TYPES[this.Id]||Folder.TYPES.USER},getHash:function(){return[this.Id,this.Name,this.Secure,this.Unread,this.Messages,this.ParentId].join("")},_set:function(attrs,silent){var res=this._setter(this,attrs,this.changed={},this.prevAttrs={});if(res){this.id=this.Id;if(this.id>=0&&!silent){patron.Events!==undef&&patron.Events.fire("updated.folder",this);patron.Folders.recalcCounters()}}return res},toJSON:function(){return this},
clear:function(){var df=$.Deferred();this.emit("clear",this);$.event.trigger({type:"beforefolderclear",folder:this});patron.log("folder.clear",this.id);if(!this.__clearDefer){this.__clearDefer=df;if(typeof this.id==="undefined"||this.id===null){df.reject();patron.log("folder.clear.fail",this.id)}else if(patron.useAPIMoveMarkMsgs)patron.API.post("folders/clear",{ids:[this.id]},this._clearComplete.bind(this,df));else patron.Ajax({url:"/cgi-bin/clearfolder",type:"POST",data:{ajax_call:1,func_name:"clear_folder",
folder:this.id},isUser:true,complete:this._clearComplete.bind(this,df)})}return this.__clearDefer},_clearComplete:function(df,R){this.__clearDefer=null;df[R.isOK()?"resolve":"reject"](R);if(R.isOK()){this.set({Unread:0,Messages:0});patron.Messages.set(this.id,[],ajs.now());patron.log("folder.clear.done",this.id)}else if(R.isAccessDenied())patron.Layers.secure(this.id,function(access){if(access)this.clear.call(this)}.bind(this));else patron.log("folder.clear.fail",this.id);$.event.trigger({type:"folderclear",
folder:this},R)},getUrl:function(){var type=Folder.TYPES[this.id];return"/messages/"+(type?type.toLowerCase():"folder/"+this.id)+"/"}});ajs.extend(Folder,{INBOX:0,BULK:950,SPAM:950,SENT:5E5,DRAFTS:500001,TRASH:500002,MRIM:500003,MRIM_ARCH:500005,TEMPLATES:500006,UNREAD:600006,FLAGGED:600007,ATTACH:600008,SECURE:1,SECURE_OPEN:2,FILESEARCH:-2,TYPES:{0:"Inbox",950:"Spam",5E5:"Sent",500001:"Drafts",500002:"Trash",500003:"MRIM",500006:"Templates",USER:"user"}});patron.Folder=Folder})();jsLoader.loaded("{patron.model}patron.Folder")});
jsLoader.use("{patron.model}patron.Folder",function(){jsClass.create("patron.Folders").statics({ID:0,List:[],Map:{},UNREAD:0,MESSAGES:0,Null:new patron.Folder({Id:null},{silent:true})}).statics({setId:function(id,a){if(!this.isReady||id!==void 0&&this.ID!=id||a){patron.Events.fire("select.folder",[this.ID,this.ID=id]);return true}return false},upd:function(id,Data,force){if(!(id in this.Map))this.Map[id]=new patron.Folder({Id:id,Unread:0,Messages:0},{silent:force});this.Map[id].set(Data,force);return this.Map[id]},
set:function(folders,hash,force){var list=[];this.hash=hash;this.COUNT=folders.length;Array.forEach(folders,function(folder){list.push(patron.Folders.upd(folder.Id,folder,force))},this);this.List=list;if(force!==1)patron.Events.fire("update.folders",this.List)},get:function(id,def){if(id==null)id=patron.getFolderId();return this.Map[id]||(def!==void 0?this.make(def,id):def)},getSafe:function(id){return this.get(id,true)},getAll:function(){return this.List},getHash:function(){return this.hash},getSearch:function(id){if(id===
void 0)id=~~GET.q_folder;return this.getSafe(-1-(id>=0?id:0))},hasCache:function(id,page){id=Math.max(parseInt(id||0),0);page=Math.max(parseInt(page||0),1);var folder=patron.Folders.get(id),letters=patron.Messages.getByFolder(id,page);return folder&&!folder.Messages||!!letters.length},make:function(props,id){if(props===true)props={};if(props.Id===void 0)props.Id=id;return new patron.Folder(props,{silent:true})},recalcCounters:function(){var unread=0,messages=0;Object.forEach(this.Map,function(folder){if(!folder.isBulk()&&
!folder.isTrash())unread+=folder.Unread;messages+=folder.Messages});patron.Folders.UNREAD=unread;patron.Folders.MESSAGES=messages;$(window).triggerHandler("updatemessagescount",[unread])},convertThreads:function(folders){var newFolders=[];if($.isArray(folders))for(var folder,i=0;i<folders.length;i++){folder=folders[i];newFolders[i]={Id:folder.id,Name:ajs.Html.unescape(folder.name||Lang.str("folder.name."+folder.id)),Unread:folder.messages_unread,Messages:folder.messages_total,Threads:folder.threads_total,
ThreadsUnread:folder.threads_unread,Secure:folder.security?folder.open?patron.Folder.SECURE_OPEN:patron.Folder.SECURE:0,ParentId:folder.parent,IsSubfolder:folder.parent!=-1,IsParent:0};if(folder.parent!=-1&&i>0&&newFolders[i-1].Id==folder.parent)newFolders[i-1]["IsParent"]=1}return newFolders}});(function(){if(window.arMailRuFolders)patron.Folders.set(window.arMailRuFolders,patron.CurrentTimestamp,1)})();Array.forEach("transaction rollback".split(" "),function(name){patron.Folders[name]=function(){var args=
arguments;Array.forEach(this.getAll(),function(folder){folder[name].apply(folder,args)})}});patron.Folders.find=function(data){var defer=new $.Deferred;patron.Folders.findAll().fail(defer.reject).done(function(){var folder=patron.Folders.getSafe(Math.max(data.id|0,0));defer.resolve(folder)});return defer.promise()};patron.Folders.findAll=function(){var defer=this._deferAll,folders=patron.Folders.getAll();if(!defer){defer=this._deferAll=$.Deferred();if(folders.length){defer.loaded=true;defer.resolve(folders)}else{patron.Events.one("stop.updater",
function(){defer.loaded=true;defer.resolve(patron.Folders.getAll())});if(!patron.Updater.active)patron.Updater.reload()}}else if(defer.loaded)defer=$.Deferred().resolve(folders);return defer.promise()};patron.Folders.findByMsgId=function(id){var df=$.Deferred();patron.Messages.find({id:id,sm:GET.sm,read:GET.id==id,bulk_show_images:GET.bulk_show_images}).fail(df.reject).done(function(){var msg=patron.Messages.getSafe(id);patron.Folders.find({id:msg.folder||msg.FolderId}).done(df.resolve).fail(df.reject)});
return df.promise()};patron.Folders.findByThreadId=function(id){var df=$.Deferred();patron.Threads.find({id:id}).then(function(thread){patron.Folders.find({id:thread.get("folder")}).then(df.resolve,df.reject)},df.reject);return df.promise()};jsLoader.loaded("{patron}patron.Folders")});jsLoader.use(["{patron.utils}patron.Utils"],function(){var htmlEscape=function(val){return val}||ajs.Html.escape,htmlUnescape=ajs.Html.unescape,_regexp_macros=/__(BODY|BODY_HTML|BODY_QUOTED|SIGN|SIGN_HTML)_PLACEHOLDER__/g;
function getMessageEmailFields(toFieldName,data){if(data instanceof Array){var sep=", ",standartValue=[],shortValue=[],listValue=[],email,i=data.length;if(toFieldName=="To")standartValue[0]=shortValue[0]="<"+Lang.get("readmsg.not_specified")+">";while(i--){email=data[i];if(!email.__escape){email.__escape=true;email.name=htmlEscape(email.name);email.email=htmlEscape(email.email)}standartValue[i]=email.email||"";shortValue[i]=email.name||standartValue[i];listValue[i]=email.name?email.name+" <"+standartValue[i]+
">":standartValue[i]}return[standartValue.join(sep),listValue.join(sep),shortValue.join(sep)]}return null}function replaceMacros(text){var signature=patron["UserSignature"];var signature_text=window.replaceEntity(signature),signature_html=signature.replace(/\r?\n/g,"<br/>");return text.replace(_regexp_macros,function(body,type){if(type==="BODY")body="__LET_BODY_PLAIN__";else if(type==="BODY_HTML")body="__LET_BODY_HTML__";else if(type==="BODY_QUOTED")body="__LET_BODY_QUOTE_PLAIN__";else if(type===
"SIGN")body=signature_text;else if(type==="SIGN_HTML")body=signature_html;return body})}function fillEmailFields(from,to,toFieldPrefix,fromFields,toFields){var toFieldName,fields,i=fromFields.length;for(;i--;){toFieldName=toFieldPrefix+toFields[i];fields=getMessageEmailFields(toFieldName,from[fromFields[i]]);if(fields){to[toFieldName]=fields[0];to[toFieldName+"List"]=fields[1];to[toFieldName+"Short"]=to[toFieldName+"Name"]=fields[2];if(toFieldName==="Cc"||toFieldName==="ReplyTo"||toFieldName==="ReplyAllTo"||
toFieldName==="ReplyAllCC"||toFieldName==="ReSentFrom"||toFieldName==="ReSentTo"){to[toFieldName]=to[toFieldName+"List"];delete to[toFieldName+"List"];delete to[toFieldName+"Short"];delete to[toFieldName+"Name"]}else if(toFieldName==="From")to[toFieldName+"Full"]=fields[1]}}}function dateWithTimezoneOffset(timestamp){var date=new Date(timestamp*1E3);return date}patron.Utils.AjaxConverter={convert:function(response,ajaxData){if(ajaxData.url=="/api/v1/messages/status")response=this.statusToChecknew(response,
ajaxData);else if(ajaxData.url=="/api/v1/messages/message")response=this.messageToReadmsg(response,ajaxData);return response},messageToReadmsg:function(messageJSON,ajaxData){var readmsgJSON=["AjaxResponse"],response=["Error"];if(messageJSON){var body=messageJSON.body;if(messageJSON.status==400){if(body&&body.id&&body.id.error=="not_exist")if(ajaxData&&ajaxData.data&&ajaxData.data.sm)response=["Redirect","/cgi-bin/msglist?folder=500000"];else response=["OK",[{NoMSG:1}]]}else if(messageJSON.status==
403)if(messageJSON.body=="token")readmsgJSON=messageJSON;else if(messageJSON.body=="nosdc")readmsgJSON=["AjaxResponse","NoSDC"];else response=["Redirect","/cgi-bin/login?noclear=1&page=mailbox"];else if(messageJSON.status==200)if(body)response=["OK",[this.messageToOldApi(body)]]}if($.isArray(readmsgJSON))readmsgJSON=readmsgJSON.concat(response);return readmsgJSON},statusToChecknew:function(statusJSON,ajaxData){var checknewJSON={status:"Error"};if(statusJSON){if(statusJSON.status){checknewJSON.status=
"OK";if(statusJSON.status==304)checknewJSON.status="NOP";else if(statusJSON.status==500)checknewJSON.status="Error";else if(statusJSON.status==403)if(statusJSON.body=="folder")checknewJSON.status="AccessDenied";else if(statusJSON.body=="nosdc")checknewJSON.status="nosdc";else if(statusJSON.body=="token")checknewJSON=statusJSON;else checknewJSON.status="NoAuth"}if(checknewJSON.status=="OK"||checknewJSON.status=="NOP"){var emailparts=statusJSON.email.split("@");checknewJSON.data={username:emailparts[0],
userdomain:emailparts[1]};if(checknewJSON.status=="OK"){checknewJSON.data.build=patron.build;checknewJSON.data.cts=statusJSON.last_modified+"";checknewJSON.data.sortBy=ajaxData.data.sortby||patron.messagesSort;if(statusJSON.body){if($.isArray(statusJSON.body.folders)){checknewJSON.data.folders=this.foldersToOldApi(statusJSON.body.folders);checknewJSON.data.folders_hash=checknewJSON.data.cts}if($.isArray(statusJSON.body.messages)){checknewJSON.data.messages=this.statusMessagesToOldApi(statusJSON.body.messages);
checknewJSON.data.messages_hash=checknewJSON.data.cts+checknewJSON.data.sortBy}if(statusJSON.body.collectors)try{checknewJSON.data.collectors=this.collectorsToOldApi(statusJSON.body.collectors);var collectors=patron.user.collectors={"body":statusJSON.body.collectors,"email":statusJSON.email,"last_modified":statusJSON.last_modified,"status":statusJSON.status};var collector=new patron.Collector;collector.store.set(collectors);collector.list(function(collectors){var notify_key=patron.useremail+"|collector.notify",
notify_value=store.get(notify_key)||{};ajs.require(["{patron}patron.Notify"],function(){Array.forEach(collectors,function(collector){var email=collector.email;if(email in notify_value&&!/extra_auth|blocked|noauth/.test(collector.state)){patron.Notify.hide(notify_value[email]);delete notify_value[email]}});store.set(notify_key,notify_value)})})}catch(error){ajs.log("patron.user.collectors: patron.Utils.Ajax.Converter\n",error)}checknewJSON.data.token=statusJSON.body.token;checknewJSON.data.tokens=
statusJSON.body.tokens}}}checknewJSON.token=statusJSON.token}return checknewJSON},collectorsToOldApi:function(collectors){var newCollectors={};if(Array.isArray(collectors))Array.forEach(collectors,function(collector){var state="",error="";switch(collector.state){case "auth_error":error="auth";break;case "extra_auth":error="extra_auth";break;case "blocked":error="blocked";break;case "overlimit_error":error="limit";break;case "internal_error":error="internal";break;default:state=collector.state;break}newCollectors[collector.folder]=
{id:collector.id,email:collector.email,type:collector.type,state:state,error:error}});return newCollectors},foldersToOldApi:function(folders){var newFolders=[];if($.isArray(folders))for(var folder,i=0,l=folders.length;i<l;i++){folder=folders[i];newFolders[i]={Id:folder.id,IsSubfolder:folder.child,IsParent:0,Messages:folder.messages_total,Name:folder.name,ParentId:folder.parent,Secure:folder.security?folder.open?2:1:0,Unread:folder.messages_unread};if(folder.child&&i>0&&newFolders[i-1].Id==folder.parent)newFolders[i-
1]["IsParent"]=1}return newFolders},statusMessagesToOldApi:function(messages){var newMessages=[];if($.isArray(newMessages))for(var i=0,l=messages.length;i<l;i++)newMessages[i]=this.statusMessageToOldApi(messages[i]);return newMessages},statusThreadToOldApi:function(message){message.snippet=htmlEscape(message.snippet);return this.statusMessageToOldApi(message)},statusMessageToOldApi:function(message){var newMessage={id:message.id,Id:message.id,DateUTS:message.date,FolderId:message.folder,NextId:message.next,
PrevId:message.prev,Priority:message.priority,Size:message.size,Subject:htmlEscape(message.subject||Lang.get("message.email.untitled")),Microformat:{text:htmlUnescape(message.snippet)},flags:message.flags,correspondents:message.correspondents};if(message.flags){newMessage.Flagged=message.flags.flagged;newMessage.Forward=message.flags.forward;newMessage.Reply=message.flags.reply;newMessage.Unread=message.flags.unread;newMessage.SPF=message.flags.spf;newMessage.Attachment=message.flags.attach;newMessage.ReadSet=
message.flags.read_set}if(message.correspondents)fillEmailFields(message.correspondents,newMessage,"",["cc","from","to","bcc"],["Cc","From","To","Bcc"]);if(message.date){var date=dateWithTimezoneOffset(message.date);newMessage.Date=date.getLocaleFullDate();newMessage.DateShort=date.getLocaleDateShort();newMessage.DateFull=date.getLocaleDateFull()}return newMessage},threadToOldApi:function(message){message.snippet=htmlEscape(message.snippet);return this.messageToOldApi(message)},messageToOldApi:function(message){var newMessage=
this.statusMessageToOldApi(message),reHost=/^[^/]*\/\/([^/]+)/,reAttachesTotal=/^[^/]*\/\/([^/]+).*?partids=([^&]+)/,matches;newMessage.SaveSent=1;newMessage.HTMLCompose=patron["HTMLCompose"];newMessage.AccountVerified=patron["AccountVerified"];newMessage.quote_string="> ";newMessage.MainMailHost=location.host;newMessage.MailAttachZipHost="";newMessage.MailAttachPreviewHost=patron.MailAttachPreviewHost||"apf."+(patron.SingleDomainName||"mail.ru");newMessage.AttachmentHost="af.attach"+(patron.SingleDomainName||
"mail.ru");if(message.attaches){var Attachments=[],Attachlinks=[],newAttach;if($.isArray(message.attaches.list))for(var attach,i=0,l=message.attaches.list.length;i<l;i++){attach=message.attaches.list[i];if(attach.type==="cloud"){attach.type="link";attach.cloud=true}newAttach={name:htmlEscape(attach.name),size:attach.size,ContentType:attach.content_type,avstatus:attach.scan,cloud:!!attach.cloud};if(attach.id)if(attach.type==="link"&&!attach.cloud)newAttach.Id=attach.id;else newAttach.PartID=message.id.split(";")[0]+
";"+attach.id;if(attach.flags){newAttach.IsImage=attach.flags.image;newAttach.isTNEF=attach.flags.tnef;newAttach.isRFC822=attach.flags.eml;newAttach.IsMp3=attach.flags.mp3}if(attach.href)newAttach.downloadlink=attach.href.download;if(attach.duedate)newAttach.duedate=dateWithTimezoneOffset(attach.duedate).getLocaleFullDate();if(attach.thumbnails){if(attach.thumbnails.text){newAttach.ContentText=htmlEscape(attach.thumbnails.text.snippet);var snippetLength=attach.thumbnails.text.snippet_size;if(snippetLength<
attach.size)newAttach.ContentTextLen=snippetLength}if($.isPlainObject(attach.thumbnails.eml))newAttach.Subject=attach.thumbnails.eml.subject;else newAttach.Subject=attach.thumbnails.eml;if(attach.thumbnails.mp3&&attach.thumbnails.mp3.player)if(matches=attach.thumbnails.mp3.player.match(reHost))newMessage.MailAttachZipHost=matches[1]}if(attach.legacy){newAttach.BodyStart=attach.legacy.BodyStart;newAttach.OriginalBodyLen=attach.legacy.OriginalBodyLen;newAttach.ContentName=attach.legacy.ContentName;
newAttach.ContentEncoding=attach.legacy.ContentEncoding;newAttach.tnef_id=attach.legacy.tnef_id;newAttach.DontShow=attach.legacy.DontShow;newAttach.ForceAddNotype=attach.legacy.ForceAddNotype;newAttach.ShowThumbnail=attach.legacy.ShowThumbnail;newAttach.AddPhoto=attach.legacy.AddPhoto}if(attach.type=="link")Attachlinks.push(newAttach);else Attachments.push(newAttach)}newMessage.Attachments=Attachments;newMessage.Attachfiles_Items=Attachments.length;newMessage.Attachlinks=Attachlinks;newMessage.Attachlinks_Items=
Attachlinks.length;if(message.attaches.total)if(matches=message.attaches.total.href.match(reAttachesTotal)){newMessage.AttachAllfiles_AttachHost=matches[1];newMessage.AttachAllfiles_MsgId=message.id;newMessage.AttachAllfiles_name=message.attaches.total.name;newMessage.AttachAllfiles_PartsId=matches[2]}if(message.attaches.tnef){var winmailData=String.toObject(message.attaches.tnef);newMessage.Winmail_name=unescape(winmailData.file);newMessage.Winmail_URLFileName=winmailData.file;newMessage.Winmail_PartID=
winmailData.id;newMessage.Winmail_Channel=winmailData.channel}}if(message.collector)newMessage.collector=message.collector.id;if(message.body){newMessage.let_body=message.body.html;newMessage.let_body_plain=message.body.text}if(message.templates){if(message.templates.replay){newMessage.SubjectRe=htmlEscape(message.templates.replay.subject);newMessage.let_body_re=replaceMacros(message.templates.replay.body.html);newMessage.let_body_re_plain=replaceMacros(message.templates.replay.body.text)}if(message.templates.forward){newMessage.SubjectFwd=
htmlEscape(message.templates.forward.subject);newMessage.let_body_fwd=replaceMacros(message.templates.forward.body.html);newMessage.let_body_fwd_plain=replaceMacros(message.templates.forward.body.text)}}if(message.resend){fillEmailFields(message.resend,newMessage,"ReSent",["from","to"],["From","To"]);if(message.resend.date)newMessage.ReSentDate=dateWithTimezoneOffset(message.resend.date).getLocaleFullDate();newMessage.ReSendComment=message.resend.comment}if(message.replies){fillEmailFields(message.replies,
newMessage,"Reply",["to"],["To"]);fillEmailFields(message.replies,newMessage,"ReplyAll",["all","cc"],["To","CC"])}if(message.correspondents)if(message.correspondents.from)if(message.correspondents.from[0]&&message.correspondents.from[0].avatars)newMessage["Avatar.UrlAbsolute"]=message.correspondents.from[0].avatars["default"];if(message.images){if(message.images.attaches2cid){var attaches2cidJSON=JSON.stringify(message.images.attaches2cid);newMessage.map_inline_img=attaches2cidJSON.substring(1,attaches2cidJSON.length-
1)}newMessage.MailWithImages=message.images.exists;newMessage.HasBannedImages=message.images.banned;newMessage.ImagesAreHidden=message.images.hidden}if(message.flags){if(message.flags.safe)newMessage.files_status="clean";newMessage.HideFastAnswer=message.flags.hide_fast_answers;newMessage.Receipt=message.flags.receipt;newMessage.x_spam=message.flags.probable_spam;newMessage.dmarc_warning=patron.dmarcIsActive&&message.flags.dmarc_fail;newMessage.x_ubl_black=message.flags.blacklist_spam}if(message.drafts){newMessage.reply_draft=
message.drafts.reply;newMessage.replyall_draft=message.drafts.replyall;newMessage.forward_draft=message.drafts.forward;newMessage.last_draft_type=message.drafts.last_type;if(newMessage.last_draft_type)newMessage.last_draft=message.drafts[newMessage.last_draft_type]}if(message.headers){newMessage.headers=message.headers;newMessage.ListUnsubscribe=message.headers["List-Unsubscribe"];newMessage.ListSubscribe=message.headers["List-Subscribe"]}return newMessage},convertThreadsStatusFolders:function(folders){var newFolders=
[];if($.isArray(folders))for(var folder,i=0;i<folders.length;i++){folder=folders[i];newFolders[i]={Id:folder.id,Name:folder.name||Lang.str("folder.name."+folder.id),Unread:folder.messages_unread,Messages:folder.messages_total,Threads:folder.threads_total,ThreadsUnread:folder.threads_unread,Secure:folder.security?folder.open?patron.Folder.SECURE_OPEN:patron.Folder.SECURE:0,ParentId:folder.parent,IsSubfolder:folder.parent!=-1,IsParent:0};if(folder.parent!=-1&&i>0&&newFolders[i-1].Id==folder.parent)newFolders[i-
1]["IsParent"]=1}return newFolders},convertThreadsStatusMessages:function(array){var ret=[],i=0,n=array.length,msg,date,emails,flags,escapeHtml=function(str){return str};for(;i<n;i+=1){msg=array[i];date=Date.parse(msg.date*1E3);flags=msg.flags;emails=msg.correspondents;ret[i]={Id:msg.id,SPF:ajs.isset(flags.spf,true),FolderId:msg.folder,PrevId:msg.prev,NextId:msg.next,Unread:flags.unread,Flagged:flags.flagged,Priority:msg.priority||3,Reply:flags.reply,Forward:flags.forward,Attachment:flags.attach,
From:escapeHtml(emails.from[0]&&emails.from[0].email||""),FromList:escapeHtml(ajs.map(emails.from,function(item){return item.name+" <"+item.email+">"}).join(", ")),FromShort:escapeHtml(ajs.map(emails.from,function(item){return item.name||item.email}).join(", ")),To:escapeHtml(emails.to[0]&&emails.to[0].email||""),ToList:escapeHtml(ajs.map(emails.to,function(item){return item.name+" <"+item.email+">"}).join(", ")),ToShort:escapeHtml(ajs.map(emails.to,function(item){return item.name||item.email}).join(", ")),
Cc:escapeHtml(ajs.map(emails.cc,function(item){return item.name+" <"+item.email+">"}).join(", ")),Date:date.format("d n Y, H:I"),DateShort:date.isToday()?date.format("H:I"):date.format("d n"),DateUTS:msg.date,Subject:escapeHtml(msg.subject),ReSentTo:"",ReSentFrom:"",ReSentDate:"",ReSendComment:"",IcoFromWho:"",Size:msg.size,FilinN:0,FilinEM:0,Microformat:{text:escapeHtml(msg.snippet)},AvatarUrl:emails[0]&&emails[0].avatars&&emails[0].avatars["default"],thread:msg.id,threadLength:msg.length,length_unread:msg.length_unread,
expandId:typeof msg.expand==="string"?msg.expand:msg.expand[0],correspondents:emails}}return ret},searchResult:function(result){if(!result.converted){result.converted=true;Array.map(result.getData().messages,function(data){data.From=htmlUnescape(data.From);data.FromList=htmlUnescape(data.FromList);data.FromShort=htmlUnescape(data.FromShort);data.To=htmlUnescape(data.To);data.ToList=htmlUnescape(data.ToList);data.ToShort=htmlUnescape(data.ToShort);data.correspondents.from[0].avatars["default"]=htmlUnescape(data.correspondents.from[0].avatars["default"])})}}};
jsLoader.loaded("{patron.utils}patron.Utils.AjaxConverter",patron.Utils.AjaxConverter)});jsLoader.use("{patron.model}patron.Model",function(){(function(){var Message=patron.OldModel.extend({getFolder:function(){return patron.Folders.getSafe(this.FolderId)},inFolder:function(id){var F=this.getFolder();return F&&F.inFolder(id)},getIcon:function(){var i=0;if(this.isForward()&&this.isReply())i=211;else if(this.isForward())i=501;else if(this.isReply())i=510;else if(this.isUnread())i=500;return i},getCountAttachments:function(){return(this.Attachfiles_Items|
0)+(this.Attachlinks_Items|0)},getAttachment:function(partId){return Array.filter(this.Attachments,function(value,id){return value.PartID===partId})[0]},isLoaded:function(){return this.Id&&!!(this._loaded||this._static)},isLow:function(){return Message.LOW==this.Priority},isHigh:function(){return Message.HIGH==this.Priority},isNormal:function(){return Message.NORMAL==this.Priority},isReadSet:function(){return 1==this.ReadSet},isUnread:function(){return 1==this.Unread},isReply:function(){return 1==
this.Reply},isForward:function(){return 1==this.Forward},isFlagged:function(){return 1==this.Flagged},isEditable:function(){return!/\d{20};\d;\d/.test(this.id)},getSubject:function(){return this.Subject==""?"&lt;"+Lang.str("message.email.untitled")+"&gt;":this.Subject},getWbrSubject:function(){return this.WbrSubject==""?"&lt;"+Lang.str("message.email.untitled")+"&gt;":this.WbrSubject},getSnipletText:function(){return this.SnipletText==""?"":this.SnipletText},getSearchSniplet:function(){return this.SearchSnippet?
this.SearchSnippet:patron.MicroFormat.text(this)},getSearchSubject:function(){return this.SearchSubject?this.SearchSubject:"&lt;"+Lang.str("message.email.untitled")+"&gt;"},getSearchFrom:function(){return this.SearchFrom?this.SearchFrom:"&lt;"+Lang.str("message.email.unknown")+"&gt;"},setBody:function(html,text){this.let_body=html;this.let_body_plain=text},getBody:function(type){var body=!type||type=="html"?this.let_body:this.let_body_plain;return body==null?"":body},invalidate:function(){this.set({_loaded:0,
_static:0,_load_by_message:0})},_set:function(attrs,silent){var res=this._setter(this,attrs,this.changed={},this.prevAttrs={});if(res&&!silent)patron.Events!==undef&&patron.Events.fire("updated.message",this);return res},save:function(attrs,options){this.set(attrs||{});var changed=this.changed;var type=(options||{}).type;if("Flagged"in changed)patron.Messages.edit({type:type||"mark",models:[this],data:patron.Message[changed.Flagged?"FLAG":"NOFLAG"]});else if("Unread"in changed)patron.Messages.edit({type:type||
"mark",models:[this],data:patron.Message[changed.Unread?"UNREAD":"READ"]});this.changed={}},fetch:function(params){return patron.Messages.find(ajs.extend({id:this.id},params))},canListUnsubscribe:function(){return!!this.get("ListUnsubscribe")},getCountUnread:function(){return this.length_unread|0||(this.Unread?1:0)}});ajs.extend(Message,{READ:2,UNREAD:1,FLAG:6,NOFLAG:7,LOW:5,HIGH:1,NORMAL:3});patron.Message=Message;patron.Message.Null=new patron.Message({Id:null},{silent:true});patron.Message.NoMSG=
new patron.Message({Id:null,NoMSG:1},{silent:true});patron.Message.Empty=new patron.Message({Id:null},{silent:true})})();jsLoader.loaded("{patron.model}patron.Message")});if(!("ajs"in window))ajs={};(function(ajs){var hex_chr="0123456789abcdef";function rhex(num){var str="",j;for(j=0;j<=3;j++)str+=hex_chr.charAt(num>>j*8+4&15)+hex_chr.charAt(num>>j*8&15);return str}function str2blks_MD5(str){var nblk=(str.length+8>>6)+1,blks=new Array(nblk*16),i;for(i=0;i<nblk*16;i++)blks[i]=0;for(i=0;i<str.length;i++)blks[i>>
2]|=str.charCodeAt(i)<<i%4*8;blks[i>>2]|=128<<i%4*8;blks[nblk*16-2]=str.length*8;return blks}function add(x,y){var lsw=(x&65535)+(y&65535);var msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&65535}function rol(num,cnt){return num<<cnt|num>>>32-cnt}function cmn(q,a,b,x,s,t){return add(rol(add(add(a,q),add(x,t)),s),b)}function ff(a,b,c,d,x,s,t){return cmn(b&c|~b&d,a,b,x,s,t)}function gg(a,b,c,d,x,s,t){return cmn(b&d|c&~d,a,b,x,s,t)}function hh(a,b,c,d,x,s,t){return cmn(b^c^d,a,b,x,s,t)}function ii(a,
b,c,d,x,s,t){return cmn(c^(b|~d),a,b,x,s,t)}function calcMD5(str){var x=str2blks_MD5(str),a=1732584193,b=-271733879,c=-1732584194,d=271733878,i,olda,oldb,oldc,oldd;for(i=0;i<x.length;i+=16){olda=a;oldb=b;oldc=c;oldd=d;a=ff(a,b,c,d,x[i+0],7,-680876936);d=ff(d,a,b,c,x[i+1],12,-389564586);c=ff(c,d,a,b,x[i+2],17,606105819);b=ff(b,c,d,a,x[i+3],22,-1044525330);a=ff(a,b,c,d,x[i+4],7,-176418897);d=ff(d,a,b,c,x[i+5],12,1200080426);c=ff(c,d,a,b,x[i+6],17,-1473231341);b=ff(b,c,d,a,x[i+7],22,-45705983);a=ff(a,
b,c,d,x[i+8],7,1770035416);d=ff(d,a,b,c,x[i+9],12,-1958414417);c=ff(c,d,a,b,x[i+10],17,-42063);b=ff(b,c,d,a,x[i+11],22,-1990404162);a=ff(a,b,c,d,x[i+12],7,1804603682);d=ff(d,a,b,c,x[i+13],12,-40341101);c=ff(c,d,a,b,x[i+14],17,-1502002290);b=ff(b,c,d,a,x[i+15],22,1236535329);a=gg(a,b,c,d,x[i+1],5,-165796510);d=gg(d,a,b,c,x[i+6],9,-1069501632);c=gg(c,d,a,b,x[i+11],14,643717713);b=gg(b,c,d,a,x[i+0],20,-373897302);a=gg(a,b,c,d,x[i+5],5,-701558691);d=gg(d,a,b,c,x[i+10],9,38016083);c=gg(c,d,a,b,x[i+15],
14,-660478335);b=gg(b,c,d,a,x[i+4],20,-405537848);a=gg(a,b,c,d,x[i+9],5,568446438);d=gg(d,a,b,c,x[i+14],9,-1019803690);c=gg(c,d,a,b,x[i+3],14,-187363961);b=gg(b,c,d,a,x[i+8],20,1163531501);a=gg(a,b,c,d,x[i+13],5,-1444681467);d=gg(d,a,b,c,x[i+2],9,-51403784);c=gg(c,d,a,b,x[i+7],14,1735328473);b=gg(b,c,d,a,x[i+12],20,-1926607734);a=hh(a,b,c,d,x[i+5],4,-378558);d=hh(d,a,b,c,x[i+8],11,-2022574463);c=hh(c,d,a,b,x[i+11],16,1839030562);b=hh(b,c,d,a,x[i+14],23,-35309556);a=hh(a,b,c,d,x[i+1],4,-1530992060);
d=hh(d,a,b,c,x[i+4],11,1272893353);c=hh(c,d,a,b,x[i+7],16,-155497632);b=hh(b,c,d,a,x[i+10],23,-1094730640);a=hh(a,b,c,d,x[i+13],4,681279174);d=hh(d,a,b,c,x[i+0],11,-358537222);c=hh(c,d,a,b,x[i+3],16,-722521979);b=hh(b,c,d,a,x[i+6],23,76029189);a=hh(a,b,c,d,x[i+9],4,-640364487);d=hh(d,a,b,c,x[i+12],11,-421815835);c=hh(c,d,a,b,x[i+15],16,530742520);b=hh(b,c,d,a,x[i+2],23,-995338651);a=ii(a,b,c,d,x[i+0],6,-198630844);d=ii(d,a,b,c,x[i+7],10,1126891415);c=ii(c,d,a,b,x[i+14],15,-1416354905);b=ii(b,c,d,
a,x[i+5],21,-57434055);a=ii(a,b,c,d,x[i+12],6,1700485571);d=ii(d,a,b,c,x[i+3],10,-1894986606);c=ii(c,d,a,b,x[i+10],15,-1051523);b=ii(b,c,d,a,x[i+1],21,-2054922799);a=ii(a,b,c,d,x[i+8],6,1873313359);d=ii(d,a,b,c,x[i+15],10,-30611744);c=ii(c,d,a,b,x[i+6],15,-1560198380);b=ii(b,c,d,a,x[i+13],21,1309151649);a=ii(a,b,c,d,x[i+4],6,-145523070);d=ii(d,a,b,c,x[i+11],10,-1120210379);c=ii(c,d,a,b,x[i+2],15,718787259);b=ii(b,c,d,a,x[i+9],21,-343485551);a=add(a,olda);b=add(b,oldb);c=add(c,oldc);d=add(d,oldd)}return rhex(a)+
rhex(b)+rhex(c)+rhex(d)}ajs.MD5=calcMD5})(ajs);jsLoader.loaded("{utils}MD5");jsLoader.use(["{jQuery}jquery"],function(){(function($){jsClass.create("jQueryEvent").methods({one:function(type,data,fn){return $(this).one(type,data,fn)},bind:function(type,data,fn){return $(this).bind(type,data,fn)},unbind:function(type,fn){return $(this).unbind(type,fn)},trigger:function(type,data){this.triggerHandler(type,data);return this},triggerHandler:function(type,data){return $(this).triggerHandler(type,data)},
removeEventListener:$.noop,detachEvent:$.noop})})(jQuery);jsLoader.loaded("{plugins}jQueryEvent")});(function(w){var VIEW={},timers={},_log=[],_indent=0;jsClass.create("jsView").methods({__construct:function(opts){Object.extend(this,{id:this.uniqId,tag:"view",_$P:false,onBeforeRedraw:ajs.retTrue,onRedraw:ajs.retTrue},opts);if(VIEW[this.id]!==undef)throw this.id+" - jsView.ID must by uniq.";else VIEW[this.id]=this;this.__init={};this._changes={};this.__changes={};this.tag=this.tag.toUpperCase();this.subviews=
[];this.changed=false;if(!this.idView)this.idView="#"+this.id;this.$P("_lego");this._lego();this._first();$(this._onReady.bind(this));this.$P("_lego",1);if(this.events)this.listen(this.events)},_init:function(name,func){if(!(name in this.__init)&&func!==undef){this.$P("_init."+name);func.call(this);this.__init[name]=1;this.$P("_init."+name,1)}return name in this.__init},_one:$.noop,_lego:$.noop,_first:$.noop,_redraw:function(r,a){},_onReady:$.noop,_changed:returnTrue,_active:returnTrue,__redraw:function(r,
a){if(this._one!==null){this.$P("_one");this._one();this._one=null;this.$P("_one",1)}this._redraw(r,a)},$P:function(name){if(this._$P){name="["+this.id+"]."+name;if(arguments.length==2){_indent--;return timers[name]=ajs.now()-timers[name]}else{timers[name]=ajs.now();_log.push({name:name,indent:_indent++})}}},isChanged:function(){return this.changed},isActive:function(){return this._active()&&(this.id==="root"||!this.parentViewId||this.parentView().isActive())},getMapper:function(){return this.mapper},
isChange:function(name,value,noSet){if(arguments.length===1)return!!this.__changes[name];if(Array.isArray(value))value=value.join(",");var r=this._changes[name]!==value;if(!noSet){this.__changes[name]=r;this._changes[name]=value}return r},redraw:function(){if(this.onBeforeRedraw()){this.changed=false;if(this.id==="root")this.$P("TOTAL");var a=this.isActive(),subviews=a;if(!(this.active===undef&&!a)){if(this.active!==a){this.$P("active");subviews=true;this.active=a;this.__redraw(false,a);this.$P("active",
1)}if(a&&this._changed()){this.$P("redraw");this.changed=true;this.__redraw(true,a);this.$P("redraw",1)}if(subviews)for(var i=0,views=this.subviews,n=views.length;i<n;i++)views[i].redraw()}if(this.id==="root"){if(this.$P("TOTAL",1)>5)ajs.each(_log,function(log){var name=log.name,ts=timers[name];if(ts>=1){ajs.log((new Array(log.indent)).join("  ")+name+": "+ts+"ms");delete timers[name]}});_log=[]}this.onRedraw();return true}return false},addSubView:function(View){View.parentViewId=this.id;this.subviews.push(View);
return this},removeSubView:function(View){delete View.parentViewId;this.subviews=Array.remove(this.subviews,View);return this},parentView:function(){return VIEW[this.parentViewId]},getViewsByTag:function(tag){var result=[];tag=tag.toUpperCase();Array.forEach(this.subviews,function(View){if(tag==="*"||View.tag.toUpperCase()==tag)result.push(View);result=result.concat(View.getViewsByTag(tag))});return result},getViewById:function(id){return VIEW[id]},listen:function(events){patron.Events.bind(events,
function(){this.redraw()}.bind(this));return this},group:function(opts,func){var View="getViewById"in opts?opts:new jsView(opts);if(func!==undef)func.call(View,View);return this.addSubView(View)},getView:function(selector){if(!this.$View){var id=this.idView;this.$View=$(id,!ajs.isString(id)||/^#/.test(id)?undef:this.parentView().getView())}if(selector)return/^#/.test(selector)?$(selector):this.$View.find(selector);return this.$View}});jsView.root=w.documentView=new jsView({id:"root",tag:"root",_$P:true});
jsView.get=jsView.root.getViewById;jsView.create=function(name){return jsClass.create(name).extend(jsView)};jsView.getViewsByTag=function(name){return jsView.root.getViewsByTag(name)}})(window);jsLoader.loaded("{labs}jsView");define("{patron}patron.Collector",["{patron}patron.Notify","{toolkit.common}store/store","{utils}Lang"],function(){jsClass.create("patron.Collector").methods({__construct:function(){},namespace:function(collector,key){return patron.useremail+"|collector."+collector+"."+(key||
"")},providers:{"mail.ru":["mail.ru","mail.ua","inbox.ru","list.ru","bk.ru"],"yandex.ru":["yandex.ru","yandex.com","yandex.ua","yandex.kz","yandex.by","narod.ru","ya.ru","ya.com"],"rambler.ru":["rambler.ru","lenta.ru","myrambler.ru","autorambler.ru","ro.ru","r0.ru"],"gmail.com":["gmail.com"],"aol.com":["aol.com"],"icloud.com":["icloud.com","me.com"],"qq.com":["qq.com"],"my.com":["my.com"],"yahoo.com":["yahoo.com","ymail.com","rocketmail.com","yahoo.com.ar","yahoo.com.au","yahoo.at","yahoo.be","yahoo.fr",
"yahoo.nl","yahoo.com.br","yahoo.ca","yahoo.en","yahoo.com.cn","yahoo.cn","yahoo.com.co","yahoo.cz","yahoo.dk","yahoo.fi","yahoo.de","yahoo.gr","yahoo.com.hk","yahoo.fi","yahoo.de","yahoo.gr","yahoo.com.hk","yahoo.hu","yahoo.co.in","yahoo.in","yahoo.co.id","yahoo.ie","yahoo.co.il","yahoo.it","yahoo.co.jp","yahoo.co.kr","yahoo.com.my","yahoo.com.mx","yahoo.ae","yahoo.nl","yahoo.co.nz","yahoo.no","yahoo.com.ph","yahoo.pl","yahoo.pt","yahoo.ro","yahoo.ru","yahoo.com.sg","yahoo.co.za","yahoo.es","yahoo.se",
"yahoo.ch","yahoo.com.tw","yahoo.co.th","yahoo.com.tr","yahoo.co.uk","yahoo.com","yahoo.com.vn"],"qip.ru":["qip.ru","pochta.ru","fromru.com","front.ru","hotbox.ru","hotmail.ru","krovatka.su","land.ru","mail15.com","mail333.com","newmail.ru","nightmail.ru","nm.ru","pisem.net","pochtamt.ru","pop3.ru","rbcmail.ru","smtp.ru","5ballov.ru","aeterna.ru","ziza.ru","memori.ru","photofile.ru","fotoplenka.ru","pochta.com"],"outlook.com":["outlook.com","hotmail.com","msn.com","live.com","live.ru"]},states:["work",
"pause","conflict","expected_activation","auth_error","extra_auth","overlimit_error","internal_error"],supported:new function(){if(patron.IsMyCom)return["gmail.com","yahoo.com","outlook.com","hotmail.com","aol.com","icloud.com"];else return["yandex.ru","rambler.ru","gmail.com","yahoo.com","outlook.com"]},oauth:{has:function(host){return host in this.url.path},url:{path:{"gmail.com":"oauth2_google","outlook.com":"oauth2_outlook"},external:function(params){var login=params.login,back="";if(login&&!/@/.test(login))login+=
"@"+params.domain;var query=Object.extend({login:login,lang:mailru.LANG},params);if(params.back)back="&page="+encodeURIComponent(params.back);return patron.AuthUrl+this.path[params.domain]+"?"+ajs.toQuery(query)+back},collectors:null}},log:function(method,error){ajs.log(this.uniqName+": "+method+"\n"+error)},remove:function(data,callback,failback,context){patron.API.post("collectors/remove",{collect:[data]},function(response){if(response.isOk())this.utils.notify("ok","remove",data,function(){callback.call(context,
response.getBody(),response)});else if(typeof failback=="function"){var error=this.utils.error(response);this.utils.notify("error","remove",data,function(){failback.call(context,error,response)})}}.bind(this))},state:function(data,callback,failback,context){patron.API.post("collectors/state",{collect:[data]},function(response){if(response.isOk())this.utils.notify("ok","state",data,function(){callback.call(context,response.getBody(),response)});else if(typeof failback=="function"){var error=this.utils.error(response);
this.utils.notify("error","state",data,function(){failback.call(context,error,response)})}}.bind(this))},add:function(data,callback,failback,context){if(data.email==patron.useremail){if(typeof failback=="function")return failback.call(context,"oneself",{status:400})}else patron.API.post("collectors/add",{collect:[this.utils.filter_settings(data)]},function(response){var body=response.getBody();if(response.isOk())this.utils.notify("ok","add",data,function(){callback.call(context,body,response)});else if(typeof failback==
"function"){var unknown_server=false;if(response.status==400)try{Object.forEach(body,function(value,name){if(value.error=="required"&&/ssl|port|server/.test(name)){unknown_server=true;return false}})}catch(error){ajs.log(error)}var error=this.utils.error(response);failback.call(context,error,response,unknown_server)}}.bind(this))},edit:function(data,callback,failback,context){patron.API.post("collectors/edit",{collect:[this.utils.filter_settings(data)]},function(response){if(response.isOk())this.utils.notify("ok",
"folder",data,function(){callback.call(context,response.getBody(),response)});else if(typeof failback=="function"){var error=this.utils.error(response);failback.call(context,error,response)}}.bind(this))},convert:function(data,callback,failback,context){patron.API.post("collectors/convert",{collect:[data]},function(response){if(response.isOk())this.utils.notify("ok","folder",data,function(){callback.call(context,response.getBody(),response)});else if(typeof failback=="function"){var error=this.utils.error(response);
failback.call(context,error,response)}}.bind(this))},external_signup_settings:function(data,callback,failback,context){patron.API.post("user/signup/external/unknown",data,function(response){if(response.isOk())callback.call(context,response.getBody(),response);else if(typeof failback=="function"){var error=this.utils.error(response);failback.call(context,error,response)}}.bind(this),null,null,true)},external_signup_user:function(data,callback,failback,context){patron.API.post("user/signup/external",
data,function(response){if(response.isOk())callback.call(context,response.getBody(),response);else if(typeof failback=="function"){var error=this.utils.error(response);failback.call(context,error,response)}}.bind(this),null,null,true)},type:function(provider,callback,failback,context){patron.API.post("collectors/domain",{domain:this.host(provider)},function(response){var data=response.getBody();if(response.isOk()){var type="pop3";try{if(data.protocols.imap.available)type="imap"}catch(error){if(data.imap===
true)type="imap";ajs.log("patron.Collector.type: ",error)}callback.call(context,type,response)}else if(typeof failback=="function")failback.call(context,data,response)})},filter:function(data,callback,context){var result={};var filters={message:function(id,callback){var item=patron.Messages.get(id||GET.id);if(item&&(item=item.collector))this.list(function(collectors){Array.some(collectors,function(collector){if(collector&&item==collector.id)return result=collector});callback(result)});else callback(result)},
folder:function(id,callback){var folders=patron.Folders.getAll();this.list(function(collectors){Array.some(folders,function(folder){if(folder.Id==id){Array.forEach(collectors,function(collector){if(collector&&collector.id[!folder.IsSubfolder?folder.Id:folder.ParentId])return result=collector});return true}});callback(result)})},collector:function(id,callback){this.list(function(collectors){Array.some(collectors,function(collector){if(collector&&collector.id==id)return result=collector});callback(result)})}}[data.type];
if(filters)filters.bind(this)(data.id,callback.bind(context||this))},folders:{SYSTEM:{950:"spam",5E5:"sent",500001:"drafts",500002:"trash",500003:"mrim"},name:function(id){if(id!=void 0){var folders=patron.Folders.getAll(),name;Array.some(folders,function(folder){if(folder.Id==id)return name=folder.Name});return name}},get:function(callback,predicate,context){patron.API.post("folders",function(response){var folders=[];if(response.isOk())try{var data=response.getBody();folders=Array.filter(data,function(folder){var filter=
1;if(typeof predicate=="function")filter=predicate.call(context,folder);if(Object.keys(this.SYSTEM).indexOf(folder.id)===-1&&filter)return folder},this)}catch(error){ajs.log("patron.Collector::folders: ",error)}callback.call(context,folders,response)}.bind(this))},is_system:function(name){var folders=patron.Folders.getAll();return Array.some(folders,function(folder){return folder.Name==name&&folder.Id in this.SYSTEM},this)},add:function(data,callback,failback,context){if(this.is_system(data.name)){var response=
{body:{"folder[0].name":{error:"invalid",value:data.name}},status:400};return failback.call(context,"invalid",response.body,response)}patron.API.post("folders/add",{folders:[data]},function(response){var folders=response.getBody();if(response.isOk())callback.call(context,folders,response);else{var error="internal";if(Object.isObject(folders))Object.forEach(folders,function(value){error=value.error;return false});if(typeof failback=="function")failback.call(context,error,folders,response)}})},id:function(){}},
has:function(callback,force){this.list(function(collectors){callback(Object.keys(collectors).length)},force)},host:function(email){if(email){var host=email.match(this.utils.host);if(host)return host[1]}return email},cache:function(){var user=patron.user;if(user.collectors)return this.data(user.collectors)},store:new function(){var namespace=patron.useremail+"|user.collectors";return{set:function(response){store.set(namespace,response);patron.user.collectors=response},get:function(){return store.get(namespace)},
clean:function(){store.remove(namespace)}}},data:function(data){return data&&Array.isArray(data.body)?data.body:[]},list:function(callback,force){var user=patron.user;var cache=this.store.get();var reload=Array.some(this.data(cache),function(collector){return/extra_auth|blocked/.test(collector.state)});if(!user.collectors&&cache)user.collectors=cache;if(!force&&!reload&&user.collectors){var data=this.data(user.collectors);callback(data)}else patron.API.post("collectors",function(response){if(response.isOk())this.store.set(response);
var data=this.data(response);callback(data)}.bind(this))},get_provider:function(provider){var host=provider=this.host(provider);Object.forEach(this.providers,function(aliases,name){if(Array.contains(aliases,host))provider=name},this);return provider},utils:{host:/@(.{4,})$/,name:/(.*)@.{4,}$/,DEFAULT_PASSWORD:"********",COLLECTOR_SETTINGS:{id:false,type:false,email:false,user_name:false,password:false,server:false,port:false,ssl:true,folder:true,"import":true,addressbook:true,apply_filters:true,mark:true,
keep_original:true},MAX_FOLDER_NAME_LENGTH:250,EMAIL_HOST_MASK:/@(.{4,})$/,EMAIL_NAME_MASK:/(.*)@.{4,}$/,EMAIL_FULL_MASK:/(.*)@(.{4,})$/,filter_settings:function(data){var params={};Object.forEach(data,function(value,key){if(key in this.COLLECTOR_SETTINGS)params[key]=value},this);return params},time_format:function(timestamp){return timestamp?timestamp*1E3:0},get_folders:function(callback,failback,context){patron.API.post("folders",function(response){if(response.isOk())callback.call(context,response.getBody(),
response);else if(typeof failback=="function")failback.call(context,response.getBody(),response)})},get_folder_id:function(name,callback,failback,context){this.get_folders(function(folders){var id=0;try{Array.some(folders,function(folder){if(folder.parent==-1&&folder.name==name){id=folder.id;return true}})}catch(error){ajs.log("patron.Collector::utils.get_folder_id: ",error)}callback.call(context,id,folders)},function(){failback.apply(context,arguments)})},parse_host:function(host){return host.match(/(.*)\.(.*)$/)},
parse_email:function(email){try{var match=email.match(this.EMAIL_FULL_MASK);if(match)return{name:match[1],host:match[2]}}catch(error){ajs.log("patron.Collector::utils.parse_email: ",error)}},ports:{incoming:{imap:[143,993],pop3:[110,995],exchange:[443,443]},outgoing:[25,465]},notify:function(type,text,options,callback,context){options=options||{};var lang=Lang.str("notify.collector."+text+"."+type).replace("%s",options.email||"");if(!lang)return ajs.log("patron.Collector.utils.notify\n","Can not find a text string\n",
arguments);patron.Notify.add(type,{text:lang});if(options.group)patron.Notify.hide(options.group);if(typeof callback=="function")callback.call(context)},text:function(type){return Lang.get("Collector")[type]},error:function(response){var data=response.getBody(),error="internal";switch(response.status|0){case 403:error="token";break;case 417:error="expectation_failed";break;case 429:error="auth_limit";break;case 507:error="over_limit";break;case 500:if(/denied|timeout|collect_timeout|smtp_timeout|collect_auth_fail|exists_domain|token/.test(data))error=
data;break;default:if(Object.isObject(data))Object.forEach(data,function(value){error=value.error;return false});break}return error},counter:function(){$.event.trigger("ui-abstract-action",{chain:Array.prototype.concat.apply(["collectors"],arguments)})}}})});jsLoader.use(["{labs}jsView","{patron}patron.Collector"],function(){(function(){var _useCrossDomainRequests=patron.XHRComposeLoad&&jQuery.support.cors,_defaultLoaderState={js:{attempts:patron.XHRComposeLoadAttemptsCount,timeout:patron.XHRComposeLoadTimeoutSec*
1E3},html:{attempts:patron.XHRComposeLoadAttemptsCount,timeout:patron.XHRComposeLoadTimeoutSec*1E3}},_loaderState={js:{deffered:$.Deferred(),status:0},html:{deffered:$.Deferred(),status:0}};$.extend(true,_loaderState,_defaultLoaderState);jsView.create("patron.View.Compose").statics({status:-1,attempts:30,isLoaded:function(){var href=location.href.split("?");href=href[0]+(href[1]?"?"+jsHistory.buildParams():"");return patron.isComposePage()&&href==jsHistory.get()||this.status==2},_loadHtml:function(){var stateKey=
"html",state=_loaderState[stateKey],defaultState=_defaultLoaderState[stateKey],deffered=state.deffered,start=new Date;if(state.status===2)deffered.resolve();else if(state.status!==1){state.status=1;$.ajax({url:"/cgi-bin/lstatic?get=compose",dataType:"text",type:"POST",timeout:state.timeout,data:{compose_name:"COMPOSE_FORM_NAME",modern:patron["IsNewComposeDesign"]?1:0,MultiAttach:patron["EnableComposeMultiAttach"]?1:0,v2:+!!patron.v2,qunit:patron.qunit|0},complete:function(jqXHR,textStatus){var text=
jqXHR.responseText||"",status=0,fields=["hstatus_"+jqXHR.status+"=1","tstatus_"+textStatus+"=1","time="+(new Date-start),"length="+text.length,"retry="+(defaultState.attempts-state.attempts+1)];if(textStatus==="timeout")fields.push("timeout=1");else if(text){this.__html=text;status=2}else fields.push("empty=1");state.status=status;if(status===2||--state.attempts)this._loadHtml();else deffered.reject();patron.radar("LazyComposeHTML",fields.join("&"))}.bind(this)})}return deffered.promise()},_loadJs:function(){var stateKey=
"js",state=_loaderState[stateKey],defaultState=_defaultLoaderState[stateKey],deffered=state.deffered,start=new Date;if(state.status===2)deffered.resolve();else if(state.status!==1){state.status=1;$.ajax({url:window["js"+"Loader"+"Files"]["{patron"+".build}Compose"],dataType:"text",type:"GET",timeout:state.timeout,crossDomain:true,processData:false,complete:function(jqXHR,textStatus){var text=jqXHR.responseText||"",status=0,fields=["hstatus_"+jqXHR.status+"=1","tstatus_"+textStatus+"=1","time="+(new Date-
start),"length="+text.length];if(textStatus==="timeout")fields.push("timeout=1");else if(text)try{$.globalEval(text);status=2;fields.push("retry_"+(defaultState.attempts-state.attempts+1)+"=1")}catch(e){fields.push("syntaxerror=1");patron.gstat({log:"COMPOSE_BUILD_SYNTAXERROR",text:text},"ua=1")}else fields.push("empty=1");state.status=status;if(status===2||--state.attempts)this._loadJs();else{fields.push("retry_max=1");deffered.reject()}patron.radar("LazyComposeJS",fields.join("&"))}.bind(this)})}return deffered.promise()},
loadFormHtml:function(formName,func){if(func)jsCore.wait(this.classUniqId+"_HTML",function(){var html=this.__html.replace(/COMPOSE_FORM_NAME/g,formName);func(false,html)}.bind(this));if(_useCrossDomainRequests){if(this.status<=0){this.status=1;$.extend(true,_loaderState,_defaultLoaderState);$.when(this._loadHtml(),this._loadJs()).then(function(){this.status=2;$(window).trigger("composeformloaded");jsCore.notify(this.classUniqId+"_HTML")}.bind(this),function(){this.status=0}.bind(this))}return}if(this.status==
-1)$R("{patron"+".build}Compose");if(this.status<=0){this.status=1;patron.Ajax({url:"/cgi-bin/lstatic?get=compose",data:{compose_name:"COMPOSE_FORM_NAME",modern:patron["IsNewComposeDesign"]?1:0,MultiAttach:patron["EnableComposeMultiAttach"]?1:0,v2:+!!patron.v2,qunit:patron.qunit|0},user:true,timeout:1E4,dataType:"text",type:"GET",complete:function(R){if(R.isOK()){var html=R.getData();this.status=2;this.__html=html;$(window).trigger("composeformloaded");jsCore.notify(this.classUniqId+"_HTML")}else if(this.attempts>
0){this.status=0;this.attempts--;patron.log("compose.load.html.error",formName,true);setTimeout(patron.View.Compose.loadFormHtml.bind(this,formName,func),5E3)}}.bind(this)})}},renderTo:function($el,fn){var df=$el.data("compose");if(!df){$el.data("compose",(df=$.Deferred()).promise());var name="compose_"+$.guid++ +"_";var View=new patron.View.Compose({id:name,idView:$el,_active:returnTrue});if(patron.MrimDisabled)fn();else $(window).bind("init."+name,function(){jsCore.wait(name+".init",function(){View.getForm().bind("cancel",
function(){$el.trigger("composecancel");return false});View.getForm().parentHeight(function(){return ajs.windowHeight()-260});df.resolve(View)})});View.redraw()}return df.done(fn)}}).methods({_first:function(){this.status=this.active?2:0;_loaderState.js.status=this.status;this.__GET={};this.__html=0;this._signature="";this.active=false;this.isChange("hash",jsHistory.get())},_one:function(){this.$View=$(this.idView);this.$Loader=$();$(window).triggerHandler("show.compose")},_redraw:function(r,a){if(!r){if(!a){this.__signatureLoaded=
false;this.isChange("hash",null)}if(2===this.status){if(a&&0!==this.__html){this.$View.innerHTML(this.__html);this.__html=0;$.globalEval($("#SCRIPT_"+this.id).remove().innerHTML())}}else if(0===this.status){this.status=1;patron.View.Compose.loadFormHtml(this.id,function(error,html){if(!error){this.__html=html;this.status=2;this._redraw(0,this.isActive())}}.bind(this))}else if(this.status===1)patron.View.Compose.loadFormHtml()}else if(a){var url=jsHistory.get();if(~url.indexOf("action=")||this.autoload&&
this.isChange("hash",url))this.load(url)}},_letBody:function(text,mode,Msg){var let_body=Msg.let_body==null?"":Msg.let_body.toString();var let_body_plain=Msg.let_body_plain==null?"":Msg.let_body_plain.toString();var quote_string=Msg.quote_string==null?"":Msg.quote_string.toString();var index="let_body";if(mode==="forward")index+="_fwd";else if(mode!=="drafts")index+="_re";index+=text==="plain"?"_plain":"";var result=Msg[index];if(index!=="let_body"&&index!=="let_body_plain")result=result.replace(/__LET_BODY_(QUOTE_PLAIN|PLAIN|HTML)__/,
function(body,type){if(type=="HTML")body=let_body;else if(type=="PLAIN")body=let_body_plain;else body=quote_string+let_body_plain.replace(/[\r\n]/g,"\n"+quote_string);return body});return result},_fix:function(){},getForm:function(){return patron.Compose&&patron.Compose.Form&&patron.Compose.Form[this.id]},switchMode:function(mode,force){var data=String.toObject(this._query);if("replyall"in data)delete data["reply"];if(!(mode in data)||force){delete data["reply"];delete data["replyall"];delete data["forward"];
delete data["new"];var Msg=patron.Messages.get(data.id);var draftId=this._getDraftId(Msg,mode);this.load(String.toQuery(data),mode)}},load:function(data,mode,force){data=String.toObject(this._toOldFormat(data));var forward=data.forward;if(patron.IsNewComposeDesign&&(patron.EnableIMAP||patron.IsExternalAccount&&patron.NeedMoreInfoForCompose))this.setFrom();if(/^\d+(;\d+;\d+)?$/.test(data.id))if("forward"in data)mode="forward";else if("drafts"in data)mode="drafts";else if("replyall"in data)mode="replyall";
else{if("reply"in data)mode="reply"}else if("templates"in data)mode="templates";else mode="new";if(data._key_){data=this.__GET[data._key_]||"";force=true;if(/forward/.test(data))mode="forward";else if(/replyall/.test(data))mode="replyall";else if(/reply/.test(data))mode="reply";else mode="new";if(/forward=attach/.test(data))forward="attach"}else{data=String.toQuery(data).replace(/(reply|replyall|drafts|forward)[=&\d]*/gi,"")+"&";this.mode=mode;switch(mode){case "replyall":data+="reply&replyall=1";
break;case "forward":data+="forward";break;case "templates":data+="new&new=1";break;default:data+=mode?mode+"=1":""}}this.abort();this._url="/compose/?"+data;this._query=data;var Msg=patron.Messages.get(String.toObject(this._url).id),draftId;if(Msg){if(Msg.map_inline_img)force=1;else if(Msg.Attachment||Msg.Attachfiles_Items||Msg.Attachlinks_Items)if(!(mode=="reply"||mode=="replyall"))force=1;draftId=this._getDraftId(Msg,mode)?this._getDraftId(Msg,mode):"";if(draftId&&!(mode=="reply"||mode=="replyall"))data=
"id="+draftId+"&drafts=1";(function(){var draftsModes=[];Array.forEach(["reply","replyall","forward"],function(mode){if(Msg[mode+"_draft"])draftsModes.push(mode)});if(draftsModes.length===1)patron.radar("MessageFromDraft","exists=1");else if(draftsModes.length>1)patron.radar("MessageFromDraft","exists_many=1");Array.forEach(draftsModes,function(mode){patron.radar("MessageFromDraft",mode+"_exists=1")})})()}if(patron.UseSendAPIV1){force=false;if(forward==="attach")Msg=null}else forward="";patron.log("compose.msg:",
this._url);if(!force&&mode!="new"&&(mode!="drafts"||patron.UseSendAPIV1)&&Msg&&"let_body_re"in Msg)jsCore.wait(this.id+".init",function(){var Form=this.getForm(),data=Form.getData({attachments:false});$.extend(data,{mode:mode,MessageId:this._createMessageId(),HTMLCompose:Msg.HTMLCompose,letbody_html:this._letBody("html",mode,Msg),letbody_plain:this._letBody("plain",mode,Msg),files_id:"",files_ids:"",cloud_files_ids:"",actionId:"",template_id:"",HighPriority:"",NeedRcpt:"",remind:"",LeftMailSize:patron.Compose.fileUploaderSettings.MaxAttachmentSize,
map_inline_img:Msg.map_inline_img},Form.getFieldsByType(mode,Msg));if(draftId)data.draft_msg=draftId;Form.parentView=this;Form.reset().redraw(data);this._fix()}.bind(this));else if(mode=="new"||mode=="templates"||forward==="attach")jsCore.wait(this.id+".init",function(){var Form=this.getForm(),data=Form.getData({attachments:false});var extra_fields={};var initialMessageText=ajs.Html.escape(GET.Body||GET.body)||"";if(forward==="attach"){var request=Pilot.parseURL(this._url);var attached_messages=[];
var attached_messages_ids=typeof request.query.id==="string"?[request.query.id]:request.query.id;Array.forEach(attached_messages_ids,function(id){var message=patron.Messages.get(id);if(message)attached_messages.push(message)});$.extend(extra_fields,Form.getFieldsByType(mode,Msg,attached_messages))}else if(patron.v2){$.extend(extra_fields,this._toObject(window.location.hash||window.location.search));if(extra_fields.to)extra_fields.To=extra_fields.to;else if(extra_fields.mailto){var mailto=extra_fields.mailto.match(/mailto:([^\?]+@[^\?]+\.[a-z]{2,})/i);
$.extend(extra_fields,this._toObject(extra_fields.mailto));if(extra_fields.to)extra_fields.To=extra_fields.to;if(mailto&&mailto[1])extra_fields.To=mailto[1]+(extra_fields.to?","+extra_fields.to:"")}if(extra_fields.cc)extra_fields.CC=extra_fields.cc;if(extra_fields.bcc)extra_fields.BCC=extra_fields.bcc;if(extra_fields.subject)extra_fields.Subject=extra_fields.subject;if(extra_fields.body)initialMessageText=ajs.Html.escape(extra_fields.body)||initialMessageText;if(GET["cards"]!==undefined)extra_fields.showcards=
true}$.extend(data,{letbody_html:initialMessageText+this.getSign("html"),letbody_plain:initialMessageText+this.getSign("text"),HTMLCompose:patron.HTMLCompose,To:"",CC:"",BCC:"",Subject:"",draft_msg:"",re_msg:"",fwd_msg:"",files_id:"",files_ids:"",cloud_files_ids:"",actionId:"",template_id:"",HighPriority:"",remind:"",NeedRcpt:"",LeftMailSize:patron.Compose.fileUploaderSettings.MaxAttachmentSize,MessageId:this._createMessageId(),initialMessageText:initialMessageText},extra_fields);Form.parentView=
this;this.getForm().reset().redraw(data);this._fix()}.bind(this));else{var Form=this.getForm();if(this.getForm()){Form.parentView=this;this.getForm().reset().disableEdit()}if(patron.UseSendAPIV1)patron.Messages.load({id:String.toObject(this._url).id},function(url,err){if(!err&&this.isActive()&&url===this._url)this.load(data,mode)}.bind(this,this._url));else patron.Ajax.get("/compose/?ajax_call=1&func_name=get_params",data,function(url,result){if(result.isOK()&&this.isActive()&&url==this._url)jsCore.wait(this.id+
".init",function(){var data=result.getData(),draftMode=this.getForm()._getMessageMode();if(draftMode&&draftId&&data.NoMSG&&Msg){Msg[draftMode+"_draft"]=Msg.last_draft=Msg.last_draft_type=null;$.each(["reply","replyall","forward"],function(k,v){if(Msg[v+"_draft"]){Msg.last_draft=Msg[v+"_draft"];Msg.last_draft_type=v}});this.switchMode(draftMode,true)}else{this.getForm().parentView=this;this.getForm().enableEdit().redraw(data)}this._fix()}.bind(this))}.bind(this,this._url))}},_createMessageId:function(){return jsCore.getRandomHash(32,
true,true,true)},_toObject:function(s){var o={};if(typeof s==="object")o=s||o;else if(s=String(s)){if(s.indexOf("?")>-1||/^http:/.test(s))s=s.split("?")[1]||"";s=s.split("&");for(var i=0,n=s.length,v,k;i<n;i++)if(s[i]!=""){s[i]=s[i].split("=");s[i][0]=s[i][0].replace(/^(to|from|b?cc|subject|body)$/i,function(str){return str.toLowerCase()});v=s[i][1];k=s[i][0];if(typeof v=="string")try{v=decodeURIComponent(v)}catch(e){v=unescape(v)}else v="";try{k=decodeURIComponent(k)}catch(e){k=unescape(k)}if(o[k]&&
/^(to|b?cc)$/i.test(k))o[k]+=","+v;else o[k]=v}return o}return o},setFrom:function(){var collector=new patron.Collector;collector.filter({type:"message",id:GET.id},function(collector){this.$View.find(".js-compose__dropdown_email").text(collector.email||patron.useremail)},this)},_getDraftId:function(Msg,mode){var id;if(patron.MessageFromDraft&&mode&&Msg&&Msg.last_draft)id=Msg[mode+"_draft"];return id},abort:function(){if(this._xhr)try{this._xhr.abort()}catch(er){}},getUrl:function(){return this._url},
getSign:function(type){var t=this._signature,s=patron.UserSignature,dS=patron.DefaultSignature;if(!this.__signatureLoaded){this.__signatureLoaded=true;if($.trim(s)==""&&!patron.DisableReklama&&!patron.DisableSignatureAds){if(!patron.UserHasMy){if(dS)t=Ajax.getSyncData("/tmpl/static",{getSlotById:dS})||""}else t=Ajax.getSyncData("/tmpl/static",{getSlotById:563})||"";t=$.trim(t)!=""?"--\n"+t:""}else t=s;t=$.trim(t)!=""?"\n\n\n"+t:""}this._signature=t;if(t!="")if(type=="html")t=t.replace(/\r?\n/g,"<br/>");
else t=window.replaceEntity(t);return t},open:function(params,load,disableHistory){params=this._toOldFormat(params);var ids=params.match(/id=/g),key,url;if(/replyall/.test(params)&&!/reply[&=]/.test(params))params+="&reply";if(ids&&ids.length>1||/forward=attach|filesearch/.test(params)){key=ajs.now();this.__GET[key]=params;if(disableHistory)params="_key_="+key;else jsHistory.set("/compose/?_key_="+key)}load&&this.load(params)},_toOldFormat:function(params){if(!~params.indexOf("id=")){var isFS=/filesearch/.test(params);
var match=params.match(/^[^\?]+\/([\d,;]+)\/([^\/]+)/);if(match){if(match[2]=="draft")match[2]="drafts";params=match[2].replace(/-/g,"=")+"&id="+match[1].split(",").join("&id=");params+=isFS?"&filesearch=1":""}}return params}})})();jsLoader.loaded("{patron.view}patron.View.Compose")});jsLoader.use(["{toolkit.common}store/store"],function(){var _performance=window["performance"]||{};_performance.now=function(){return _performance["now"]||_performance["mozNow"]||_performance["msNow"]||_performance["oNow"]||
_performance["webkitNow"]||function(){return(new Date).getTime()}}();var LoggerItemList=[];var LoggerItemListToConsole=[];var LoggerItem=function(name,message,start_time,args){this.name=name;this.message=message;this.start_data=args.length>1?args:args[0];this.start_date=new Date;this.start_time=start_time};LoggerItem.prototype={done:function(end_time,args){this.time=end_time-this.start_time;this.end_data=args.length>1?args:args[0]},toConsole:function(){var args=[this.toString()];if(this.start_data!==
undefined)args.push("[start data] ->",this.start_data);if(this.end_data!==undefined)args.push("[end data] ->",this.end_data);ajs.log.apply(ajs.log,args)},toConsoleJSON:function(){function censor(key,value){if(value)if(typeof value=="object")if(value.nodeName)return"DOMElement "+value.nodeName;return value}var args=[this.toString()];if(this.start_data!==undefined)args.push("[start data] ->",JSON.stringify(this.start_data,censor));if(this.end_data!==undefined)args.push("[end data] ->",JSON.stringify(this.end_data,
censor));ajs.log.apply(ajs.log,args)},toString:function(){return"   ---\x3e ["+this.name+": "+this.start_date.format("H:I:S")+"] "+this.message+": "+this.time.toFixed(3)}};var LoggerInterface=$.noop;Array.forEach(["start","startAt","end","endAt","push"],function(name){LoggerInterface.prototype[name]=$.noop});Array.forEach(["toConsole","toConsoleJSON"],function(name){LoggerInterface[name]=$.noop});var Logger=function(name){this.inputToConsole=window["store"].get("offline.log_to_console");this.name=
name;this.map=[];this.length=0};Logger.prototype={start:function(message){var args=Array.prototype.slice.call(arguments,1);var item=new LoggerItem(this.name,message,_performance.now(),args);this.push(item);return item},startAt:function(key,message){return this.map[key]=this.start(message)},end:function(item){var args=Array.prototype.slice.call(arguments,1);item.done(_performance.now(),args);if(this.inputToConsole)for(var itemToConsole,i=0,l=LoggerItemListToConsole.length;i<l;i++){itemToConsole=LoggerItemListToConsole[i];
if("time"in itemToConsole){itemToConsole.toConsole();LoggerItemListToConsole.splice(i,1);l--;i--}else break}},endAt:function(key){var item=this.map[key];if(item)this.end(item)},push:function(item){if(LoggerItemList.length>500)LoggerItemList.shift();LoggerItemList.push(item);if(this.inputToConsole)LoggerItemListToConsole.push(item)}};Logger.toConsole=function(){ajs.log("\n----------//----------//----------//----------//----------//----------//----------//----------\n");for(var i=0,l=LoggerItemList.length;i<
l;i++)LoggerItemList[i].toConsole()};Logger.toConsoleJSON=function(){ajs.log("\n----------//----------//----------//----------//----------//----------//----------//----------\n");for(var i=0,l=LoggerItemList.length;i<l;i++)LoggerItemList[i].toConsoleJSON()};if(patron["isC"])patron.OfflineLogger=Logger;else patron.OfflineLogger=LoggerInterface;jsLoader.loaded("{patron.offline}patron.OfflineLogger")});jsLoader.use(["{jQuery}jquery","{patron.offline}patron.OfflineLogger"],function(){var _log=new patron.OfflineLogger("OfflineWebstoreTransport");
jsClass.create("patron.OfflineWebstoreTransport").statics({defaultOptions:{timeout:1E4}}).methods({__construct:function(options){this.options=$.extend({},patron.OfflineWebstoreTransport.defaultOptions,options);this.type="webstore";var webstoreHost=location.protocol+"//"+this.options.userMD5+".webstore.mail.ru";if(/((omega|alpha)\.test|win\d+\.dev)\.mail\.ru$/.test(location.host))webstoreHost="http://"+this.options.userMD5+".webstore."+location.host;this.readyTimerId=setTimeout(this._complete.bind(this,
"error"),this.options.timeout);var RpcConfig={channel:"webstore",remote:webstoreHost+"/cgi-bin/lstatic?"+$.param({get:"webstore",offline_data_version:patron["OfflineDataVersion"],offline_storage_version:patron["OfflineStorageVersion"],messages_per_page:patron["messagesPerPage"],nomanifest:+!patron["OfflineManifest"]}),props:{style:{display:"none"}}};var RpcJsonRpcConfig={local:{storageStatus:this._complete.bind(this)},remote:{post:{},dropAppCache:{},removeStorage:{}}};_log.startAt("transport","init storageTransport",
RpcConfig,RpcJsonRpcConfig);this.transport=new patron.OfflineCache.easyXDM.Rpc(RpcConfig,RpcJsonRpcConfig)},_complete:function(textStatus){_log.endAt("transport",textStatus);if(textStatus=="success")clearTimeout(this.readyTimerId);this.options.complete(textStatus)},post:function(url,data,complete){var _li=_log.start("post",url,data);complete=complete||$.noop;var success=function(response){_log.end(_li,"success",response[0],response[1]);complete(response[1])};var error=function(response){_log.end(_li,
"error",response[0],response[1]);complete()};if(this.transport.post){var parts=url.split("/");this.transport.post({object:parts.shift(),method:parts.join("/"),data:data},success,error)}else error()},dropAppCache:function(successFn,errorFn){this.transport.dropAppCache(successFn,errorFn)},removeStorage:function(successFn,errorFn){this.transport.removeStorage(successFn,errorFn)},destroy:function(){this.transport.destroy()}});jsClass.create("patron.OfflinePluginTransport").methods({__construct:function(options){this.options=
$.extend({},patron.OfflinePluginTransport.defaultOptions,options);setTimeout(function(){this._complete("success")}.bind(this),0)},_complete:function(textStatus){this.options.complete(textStatus)},post:function(url,data,complete){complete()},dropAppCache:function(successFn){if(successFn)successFn()},removeStorage:function(successFn){if(successFn)successFn()},destroy:function(){}});jsClass.create("patron.OfflineTransport").methods({__construct:function(options){if(0)this.transport=new patron.OfflinePluginTransport(options);
else this.transport=new patron.OfflineWebstoreTransport(options)},getType:function(){return this.transport.type},post:function(url,data,complete){if($.isFunction(data)){complete=data;data=null}this.transport.post(url,data,complete)},dropAppCache:function(complete){this.transport.dropAppCache(complete,complete)},removeStorage:function(complete){this.transport.removeStorage(complete,complete)},destroy:function(){this.transport.destroy()}});jsLoader.loaded("{patron.offline}patron.OfflineTransport")});
jsLoader.use(["{jQuery}jquery.tpl","{patron.offline}patron.OfflineLogger"],function(){var _log=new patron.OfflineLogger("OfflineActionManager");jsClass.create("patron.OfflineActionManager").statics({defaultOptions:{actionsTemplateId:"#offline__actions_ejs",actionsContainerSelector:"#announcements__offline-actions"}}).methods({__construct:function(Transport,options){var self=this;this.Transport=Transport;this.options=$.extend({},patron.OfflineActionManager.defaultOptions,options);this.actions=[];this.controlClickObserver=
this._controlClick.bind(this);this.$container=$(this.options.actionsContainerSelector);this.$container.delegate(".js-control","click",this.controlClickObserver);$(window).bind("update.offlineActions",function(){self._updateActions()})},getActions:function(){var _li=_log.start("getActions");var self=this,deffered=$.Deferred();if(this.loaded){_log.end(_li,"loaded",this.actions);deffered.resolve(this.actions)}else if(this.getActionsDeferred)deffered=this.getActionsDeferred;else{this.getActionsDeferred=
deffered;this.Transport.post("messages/getActions",null,function(response){self.loaded=true;if($.isArray(response)){_log.end(_li,"done",response);deffered.resolve(self.actions=response)}else{_log.end(_li,"fail",response);deffered.reject()}})}return deffered.promise()},execActions:function(){var _li=_log.start("execActions");var self=this,deffered=$.Deferred();if(this.execActionDeferred)deffered=this.execActionDeferred;else{this.execActionDeferred=deffered;$.when(deffered.promise()).then(function(){_log.end(_li,
"done");delete self.execActionDeferred},function(){_log.end(_li,"fail");delete self.execActionDeferred});this.getActions().then(function(actions){self._execActions(Array.prototype.concat(actions)).done(function(){if(patron.Updater)patron.Updater.cts={};deffered.resolve()})},function(){deffered.reject()})}return deffered.promise()},_updateActions:function(){var sendmsgActions=[];$.each(this.actions,function(k,action){if(action.cmd=="sentmsg")sendmsgActions.push(action)});this.$container.tpl(this.options.actionsTemplateId,
{Actions:sendmsgActions});this.$container.toggle(sendmsgActions.length>0)},_controlClick:function(evt){var $control=$(evt.target).closest(".js-control",this.$container);if($control.length)if($control.hasClass("js-close")){var id=$control.data("id");this.deleteAction(parseInt(id));evt.preventDefault()}},getActionCount:function(){return this.actions.length},getAction:function(id){var deffered=$.Deferred();this.getActions().done(function(actions){var action,i=actions.length;for(;i--;)if(actions[i].time==
id){action=actions[i];break}deffered.resolve(action)});return deffered.promise()},putAction:function(cmd,data,id){var action={cmd:cmd,data:data,time:id||ajs.now()};var actions=this.actions,i=actions.length,find;for(;i--;)if(actions[i].time==action.time){find=1;break}if(find)actions.splice(i,1,action);else actions.push(action);$(window).triggerHandler("update.offlineActions",[this.actions]);this.Transport.post("messages/putActions",[action])},deleteAction:function(id){var actions=this.actions,i=actions.length;
for(;i--;)if(actions[i].time==id){actions.splice(i,1);break}$(window).triggerHandler("update.offlineActions",[this.actions]);this.Transport.post("messages/deleteActions",[id])},_execActions:function(actions){var self=this,deferred=$.Deferred(),length=actions.length,count=0;function complete(){if(++count>=length)deferred.resolve()}function doNext(){var action=actions.shift();if(action)self._execAction(action).then(function(){self.deleteAction(action.time);complete();doNext()},function(){deferred.resolve()})}
if(length>0)doNext();else deferred.resolve();return deferred.promise()},_execAction:function(action){var deferred=$.Deferred();patron.API.ajax({url:action.data.url,type:"POST",cacheRunning:1,data:action.data.data,complete:function(result,textStatus){if(textStatus=="success")deferred.resolve();else deferred.reject()}});return deferred.promise()}});jsLoader.loaded("{patron.offline}patron.OfflineActionManager")});jsLoader.use(["{utils}MD5","{toolkit.common}store/store","{plugins}jQueryEvent","{patron}patron.Folders",
"{patron.model}patron.Message","{patron.model}patron.Folder","{patron.view}patron.View.Compose","{patron.offline}patron.OfflineLogger","{patron.offline}patron.OfflineTransport","{patron.offline}patron.OfflineActionManager"],function(){var _log=new patron.OfflineLogger("OfflineCacheManager");var AccountManager=function(){this.active_user_email=patron["OfflineMode"]?store.get("user_active"):patron.useremail;this.map={users_authorized:store.get("users_authorized")};this.map["users_"+this.active_user_email]=
store.get("users_"+this.active_user_email)};AccountManager.prototype={isAuth:function(){var users_authorized=this.map["users_authorized"];var user_active=this.active_user_email;if(user_active&&$.isArray(users_authorized))for(var i=users_authorized.length;i--;)if(users_authorized[i]===user_active)return true;return false},isEnableOfflineMode:function(){var user_data=this._getUserData();return user_data&&user_data.offline&&user_data.offline.enabled&&user_data.offline.auth_key},setOfflineModeStatus:function(enabled,
password){var user_data=this._getUserData();if(enabled)user_data=$.extend(true,user_data,{offline:{enabled:true,auth_key:ajs.MD5(this.active_user_email+password)}});else if(user_data)delete user_data["offline"];this.save("users_"+this.active_user_email,user_data)},auth:function(email,password){var users_authorized=this.map["users_authorized"];var user_data=this._getUserData();var isAuth=user_data&&user_data.offline&&user_data.offline.auth_key==ajs.MD5(email+password);if(isAuth){users_authorized.push(email);
this.save("users_authorized",users_authorized)}return isAuth},logout:function(){this.save("users_authorized",[])},save:function(key,data){store.set(key,this.map[key]=data)},getActiveEmail:function(){return this.active_user_email},_getUserData:function(){return this.map["users_"+this.active_user_email]}};var PreloadManager=function(Transport){this.Transport=Transport;this.messagesData=[];this.foldersData=[];this.currentCount=this.allCount=0;this.cacheFolders={};this.$indicator=$("#OfflinePreloadIndicator").show();
this.$indicatorPercentContainer=this.$indicator.find(".js-percent-container");this.$indicatorPercent=this.$indicatorPercentContainer.find(".js-percent");Array.forEach(patron.Folders.getAll(),function(folder){this.cacheFolders[folder.Id]=folder},this)};PreloadManager.MAX_CACHE_PAGE_COUNT=2;PreloadManager.prototype={preloadData:function(){var folderList=patron.Folders.getAll();if($.isArray(folderList)&&folderList.length){Array.forEach(folderList,function(folder,index){folder.Sort=index});this.Transport.post("messages/clearAndPutFolders",
folderList);if(patron["OfflinePreload"])this.loadFoldersByList(folderList)}},preloadFolders:function(params,folders){var list=[];if($.isArray(folders))Array.forEach(folders,function(folder){if(folder.Id!=params.folder){var cacheFolder=this.cacheFolders[folder.Id];if(cacheFolder)if(cacheFolder.Unread!=folder.Unread||cacheFolder.Messages!=folder.Messages)list.push(folder)}this.cacheFolders[folder.Id]=folder},this);this.loadFoldersByList(list)},preloadMessages:function(params,messages){if($.isArray(messages)&&
messages.length>0){this.Transport.post("messages/putMessagesPreview",{folder:params.folder,limit:params.limit,offset:params.offset,messages:messages});if(params.page<PreloadManager.MAX_CACHE_PAGE_COUNT){this.currentCount+=patron.messagesPerPage;this.allCount+=patron.messagesPerPage;this.checkMessages(messages)}}},loadFoldersByList:function(folders){var foldersData=[];for(var q=0,n=folders.length;q<n;q++)for(var i=0,l=PreloadManager.MAX_CACHE_PAGE_COUNT;i<l;i++){this.currentCount+=patron.messagesPerPage;
this.allCount+=patron.messagesPerPage;foldersData[i*n+q]=[folders[q].Id,i+1]}this.updatePreloadInfo();this.loadFolders(foldersData)},updatePreloadInfo:function(){if(this.currentCount>0&&this.currentCount<this.allCount){var percent=Math.ceil(100-100/this.allCount*this.currentCount);this.$indicatorPercentContainer.show();this.$indicatorPercent.text(percent)}else this.$indicatorPercentContainer.hide();if(this.currentCount<=0)this.currentCount=this.allCount=0},loadNextFolder:function(){var self=this;
var data=this.foldersData.shift();if(data)this.doLoadFolder(data[0],data[1],function(result){var hasMessages;if(result.isOK()){var resultData=result.getData(),options=result.getOpts().data;if(resultData)if($.isArray(resultData.messages)&&resultData.messages.length>0){hasMessages=1;self.Transport.post("messages/putMessagesPreview",{folder:options.folder,limit:options.limit,offset:options.offset,messages:resultData.messages},function(){setTimeout(function(){self.loadNextFolder()},500)});self.checkMessages(resultData.messages)}}if(!hasMessages){self.currentCount-=
patron.messagesPerPage;self.updatePreloadInfo();setTimeout(function(){self.loadNextFolder()},500)}});else this.preloadIsLoadedData=false},loadFolders:function(foldersData){this.foldersData=this.foldersData.concat(foldersData);if(!this.preloadIsLoadedData){this.preloadIsLoadedData=true;this.loadNextFolder()}},loadNextMessage:function(){var self=this;var data=this.messagesData.shift();if(data)this.doLoadMessage(data,function(result){var hasMessage;if(result.isOK()){var resultData=result.getData();if(resultData&&
resultData[0]){var message=resultData[0];if(message&&!message["NoMSG"]){hasMessage=1;self.Transport.post("messages/putMessages",[message],function(){setTimeout(function(){self.loadNextMessage()},500)})}}}self.currentCount--;self.updatePreloadInfo();if(!hasMessage)setTimeout(function(){self.loadNextMessage()},500)});else this.preloadIsLoadedMessage=false},loadMessages:function(messagesData){this.messagesData=this.messagesData.concat(messagesData);if(!this.preloadIsLoadedMessage){this.preloadIsLoadedMessage=
true;this.loadNextMessage()}},checkMessages:function(messages){var self=this,ids=[];$.each(messages,function(k,message){ids.push(message.Id)});this.Transport.post("messages/hasMessages",ids,function(response){if(response){var presentIds=response[0],unpresentIds=response[1];self.currentCount-=presentIds.length+(patron.messagesPerPage-(presentIds.length+unpresentIds.length));self.updatePreloadInfo();if($.isArray(unpresentIds))self.loadMessages(unpresentIds)}})},doLoadMessage:function(messageId,complete){patron.API.ajax({url:"/message/?func_name=get_messages_by_id",
cacheRunning:1,data:{id:messageId},complete:complete})},doLoadFolder:function(folderId,page,complete){patron.API({url:"messages/status",convertResultToOldApi:true,cacheRunning:1,data:{cts:ajs.now(),force:1,now:ajs.now(),sortby:"D",page:page,sort:{type:"date",order:"desc"},folder:folderId,offset:patron.messagesPerPage*(page-1),limit:patron.messagesPerPage,last_modified:ajs.now(),htmlencoded:false},complete:complete})}};var _testAndParseHtmlRedirect=function(body){return/<meta[^>]+refresh[^>]+/i.test(body)};
jsClass.create("patron.OfflineCacheManager").extend(jQueryEvent).statics({defaultOptions:{offlineModeNoAuthClass:"GlobalOfflineModeNoAuth",offlineModeClass:"GlobalOfflineMode",onlineModeClass:"GlobalOnlineMode",urlTypePattern:/^(?:https?:\/\/[^/]+)?\/?(?:cgi-bin\/)?([^?]+)/i}}).methods({__construct:function(options){var _li=_log.start("__construct");this.options=$.extend({},patron.OfflineCacheManager.defaultOptions,options);this.AccountManager=new AccountManager;this.userMD5=ajs.MD5(this.AccountManager.getActiveEmail());
this.onFirstActionsExecuteObserver=this._onFirstActionsExecute.bind(this);this.onChangeOfflineModeObserver=this._onChangeOfflineMode.bind(this);_log.end(_li)},onDOMReady:function(){var self=this;this.$logoutLink=$("#PH_logoutLink");if(this.isEnabled())this.$logoutLink.bind("click",{scope:this},function(evt){evt.data.scope.AccountManager.logout();if(patron["OfflineMode"]){evt.preventDefault();location.href="/"}});if(patron["OfflineMode"])if(this.isAuth()&&this.isEnabled()){$(document.body).removeClass(this.options.offlineModeNoAuthClass);
this.setActivate(true)}else{this._complete("error");ajs.require("{plugins}"+"LayerManager",function(){LayerManager.show("noAuthOffline",{active_email:self.AccountManager.getActiveEmail(),success:function(layer,email,password){if(self.AccountManager.auth(email,password))location.href="/";else $(".js-formError",layer.$div).text(Lang.get("password.wrong")).show();return false}})});this._complete("error")}else if(this.isEnabled())this.setActivate(true);_log.endAt("onDOMReady")},_initialize:function(){var _li_init=
_log.start("_initialize");_log.startAt("complete","init offlineCacheComplete");var self=this;if(!patron["OfflineMode"]){this.AccountManager.save("user_active",patron.useremail);if(/win\d+\.dev\.mail\.ru$/.test(location.host))this.AccountManager.save("users_authorized",[patron.useremail]);else __PH.loadAccountsList(function(list){if(list&&$.isArray(list.accounts)){for(var accounts=[],i=list.accounts.length;i--;)if(list.accounts[i]&&list.accounts[i].email)accounts.push(list.accounts[i].email);this.AccountManager.save("users_authorized",
accounts)}}.bind(this))}var RpcConfig={channel:"appcache",remote:"/cgi-bin/lstatic?"+$.param({get:"appcache",offline_data_version:patron["OfflineDataVersion"],offline_storage_version:patron["OfflineStorageVersion"],messages_per_page:patron["messagesPerPage"],nomanifest:+!patron["OfflineManifest"]}),onReady:function(){_log.end(_li_appcacheTransport)},props:{style:{display:"none"}}};var RpcJsonRpcConfig={remote:{dropAppCache:{}}};var _li_appcacheTransport=_log.start("appcacheTransport",RpcConfig,RpcJsonRpcConfig);
this.appcacheTransport=new patron.OfflineCache.easyXDM.Rpc(RpcConfig,RpcJsonRpcConfig);var transportConfig={userMD5:this.userMD5,complete:function(textStatus){_log.endAt("storageTransport",textStatus);if(textStatus=="success")self.execActions().then(self.onFirstActionsExecuteObserver,self.onFirstActionsExecuteObserver);else self._complete("error")}};_log.startAt("storageTransport","storageTransport complete",transportConfig);this.Transport=new patron.OfflineTransport(transportConfig);this.PreloadManager=
new PreloadManager(this.Transport);this.OfflineActionManager=new patron.OfflineActionManager(this.Transport);_log.end(_li_init)},_complete:function(textStatus){_log.endAt("complete",textStatus);this.isComplete=true;if(textStatus=="success"){$(window).bind("offlinechange.offline",this.onChangeOfflineModeObserver);$(window).triggerHandler("offlinechange",[ajs.offline])}this.triggerHandler("complete")},_onFirstActionsExecute:function(){if(patron.Updater)patron.Updater.reload();if(!ajs.offline)this.PreloadManager.preloadData();
$(window).triggerHandler("update.offlineActions");this._complete("success")},ajax:function(o,ajaxData,callback){var self=this;if(!o.cacheRunning&&this.isAllowed())if(!this.isComplete){var _li_complete=_log.start("ajax offlineCacheComplete");this.one("complete",function(){_log.end(_li_complete);self.ajax(o,ajaxData,callback)})}else if(!o.isExecActions&&this.getActionCount()){o.isExecActions=true;var _li_execActions=_log.start("ajax execActions");this.execActions().then(function(){_log.end(_li_execActions,
"done");self.ajax(o,ajaxData,callback)},function(){_log.end(_li_execActions,"fail");self.ajax(o,ajaxData,callback)})}else if(patron["ForceOfflineMode"])this.getCache(o,!patron["ForceOfflineMode"],function(response,old_answer){callback(response,o,{status:200,readyState:4},"success",200,"",old_answer)});else if(patron["EnableOfflineModeLoadFromCache"])this.getCache(o,!patron["ForceOfflineMode"],function(response,old_answer){if(response)callback(response,o,{status:200,readyState:4},"success",200,"",
old_answer);else $.ajax(ajaxData)});else $.ajax(ajaxData);else $.ajax(ajaxData)},parse:function(jqXHR,textStatus,o,callback){if(typeof jqXHR=="string"||jqXHR===undef)jqXHR={status:200,responseText:jqXHR,readyState:4};var status,response,error="";try{status=jqXHR.status}catch(er){status=403;textStatus="xhr_error"}var useOfflineStorage=this.isAllowed()&&!(o&&o.cacheRunning);o=o||{dataType:"json",type:"GET"};if(status==200){response=jqXHR.responseText;if(textStatus=="success"&&(o.dataType=="json"||o.dataType==
"text"))if(o.dataType=="json")try{response=jQuery.parseJSON(response,o);if(useOfflineStorage)try{this.setCache(o,response)}catch(e){}}catch(e){if(useOfflineStorage&&~response.indexOf("__OFFLINE_MODE__"))return this.getCache(o,false,function(response,old_answer){if(response)callback(response,o,{status:200,readyState:4},"success",200,error,old_answer);else callback(response,o,jqXHR,"parsererror",status,e)});else{var errname="parsererror";if(_testAndParseHtmlRedirect(response))errname="connection.hello";
return callback(response,o,jqXHR,errname,status,e)}}else if(useOfflineStorage)if(~response.indexOf("__OFFLINE_MODE__"))return this.getCache(o,false,function(response,old_answer){if(response)callback(response,o,{status:200,readyState:4},"success",200,error,old_answer);else callback(response,o,jqXHR,"error",status,error)});else this.setCache(o,response)}else if(status==302)response={status:"redirect",data:jqXHR.getResponseHeader("Location")};else if(useOfflineStorage&&jqXHR.status==0&&textStatus=="error"&&
jqXHR.readyState==0&&!jqXHR.responseText)return this.getCache(o,false,function(response,old_answer){if(response)callback(response,o,{status:200,readyState:4},"success",200,error,old_answer);else callback({status:"error",data:status},o,jqXHR,"error",status,error)});else response={status:"error",data:status};return callback(response,o,jqXHR,textStatus,status,error)},setActivate:function(active){var self=this;if(active)$R("{easyXDM}"+"easyXDM.min",function(){self.easyXDM=self.easyXDM||easyXDM.noConflict("patron.OfflineCache");
self._initialize()});else{$(window).unbind(".offline",this.onChangeOfflineModeObserver);this.Transport.removeStorage(function(){self.Transport.dropAppCache(function(){self.Transport.destroy()})});this.appcacheTransport.dropAppCache(function(){self.appcacheTransport.destroy()})}},setEnable:function(enable,password){this.AccountManager.setOfflineModeStatus(enable,password);this.setActivate(enable)},setCache:function(ajaxData,response){this._syncData(ajaxData);this._setCache(ajaxData,response);if(!patron["ForceOfflineMode"])if(ajs.offline)$(window).triggerHandler("offlinechange",
[ajs.offline=false])},getCache:function(ajaxData,beforeAjax,successFn){var _li=_log.start("getCache",ajaxData,beforeAjax);var _successFn=function(response,oldAPIFormat){_log.end(_li,response,oldAPIFormat);successFn(response,oldAPIFormat)};ajaxData=$.extend(true,{url:"",data:{}},ajaxData);var self=this;var type=this._getUrlType(ajaxData.url),queryData=ajs.toObject(ajaxData.url);var statusParams={sort:{type:"date",order:"desc"},username:patron.username,userdomain:patron.userdomain,folder:ajaxData.data.folder,
offset:ajaxData.data.offset,limit:ajaxData.data.limit,before_ajax:beforeAjax};var messageParams={id:ajaxData.data.id,before_ajax:beforeAjax};if(beforeAjax)if(type=="readmsg"&&queryData.func_name=="get_messages_by_id"&&ajaxData.data.id)this.Transport.post("messages/message",messageParams,function(response){_successFn(response,self.Transport.getType()=="webstore")});else _successFn();else{if(type=="readmsg"&&queryData.func_name=="get_messages_by_id"&&ajaxData.data.id)this.Transport.post("messages/message",
messageParams,function(response){if(response){var message=response[2];if(message.Unread&&ajaxData.data.read){message.Unread=0;self.OfflineActionManager.putAction("mark",{url:"/cgi-bin/movemsg",data:{id:[message.Id],markmessage:patron.Message.READ,mark:1,ajaxmode:1}});self.Transport.post("messages/putMessages",[message])}}_successFn(response,self.Transport.getType()=="webstore")});else if(type=="api/v1/messages/status"||type=="checknew")this.Transport.post("messages/status",statusParams,function(response){_successFn(response,
type=="api/v1/messages/status"&&self.Transport.getType()=="webstore")});else if(type=="movemsg"||type=="spamabuse"||type=="clearfolder")this._syncData(ajaxData).then(function(response){_successFn(response);if(type=="clearfolder")self.OfflineActionManager.putAction("clear_folder",{url:ajaxData.url,data:ajaxData.data});else if(ajaxData.data.mark)self.OfflineActionManager.putAction("mark",{url:ajaxData.url,data:ajaxData.data});else if(ajaxData.data.move)self.OfflineActionManager.putAction("move",{url:ajaxData.url,
data:ajaxData.data});else if(ajaxData.data.spam)self.OfflineActionManager.putAction("spamabuse",{url:ajaxData.url,data:ajaxData.data})},function(){_successFn()});else if(type=="sentmsg")if(0&&queryData.func_name=="message_to_draft"){this.OfflineActionManager.putAction("message_to_draft",{url:ajaxData.url,data:ajaxData.data});_successFn(["AjaxResponse","OK",{Id:ajs.now()}])}else if(queryData.func_name=="send"){this.OfflineActionManager.putAction("sentmsg",{url:ajaxData.url,data:ajaxData.data},parseInt(ajaxData.data.actionId));
_successFn(["AjaxResponse","OK",{redir_url:"msglist",Ok:"1"}])}else _successFn();else if(type=="lstatic")if(queryData.get=="compose")patron.API.ajax({url:"/offline/compose",type:"GET",dataType:"text",cacheRunning:1,complete:function(result){if(result.isOK())_successFn(result.getData());else _successFn()}});else _successFn();else _successFn();if(!patron["ForceOfflineMode"])if(!ajs.offline)$(window).triggerHandler("offlinechange",[ajs.offline=true])}},getAction:function(id){return this.OfflineActionManager.getAction(id)},
getActionCount:function(){return this.OfflineActionManager.getActionCount()},execActions:function(){return this.OfflineActionManager.execActions()},_setCache:function(o,response){var type=this._getUrlType(o.url);if(type!="checknew"||response.status=="OK")if(type=="readmsg"){if(response&&response[2]&&response[2][0]){var message=response[2][0];if(message)this.Transport.post("messages/putMessages",[message])}}else if(type=="api/v1/messages/status"||type=="checknew")if(response){if(type=="api/v1/messages/status")response=
patron.Utils.AjaxConverter.statusToChecknew(response,o);if(response.data){this.PreloadManager.preloadMessages(o.data,response.data.messages);this.PreloadManager.preloadFolders(o.data,response.data.folders)}}},_syncData:function(o){var self=this;var deferred=$.Deferred();var trySetCommand=false;var type=this._getUrlType(o.url);if(type=="movemsg"||type=="spamabuse"||type=="clearfolder")if(o.data)if(type=="clearfolder"){trySetCommand=true;this.Transport.post("messages/clearFolder",o.data.folder,function(response){deferred.resolve(response)})}else if(o.data.mark){trySetCommand=
true;this.Transport.post("messages/markMessages",{id:o.data.id,state:o.data.markmessage},function(response){deferred.resolve(response)})}else if(o.data.move||o.data.spam){trySetCommand=true;this.Transport.post("messages/moveMessages",{id:o.data.id,folder:o.data.folder},function(response){if(o.data.folder==patron.Folder.TRASH)self.Transport.post("messages/markMessages",{id:o.data.id,state:patron.Message.READ},function(response){deferred.resolve(response)});else deferred.resolve(response)})}if(!trySetCommand)deferred.reject();
return deferred.promise()},_getUrlType:function(url){var result;if(typeof url=="string"){var matches=url.match(this.options.urlTypePattern);if(matches)result=matches[1]}return result},_onChangeOfflineMode:function(evt,offline){var $body=$(document.body);if(offline)$body.removeClass(this.options.onlineModeClass).addClass(this.options.offlineModeClass);else $body.removeClass(this.options.offlineModeClass).addClass(this.options.onlineModeClass);if(patron.ui){var search=patron.ui["PortalSearchSuggest"];
if(search)if(offline){$(search.Search.$Input[0]).attr("disabled","disabled");$("."+search.Search.opts.cnSectionLink,search.Search.$Form).hide()}else{$(search.Search.$Input[0]).removeAttr("disabled");$("."+search.Search.opts.cnSectionLink,search.Search.$Form).show()}}if(patron.Updater)patron.Updater.cts={}},isSupported:function(){return!!(window["postMessage"]&&window["applicationCache"]&&(window["indexedDB"]||(window["webkitIndexedDB"]||window["mozIndexedDB"]||window["msIndexedDB"])||$.browser.webkit&&
window["openDatabase"]))},isAuth:function(){return!patron["OfflineMode"]||this.AccountManager.isAuth()},isEnabled:function(){return!!(patron.username&&patron.userdomain&&patron["EnableOfflineModeSwitcher"]&&this.AccountManager.isEnableOfflineMode())},isAllowed:function(){return this.isEnabled()&&this.isSupported()&&this.isAuth()}});patron.OfflineCache=new patron.OfflineCacheManager;if(patron.OfflineCache.isSupported()){_log.startAt("onDOMReady","onDOMReady");$.isReady?patron.OfflineCache.onDOMReady():
$(function(){patron.OfflineCache.onDOMReady()})}jsLoader.loaded("{patron.offline}patron.OfflineCache")});jsLoader.use(["{jQuery}jquery","{toolkit.common}ajs/__array/ajs__array","{jsCore}Date","{patron}patron.Notify","{patron.offline}patron.OfflineCache","{toolkit.common}store/store"],function(){function getMailFromCookie(){var result,Mpop=jsCookie.get("Mpop");if(Mpop)result=Mpop.split(":")[2];return patron.IsMyCom?patron.useremail:result}function authUser(){$.ajax({url:"https://auth."+patron.SingleDomainName+
"/cgi-bin/auth?mac=1",dataType:"jsonp",timeout:5E3,data:{Login:patron.useremail},jsonp:"JSONP_call",success:function(response){$(window).triggerHandler("authUser.success",[response])},complete:function(){$(window).triggerHandler("authUser.complete")}})}$.ajaxSetup({data:{ajax_call:1,"x-email":function(){return patron.userdomain&&patron.username&&patron.useremail?patron.useremail:""}},traditional:true});patron.Ajax=function(o){patron.restoreJquery();var email=getMailFromCookie();if(!o.tryAuth&&(patron.OldMultiAuthLayerLogic||
patron.newMultiAuthLogic)&&!ajs.blurred&&email&&patron.username&&patron.userdomain&&email!=patron.useremail){$(window).one("authUser.complete",function(o,evt){o.tryAuth=1;patron.Ajax(o)}.bind(this,o));authUser()}else{o.type=(o.type||"GET").toUpperCase();o.dataType=(o.dataType||"json").toLowerCase();o.timeout=ajs.isset(o.timeout,0);o.async=ajs.isset(o.async,true);o.tokenRetry=ajs.isset(o.tokenRetry,1);o.headers={"X-Request-Id":ajs.uuid()};$(window).triggerHandler("ajax.beforeSend",[o]);patron.OfflineCache.ajax(o,
{url:o.url,type:o.type,data:o.data,dataType:"text",timeout:o.timeout,async:o.async,headers:o.headers,complete:function(jqXHR,textStatus){patron.Ajax.parse(jqXHR,textStatus,o)}},doResult)}};patron.Ajax.getSyncData=function(url,data){try{var xhr=$.ajax({"url":url,"data":data,"async":false,"dataType":"text"}),res=$.parseJSON(xhr.responseText);if(res&&res.status=="OK")return res.data}catch(e){}};patron.Ajax.byType=function(t,u,d,s,e){var o={url:u,data:d,type:t};if(e!==true){o.success=s;o.error=e}else o.complete=
s;return patron.Ajax(o)};Array.forEach(["get","post"],function(type){patron.Ajax[type]=function(url,data,success,error){if($.isFunction(data)){success=data;error=success;data={}}return patron.Ajax.byType(type,url,data,success,error)}});patron.Ajax.Result=function(res,options,xhr,xhrStatus,xhrError){this._xhr=xhr;this._options=options||{};this.xhrError=xhrError;this.xhrStatus=xhr&&xhr.status;this.xhrStatusText=this.status=xhrStatus+"";if(this.isSuccess()){if(this.isJSON()){if(res&&res[0]=="AjaxResponse")res=
{status:res[1],data:res[2],additionalData:res.slice(3)};else if($.isArray(res))res={status:"ok",data:res};else if(!res)res={status:"unknown"};res.status=String(res.status).toLowerCase()}else res={status:"ok",data:res};if(xhr&&xhr.getResponseHeader&&xhr.getResponseHeader("X-NoSDC")==1)res.status="NoSDC";if(res&&res.status=="redirect"&&res.data.indexOf("/cgi-bin/login")===0)res.status="noauth";ajs.extend(this,res)}};patron.Ajax.Result.fn=patron.Ajax.Result.prototype={constructor:patron.Ajax.Result,
getXHR:function(){return this._xhr},getResponseText:function(){return this._xhr&&this._xhr.responseText},getOpts:function(){return this._options},isOK:function(){return this.status=="ok"||this.status==200},isSuccess:function(){return this.xhrStatusText=="success"&&this.status!="error"},isError:function(){return this.hasNet()&&!(this.isOK()||this.isNOP()||this.isNoSDC()||this.isNoAuth()||this.isNoToken()||this.isBadToken()||this.isRedirect()||this.isAccessDenied()||this.isAbort()||this.isInvalidPassword())},
hasNet:function(){var xhr=this.getXHR();return this.isSuccess()||xhr&&xhr.readyState==4&&xhr.status>99&&xhr.status<600},isGET:function(){return String(this._options.type||"GET").toUpperCase()=="GET"},isPOST:function(){return String(this._options.type).toUpperCase()=="POST"},isJSON:function(){return String(this._options.dataType||"json").toLowerCase()=="json"},getStatus:function(){return this.status},getError:function(){return this.xhrError},setData:function(data){this.data=data;return this},getData:function(){return this.data},
getAdditionalData:function(){return this.additionalData},getBody:function(){return this.getData()}};Array.forEach("NOP bad-token no-auth no-SDC no-token redirect access-denied invalid-password abort".split(" "),function(name,status){status=name.replace(/-/g,"").toLowerCase();patron.Ajax.Result.fn[$.camelCase("is-"+name)]=function(){return(this.status||"").toLowerCase()==status}});function doResult(response,opts,xhr,s,status,error,old_answer){var convert_response=response,convert_time;if(s=="success"&&
opts.convertResultToOldApi&&!old_answer){convert_time=new Date;convert_response=patron.Utils.AjaxConverter.convert(response,opts);convert_time=new Date-convert_time}var result=new patron.Ajax.Result(convert_response,opts,xhr,s,error);opts.pending=false;$.event.trigger("ajax-stop",{options:opts,result:result,convert_time:convert_time});if(result.isBadToken()&&opts.tokenRetry-- >0)patron.API.post("tokens",function(Result){if(Result.isOk()){var token=Result.getBody().token;if(token)patron.updateToken(token)}patron.Ajax(opts)});
else if(patron["UseSDC"]&&result.isNoSDC()&&opts.SDC===void 0){var doSDC=function(state){opts.SDC=state;if(state)patron.Ajax(opts);else{result.status="noauth";(opts.error||ajs.F)(result,s);(opts.complete||ajs.F)(result,s)}};$.ajax({url:"https://"+patron["UseSDC"]+"/sdc?JSONP_call=?&from="+ajs.encode(ajs.Router.parseURL(jsHistory.get()).url),type:"get",dataType:"jsonp",timeout:3E3,error:function(){doSDC(false)},success:function(state){doSDC(state)}})}else{((result.isSuccess()?opts.success:opts.error)||
ajs.F)(result,s);(opts.complete||jsCore.F)(result,s);if(s=="parsererror"&&error)$.event.trigger("ajaxError",[xhr,opts,error]);if(patron.Events)if(result.isRedirect())patron.Events.fire("redirect.ajax",result);else if(s!=="success"){patron.saveError(s,[status]);patron.Events.fire("error.ajax",result)}}$(window).triggerHandler("ajax.complete",[result]);if(s==="success"&&!old_answer&&opts.isAPIV1&&response&&response.status){var api_key_re=/^\/api?(?:\-(proxy\/[^/]+\/)|\/)v\d+\/([^\?]+).*/;if(api_key_re.test(opts.url)){var api_key=
opts.url.replace(api_key_re,"$1$2").replace(/\//g,"_"),radar_parts,rlog,time=ajs.now()-opts.__ts,front;if(xhr.getResponseHeader)front=xhr.getResponseHeader("X-Host");if(api_key!=="messages_status"||response.status!=304){radar_parts=[api_key+"_"+response.status+"="+time];if(response.status!=200)if(typeof response.body==="string")if(response.body)radar_parts.push(api_key+"_"+response.status+"_"+response.body+"="+time);else radar_parts.push(api_key+"_"+response.status+"_nobody="+time);else{radar_parts.push(api_key+
"_"+response.status+"_objectbody="+time);if(patron.LogAPISObjectError)rlog={rlog:"apis_object_error",rlog_message:JSON.stringify({status:response.status,method:api_key,body:response.body,front:front})}}radar_parts.push(response.status+"="+time)}if(radar_parts)patron.radar("APIS",radar_parts.join("&"),null,rlog)}}else if(s=="connection.hello"){$.event.trigger("ajaxError",[xhr,opts,error]);patron.Notify.add("connection.hello",{delay:0,group:"ajax"})}}patron.Ajax.parse=function(jqXHR,textStatus,o){patron.OfflineCache.parse(jqXHR,
textStatus,o,doResult)};window.Ajax=patron.Ajax;(function(){var _rtype=/^(?:https?:\/\/[^/]+)?\/?(?:cgi-bin\/)?(\w+)/i,_log=function(txt){window.console&&console.log&&console.log(txt)};function _relPath(url){var result=url.match(_rtype);return result?result[1]:false}$(window).bind({"ajax.beforeSend":function(evt,options,type){try{_start(options)}catch(er){}if($.type(options.data)=="string")options.url+=(~options.url.indexOf("?")?"&":"?")+"x-email="+patron.useremail;if(!(options.isAPIV1||options.saveTokens)&&
patron.tokens&&(type=options.ref)){var token_parts=window["mailru_api_token_parts"]||patron.tokens[type];if(token_parts)if(options.data)if($.type(options.data)=="string")options.data=$.param(token_parts)+"&"+options.data.replace(/(^|&)(form_sign|form_token)=[^&]*/g,"");else{if($.type(options.data)=="object")options.data=$.extend({},options.data,token_parts)}else options.data=token_parts}if(options.beforeSend)options.beforeSend(options)},"ajax.complete":function(evt,response){var data=response.getData();
var options=response.getOpts();var type=options.ref;try{_stop(options,response)}catch(er){}if(response.isOK()){if($.type(data)=="array")data=data[0];if($.type(data)=="object"){patron.tokens=patron.tokens||{};if(type=="movemsg"&&data.form_sign&&data.form_token)patron.tokens["movemsg"]={form_sign:data.form_sign,form_token:data.form_token};else if(data.form_sign_movemsg&&data.form_token_movemsg)patron.tokens["movemsg"]={form_sign:data.form_sign_movemsg,form_token:data.form_token_movemsg};if(type=="sentmsg"&&
data.form_sign&&data.form_token)patron.tokens["sentmsg"]={form_sign:data.form_sign,form_token:data.form_token};else if(data.form_sign_sentmsg&&data.form_token_sentmsg)patron.tokens["sentmsg"]={form_sign:data.form_sign_sentmsg,form_token:data.form_token_sentmsg};if(type=="bouncemsg"&&data.form_sign&&data.form_token)patron.tokens["bouncemsg"]={form_sign:data.form_sign,form_token:data.form_token};else if(data.form_sign_bouncemsg&&data.form_token_bouncemsg)patron.tokens["bouncemsg"]={form_sign:data.form_sign_bouncemsg,
form_token:data.form_token_bouncemsg};if(data.form_sign_smsverificator&&data.form_token_smsverificator)patron.tokens["smsverificator"]={form_sign:data.form_sign_smsverificator,form_token:data.form_token_smsverificator};if(data.form_sign_api_v1&&data.form_token_api_v1)patron.updateToken(data.form_sign_api_v1+":"+data.form_token_api_v1)}}checkActiveAccount(response)}});function checkLayer(name,vars){if(!vars)vars={};if(patron.DisabledNoAuthLayer)return;ajs.require("{plugins}"+"LayerManager,{plugins}"+
"Layer",function(name,vars){if(!LayerMainDiv.getInstance().visible&&(!patron.phAuthFormEnabled||!__PH.authForm.isVisible()))if(!patron.IsMyCom&&(patron.OldMultiAuthLayerLogic||patron.newMultiAuthLogic)){if(!ajs.blurred){$(window).one("authUser.success",function(name,vars,evt,response){if(response.status=="ok")debug.log("account EXISTS");else{var data=response.data,list;if(data)list=data.list;if(Array.isArray(list))if(list.length==1){name="changeAccount";if(!patron.phAuthFormEnabled)vars={email:list[0]}}else{if(patron.phAuthFormEnabled)vars.formType=
"relogin"}else if(patron.phAuthFormEnabled)vars.formType="relogin";LayerManager.show(name,vars);debug.log("account NOT EXISTS")}}.bind(this,name,vars));authUser()}}else LayerManager.show(name,vars)}.bind(this,name,vars))}function checkActiveAccount(response){var data=response.getData(),options=response.getOpts(),type=options.ref,email;if(response&&response.isNoAuth())if(patron.phAuthFormEnabled)checkLayer("noAuth",{closable:false,login:patron.username,domain:patron.userdomain,focus:"password"});else checkLayer("noAuth");
else{if(type=="checknew"){if(data&&data.username&&data.userdomain)email=data.username+"@"+data.userdomain}else email=getMailFromCookie();if(email&&email!=patron.useremail)checkLayer("changeAccount",{email:email})}}var _req={},_isConn=true;function _start(o){o.pid=ajs.uniqId();o.ref=_relPath(o.url);o.__ts=ajs.now();o.loadPage=o.loadPage&&patron._loadPageUrl;o.pending=true;$.event.trigger("ajax-start",{options:o});if(o.isUser||o.loading)_req[o.pid]=setTimeout(function(){_notifyLog(o,"notify.loading");
if(o.loading)patron.Notify.add(typeof o.loading=="string"?o.loading:"load",{delay:0,group:"ajax"});_req[o.pid]=setTimeout(function(){_ping(o,"6s");_notifyLog(o,"notify.connection.still");if(o.loading)patron.Notify.add((typeof o.loading=="string"?o.loading:"load")+".still",{delay:0,group:"ajax"});_req[o.pid]=setTimeout(function(){_ping(o,"11s");_req[o.pid]=setTimeout(function(){_notifyLog(o,"notify.connection.still.error");patron.Notify.add("connection.still.error",{delay:0,group:"ajax"})},5*60*1E3)},
5*1E3)},5*1E3)},1*1E3);else _req[o.pid]=setTimeout(function(){_ping(o,"8s")},8*1E3)}function _stop(o,R){clearTimeout(_req[o.pid]);delete _req[o.pid];var s=R.getStatus(),dt=ajs.now()-o.__ts,_radar;if(Math.random()<0.1&&o.ref&&/messages?|compose|osearch|readmsg|filesearch/.test(o.ref))patron.radar("ajax",o.ref.replace(/[^a-z]+/g,"-")+"="+dt);if(R.xhrStatus==200){if(~"error parseerror redirect unknown".indexOf(s))_radar="200_"+s.substr(0,5)}else if(R.hasNet())_radar=R.xhrStatus;if(_radar){patron.radar("Ajax_error",
_radar+"=1",1);var _xhr=R.getXHR(),_opts=R.getOpts();var _log={log:"ajax_xhrStatus_"+_radar,url:_opts.url,data:JSON.stringify(_opts.data),dataType:_opts.dataType,type:_opts.type,xstatus:_xhr.status,xstate:_xhr.xstate,email:patron.useremail};if(patron.ips)_log.ips=patron.ips.join(",");if(_radar==503){if(Math.rand(1,100)==1)_log.ajax_xhrStatus_503_body=_xhr.responseText}else if(_radar=="200_error")if(Math.rand(1,100)==1)_log.ajax_xhrStatus_200_error_body=_xhr.responseText;if(_xhr.getAllResponseHeaders)_log.headers=
_xhr.getAllResponseHeaders();(new Image).src="//gstat."+patron.staticDomainName+"/gstat?ua=1&logme="+encodeURIComponent($.param(_log))+"&r="+Math.random()}ajs.log("[ajax.complete] error:",R.isError(),", net:",R.hasNet(),", isUser:",o.isUser||o.loading);if(o.loadPage&&!R.isOK())$(window).triggerHandler("errorloadpage",[o.loadPage]);if(!R.isError()&&R.hasNet()&&(o.isUser||o.loading||!_isConn)){_isConn=true;patron.Notify.hide("ajax");if(!store.disabled){var df=store.get("disconnectNotify");if(df>0)(new Image).src=
"//rs."+patron.SingleDomainName+"/d798187&r="+ajs.now();store.remove("disconnectNotify")}}else if(o.isUser||o.loading)if(!R.hasNet()||s=="timeout"){patron.Notify.hide("ajax");_ping(o,!R.hasNet()?"net":"timeout")}else if(R.isError()&&!o.hideAutoErrors){_notifyLog(o,"notify.error");patron.Notify.add("error",{delay:10,group:"ajax"})}if(Math.random()<0.01)patron.gstat(["AJAX_REQUEST",location.protocol.replace(":",""),patron.realIP||"0.0.0.0",o.ref,s,dt+"ms"].join("-"),"ua=1");if(R.isOK()&&/sentmsg|compose/.test(o.ref)&&
o.url.indexOf("func_name=send")!==-1){var log={log:"sentmsgtime",time:dt,email:patron.useremail};(new Image).src="//gstat."+patron.staticDomainName+"/gstat?logme="+encodeURIComponent($.param(log))+"&r="+Math.random()}}function _ping(o,radar_postfix){if(o.loading||o.isUser)$(new Image).attr("src","//img."+patron.staticDomainName+"/0.gif?"+Math.random()).bind("error load",function(evt){_isConn=evt.type=="load";ajs.log("ping.status:",_isConn?"ok":"fail");if(!_isConn){clearTimeout(o.pid);_notifyLog(o,
"notify.connection.error");patron.Notify.add("connection.error",{delay:0,group:"ajax",radar_postfix:radar_postfix});_store(o);if(!store.disabled)store.set("disconnectNotify",1)}$(this).unbind()})}function _store(o){if(!store.disabled&&o.storeMe&&(o.loading||o.isUser)&&!o.__store){var key=o.storeMe+"_fail_cnt",cnt=store.get(key)|0;o.__store=true;store.set(key,++cnt);ajs.log("inc."+key+":",cnt)}}function _notifyLog(o,name){var t=new Date;t.setTime(ajs.now()-o.__ts);patron.log(name+": "+t.format("I:S.")+
t.getMilliseconds(),{url:o.url,loading:o.loading,loadPage:o.loadPage,pending:o.pending})}jQuery(function(){if(patron.OldMultiAuthLayerLogic)$(window).bind("visibilitychange",function(evt,hidden){if(!hidden)checkLayer("noAuth")});else if(patron.newMultiAuthLogic&&window.__PH){__PH.on("authLost",function(){checkLayer("noAuth",{closable:false,login:patron.username,domain:patron.userdomain,focus:"password"})});__PH.on("loginRequest",function(){LayerManager.show("noAuth",{changeAccount:true,checkLayerMainDiv:true})});
__PH.on("authChange",function(){location.href="/messages/inbox"})}});window.Ajax=patron.Ajax})();jsLoader.loaded("{patron}patron.Ajax",patron.Ajax)});define("{patron.v2}utils/apf",function(){var apf={getExtention:function(filename){return(filename||"").replace(/^(.*)\./,"").toLowerCase()},canThumbnail:function(filename){var ext=this.getExtention(filename);return ext==="png"||ext==="jpe"||ext==="jpg"||ext==="jpeg"||ext==="gif"||ext==="bmp"}};return apf});define("{patron.v2}utils/docs",["{patron.v2}utils/apf"],
function(apf){var docs={canThumbnail:function(filename){var ext=apf.getExtention(filename);return patron["IsMRVGraphicPreviewEnabled"]&&(ext==="psd"||ext==="tga"||ext==="ai"||ext==="tif"||ext==="tiff"||ext==="eps")||(patron["IsMRVPreviewEnabled"]||patron["IsMRVOfficePreviewOnlyReadmsg"]&&(patron.isReadMsgPage()||patron.isThreadPage()))&&(patron["IsMRVMSDocPreviewEnabled"]&&(ext==="doc"||ext==="docx")||patron["IsMRVMSPptPreviewEnabled"]&&(ext==="ppt"||ext==="pptx"||ext==="pdf")||patron["IsMRVMSExcelPreviewEnabled"]&&
(ext==="xls"||ext==="xlsx")||patron["IsMRVCsvPreviewEnabled"]&&ext==="csv")}};return docs});define("{patron.v2}utils/contentTypes",[],function(){var mimeTypes=[{".123":"application/vnd.lotus-1-2-3"},{".3dml":"text/vnd.in3d.3dml"},{".3g2":"video/3gpp2"},{".3gp":"video/3gpp"},{".a":"application/octet-stream"},{".aab":"application/x-authorware-bin"},{".aac":"audio/x-aac"},{".aam":"application/x-authorware-map"},{".aas":"application/x-authorware-seg"},{".abw":"application/x-abiword"},{".acc":"application/vnd.americandynamics.acc"},
{".ace":"application/x-ace-compressed"},{".acu":"application/vnd.acucobol"},{".acutc":"application/vnd.acucorp"},{".adp":"audio/adpcm"},{".aep":"application/vnd.audiograph"},{".afm":"application/x-font-type1"},{".afp":"application/vnd.ibm.modcap"},{".ai":"application/postscript"},{".aif":"audio/x-aiff"},{".aifc":"audio/x-aiff"},{".aiff":"audio/x-aiff"},{".air":"application/vnd.adobe.air-application-installer-package+zip"},{".ami":"application/vnd.amiga.ami"},{".apk":"application/vnd.android.package-archive"},
{".application":"application/x-ms-application"},{".apr":"application/vnd.lotus-approach"},{".asc":"application/pgp-signature"},{".asf":"video/x-ms-asf"},{".asm":"text/x-asm"},{".aso":"application/vnd.accpac.simply.aso"},{".asx":"video/x-ms-asf"},{".atc":"application/vnd.acucorp"},{".atom":"application/atom+xml"},{".atomcat":"application/atomcat+xml"},{".atomsvc":"application/atomsvc+xml"},{".atx":"application/vnd.antix.game-component"},{".au":"audio/basic"},{".avi":"video/x-msvideo"},{".aw":"application/applixware"},
{".azf":"application/vnd.airzip.filesecure.azf"},{".azs":"application/vnd.airzip.filesecure.azs"},{".azw":"application/vnd.amazon.ebook"},{".bat":"application/x-msdownload"},{".bcpio":"application/x-bcpio"},{".bdf":"application/x-font-bdf"},{".bdm":"application/vnd.syncml.dm+wbxml"},{".bh2":"application/vnd.fujitsu.oasysprs"},{".bin":"application/octet-stream"},{".bmi":"application/vnd.bmi"},{".bmp":"image/bmp"},{".book":"application/vnd.framemaker"},{".box":"application/vnd.previewsystems.box"},
{".boz":"application/x-bzip2"},{".bpk":"application/octet-stream"},{".btif":"image/prs.btif"},{".bz":"application/x-bzip"},{".bz2":"application/x-bzip2"},{".c":"text/x-c"},{".c4d":"application/vnd.clonk.c4group"},{".c4f":"application/vnd.clonk.c4group"},{".c4g":"application/vnd.clonk.c4group"},{".c4p":"application/vnd.clonk.c4group"},{".c4u":"application/vnd.clonk.c4group"},{".cab":"application/vnd.ms-cab-compressed"},{".car":"application/vnd.curl.car"},{".cat":"application/vnd.ms-pki.seccat"},{".cc":"text/x-c"},
{".cct":"application/x-director"},{".ccxml":"application/ccxml+xml"},{".cdbcmsg":"application/vnd.contact.cmsg"},{".cdf":"application/x-netcdf"},{".cdkey":"application/vnd.mediastation.cdkey"},{".cdx":"chemical/x-cdx"},{".cdxml":"application/vnd.chemdraw+xml"},{".cdy":"application/vnd.cinderella"},{".cer":"application/pkix-cert"},{".cgm":"image/cgm"},{".chat":"application/x-chat"},{".chm":"application/vnd.ms-htmlhelp"},{".chrt":"application/vnd.kde.kchart"},{".cif":"chemical/x-cif"},{".cii":"application/vnd.anser-web-certificate-issue-initiation"},
{".cil":"application/vnd.ms-artgalry"},{".cla":"application/vnd.claymore"},{".class":"application/java-vm"},{".clkk":"application/vnd.crick.clicker.keyboard"},{".clkp":"application/vnd.crick.clicker.palette"},{".clkt":"application/vnd.crick.clicker.template"},{".clkw":"application/vnd.crick.clicker.wordbank"},{".clkx":"application/vnd.crick.clicker"},{".clp":"application/x-msclip"},{".cmc":"application/vnd.cosmocaller"},{".cmdf":"chemical/x-cmdf"},{".cml":"chemical/x-cml"},{".cmp":"application/vnd.yellowriver-custom-menu"},
{".cmx":"image/x-cmx"},{".cod":"application/vnd.rim.cod"},{".com":"application/x-msdownload"},{".conf":"text/plain"},{".cpio":"application/x-cpio"},{".cpp":"text/x-c"},{".cpt":"application/mac-compactpro"},{".crd":"application/x-mscardfile"},{".crl":"application/pkix-crl"},{".crt":"application/x-x509-ca-cert"},{".csh":"application/x-csh"},{".csml":"chemical/x-csml"},{".csp":"application/vnd.commonspace"},{".css":"text/css"},{".cst":"application/x-director"},{".csv":"text/csv"},{".cu":"application/cu-seeme"},
{".curl":"text/vnd.curl"},{".cww":"application/prs.cww"},{".cxt":"application/x-director"},{".cxx":"text/x-c"},{".daf":"application/vnd.mobius.daf"},{".dataless":"application/vnd.fdsn.seed"},{".davmount":"application/davmount+xml"},{".dcr":"application/x-director"},{".dcurl":"text/vnd.curl.dcurl"},{".dd2":"application/vnd.oma.dd2+xml"},{".ddd":"application/vnd.fujixerox.ddd"},{".deb":"application/x-debian-package"},{".def":"text/plain"},{".deploy":"application/octet-stream"},{".der":"application/x-x509-ca-cert"},
{".dfac":"application/vnd.dreamfactory"},{".dic":"text/x-c"},{".diff":"text/plain"},{".dir":"application/x-director"},{".dis":"application/vnd.mobius.dis"},{".dist":"application/octet-stream"},{".distz":"application/octet-stream"},{".djv":"image/vnd.djvu"},{".djvu":"image/vnd.djvu"},{".dll":"application/x-msdownload"},{".dmg":"application/octet-stream"},{".dms":"application/octet-stream"},{".dna":"application/vnd.dna"},{".doc":"application/msword"},{".docm":"application/vnd.ms-word.document.macroenabled.12"},
{".docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document"},{".dot":"application/msword"},{".dotm":"application/vnd.ms-word.template.macroenabled.12"},{".dotx":"application/vnd.openxmlformats-officedocument.wordprocessingml.template"},{".dp":"application/vnd.osgi.dp"},{".dpg":"application/vnd.dpgraph"},{".dsc":"text/prs.lines.tag"},{".dtb":"application/x-dtbook+xml"},{".dtd":"application/xml-dtd"},{".dts":"audio/vnd.dts"},{".dtshd":"audio/vnd.dts.hd"},{".dump":"application/octet-stream"},
{".dvi":"application/x-dvi"},{".dwf":"model/vnd.dwf"},{".dwg":"image/vnd.dwg"},{".dxf":"image/vnd.dxf"},{".dxp":"application/vnd.spotfire.dxp"},{".dxr":"application/x-director"},{".ecelp4800":"audio/vnd.nuera.ecelp4800"},{".ecelp7470":"audio/vnd.nuera.ecelp7470"},{".ecelp9600":"audio/vnd.nuera.ecelp9600"},{".ecma":"application/ecmascript"},{".edm":"application/vnd.novadigm.edm"},{".edx":"application/vnd.novadigm.edx"},{".efif":"application/vnd.picsel"},{".ei6":"application/vnd.pg.osasli"},{".elc":"application/octet-stream"},
{".eml":"message/rfc822"},{".emma":"application/emma+xml"},{".eol":"audio/vnd.digital-winds"},{".eot":"application/vnd.ms-fontobject"},{".eps":"application/postscript"},{".epub":"application/epub+zip"},{".es3":"application/vnd.eszigno3+xml"},{".esf":"application/vnd.epson.esf"},{".et3":"application/vnd.eszigno3+xml"},{".etx":"text/x-setext"},{".exe":"application/x-msdownload"},{".ext":"application/vnd.novadigm.ext"},{".ez":"application/andrew-inset"},{".ez2":"application/vnd.ezpix-album"},{".ez3":"application/vnd.ezpix-package"},
{".f":"text/x-fortran"},{".f4v":"video/x-f4v"},{".f77":"text/x-fortran"},{".f90":"text/x-fortran"},{".fbs":"image/vnd.fastbidsheet"},{".fdf":"application/vnd.fdf"},{".fe_launch":"application/vnd.denovo.fcselayout-link"},{".fg5":"application/vnd.fujitsu.oasysgp"},{".fgd":"application/x-director"},{".fh":"image/x-freehand"},{".fh4":"image/x-freehand"},{".fh5":"image/x-freehand"},{".fh7":"image/x-freehand"},{".fhc":"image/x-freehand"},{".fig":"application/x-xfig"},{".fli":"video/x-fli"},{".flo":"application/vnd.micrografx.flo"},
{".flv":"video/x-flv"},{".flw":"application/vnd.kde.kivio"},{".flx":"text/vnd.fmi.flexstor"},{".fly":"text/vnd.fly"},{".fm":"application/vnd.framemaker"},{".fnc":"application/vnd.frogans.fnc"},{".for":"text/x-fortran"},{".fpx":"image/vnd.fpx"},{".frame":"application/vnd.framemaker"},{".fsc":"application/vnd.fsc.weblaunch"},{".fst":"image/vnd.fst"},{".ftc":"application/vnd.fluxtime.clip"},{".fti":"application/vnd.anser-web-funds-transfer-initiation"},{".fvt":"video/vnd.fvt"},{".fzs":"application/vnd.fuzzysheet"},
{".g3":"image/g3fax"},{".gac":"application/vnd.groove-account"},{".gdl":"model/vnd.gdl"},{".geo":"application/vnd.dynageo"},{".gex":"application/vnd.geometry-explorer"},{".ggb":"application/vnd.geogebra.file"},{".ggt":"application/vnd.geogebra.tool"},{".ghf":"application/vnd.groove-help"},{".gif":"image/gif"},{".gim":"application/vnd.groove-identity-message"},{".gmx":"application/vnd.gmx"},{".gnumeric":"application/x-gnumeric"},{".gph":"application/vnd.flographit"},{".gqf":"application/vnd.grafeq"},
{".gqs":"application/vnd.grafeq"},{".gram":"application/srgs"},{".gre":"application/vnd.geometry-explorer"},{".grv":"application/vnd.groove-injector"},{".grxml":"application/srgs+xml"},{".gsf":"application/x-font-ghostscript"},{".gtar":"application/x-gtar"},{".gtm":"application/vnd.groove-tool-message"},{".gtw":"model/vnd.gtw"},{".gv":"text/vnd.graphviz"},{".gz":"application/x-gzip"},{".h":"text/x-c"},{".h261":"video/h261"},{".h263":"video/h263"},{".h264":"video/h264"},{".hbci":"application/vnd.hbci"},
{".hdf":"application/x-hdf"},{".hh":"text/x-c"},{".hlp":"application/winhlp"},{".hpgl":"application/vnd.hp-hpgl"},{".hpid":"application/vnd.hp-hpid"},{".hps":"application/vnd.hp-hps"},{".hqx":"application/mac-binhex40"},{".htke":"application/vnd.kenameaapp"},{".htm":"text/html"},{".html":"text/html"},{".hvd":"application/vnd.yamaha.hv-dic"},{".hvp":"application/vnd.yamaha.hv-voice"},{".hvs":"application/vnd.yamaha.hv-script"},{".icc":"application/vnd.iccprofile"},{".ice":"x-conference/x-cooltalk"},
{".icm":"application/vnd.iccprofile"},{".ico":"image/x-icon"},{".ics":"text/calendar"},{".ief":"image/ief"},{".ifb":"text/calendar"},{".ifm":"application/vnd.shana.informed.formdata"},{".iges":"model/iges"},{".igl":"application/vnd.igloader"},{".igs":"model/iges"},{".igx":"application/vnd.micrografx.igx"},{".iif":"application/vnd.shana.informed.interchange"},{".imp":"application/vnd.accpac.simply.imp"},{".ims":"application/vnd.ms-ims"},{".in":"text/plain"},{".ipk":"application/vnd.shana.informed.package"},
{".irm":"application/vnd.ibm.rights-management"},{".irp":"application/vnd.irepository.package+xml"},{".iso":"application/octet-stream"},{".itp":"application/vnd.shana.informed.formtemplate"},{".ivp":"application/vnd.immervision-ivp"},{".ivu":"application/vnd.immervision-ivu"},{".jad":"text/vnd.sun.j2me.app-descriptor"},{".jam":"application/vnd.jam"},{".jar":"application/java-archive"},{".java":"text/x-java-source"},{".jisp":"application/vnd.jisp"},{".jlt":"application/vnd.hp-jlyt"},{".jnlp":"application/x-java-jnlp-file"},
{".joda":"application/vnd.joost.joda-archive"},{".jpe":"image/jpeg"},{".jpeg":"image/jpeg"},{".jpg":"image/jpeg"},{".jpgm":"video/jpm"},{".jpgv":"video/jpeg"},{".jpm":"video/jpm"},{".js":"application/javascript"},{".json":"application/json"},{".kar":"audio/midi"},{".karbon":"application/vnd.kde.karbon"},{".kfo":"application/vnd.kde.kformula"},{".kia":"application/vnd.kidspiration"},{".kil":"application/x-killustrator"},{".kml":"application/vnd.google-earth.kml+xml"},{".kmz":"application/vnd.google-earth.kmz"},
{".kne":"application/vnd.kinar"},{".knp":"application/vnd.kinar"},{".kon":"application/vnd.kde.kontour"},{".kpr":"application/vnd.kde.kpresenter"},{".kpt":"application/vnd.kde.kpresenter"},{".ksh":"text/plain"},{".ksp":"application/vnd.kde.kspread"},{".ktr":"application/vnd.kahootz"},{".ktz":"application/vnd.kahootz"},{".kwd":"application/vnd.kde.kword"},{".kwt":"application/vnd.kde.kword"},{".latex":"application/x-latex"},{".lbd":"application/vnd.llamagraphics.life-balance.desktop"},{".lbe":"application/vnd.llamagraphics.life-balance.exchange+xml"},
{".les":"application/vnd.hhe.lesson-player"},{".lha":"application/octet-stream"},{".link66":"application/vnd.route66.link66+xml"},{".list":"text/plain"},{".list3820":"application/vnd.ibm.modcap"},{".listafp":"application/vnd.ibm.modcap"},{".log":"text/plain"},{".lostxml":"application/lost+xml"},{".lrf":"application/octet-stream"},{".lrm":"application/vnd.ms-lrm"},{".ltf":"application/vnd.frogans.ltf"},{".lvp":"audio/vnd.lucent.voice"},{".lwp":"application/vnd.lotus-wordpro"},{".lzh":"application/octet-stream"},
{".m13":"application/x-msmediaview"},{".m14":"application/x-msmediaview"},{".m1v":"video/mpeg"},{".m2a":"audio/mpeg"},{".m2v":"video/mpeg"},{".m3a":"audio/mpeg"},{".m3u":"audio/x-mpegurl"},{".m4u":"video/vnd.mpegurl"},{".m4v":"video/x-m4v"},{".ma":"application/mathematica"},{".mag":"application/vnd.ecowin.chart"},{".maker":"application/vnd.framemaker"},{".man":"text/troff"},{".mathml":"application/mathml+xml"},{".mb":"application/mathematica"},{".mbk":"application/vnd.mobius.mbk"},{".mbox":"application/mbox"},
{".mc1":"application/vnd.medcalcdata"},{".mcd":"application/vnd.mcd"},{".mcurl":"text/vnd.curl.mcurl"},{".mdb":"application/x-msaccess"},{".mdi":"image/vnd.ms-modi"},{".me":"text/troff"},{".mesh":"model/mesh"},{".mfm":"application/vnd.mfmp"},{".mgz":"application/vnd.proteus.magazine"},{".mht":"message/rfc822"},{".mhtml":"message/rfc822"},{".mid":"audio/midi"},{".midi":"audio/midi"},{".mif":"application/vnd.mif"},{".mime":"message/rfc822"},{".mj2":"video/mj2"},{".mjp2":"video/mj2"},{".mlp":"application/vnd.dolby.mlp"},
{".mmd":"application/vnd.chipnuts.karaoke-mmd"},{".mmf":"application/vnd.smaf"},{".mmr":"image/vnd.fujixerox.edmics-mmr"},{".mny":"application/x-msmoney"},{".mobi":"application/x-mobipocket-ebook"},{".mov":"video/quicktime"},{".movie":"video/x-sgi-movie"},{".mp2":"audio/mpeg"},{".mp2a":"audio/mpeg"},{".mp3":"audio/mpeg"},{".mp4":"video/mp4"},{".mp4a":"audio/mp4"},{".mp4s":"application/mp4"},{".mp4v":"video/mp4"},{".mpa":"video/mpeg"},{".mpc":"application/vnd.mophun.certificate"},{".mpe":"video/mpeg"},
{".mpeg":"video/mpeg"},{".mpg":"video/mpeg"},{".mpg4":"video/mp4"},{".mpga":"audio/mpeg"},{".mpkg":"application/vnd.apple.installer+xml"},{".mpm":"application/vnd.blueice.multipass"},{".mpn":"application/vnd.mophun.application"},{".mpp":"application/vnd.ms-project"},{".mpt":"application/vnd.ms-project"},{".mpy":"application/vnd.ibm.minipay"},{".mqy":"application/vnd.mobius.mqy"},{".mrc":"application/marc"},{".ms":"text/troff"},{".mscml":"application/mediaservercontrol+xml"},{".mseed":"application/vnd.fdsn.mseed"},
{".mseq":"application/vnd.mseq"},{".msf":"application/vnd.epson.msf"},{".msh":"model/mesh"},{".msi":"application/x-msdownload"},{".msl":"application/vnd.mobius.msl"},{".msty":"application/vnd.muvee.style"},{".mts":"model/vnd.mts"},{".mus":"application/vnd.musician"},{".musicxml":"application/vnd.recordare.musicxml+xml"},{".mvb":"application/x-msmediaview"},{".mwf":"application/vnd.mfer"},{".mxf":"application/mxf"},{".mxl":"application/vnd.recordare.musicxml"},{".mxml":"application/xv+xml"},{".mxs":"application/vnd.triscape.mxs"},
{".mxu":"video/vnd.mpegurl"},{".n-gage":"application/vnd.nokia.n-gage.symbian.install"},{".nb":"application/mathematica"},{".nc":"application/x-netcdf"},{".ncx":"application/x-dtbncx+xml"},{".ngdat":"application/vnd.nokia.n-gage.data"},{".nlu":"application/vnd.neurolanguage.nlu"},{".nml":"application/vnd.enliven"},{".nnd":"application/vnd.noblenet-directory"},{".nns":"application/vnd.noblenet-sealer"},{".nnw":"application/vnd.noblenet-web"},{".npx":"image/vnd.net-fpx"},{".nsf":"application/vnd.lotus-notes"},
{".nws":"message/rfc822"},{".o":"application/octet-stream"},{".oa2":"application/vnd.fujitsu.oasys2"},{".oa3":"application/vnd.fujitsu.oasys3"},{".oas":"application/vnd.fujitsu.oasys"},{".obd":"application/x-msbinder"},{".obj":"application/octet-stream"},{".oda":"application/oda"},{".odb":"application/vnd.oasis.opendocument.database"},{".odc":"application/vnd.oasis.opendocument.chart"},{".odf":"application/vnd.oasis.opendocument.formula"},{".odft":"application/vnd.oasis.opendocument.formula-template"},
{".odg":"application/vnd.oasis.opendocument.graphics"},{".odi":"application/vnd.oasis.opendocument.image"},{".odp":"application/vnd.oasis.opendocument.presentation"},{".ods":"application/vnd.oasis.opendocument.spreadsheet"},{".odt":"application/vnd.oasis.opendocument.text"},{".oga":"audio/ogg"},{".ogg":"audio/ogg"},{".ogv":"video/ogg"},{".ogx":"application/ogg"},{".onepkg":"application/onenote"},{".onetmp":"application/onenote"},{".onetoc":"application/onenote"},{".onetoc2":"application/onenote"},
{".opf":"application/oebps-package+xml"},{".oprc":"application/vnd.palm"},{".org":"application/vnd.lotus-organizer"},{".osf":"application/vnd.yamaha.openscoreformat"},{".osfpvg":"application/vnd.yamaha.openscoreformat.osfpvg+xml"},{".otc":"application/vnd.oasis.opendocument.chart-template"},{".otf":"application/x-font-otf"},{".otg":"application/vnd.oasis.opendocument.graphics-template"},{".oth":"application/vnd.oasis.opendocument.text-web"},{".oti":"application/vnd.oasis.opendocument.image-template"},
{".otm":"application/vnd.oasis.opendocument.text-master"},{".otp":"application/vnd.oasis.opendocument.presentation-template"},{".ots":"application/vnd.oasis.opendocument.spreadsheet-template"},{".ott":"application/vnd.oasis.opendocument.text-template"},{".oxt":"application/vnd.openofficeorg.extension"},{".p":"text/x-pascal"},{".p10":"application/pkcs10"},{".p12":"application/x-pkcs12"},{".p7b":"application/x-pkcs7-certificates"},{".p7c":"application/pkcs7-mime"},{".p7m":"application/pkcs7-mime"},
{".p7r":"application/x-pkcs7-certreqresp"},{".p7s":"application/pkcs7-signature"},{".pas":"text/x-pascal"},{".pbd":"application/vnd.powerbuilder6"},{".pbm":"image/x-portable-bitmap"},{".pcf":"application/x-font-pcf"},{".pcl":"application/vnd.hp-pcl"},{".pclxl":"application/vnd.hp-pclxl"},{".pct":"image/x-pict"},{".pcurl":"application/vnd.curl.pcurl"},{".pcx":"image/x-pcx"},{".pdb":"application/vnd.palm"},{".pdf":"application/pdf"},{".pfa":"application/x-font-type1"},{".pfb":"application/x-font-type1"},
{".pfm":"application/x-font-type1"},{".pfr":"application/font-tdpfr"},{".pfx":"application/x-pkcs12"},{".pgm":"image/x-portable-graymap"},{".pgn":"application/x-chess-pgn"},{".pgp":"application/pgp-encrypted"},{".pic":"image/x-pict"},{".pkg":"application/octet-stream"},{".pki":"application/pkixcmp"},{".pkipath":"application/pkix-pkipath"},{".pl":"text/plain"},{".plb":"application/vnd.3gpp.pic-bw-large"},{".plc":"application/vnd.mobius.plc"},{".plf":"application/vnd.pocketlearn"},{".pls":"application/pls+xml"},
{".pml":"application/vnd.ctc-posml"},{".png":"image/png"},{".pnm":"image/x-portable-anymap"},{".portpkg":"application/vnd.macports.portpkg"},{".pot":"application/vnd.ms-powerpoint"},{".potm":"application/vnd.ms-powerpoint.template.macroenabled.12"},{".potx":"application/vnd.openxmlformats-officedocument.presentationml.template"},{".ppa":"application/vnd.ms-powerpoint"},{".ppam":"application/vnd.ms-powerpoint.addin.macroenabled.12"},{".ppd":"application/vnd.cups-ppd"},{".ppm":"image/x-portable-pixmap"},
{".pps":"application/vnd.ms-powerpoint"},{".ppsm":"application/vnd.ms-powerpoint.slideshow.macroenabled.12"},{".ppsx":"application/vnd.openxmlformats-officedocument.presentationml.slideshow"},{".ppt":"application/vnd.ms-powerpoint"},{".pptm":"application/vnd.ms-powerpoint.presentation.macroenabled.12"},{".pptx":"application/vnd.openxmlformats-officedocument.presentationml.presentation"},{".pqa":"application/vnd.palm"},{".prc":"application/x-mobipocket-ebook"},{".pre":"application/vnd.lotus-freelance"},
{".prf":"application/pics-rules"},{".ps":"application/postscript"},{".psb":"application/vnd.3gpp.pic-bw-small"},{".psd":"image/vnd.adobe.photoshop"},{".psf":"application/x-font-linux-psf"},{".ptid":"application/vnd.pvi.ptid1"},{".pub":"application/x-mspublisher"},{".pvb":"application/vnd.3gpp.pic-bw-var"},{".pwn":"application/vnd.3m.post-it-notes"},{".pwz":"application/vnd.ms-powerpoint"},{".py":"text/x-python"},{".pya":"audio/vnd.ms-playready.media.pya"},{".pyc":"application/x-python-code"},{".pyo":"application/x-python-code"},
{".pyv":"video/vnd.ms-playready.media.pyv"},{".qam":"application/vnd.epson.quickanime"},{".qbo":"application/vnd.intu.qbo"},{".qfx":"application/vnd.intu.qfx"},{".qps":"application/vnd.publishare-delta-tree"},{".qt":"video/quicktime"},{".qwd":"application/vnd.quark.quarkxpress"},{".qwt":"application/vnd.quark.quarkxpress"},{".qxb":"application/vnd.quark.quarkxpress"},{".qxd":"application/vnd.quark.quarkxpress"},{".qxl":"application/vnd.quark.quarkxpress"},{".qxt":"application/vnd.quark.quarkxpress"},
{".ra":"audio/x-pn-realaudio"},{".ram":"audio/x-pn-realaudio"},{".ras":"image/x-cmu-raster"},{".rcprofile":"application/vnd.ipunplugged.rcprofile"},{".rdf":"application/rdf+xml"},{".rdz":"application/vnd.data-vision.rdz"},{".rep":"application/vnd.businessobjects"},{".res":"application/x-dtbresource+xml"},{".rgb":"image/x-rgb"},{".rif":"application/reginfo+xml"},{".rl":"application/resource-lists+xml"},{".rlc":"image/vnd.fujixerox.edmics-rlc"},{".rld":"application/resource-lists-diff+xml"},{".rm":"application/vnd.rn-realmedia"},
{".rmi":"audio/midi"},{".rmp":"audio/x-pn-realaudio-plugin"},{".rms":"application/vnd.jcp.javame.midlet-rms"},{".rnc":"application/relax-ng-compact-syntax"},{".roff":"text/troff"},{".rpm":"application/x-rpm"},{".rpss":"application/vnd.nokia.radio-presets"},{".rpst":"application/vnd.nokia.radio-preset"},{".rq":"application/sparql-query"},{".rs":"application/rls-services+xml"},{".rsd":"application/rsd+xml"},{".rss":"application/rss+xml"},{".rtf":"application/rtf"},{".rtx":"text/richtext"},{".s":"text/x-asm"},
{".saf":"application/vnd.yamaha.smaf-audio"},{".sbml":"application/sbml+xml"},{".sc":"application/vnd.ibm.secure-container"},{".scd":"application/x-msschedule"},{".scm":"application/vnd.lotus-screencam"},{".scq":"application/scvp-cv-request"},{".scs":"application/scvp-cv-response"},{".scurl":"text/vnd.curl.scurl"},{".sda":"application/vnd.stardivision.draw"},{".sdc":"application/vnd.stardivision.calc"},{".sdd":"application/vnd.stardivision.impress"},{".sdkd":"application/vnd.solent.sdkm+xml"},{".sdkm":"application/vnd.solent.sdkm+xml"},
{".sdp":"application/sdp"},{".sdw":"application/vnd.stardivision.writer"},{".see":"application/vnd.seemail"},{".seed":"application/vnd.fdsn.seed"},{".sema":"application/vnd.sema"},{".semd":"application/vnd.semd"},{".semf":"application/vnd.semf"},{".ser":"application/java-serialized-object"},{".setpay":"application/set-payment-initiation"},{".setreg":"application/set-registration-initiation"},{".sfd-hdstx":"application/vnd.hydrostatix.sof-data"},{".sfs":"application/vnd.spotfire.sfs"},{".sgl":"application/vnd.stardivision.writer-global"},
{".sgm":"text/sgml"},{".sgml":"text/sgml"},{".sh":"application/x-sh"},{".shar":"application/x-shar"},{".shf":"application/shf+xml"},{".si":"text/vnd.wap.si"},{".sic":"application/vnd.wap.sic"},{".sig":"application/pgp-signature"},{".silo":"model/mesh"},{".sis":"application/vnd.symbian.install"},{".sisx":"application/vnd.symbian.install"},{".sit":"application/x-stuffit"},{".sitx":"application/x-stuffitx"},{".skd":"application/vnd.koan"},{".skm":"application/vnd.koan"},{".skp":"application/vnd.koan"},
{".skt":"application/vnd.koan"},{".sl":"text/vnd.wap.sl"},{".slc":"application/vnd.wap.slc"},{".sldm":"application/vnd.ms-powerpoint.slide.macroenabled.12"},{".sldx":"application/vnd.openxmlformats-officedocument.presentationml.slide"},{".slt":"application/vnd.epson.salt"},{".smf":"application/vnd.stardivision.math"},{".smi":"application/smil+xml"},{".smil":"application/smil+xml"},{".snd":"audio/basic"},{".snf":"application/x-font-snf"},{".so":"application/octet-stream"},{".spc":"application/x-pkcs7-certificates"},
{".spf":"application/vnd.yamaha.smaf-phrase"},{".spl":"application/x-futuresplash"},{".spot":"text/vnd.in3d.spot"},{".spp":"application/scvp-vp-response"},{".spq":"application/scvp-vp-request"},{".spx":"audio/ogg"},{".src":"application/x-wais-source"},{".srx":"application/sparql-results+xml"},{".sse":"application/vnd.kodak-descriptor"},{".ssf":"application/vnd.epson.ssf"},{".ssml":"application/ssml+xml"},{".stc":"application/vnd.sun.xml.calc.template"},{".std":"application/vnd.sun.xml.draw.template"},
{".stf":"application/vnd.wt.stf"},{".sti":"application/vnd.sun.xml.impress.template"},{".stk":"application/hyperstudio"},{".stl":"application/vnd.ms-pki.stl"},{".str":"application/vnd.pg.format"},{".stw":"application/vnd.sun.xml.writer.template"},{".sus":"application/vnd.sus-calendar"},{".susp":"application/vnd.sus-calendar"},{".sv4cpio":"application/x-sv4cpio"},{".sv4crc":"application/x-sv4crc"},{".svd":"application/vnd.svd"},{".svg":"image/svg+xml"},{".svgz":"image/svg+xml"},{".swa":"application/x-director"},
{".swf":"application/x-shockwave-flash"},{".swi":"application/vnd.arastra.swi"},{".sxc":"application/vnd.sun.xml.calc"},{".sxd":"application/vnd.sun.xml.draw"},{".sxg":"application/vnd.sun.xml.writer.global"},{".sxi":"application/vnd.sun.xml.impress"},{".sxm":"application/vnd.sun.xml.math"},{".sxw":"application/vnd.sun.xml.writer"},{".t":"text/troff"},{".tao":"application/vnd.tao.intent-module-archive"},{".tar":"application/x-tar"},{".tcap":"application/vnd.3gpp2.tcap"},{".tcl":"application/x-tcl"},
{".teacher":"application/vnd.smart.teacher"},{".tex":"application/x-tex"},{".texi":"application/x-texinfo"},{".texinfo":"application/x-texinfo"},{".text":"text/plain"},{".tfm":"application/x-tex-tfm"},{".tgz":"application/x-gzip"},{".tif":"image/tiff"},{".tiff":"image/tiff"},{".tmo":"application/vnd.tmobile-livetv"},{".torrent":"application/x-bittorrent"},{".tpl":"application/vnd.groove-tool-template"},{".tpt":"application/vnd.trid.tpt"},{".tr":"text/troff"},{".tra":"application/vnd.trueapp"},{".trm":"application/x-msterminal"},
{".tsv":"text/tab-separated-values"},{".ttc":"application/x-font-ttf"},{".ttf":"application/x-font-ttf"},{".twd":"application/vnd.simtech-mindmapper"},{".twds":"application/vnd.simtech-mindmapper"},{".txd":"application/vnd.genomatix.tuxedo"},{".txf":"application/vnd.mobius.txf"},{".txt":"text/plain"},{".u32":"application/x-authorware-bin"},{".udeb":"application/x-debian-package"},{".ufd":"application/vnd.ufdl"},{".ufdl":"application/vnd.ufdl"},{".umj":"application/vnd.umajin"},{".unityweb":"application/vnd.unity"},
{".uoml":"application/vnd.uoml+xml"},{".uri":"text/uri-list"},{".uris":"text/uri-list"},{".urls":"text/uri-list"},{".ustar":"application/x-ustar"},{".utz":"application/vnd.uiq.theme"},{".uu":"text/x-uuencode"},{".vcd":"application/x-cdlink"},{".vcf":"text/x-vcard"},{".vcg":"application/vnd.groove-vcard"},{".vcs":"text/x-vcalendar"},{".vcx":"application/vnd.vcx"},{".vis":"application/vnd.visionary"},{".viv":"video/vnd.vivo"},{".vor":"application/vnd.stardivision.writer"},{".vox":"application/x-authorware-bin"},
{".vrml":"model/vrml"},{".vsd":"application/vnd.visio"},{".vsf":"application/vnd.vsf"},{".vss":"application/vnd.visio"},{".vst":"application/vnd.visio"},{".vsw":"application/vnd.visio"},{".vtu":"model/vnd.vtu"},{".vxml":"application/voicexml+xml"},{".w3d":"application/x-director"},{".wad":"application/x-doom"},{".wav":"audio/x-wav"},{".wax":"audio/x-ms-wax"},{".wbmp":"image/vnd.wap.wbmp"},{".wbs":"application/vnd.criticaltools.wbs+xml"},{".wbxml":"application/vnd.wap.wbxml"},{".wcm":"application/vnd.ms-works"},
{".wdb":"application/vnd.ms-works"},{".wiz":"application/msword"},{".wks":"application/vnd.ms-works"},{".wm":"video/x-ms-wm"},{".wma":"audio/x-ms-wma"},{".wmd":"application/x-ms-wmd"},{".wmf":"application/x-msmetafile"},{".wml":"text/vnd.wap.wml"},{".wmlc":"application/vnd.wap.wmlc"},{".wmls":"text/vnd.wap.wmlscript"},{".wmlsc":"application/vnd.wap.wmlscriptc"},{".wmv":"video/x-ms-wmv"},{".wmx":"video/x-ms-wmx"},{".wmz":"application/x-ms-wmz"},{".wpd":"application/vnd.wordperfect"},{".wpl":"application/vnd.ms-wpl"},
{".wps":"application/vnd.ms-works"},{".wqd":"application/vnd.wqd"},{".wri":"application/x-mswrite"},{".wrl":"model/vrml"},{".wsdl":"application/wsdl+xml"},{".wspolicy":"application/wspolicy+xml"},{".wtb":"application/vnd.webturbo"},{".wvx":"video/x-ms-wvx"},{".x32":"application/x-authorware-bin"},{".x3d":"application/vnd.hzn-3d-crossword"},{".xap":"application/x-silverlight-app"},{".xar":"application/vnd.xara"},{".xbap":"application/x-ms-xbap"},{".xbd":"application/vnd.fujixerox.docuworks.binder"},
{".xbm":"image/x-xbitmap"},{".xdm":"application/vnd.syncml.dm+xml"},{".xdp":"application/vnd.adobe.xdp+xml"},{".xdw":"application/vnd.fujixerox.docuworks"},{".xenc":"application/xenc+xml"},{".xer":"application/patch-ops-error+xml"},{".xfdf":"application/vnd.adobe.xfdf"},{".xfdl":"application/vnd.xfdl"},{".xht":"application/xhtml+xml"},{".xhtml":"application/xhtml+xml"},{".xhvml":"application/xv+xml"},{".xif":"image/vnd.xiff"},{".xla":"application/vnd.ms-excel"},{".xlam":"application/vnd.ms-excel.addin.macroenabled.12"},
{".xlb":"application/vnd.ms-excel"},{".xlc":"application/vnd.ms-excel"},{".xlm":"application/vnd.ms-excel"},{".xls":"application/vnd.ms-excel"},{".xlsb":"application/vnd.ms-excel.sheet.binary.macroenabled.12"},{".xlsm":"application/vnd.ms-excel.sheet.macroenabled.12"},{".xlsx":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"},{".xlt":"application/vnd.ms-excel"},{".xltm":"application/vnd.ms-excel.template.macroenabled.12"},{".xltx":"application/vnd.openxmlformats-officedocument.spreadsheetml.template"},
{".xlw":"application/vnd.ms-excel"},{".xml":"application/xml"},{".xo":"application/vnd.olpc-sugar"},{".xop":"application/xop+xml"},{".xpdl":"application/xml"},{".xpi":"application/x-xpinstall"},{".xpm":"image/x-xpixmap"},{".xpr":"application/vnd.is-xpr"},{".xps":"application/vnd.ms-xpsdocument"},{".xpw":"application/vnd.intercon.formnet"},{".xpx":"application/vnd.intercon.formnet"},{".xsl":"application/xml"},{".xslt":"application/xslt+xml"},{".xsm":"application/vnd.syncml+xml"},{".xspf":"application/xspf+xml"},
{".xul":"application/vnd.mozilla.xul+xml"},{".xvm":"application/xv+xml"},{".xvml":"application/xv+xml"},{".xwd":"image/x-xwindowdump"},{".xyz":"chemical/x-xyz"},{".zaz":"application/vnd.zzazz.deck+xml"},{".zir":"application/vnd.zul"},{".zirz":"application/vnd.zul"},{".zmm":"application/vnd.handheld-entertainment+xml"},{".tga":"image/x-targa"},{".tga":"image/x-tga"},{".rar":"application/x-rar"},{".rar":"application/x-rar-compressed"},{".7z":"application/x-7z-compressed"},{".zip":"application/zip"},
{".zip":"application/x-zip"},{".zip":"application/x-zip-compressed"},{".zip":"application/x-compress"},{".zip":"application/x-compressed"},null];var mimeTypesMap={},extensionsMap={};var categories={image:["psd","tga","ai","tif","tiff","eps","image","bmp","gif","image/jpeg","png","psp","svg"],audio:["mp3","ram","midi","wav","ogg","aiff","flac","m4a","wma"],video:["avi","mpeg","mp4","asf","mov","3gp","mpg","wmv","flv"],executable:["exe","vbs","js"],archive:["zip","rar","7z","arj","gz","bzip2","zipz",
"bz2"],doc:["doc","docx","wpd","wps","rtf"],xls:["xls","xlsx","xlsb","xlsm","csv"],ppt:["ppt","pptx","pps","ppsx"],pdf:["pdf"],txt:["txt","log"],eml:["eml","msg","mail"],html:["html","htm"]};Array.forEach(mimeTypes,function(mimeType){Object.forEach(mimeType,function(value,key){var extension=key.slice(1);mimeTypesMap[value]=mimeTypesMap[value]||[];mimeTypesMap[value].push(extension);extensionsMap[extension]=extensionsMap[extension]||[];extensionsMap[extension].push(value)})});var contentTypes={getExtensions:function(mimeType){return mimeTypesMap[mimeType]},
getMimeTypes:function(extension){return extensionsMap[extension]},is:function(category,mimeTypeOrExtension){if(categories[category]){if(!!~categories[category].indexOf(mimeTypeOrExtension))return true;if(mimeTypesMap[mimeTypeOrExtension])return!!Array.filter(mimeTypesMap[mimeTypeOrExtension],function(mimeType){return!!~categories[category].indexOf(mimeType)}).length;if(extensionsMap[mimeTypeOrExtension])return!!Array.filter(extensionsMap[mimeTypeOrExtension],function(extension){return!!~categories[category].indexOf(extension)}).length}return false},
getCategory:function(mimeTypeOrExtension){var category;Object.forEach(categories,function(value,key){if(contentTypes.is(key,mimeTypeOrExtension))category=category||key});return category}};return contentTypes});jsLoader.use(["{patron.v2}utils/docs","{patron.v2}utils/apf","{patron.v2}utils/contentTypes","{patron.utils}patron.Utils"],function(docs,apf,contentTypes){var Utils={getTime:function(file){return patron.FilesSearchData.version?file.DateShort:Date.parse(file.time*1E3).format("H:I")},getSubject:function(file){return file.subject||
"<"+Lang.get("message.email.untitled")+">"},canPreview:function(file){return file.content_type_id==1&&apf.canThumbnail(file.name)},isGraphicPreview:function(file){var ext=this.getFileExtention(file);return patron["IsMRVGraphicPreviewEnabled"]&&(ext=="psd"||ext=="tga"||ext=="ai"||ext=="tif"||ext=="tiff"||ext=="eps")},isOfficePreview:function(file){var ext=this.getFileExtention(file);return patron["IsCorpUser"]&&(patron["IsMRVMSDocPreviewEnabled"]||patron["IsMRVMSPptPreviewEnabled"]||patron["IsMRVMSExcelPreviewEnabled"])&&
(ext=="doc"||ext=="docx"||ext=="xls"||ext=="xlsx"||ext=="ppt"||ext=="pptx"||ext=="pdf")},getThumbnailSrc:function(file){var url="";if(docs.canThumbnail(file.name))url="//docs."+(patron.SingleDomainName||"mail.ru")+"/preview/160x120/?"+ajs.toQuery({src:this.getDownloadUrl(file.Id,file.name),"x-email":patron.useremail});else if(this.canPreview(file)){var params={id:file.Id,fx:160,fy:120,mode:"attachment",channel:"",preview:1};if(patron.exif)params.exif=1;url=(patron.IsWinDev||patron.IsDevMyCom?"http://":
"//")+(patron.MailAttachPreviewHost||"apf."+(patron.SingleDomainName||"mail.ru"))+"/cgi-bin/readmsg/"+encodeURIComponent(file.name)+"?"+$.param(params);patron.Utils.logAPFRequest(url)}return url},getFileExtention:function(file){return(file.name||"").replace(/^(.*)\./,"").toLowerCase()},getPreviewHref:function(file,query,index){var result="",params={"x-email":patron.useremail};$.extend(params,query,{offset:index,filesearch:1,id:file.id.replace(/;\d+;\d+$/,"")});params._av=file.id;return"/attaches-viewer/?"+
$.param(params)},getFilesSize:function(files){var size=0;ajs.each(files,function(file){size+=file.size|0});return size},getDownloadUrl:function(id,name){return location.protocol+"//"+patron.MainMailHost+"/cgi-bin/getattach?"+$.param({id:id,file:name,mode:"attachment",channel:"",notype:1,"x-email":patron.useremail})},download:function(files){var defer=$.Deferred();if(files.length){var size=this.getFilesSize(files);if(size>patron["MaxAttachmentSize"]){var error=String.sprintf(Lang.get("FileSearchDownloadSizeLimit"),
Math.round(patron.MaxAttachmentSize/Math.MB));patron.Notify.add("error",{text:error});defer.reject()}else{var params={partids:ajs.map(files,function(file){return file.id}).join("_"),"x-email":patron.useremail,mode:"attachment",fname:"attachments_"+(new Date).format("D-M-Y_H-I-S")};var url="//"+patron.FilesSearchData.attach_host+"/cgi-bin/getattachment?"+$.param(params);location.href=url;defer.resolve()}}else defer.resolve();return defer.promise()},forward:function(files){var defer=$.Deferred();if(files.length){var ids=
ajs.map(files,function(file){return file.id});var url=patron.getPageURL("compose",{id:ids,mode:"forward"});var size=this.getFilesSize(files);if(size>patron["MaxAttachmentSize"]){var error=String.sprintf(Lang.get("FileSearchForwardSizeLimit"),Math.round(patron.MaxAttachmentSize/Math.MB));patron.Notify.add("error",{text:error});defer.reject()}else if(patron.v2){jsHistory.set(url+"?filesearch=1");defer.resolve()}}else defer.resolve();return defer.promise()},openViewer:function(file,query,index){var url=
this.getPreviewHref(file,query,index);try{var w=open(url);w.focus()}catch(e){}},has:function(files,category){var that=this;return Array.some(files,function(file){return contentTypes.is(category,that.getFileExtention(file))})}};patron.Utils.FileSearch=Utils;jsLoader.loaded("{patron.utils}patron.Utils.FileSearch",Utils)});jsLoader.use(["{jQuery}jquery","{patron.utils}patron.Utils.AjaxConverter","{utils}Counter","{patron.model}patron.Message","{patron}patron.Ajax","{toolkit.common}store/store","{patron.utils}patron.Utils.FileSearch"],
function($,AjaxConverter){(function(){var _request_log_timers={};function _request_limit_log(seconds){patron.radar("MessageXHR","limit_"+seconds+"s=1")}function _request_time_log(ms){if(Math.random()*100<patron.MessageXHRTimeLogPercent)patron.radar("MessageXHR","time="+ms)}function _request_timer(timers,seconds){if(Math.random()*100<patron.MessageXHRLimitLogPercent)if(seconds<=120)timers.id=setTimeout(function(seconds){_request_limit_log(seconds);_request_timer(timers,seconds+10)}.bind(this,seconds),
1E4)}jsClass.create("patron.Messages").statics({hash:{},page:{},data:{},redraw:{},onPage:{},folder:{},radar:createRadar("mailru_Messages"),_search:{},_fileSearch:{},_cleanMemory:function(){if(patron.isMsgList&&0){var mId,fId,ids;for(mId in this.data){fId=this.data[mId].FolderId;ids=this.onPage[fId];if(ids===undef||Array.indexOf(ids,mId)==-1){$("#MSG"+mId).remove();delete this.data[mId]}}}},set:function(fId,List,hash,force,fields){var onPage=(this.folder[fId]||[]).length;if(!force)if(onPage!=List.length)force=
true;else{onPage=this.onPage[fId];for(var i=0,n=List.length,M;i<n;i++){M=this.get(onPage[i]);if(M===undef||List[i].Id!=M.Id||List[i].FolderId!=M.FolderId){force=true;break}}}this.hash[fId]=hash;this.page[fId]=Math.max(parseInt(GET.page||1),1);this.folder[fId]=[];this.onPage[fId]=[];Array.forEach(List,function(X,i){this.folder[fId][i]=X=this.upd(X.Id,X,null,fields);this.onPage[fId][i]=X.Id;delete X._tcrc},this);if(force&&force!==1){patron.Events.fire("update.messages",this.folder[fId],{FOLDER_ID:fId});
return true}return false},setFilesSearch:function(fId,List,hash,force){this.folder[fId]=[];this.hash[fId]=hash;Array.forEach(List,function(X,i){this.folder[fId][i]=this.upd(X.Id,X)},this);patron.Events.fire("update.messages",this.folder[fId],{FOLDER_ID:fId})},getByFolder:function(id,page){if(!(id in this.folder))this.folder[id]=[];if(page&&page!=this.page[id])return[];return[].concat(this.folder[id])},clearFolderCache:function(id){delete this.page[id];delete this.folder[id]},get:function(id,def){if(id&&
typeof id!=="string"){var models=Array.map(id,function(X){return this.data[X.id||X]},this);return Array.filter(models,function(X){return X&&X.Id})}return this.data[id]||def},getSafe:function(id){return this.get(id,{Id:id})},upd:function(id,data,safe,fields){var M=this.get(id),extra_data={};if(!M)M=new patron.Message({Id:id},{silent:true});this.data[id]=M;M.set(data,false,safe);return M},getHash:function(fId){return this.hash[fId]},load:function(params,preload,read){if(!(params&&params.id))return;
if(typeof params==="string")params={id:params};var Msg=this.get(params.id)||patron.Message.Empty;var key=params.bulk_show_images+"";var doneFn=ajs.F;if($.isFunction(preload)){doneFn=preload;preload=void 0;if(Msg._loaded)doneFn(null,Msg)}if(params.force||Msg._key!=key){if(Msg._loaded)preload=0;Msg._key=key;Msg._crc=null;Msg._loaded=0}if(!(Msg._loading||Msg._loaded)||!preload&&preload!==void 0){patron.log("message.load",{id:Msg.Id,force:!preload&&preload!==void 0,preload:preload});this.upd(params.id,
{_loading:1,_preload:params.id!=GET.id});var request_id=ajs.uniqId();var ajaxData={url:"/message/?ajax_call=1&func_name=get_messages_by_id&no_rnb=Y&now="+Date.now(),data:ajs.extend({multi_msg_prev:0,multi_msg_past:0,sortby:patron.messagesSort,NewAttachViewer:+patron.NewAttachViewer,AvStatusBar:+patron.AvStatusBar,let_body_type:"let_body_plain",log:+(params.id==GET.id),bulk_show_images:~~params.bulk_show_images,folder:patron.getFolderId(),wrap_body:+!patron.v2},params,{read:read?params.id:0,mark_read:!!read}),
timeout:8E4,storeMe:"readmsg",loading:(params.loading||params.id==GET.id)&&"load",loadPage:params.id==GET.id,complete:this._messagesLoaded.bind(this,key,doneFn,request_id),NoMSG:params.NoMSG};if(patron.IsReadmsgToMessage)patron.API($.extend(true,ajaxData,{url:"messages/message",convertResultToOldApi:true,data:{htmlencoded:false}}));else patron.Ajax(ajaxData);var timers=_request_log_timers[request_id]={start_time:+new Date};_request_timer(timers,10)}else if(Msg._loaded&&preload)for(var i=0,id;i<preload;i++){Msg=
this.get(id=Msg[patron.isClickOnPrev?"PrevId":"NextId"])||patron.Message.Empty;if(Msg.Id&&!Msg._loaded||!Msg.Id&&id){this.load(Object.extend({},params,{id:Msg.Id||id,sm:0}),preload-(i+1));break}}return this.get(params.id)},_messagesLoaded:function(key,doneFn,request_id,R){var opts=R.getOpts().data;var timers=_request_log_timers[request_id];if(timers){timers.time=new Date-timers.start_time;clearTimeout(timers.id);_request_time_log(timers.time)}if(R.isOK()){var Messages=R.getData()||[],X=Messages[0];
if(X){if(X.AccountVerified==0&&!this.__verifyPhoneNotify&&patron.VerifyPhoneNotify){this.__verifyPhoneNotify=1;ajs.require("{plugins}LayerManager",function(){LayerManager.verifyPhoneNotify("#VerifyPhoneNotify")})}if(X.NoMSG==1){patron.log("message.load.NoMSG",{id:opts.id,xhr:R.getResponseText()});if(R.getOpts().NoMSG){var msg=this.upd(opts.id,{NoMSG:1,_loaded:true});patron.Events.fire("update.message",[msg.Id,msg,opts]);doneFn(null,msg,R)}else{patron.Notify.add("error",{subtype:"nomsg"});doneFn("nomsg",
null,R)}}else if(X.Id)Array.forEach(Messages,function(data){data.Id=String(data.Id+"").replace(/,/g,";");data._key=key;data._loaded=1;data._loading=0;data.FromList=data.FromFull;var msg=this.upd(data.Id,data,GET.id!=data.Id);if(opts.sm||opts.id.indexOf("f")===0)this.upd(opts.id,$.extend(msg,{_loaded:1}));msg._loaded=1;patron.log("message.load.success",opts.id);patron.Events.fire("update.message",[msg.Id,msg,opts]);doneFn(null,msg,R)},this);else{this.upd(opts.id,{_loaded:0});patron.log("message.load.unknown",
{id:opts.id,xhr:R.getResponseText()});patron.Notify.add("error");doneFn("error",null,R)}}}else{patron.log("message.load.error",{id:opts.id,xhr:R.getResponseText()});doneFn("server_error",null,R);this.upd(opts.id,{_loaded:0})}this.isLoading=false;this.upd(opts.id,{_loading:0});patron.Events.fire("loaded.messages")},getSearchCacheKey:function(data){return ajs.toQuery(data)},hasSearchCache:function(data){return!!this.getSearchCache(data)},getSearchCache:function(data){return this._search[this.getSearchCacheKey(data)]},
addSearchCache:function(data,Data){this._search[this.getSearchCacheKey(data)]=Data},resetSearchCache:function(){this._search={}},resetFileSearchCache:function(){this._fileSearch={}},_prepareSearchData:function(SearchData){Array.forEach(SearchData.messages,function(msg,i){if(msg.AttachList&&msg.AttachList.length)SearchData.messages[i].AttachList=Array.filter(msg.AttachList,function(attach){return attach!=null});else msg.AttachList=[]});return SearchData},setSearchData:function(SearchData){var Data=
this._prepareSearchData(SearchData);var search_result=new patron.Ajax.Result({status:"OK",data:Data},{},{},"success");patron.Utils.AjaxConverter.searchResult(search_result);var search_data=search_result.getData();this.set(patron.getFolderId(),search_data.messages,Date.now());this.addSearchCache(GET,search_result)},loadSearch:function(params,noCache,noLoading){var df=$.Deferred();var query=ajs.toQuery(ajs.extend({q_query:"",json:"Y",withattachs:patron.AttachmentsInSERP?"Y":""},params));if(this._searchQ==
query)return this._searchDefer;this._searchQ=query;this._searchDefer=df;var loaded=function(R){if(R){this._searchQ=null;patron.Events.fire("beforeloaded.search",R);if(R.isOK()){var data=patron.SearchData=this._prepareSearchData(R.getData()),folderId=patron.Folders.getSearch(params.q_folder).Id,messages=data.messages;this.addSearchCache(params,R);this.set(folderId,messages,ajs.now(),true);if(patron.isFilterFolder(folderId))patron.Folders.upd(folderId,{Messages:data.search.count});df.resolve({data:data,
models:this.getByFolder(folderId)});documentView.redraw()}patron.Events.fire("loaded.search",R)}}.bind(this);if(this._searchXHR)this._searchXHR.abort();this._searchXHR=patron.Ajax({url:"/search/",data:ajs.toObject(query),complete:loaded,saveTokens:false,loading:!noLoading&&!this.hasSearchCache(params)&&"load"});if(!noCache)loaded(this.getSearchCache(params));return df},prepareFileSearchParams:function(data){var params={folder_id:0,content_type_id:-1,offset:patron.filesPerPage*((data.page||1)-1),limit:patron.filesPerPage,
name_needle:data.q_query||""};if(data.only_hidden!=1)delete data["only_hidden"];if(!defined(data.only_hidden)&&!defined(data.q_query))params.folder_id=0;return $.extend(params,data)},getFilesSearchCacheKey:function(data){return ajs.toQuery(this.prepareFileSearchParams(data))},hasFilesSearchCache:function(data){return!!this.getFilesSearchCache(data)},getFilesSearchCache:function(data){return this._fileSearch[this.getFilesSearchCacheKey(data)]},addFilesSearchCache:function(data,Data){this._fileSearch[this.getFilesSearchCacheKey(data)]=
Data},loadFilesSearch:function(params,noCache,noLoading){params=this.prepareFileSearchParams(params);var df=$.Deferred();var query=ajs.toQuery(params);if(this._filesSearchQ==query)return this._filesSearchDefer;else{this._filesSearchQ=query;this._filesSearchDefer=df}var loaded=function(R){if(R){this._filesSearchQ=null;patron.Events.fire("beforeloaded.fileSearch",R);if(R.isOK()){var folderId=patron.Folder.FILESEARCH,Data=patron.FilesSearchData=$.extend({total:0,cnt:0,list:[]},R.getData()||{});ajs.each(Data.list,
function(file){file.Id=[file.id].concat(file.n).join(";");file.FolderId=folderId});this.addFilesSearchCache(params,R);this.setFilesSearch(folderId,Data.list,Date.now(),true);df.resolve({data:Data,models:this.getByFolder(folderId)});documentView.redraw()}patron.Events.fire("loaded.fileSearch",R)}}.bind(this);if(this._fileSearchXHR)this._fileSearchXHR.abort();this._fileSearchXHR=patron.Ajax({url:"/cgi-bin/filesearch_ajax?ajax_call=1&func_name=ajax_search",data:params,loading:!noLoading&&!this.hasFilesSearchCache(params)&&
"load",complete:loaded});if(!noCache)loaded(this.getFilesSearchCache(params));return df},_moveTo:function(params){var to=params.data,models=params.models,complete=params.complete;var $Form=patron.View.Messages.getActive().getForm();if(patron.isReadMsgPage())$Form.append('<input value="'+models[0].id+'" name="id" type="hidden" />');if(to=="new"){if(patron.SettingsOn)patron.API.post("tokens",function(R){var token=String(R.getBody().token).split(":");LayerManager.show("settings__folders__edit",{url:"/cgi-bin/settings/ajax_settings?ajax_call=1&func_name=edit",
tokens:token,foldersList:ajs.filter(patron.Folders.getAll(),function(folder){return!folder.IsSubfolder}),cancel:function(){(complete||ajs.F)(new patron.Ajax.Result)},success:function($form,toFolderId){patron.Folders.upd(toFolderId,{Name:$form.toObject().Name});patron.Messages.edit(ajs.extend({},params,{type:"move",data:toFolderId}))}})})}else{$Form.find(".js-InpMoveTo").val(to);$Form.find(".js-MainBookfilterBtn:first").click()}return true},_filterEditable:function(models){return Array.filter(models,
function(model){return model.isEditable()})},confirmSpam:function(params){var id=params.id,models=this._filterEditable(params.models||this.get([].concat(id))),data=params.data,defer=$.Deferred();id=ajs.map(models,function(model){return model.id});function _edit(models,type){patron.Messages.edit({type:type||"spam",models:models,data:data,complete:defer.resolve,allInFolder:params.allInFolder})}function success(status){if(status==true){_edit(models,"unsubscribe");Counter.sb(1611231)}else if(status===
false){_edit(models);Counter.sb(1678289)}}if(patron.isReadMsgPage()&&patron.ListUnsubscribeEnabled&&models[0]&&models[0].ListUnsubscribe){if(!patron.ListUnsubscribeImmediatlyEnabled)LayerManager.show("listUnsubscribe",{from:models[0].FromName||models[0].From,success:success});else success(false);if(!patron.ListUnsubscribeImmediatlyEnabled){Counter.d(1611231);Counter.d(1678289)}}else $R("{patron}"+"patron.Balloon",function(){patron.Balloon.getAddressBookData(function(abEmails){var email,emails=[],
modelsToSpam=[],modelsConfirm=[],emailContains=function(array,email){var i=array.length;while(i--)if(array[i].toLowerCase()==email.toLowerCase())return true;return false};Array.forEach(models,function(model){email=model.FromList||model.FromFull||model.From;if(email&&emailContains(abEmails,ajs.Html.unescape(email))){modelsConfirm.push(model);if(!emailContains(emails,email))emails.push(email)}else modelsToSpam.push(model)});if(emails.length){LayerManager.show("confirmSpam",{users:emails,success:function(status){if(status===
false){_edit(modelsConfirm);Counter.sb(1345884)}else if(status==true)Counter.sb(1345885);else Counter.sb(1345883)}});Counter.d(1345881);if(modelsToSpam.length>0)_edit(modelsToSpam)}else _edit(models)})});return defer},edit:function(params){params=params||{};var type=params.type,id=params.id,data=params.data,complete=params.complete,models=params.models||this.get([].concat(id)),folder=models[0]&&models[0].getFolder&&models[0].getFolder()||patron.Folders.getSafe(models[0]&&(models[0].FolderId||models[0].folder));
if(Array.contains(["mark","move","spam","unsubscribe","remove"],type)&&data!="fileInArchive"&&data!="fileFromArchive")models=this._filterEditable(models);var url,reqData={},updaterReloead=false,statusLine=0,View=patron.View.Messages.getActive(),isUser=true,reloadBanners=false,countProcessing=models&&models.length;id=ajs.map(models,function(model){return model.id});if(params.allInFolder){reqData.wholefolder=folder.id;countProcessing=View.countInActiveFolder()}if(!countProcessing){if($.isFunction(complete))complete(new patron.Ajax.Result);
return}patron.Folders.transaction(true);switch(type){case "redirect":url="/cgi-bin/bouncemsg?func_name=ajax_bounce_msg";reqData=data;break;case "bookfilter":if(data=="blist")return this._moveTo({data:data,id:models,complete:complete,allInFolder:params.allInFolder});url="/cgi-bin/movemsg";statusLine=1;reqData.id=id;reqData.moveto=statusLine="abook";reqData.bookfilter=1;break;case "mark":case "move":case "spam":case "unsubscribe":case "read":case "remove":if(type=="read"){data=patron.Message.READ;isUser=
false;reqData.no_dwh=1}else reloadBanners=true;updaterReloead=true;statusLine=type;if(!models.length)return;if(data=="new")return this._moveTo({data:data,models:models,complete:complete,allInFolder:params.allInFolder});if(type=="read"){statusLine=0;type="mark"}if(type=="mark"){var a=0,um=0,flag,unread,uf=0;reqData.markmessage=data;Array.forEach(models,function(model){switch(data){case patron.Message.FLAG:if(!model.get("Flagged")){uf++;flag=1;model.set({"Flagged":true,"length_flagged":1})}break;case patron.Message.NOFLAG:if(model.get("Flagged")){uf++;
flag=0;model.set({"Flagged":false,"length_flagged":0})}break;case patron.Message.READ:if(model.isUnread()){patron.log("message.set.read",{id:model.id});um-=model.getCountUnread();unread=0;model.set({"Unread":false,"length_unread":0});if(patron.Folders.getSafe().id==950)Counter.sb(patron.HideSpamCounterOnTheLeftCol?1563667:1563664)}break;case patron.Message.UNREAD:if(!model.isUnread()){um++;unread=1;model.set({"Unread":true,"length_unread":1})}break}});if(params.allInFolder){countProcessing=View.countInActiveFolder();
switch(data){case patron.Message.READ:folder.set("Unread",0);break;case patron.Message.UNREAD:folder.set("Unread",folder.Messages);break}}else{countProcessing=Math.abs(um||uf);folder.set("Unread",Math.max(folder.Unread+um,0))}if(!(countProcessing>0)&&!patron.isReadMsgPage())return}else{View&&(View._clearCBX=true);if(type=="spam"||type=="unsubscribe"){if(data===false){type="move";reqData.nospam=1;reqData.folder=patron.Folder.INBOX;if(patron.isReadMsgPage()&&patron.ListUnsubscribeEnabled&&models[0].ListSubscribe)reqData.subscribe=
1}else{Object.extend(reqData,data);reqData.email='["'+Array.map(models,function(X){return X.From}).join('","')+'"]';reqData.confirm="on";reqData.folder=folder.isTrash()?"":reqData.delorig=="on"?patron.Folder.BULK:models[0].FolderId;reqData.spamabuse=1;if(type=="unsubscribe")reqData.unsubscribe=1}Array.forEach(models,function(message){message.invalidate()})}else if(folder.isTrash()&&(data==folder.id||data===void 0)){reqData.remove=1;reqData.folder=-1}else if(type=="remove"){type="move";reqData.remove=
1;reqData.folder=patron.Folder.TRASH}else reqData.folder=data;if(type=="move"&&data==patron.Folder.TRASH)reqData.remove=1;if(folder.isTrash()||params.confirm)reqData.confirm="on";var cm=models.length;var um=0;patron.log("messages.edit."+type,{length:cm,from_id:folder.id,to_id:reqData.folder});var targetFolder=patron.Folders.get(reqData.folder);var canBeMoved=type!=="move"||targetFolder&&targetFolder.isSecureOpen();Array.forEach(models,function(model){if(reqData.folder!==""&&canBeMoved){model.FolderId=
type=="remove"&&reqData.confirm=="on"?-1:reqData.folder;um+=model.getCountUnread()}View._scbx&&(View._scbx[model.Id]=false)});var arr=[],i=0,deleted=0;if(this.folder[folder.id]&&(patron.isMsgListPage()||patron.isReadMsgPage())&&canBeMoved){Array.forEach(this.folder[folder.id],function(X){if(X.FolderId==folder.id){arr.push(X);if(i){X.PrevId=arr[i-1].Id;arr[i-1].NextId=X.Id}else X.PrevId=X.NexId=0;i++}else deleted++});if(!patron.v2&&false)this.folder[folder.id]=arr}folder.set({"Unread":Math.max(folder.Unread-
um,0),"Messages":Math.max(folder.Messages-cm,0)});var T=patron.Folders.get(reqData.folder);if(T&&T.Id==reqData.folder){if(T.isBulk()||patron.readMsgAfterDelete&&T.isTrash())um=0;T.set({"Unread":Math.max(T.Unread+um,0),"Messages":Math.max(T.Messages+cm,0)})}if(deleted){if(patron.isReadMsgPage())Array.forEach(models,function(M){$("#"+View.idMsgPrefix+M.Id.replace(/(:|;|\.)/g,"\\$1")).remove()});else if(View.$CurSelCBX)Array.forEach(View.$CurSelCBX,function(cbx){$("#"+View.idMsgPrefix+cbx.value.replace(/(:|;|\.)/g,
"\\$1")).addClass("messageline_disabled")});View.show([folder.id,folder.id])}patron.Folders.setId(folder.id,true);if(!patron.isFromSearchReadMsgPage()&&(patron.isReadMsgPage()||patron.isThreadPage())&&canBeMoved){var nId=models[0].get("NextId"),fId=patron.getFolderId();setTimeout(function(){patron.Updater.stop();var url="/messages",id=fId;switch(parseInt(id,10)){case 0:url+="/inbox";break;case 950:url+="/spam";break;case 5E5:url+="/sent";break;case 500001:url+="/drafts";break;case 500002:url+="/trash";
break;case 500003:case 500005:url="/agent/archive";break;default:url+="/folder/"+id}if((type=="spam"||type=="unsubscribe")&&(patron.msgListAfterDelete||!nId))jsHistory.set(url);else if(!nId||type=="move"&&T&&T.isTrash()&&patron.msgListAfterDelete)jsHistory.set(url);else if(patron.isThreadPage())jsHistory.set(patron.getPageURL("thread",{id:nId}));else jsHistory.set(patron.getPageURL("readmsg",{id:nId}));patron.Updater.start()},5)}}if(data=="fileInArchive")url="/cgi-bin/filesearch_ajax?func_name=ajax_hide";
else if(data=="fileFromArchive")url="/cgi-bin/filesearch_ajax?func_name=ajax_unhide";else url=type!="spam"&&type!="unsubscribe"?"/cgi-bin/movemsg":"/cgi-bin/spamabuse";reqData.id=id;reqData[type]=1;break;case "ExpandMode":url='/cgi-bin/ajax_avatarstat/?func_name=set_expanded_msglist&data=["'+ +data+'"]';statusLine=0;updaterReloead=true;break}if(url){if(statusLine=="move")if(reqData.folder==patron.Folder.TRASH)statusLine="move2Trash";else{if(reqData.folder==-1)statusLine="remove"}else if(statusLine==
"mark"&&(countProcessing<2||data===patron.Message.NOFLAG))statusLine=0;var useThreadsTxt=false;if(patron.threads)Array.forEach([].concat(models),function(model){if(model&&model.threadLength>1)useThreadsTxt=true});var txt=countProcessing?useThreadsTxt?Lang.get("Messages").ActionsTread[statusLine]:Lang.get("Messages").Actions[statusLine]:0;if(txt&&countProcessing)if(statusLine=="mark")txt=txt.replace("%s",String.num(countProcessing,Lang.get("Messages").letter," "));else if(data=="fileInArchive"||data==
"fileFromArchive")txt=String.num(countProcessing,Lang.get("Files").file," ")+" "+String.num(countProcessing,Lang.get("Files").Actions[data]);else if(statusLine!="unsubscribe"){var letters=String.num(countProcessing,Lang.get("Messages").letter,statusLine!="remove"&&countProcessing==1?false:" ");if(!useThreadsTxt)txt=txt.replace("%s",String.ucfirst(letters));if(statusLine=="move"||statusLine=="spam"){var xfolder=patron.Folders.get(reqData.folder,{Name:Lang.get("folders.names")[statusLine]});txt=txt.replace("%s",
ajs.Html.escape(xfolder.Name))}}reqData.noredir=reqData.ajaxmode=reqData.ajax_call=1;if(updaterReloead&&patron.Updater);patron.Updater.abort();patron.API.ajax({url:url,type:"POST",data:reqData,models:models,hideAutoErrors:true,isUser:isUser,complete:this._editComplete.bind(this,{ids:id,reload:updaterReloead,text:txt,type:type,args:arguments,data:reqData,bnrs:reloadBanners,complete:complete})})}return countProcessing},_editComplete:function(opts,R){var data=opts.data;patron.log("messages.edit.complete",
{type:opts.type,success:R.isOK(),folder:opts.data.folder});if(data&&R.isError()){if(data.mark)if(data.wholefolder!==undefined)this._revertFolder(data.wholefolder);else this._revertIds(opts.ids);if(!R.isAccessDenied())patron.Notify.add("error",{group:"move"})}if(opts.reload&&patron.Updater){if(patron.isMsgListPage()){clearTimeout(this._updaterId);this._updaterId=setTimeout(function(){if(~"mark read".indexOf(opts.type))patron.Banners.View.reload();else patron.Updater.start(patron.isMsgListPage(),{bnrs:opts.bnrs?
"Y":"N"})},500)}if(patron.isReadMsgPage()){if(!patron.threads&&~"move remove spam".indexOf(opts.type))this.load(ajs.extend({force:true},GET))}else if((patron.isSearchPage()||patron.isFilterFolder())&&!patron.v2)this.loadSearch(GET,true,true);else if(patron.isFileSearchPage())this.loadFilesSearch(GET,true,true)}if(R.isAccessDenied("folder"))patron.Layers.secure(opts.data.folder,function(access){var $List=patron.View.Messages.getActive().getView().find(".messageline_disabled");if(access)this.edit.apply(this,
opts.args);else $List.removeClass("messageline_disabled")}.bind(this));else if(R.isOK()){patron.Folders.transaction(false);if(opts.text)patron.Notify.add("ok",{html:opts.text,group:"move"})}patron.Folders.rollback();if(R.isOK())$.event.trigger("ui-abstract-action",{chain:["mass-operations","actions"],data:R.getOpts()});(opts.complete||ajs.F).call(this,R);$(window).trigger("complete-movemsg.mailru",[R,opts])},_revertFolder:function(id){var models=this.getByFolder(id);Array.forEach(models,function(model){if(model.prevAttrs)this.upd(model.Id,
model.prevAttrs)},this)},_revertIds:function(ids){Array.forEach(ids,function(id){var model=this.getSafe(id);if(model.prevAttrs)this.upd(id,model.prevAttrs)},this)},each:function(fn){ajs.each(this.data,fn)},forEach:function(ids,func,This){var i=0,n=ids.length,M;for(;i<n;i++)if(M=patron.Messages.get(ids[i]))func.call(This,M,i)},map:function(ids,func,This){var result=[];this.forEach(ids,function(M){result.push(func.call(This,M))});return result},hasCache:function(params){var M=this.get(params.id);return M&&
M.isLoaded()}});patron.Messages.saveCompactViewState=function(state){function saveCompactMode(mode,form_sign,form_token){patron.Ajax({url:"/settings/ajax_settings?ajax_call=1&func_name=set_msglistflags&flag=compact_msglist&val="+mode,type:"GET",data:{form_sign:form_sign,form_token:form_token}})}var tokens=patron.tokens["ajax_settings"];if(tokens&&tokens["form_sign"]&&tokens["form_token"])saveCompactMode(+!!state,tokens["form_sign"],tokens["form_token"]);else patron.API.post("tokens",function(result){if(result.isOK()){var tokens=
String(result.getBody().token).split(":");patron.tokens["ajax_settings"]={form_sign:tokens[0],form_token:tokens[1]};saveCompactMode(+!!state,tokens[0],tokens[1])}});$(window).triggerHandler("changeModeClick.msglist",[state])};patron.Messages.find=function(data){var folderId=data.folder*1|0,page=Math.max(data.page*1|0,1),df=$.Deferred(),uid=ajs.uniqId();if(data.id){if(!data.sm&&/\d/.test(data.id))data.id=(data.id+"").replace(/[^\d:;]/g,"");var msg=patron.Messages.get(data.id);if(msg&&msg.isLoaded())df.resolve(msg);
else if(!data.id)df.resolve(patron.Message.NoMSG);else{patron.Events.unbind("loaded.messages."+uid).bind("loaded.messages."+uid,function(){var msg=patron.Messages.get(data.id);if(msg&&msg.isLoaded()){df.resolve(msg);patron.Events.unbind("loaded.messages."+uid)}});data.NoMSG=true;patron.Messages.load(data,void 0,data.read)}}else if(!patron.Folders.hasCache(folderId,page)){var attempts=3;patron.Events.bind("stop.updater",function _(){attempts--;if(patron.Folders.hasCache(folderId,page)||!patron.Folders.get(folderId)){patron.Events.unbind("stop.updater",
_);df.resolve(patron.Messages.getByFolder(folderId,page))}else if(!attempts){patron.Events.unbind("stop.updater",_);df.reject({error:"messages not loaded",folder:folderId,page:page})}});if(!patron.Updater.active)patron.Updater.reload(true)}else df.resolve(patron.Messages.getByFolder(folderId,page));return df.done(function(msg){if(data&&data.id&&data.read&&msg.isUnread())patron.Messages.edit({type:"read",models:[msg]})})}})();jsLoader.loaded("{patron}patron.Messages")});jsLoader.use("{toolkit.common}store/store",
function(){(function(){var features=[];var labs={compose:{dnd:function(){$R("{patron.build}Compose")},userpic:function(Form){function _redraw(){var prevEmailList=this.__labsUserpicEmailList,emailList=patron.Utils.extractEmails([this._formElm("To").val(),this._formElm("CC").val(),this._formElm("BCC").val()].join("")),$box=$(this.options.domIDs.composeAvatar).toggleClass("b-compose__head__avatar_small",!!(emailList&&emailList.length)),i=prevEmailList.length,changed;while(i--){var idx=Array.indexOf(emailList,
prevEmailList[i].data("email"));if(idx==-1){prevEmailList.splice(i,1)[0].css("opacity",0).bind("TransitionEnd webkitTransitionEnd mozTransitionEnd",function(){$(this).remove()});changed=true}else emailList.splice(idx,1)}ajs.each(emailList,function(email){var $img=$(new Image).data("email",email).attr("src",patron.Utils.getAvatarSrc(email,email,40)).addClass("b-compose__head__ava").css("zIndex",prevEmailList.length+1).appendTo($box.parent());changed=true;prevEmailList.push($img)});changed&&setTimeout(function(){var cx=
0,cy=55,len=prevEmailList.length;prevEmailList.forEach(function($img,i){$img.css({top:cy+(i<len-1)*Math.rand(-10,10),left:cx+(i<len-1)*Math.rand(-10,10),opacity:0.99}).css($.support.cssPrefix+"Transform","rotate("+(i<len-1)*Math.rand(-10,10)+"deg)")})},1)}Form.__labsUserpicEmailList=[];Form.$form.bind("composeLabelsChange",_redraw.bind(Form))},stay_in_letter:ajs.F},toolbar:{counter:function(view){var $counter=$("<div>0</div>").css({padding:"3px 4px 4px",position:"absolute",fontSize:10,lineHeight:"8px",
top:-9,left:0,color:"#fff",border:"2px solid #fff",background:"#f60",borderRadius:"8px",boxShadow:"0 1px 2px rgba(0,0,0,.4)"});function _redraw(num){if(num){view.toolbar.$('[data-group="selectAll"]:first').append($counter);$counter.text(num).css("left",-$counter.width())}else $counter.detach()}view.on("render",function(){_redraw(view.getSelected().length)}).on("selectedchanged",function(evt,stat){_redraw(stat.selected)})}},datalist:{dbclick:function($el,datalist,callback){$el.delegate(".js-item-cbx",
"click",function(evt){var $el=$(".js-cbx",evt.currentTarget),lts=$el.data("last_click_ts")||0,ts=+new Date,model=datalist.getItem($el.attr("data-id"));if(model&&ts-lts<200)callback(evt,model);$el.data("last_click_ts",ts)})}}};function isEnabled(label){return!!store.get("labs."+label)}(function _walk(labs,label){if($.isPlainObject(labs))ajs.each(labs,function(value,name){if($.isFunction(value)){var key=label+"."+name;features.push(key);if(isEnabled(key))ajs.log(key+":",["on"]);else labs[name]=ajs.F}else if(typeof value===
"object")_walk(value,label?label+"."+name:name)})})(labs);labs.isEnabled=isEnabled;labs.enable=function(name){store.set("labs."+name,true)};labs.disable=function(name){store.remove("labs."+name,true)};labs.enableAll=function(){ajs.each(features,labs.enable);ajs.log("Reload page!")};ajs.exports("{patron.v2.ui}patron.ui.labs",labs)})()});jsLoader.use(["{utils}jsHistory","{patron}patron.Folders","{patron}patron.Messages","{jsCore}jsCore.ajs","{toolkit.common}jquery/__event-scroll/jquery__event-scroll",
"{patron.v2.ui}patron.ui.labs"],function(){(function($,patron,undef){window.fixedDocumentWrite=function(d){if(d.parseWrite===undef){d.close=function(){};d.open=function(html){var id="u"+Date.now(),p=html.indexOf("<script");d.__write=id;d[id]="";if(p!==-1)html=html.substr(0,p)+'<span id="'+id+'"></span>'+html.substr(p);return html};d.write=d.writeln=function(str){var id=d.__write;d[id]+=str;clearTimeout(d.__writeId);d.__writeId=setTimeout(function(){$("#"+id).append(d[id]);d[id]=""},50)};var _rscriptS=
/(<script[^>]*>)\s*(\x3c!--|\/\/\s*<!\[CDATA\[)/gi,_rscriptE=/\/\/\s*(--\x3e|\]\]>)\s*(<\/script>)/gi;d.parseWrite=function(h){var u="u"+ajs.now();h=h.replace(_rscriptS,"$1").replace(_rscriptE,"$2");h="<script>window."+u+' = "";\x3c/script>'+h.replace(/\w+\.write(ln)?\(/ig,u+"+=(").replace(/<noscript>/ig,"\x3c!--").replace(/<\/noscript>/ig,"--\x3e")+'<span id="'+u+'"></span><script>jQuery("#'+u+'").append('+u+");\x3c/script>";return h}}};var $Scroll=window.$Scroll=$(window);window.replaceHash={simb:{quot:'"',
amp:"&",lt:"<",gt:">"},code:{"037":"%","039":"'",39:"'",92:"\\",35:"#"}};window.replaceEntity=function(str){return str==null?"":str.toString().replace(/(\&(quot|amp|lt|gt)\;)/g,function($0,$1,$2){return replaceHash.simb[$2]!=undef?replaceHash.simb[$2]:$1}).replace(/(\&\#(037|039|39|92|35)\;)/g,function($0,$1,$2){return replaceHash.code[$2]!=undef?replaceHash.code[$2]:$1})};window.returnEntity=function(str){return str.replace(/&/g,"&amp;").replace(/\#/g,"&#35;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,
"&quot;").replace(/(\&lt\;wbr\/\&gt\;)/g,"<wbr/>").replace(/(\&amp\;\&\#35\;8203\;)/g,"&#8203;").replace(/\'/g,"&#039;").replace(/\\/g,"&#92;").replace(/\%/g,"&#37;")};window.wbrDelimeter=navigator.userAgent.indexOf("MSIE")!=-1&&navigator.userAgent.indexOf("Trident")!=-1?"&#8203;":"<wbr/>";window.wbrSplit=function(str,period){var c=0,r=[],i=0,n=str.length,s;for(;i<n;i++){s=str.charAt(i);if(s.match(/\s/))c=0;else c++;if(c>=period){s+=wbrDelimeter;c=0}r[i]=s}return r.join("")};patron._updIsPageVars=
function(){patron.isMsgList=patron.isMsgListPage();patron.isReadMsg=patron.isReadMsgPage();patron.isSentMsg=patron.isComposePage();patron.isSendMsgOk=patron.isSendMsgOkPage();patron.isMrimHistory=patron.isMRIMPage();patron.isSearch=patron.isSearchPage();patron.isFileSearch=patron.isFileSearchPage();patron.isAddressbook=patron.isAddressbookPage()};patron._updGETVars=function(url){var matches,GET={};if(~url.indexOf("?"))$.extend(GET,String.toObject(url));if(matches=url.match(/messages\/([a-z]+)(?:\/(\d+))?\/?/))GET.folder=
parseInt(matches[2]||patron.Folder[matches[1].toUpperCase()],10)|0;else if(matches=url.match(/(message|compose)\/([^\/\?]+)/)){GET.id=matches[2];GET.folder=patron.Messages.getSafe(GET.id).FolderId}if(GET.id)GET.id=(GET.id+"").replace(/&[^;]+;/g,"");return window.GET=GET};patron._updGETVars(jsHistory.get());var _rdomains=/@(corp\.mail|mail|inbox|bk|list)\.ru/i;var _isPage=function(val,url){url=(url||jsHistory.get()||"").split("?")[0];return url.match(val)!=null};patron.domains={"corp.mail":"corp",
mail:"mail",inbox:"inbox",bk:"bk",list:"list"};patron.isMailRuDomain=function(email){return _rdomains.test(email)};var _pageURLS={"msglist":"/messages/:folder/","readmsg":"/message/:id/","thread":"/thread/:id/","compose":"/compose/:id/:mode/","compose_key":"/compose/?_key_=:key","search":"/search/","gosearch":"/search/"};patron.getPageURL=function(name,params){var url=_pageURLS[name].replace(/:(\w+)/g,function(_,key){return params&&"/"+params[key]||""});return location.protocol+"//"+location.host+
url.replace(/\/+/g,"/")};var _pageLabels={messages:"msglist",message:"readmsg",compose:"sentmsg",search:"gosearch"};patron.getPageLabel=function(url){var match=(url||jsHistory.get()||"").match(/(messages?|msglist|readmsg|compose|filesearch|gosearch|search|sentmsg|sendmsgok|addressbook|thread)/);return match?_pageLabels[match[1]]||match[1]:"msglist"};patron.getUserUrl=function(email,name){var url="";if(patron.isMailRuDomain(email)){var part=["http://"],i=0;if(name=="avatar")name="my";part[++i]=name+
".mail.ru";part[++i]=email.indexOf("@corp")>0?"/corp/":"/"+email.match(/@([^.]+)/i)[1]+"/";part[++i]=email.match(/([^@]+)/i)?RegExp.$1:"";url=part.join("")}return url};patron.getAvatarSrc=function(email){var url="//img."+patron.staticDomainName+"/r/msg/letter.gif",mathes=email.match(/(?:^|\s)(\w.+)@(.+)\.ru/i);if(mathes&&patron.domains[mathes[2]])url="http://avt.foto.mail.ru/"+patron.domains[mathes[2]]+"/"+mathes[1]+"/_avatar?"+ajs.now();return url};patron.Events=$({removeEventListener:$.noop,detachEvent:$.noop});
patron.Events.fire=function(type,data,params){var evt=$.Event(type);evt.TYPE=type;evt.DATA=data;if(params!==undef)$.extend(evt,params);this.trigger(evt);return evt.result};patron.setTitle=function(title){setTimeout(function(){document.title=replaceEntity(title)},15)};patron.hasCollectors=function(){var collectors=patron.collectors;return Object.isObject(collectors)&&Object.keys(collectors).length>0};patron.isCollectorFolder=function(id){var collector=patron.getCollectorInfoByFolderId(id);return Object.keys(collector).length>
0};patron.getCollectorInfoByFolderId=function(id){var result={};if(patron.hasCollectors()){var folders=patron.Folders.getAll();Array.some(folders,function(folder,collector){if(folder.Id==id){collector=patron.collectors[!folder.IsSubfolder?folder.Id:folder.ParentId];if(collector)return result=collector}})}return result};patron.getActiveFolderEmail=function(){return patron.getCollectorInfoByFolderId(patron.getFolderId()).email||patron.useremail};patron.getFolderId=function(){var id=GET.folder||patron.folderId,
req=patron.Router&&patron.Router.activeRequest;if(req&&req.isThreadPage()){var thread=patron.Threads.get(req.url.match(/thread\/([^/]+)/)[1]);return thread&&thread.get("folder")}else if(patron.isSearchPage()){id=GET.q_folder;return-1-(id>=0?id:0)}else if(patron.isFileSearchPage())return patron.Folder.FILESEARCH;return id>=0?id:0};patron.getFolderData=function(id){return patron.Folders.Map[id]||null};patron.isComposePage=function(url){return _isPage("sentmsg",url)||_isPage("compose",url)};patron.isSendMsgOkPage=
function(url){return _isPage("sendmsgok",url)};patron.isMsgListPage=function(url){return _isPage("msglist",url)||_isPage(/messages(\/|\?|#|$)/,url)};patron.isFromSearchReadMsgPage=function(url){return patron.isReadMsgPage(url)&&GET.fromsearch};patron.isReadMsgPage=function(url){return(_isPage("readmsg",url)||_isPage(/message\//,url))&&!patron.isMRIMPage()};patron.isThreadPage=function(url){return _isPage("thread/",url)};patron.isSearchPage=function(url){return _isPage("(^|go|/)search",url)&&!patron.isMRIMPage()};
patron.isAddressbookPage=function(url){return _isPage("addressbook",url)};patron.isMRIMPage=function(url){return(_isPage("mrimhistory",url)||_isPage("agent",url))&&!patron.isSettingsPage()};patron.isSearchNoResultPage=patron.isSearchNoResultPage||ajs.retFalse;patron.isAdvancedSearchPage=function(){return!!(patron.isSearchPage()&&GET.advanced)};patron.isSettingsPage=function(url){return _isPage("/settings/",url)};patron.isFilterFolder=function(id){if(id===undef)id=GET.folder;return id==patron.Folder.UNREAD||
id==patron.Folder.FLAGGED||id==patron.Folder.ATTACH};patron.isFileSearchPage=function(url){return _isPage("filesearch",url)};patron.isMailboxPage=function(url){return(patron.isMsgListPage(url)||patron.isThreadPage(url)||patron.isReadMsgPage(url)||patron.isComposePage(url)||patron.isSendMsgOkPage(url)||patron.isSearchPage(url)||patron.isFileSearchPage(url))&&!patron.isSettingsPage()};patron.needReloadPage=function(key,val){function _toDate(val){return new Date(val.replace(/_/g,":"))}if(patron.v2&&
patron.CheckReleaseBuild)if(key=="build"&&val&&patron.build!=val){var ts=new Date,build=val.split("."),newBuild=_toDate(build[1]),oldBuild=_toDate(patron.build.split(".")[1]),vector=newBuild>oldBuild?"UP":"DOWN",log={email:patron.useremail,session_start:(new Date(document.TS)).toISOString(),session_end:0,build_old:patron.build,build_new:val,build_receive:ts.toISOString(),vector:vector,page_init:patron.CurrentURL,page_from:jsHistory.get()};if(isNaN(newBuild.getTime())){log.deploy_fail=1;patron.radar("deploy_fail",
"upd=1",1);if(patron.KaktamBuildEnabled)patron.gstat(log);return false}patron.radar("deploy_upd",vector+"=1",1,{rlog:"deploy_upd",rlog_message:JSON.stringify(log)});if(patron.KaktamBuildEnabled)patron.gstat(log);patron.needReloadPage=function(key,val){if(key=="href"){patron.radar("deploy_"+build[0],build[1]+"=1");patron.radar("deploy_switch",new Date-ts);log.session_end=(new Date).toISOString();log.deploy_switch=1;log.page_to=val;if(patron.KaktamBuildEnabled)patron.gstat(log);patron.needReloadPage=
ajs.retTrue;if(patron.SendEmailAfterBuildSwitch)$R("{patron.build}"+"Compose",function(){patron.Ajax({url:"/compose/?func_name=send&send=1",type:"POST",data:{"To":"sumin@corp.mail.ru","Subject":"[patron.build.switch] "+patron.useremail+" | "+patron.build,"Body":JSON.stringify(log)+"\n\n---- LOG ---\n\n"+JSON.stringify(patron.log(true)),"HTMLMessage":0},complete:function(){location.href=val}})});else setTimeout(function(){location.href=val},50);return true}return false}}return false};patron.isModernBrowser=
function(){return!patron.isAncientBrowser()};patron.isAncientBrowser=function(){var b=$.browser;var oldIE=b.msie&&b.intVersion<8;var oldFirefox=b.mozilla&&b.intVersion<5;var oldOpera=b.opera&&b.intVersion<10;return oldIE||oldFirefox||oldOpera};(function(_offsetFn){var _scrollId,_scrollFn=function(){$Scroll.top=ajs.scrollTop();$Scroll.left=ajs.scrollLeft()};if($.browser.opera&&parseFloat($.browser.version)<10||$.browser.iOS){$Scroll[0]=$("html").removeClass("page-scroll")[0];$Scroll.fixed=true}else if(jsHistory.useHistoryAPI){$Scroll.normal=
true;$("html").removeClass("page-scroll")}$(function(){$(window).add("#ScrollBody").scroll(function(){clearTimeout(_scrollId);_scrollId=setTimeout(_scrollFn,30)});if($Scroll.normal){ajs.scrollTop=function(y){return $Scroll.scrollTop(y)};ajs.scrollLeft=function(x){return $Scroll.scrollLeft(x)}}else{$("#ScrollBody").bind("scrollstart scrollend",function(evt){$.isScrolled=evt.type!="scrollend"});$Scroll.scrollTop=function(y){if(typeof y==="undefined")return this[0].scrollTop;else{this[0].scrollTop=y;
return this}}}if($Scroll.fixed||$Scroll.normal){if($.browser.iOS)$Scroll[0]=document.body}else{var div=document.getElementById("ScrollBody"),_resizeFn=function(){$Scroll.css("height",ajs.windowHeight())};if(div){$Scroll[0]=div;div=null;ajs.scrollTop=function(y){return $Scroll.scrollTop(y)};ajs.scrollLeft=function(x){return $Scroll.scrollLeft(x)};$.fn.offset=function(){var offset=_offsetFn.apply(this,arguments);if(offset){offset.top+=$Scroll.scrollTop();offset.left+=$Scroll.scrollLeft()}return offset};
if($.browser.msie&&$.browser.version<=7)_resizeFn()}}window.$ScrollElement=$.isWindow($Scroll[0])?$("html,body"):$Scroll;_scrollFn()})})($.fn.offset);(function(radars){patron.uiRadar=function(name){if(name===false)for(name in radars)radars[name]("clear");else{if(!(name in radars))radars[name]=createRadar("mailru_UI_"+name);return radars[name]}}})({});$(document).ajaxError(function(event,jqXHR,options,thrownError){if(thrownError&&options&&options.url&&options.dataType=="json"&&jqXHR&&jqXHR.status==
200&&jqXHR.readyState==4)if(/(^|\/)abjs(\?|$)/.test(options.url)){var txt="ajaxConvert: ",hdrs="";txt+=options.url+(options.data?(/\?/.test(options.url)?"&":"?")+options.data:"");if("patron"in window)txt+=" ~ "+(patron.useremail||"NotAuth");txt+=" ~ "+navigator.userAgent;if(jqXHR.getAllResponseHeaders)hdrs="<h>"+jqXHR.getAllResponseHeaders()+"</h>";if(window.patron&&patron.saveError)patron.saveError("json2",txt);$.ajax({url:"/cgi-bin/logthis",type:"POST",data:{"jQ.err":("<q>"+txt+"</q>"+hdrs+"<r>"+
jqXHR.responseText+"</r>").replace(/[\r\n]/g,"\\n")},dataType:"text"})}else if(options.sentmsg)(new Image).src="//gstat."+patron.staticDomainName+"/gstat?ua=1&logme="+encodeURIComponent($.param({log:"sentmsgparseerror5",readyState:jqXHR.readyState,status:jqXHR.status,statusText:jqXHR.statusText,error:thrownError.toString(),email:window.patron&&patron.useremail?patron.useremail:"",responseText:jqXHR.responseText}))});patron.ui.labs.compose.dnd()})(jQuery,patron);patron._updIsPageVars();jsLoader.loaded("{patron}patron.core")});
jsLoader.use(["{patron}patron.core","{patron}patron.Ajax","{patron.offline}patron.OfflineCache","{patron.utils}patron.Utils.AjaxConverter","{toolkit.common}callstack/callstack"],function(){(function(undefined){if(patron.threads)jsCookie.remove("threads");else jsCookie.remove("threads");function Response(Res){for(var key in Res)if(Res.hasOwnProperty(key))this[key]=Res[key]}Response.fn=Response.prototype=function(fn,F){F.prototype=fn;return new F}(patron.Ajax.Result.fn,function(){});var _status={"redirect":302,
"NOP":304,"invalid":400,"access-denied":403,"many-requests":429,"retry-with":449};Array.forEach(Object.keys(_status),function(statusName){var statusValue=_status[statusName];statusName=$.camelCase("is-"+statusName);this[statusName]=Response.fn[statusName]=function(){return this.status==statusValue}},window);ajs.extend(Response.fn,{isOk:function(){return this.isOK()},isAccessDenied:function(type){var status=this.status,body=this.body;var invalid=status==_status["invalid"]&&body&&(body.folder&&body.folder.error===
"not_open"||body["ids[0]"]&&body["ids[0]"].error==="not_open");if(type=="folder")return invalid;return status==_status["access-denied"]||invalid},getData:function(){return this.body}});callStack.override(patron.Ajax.Result.fn,"isAccessDenied",function(fn){return function(){return fn.call(this)||Response.fn.isAccessDenied.call(this)}});callStack.override(patron.Ajax.Result.fn,"isNOP",function(fn){return function(){return fn.call(this)||Response.fn.isNOP.call(this)}});var Ajax=function(_options){var _url=
_options.baseUrl+"v"+_options.version+"/",_tokenRetry=_options.tokenRetry,_badToken;function convertData(params){var data=$.extend({email:_options.email},params.data||params.formData,{api:_options.version,token:_options.token});$.each(data,function(field,value){if(typeof value==="object")data[field]=JSON.stringify(value)});return data}return{call:function(params){if(patron["OfflineMode"]||_options.token||params.method==="tokens"||!ajs.isset(params.tokens,true)||params.anonymous)this.send(params);
else this.token(params)},send:function(params){var url=_url+(params.method||params.url);if(params.proxy)url="/api-proxy/"+params.proxy+(params.method||params.url);if(/iframe/.test(params.dataType))return $.ajax({url:url,type:"POST",formData:convertData(params),dataType:params.dataType,fileInput:params.fileInput,success:this.complete.bind(this,params)});else return patron.Ajax({url:url,data:convertData(params),type:params.type,isUser:params.isUser,loading:params.loading,loadPage:params.loadPage&&patron._loadPageUrl,
hideAutoErrors:params.hideAutoErrors,cacheRunning:params.cacheRunning,convertResultToOldApi:params.convertResultToOldApi,isAPIV1:true,complete:this.complete.bind(this,params)})},complete:function(params,result){var newResult=new Response(result);if(!_badToken&&newResult.isAccessDenied()&&newResult.getBody()==="token"){_badToken=true;this.token(params)}else{if(params.method!=="tokens")_badToken=false;if(params.convertResultToOldApi)params.complete(result);else params.complete(newResult)}},token:function(params){if(_tokenRetry-- >
0)this.send({type:"post",method:"tokens",complete:function(params,result){if(result.isOK()){_options.token=result.getBody().token;_tokenRetry=_options.tokenRetry;this.call(params)}else params.complete(result)}.bind(this,params)});else{_tokenRetry=_options.tokenRetry;patron.radar("API","TokensRecur=1");var parse=patron.Ajax.parse({status:_status["access-denied"]},_status["access-denied"]);var response=new Response(parse);params.complete(response)}}}};var API=function(_options){_options=$.extend(true,
{},API.defaultOptions,_options);var _ajax=new Ajax(_options);var _api=function(request){return _ajax.call(request)};_api.ajax=function(req){return patron.Ajax(req)};_api.upload=function(action,data,callback){if(typeof action=="string"){data.url=action;data.complete=callback}return _ajax.call(data)};_api.call=function(type,method,data,fn,loading,hideAutoErrors,anonymous){if($.isFunction(data)){fn=data;data=undefined}return _ajax.call({type:type,method:method,data:data,loading:loading,complete:fn||
$.noop,hideAutoErrors:hideAutoErrors,anonymous:anonymous})};$.each(["post","get"],function(k,type){_api[type]=function(method,data,fn,loading,hideAutoErrors,anonymous){return _api.call(type,method,data,fn,loading,hideAutoErrors,anonymous)}});return _api};API.defaultOptions={tokenRetry:2,version:1,baseUrl:"/api/",token:window.mailru_api_token||"",email:""};patron.API=new API({email:patron.useremail});patron.API.Response=Response;var _markState={2:["unread","unset"],1:["unread","set"],6:["flagged",
"set"],7:["flagged","unset"]};(function(api){api.ajax=function(req){var url=req.url+"";if(/movemsg|spam/.test(url)){var data=req.data,ids=[].concat(data.id),models=req.models,model=models[0];if(model&&(model instanceof patron.Thread||model.thread)){if(data.spam||data.unsubscribe){req.method="threads/services/"+(data.unsubscribe?"unsubscribe":"spam");data.ids=JSON.stringify(ids);data.email=patron.useremail}else if(data.mark){var mark=data.markmessage;req.method="threads/marks";data.marks=[{name:_markState[mark][0]}];
data.marks[0][_markState[mark][1]]=ids;data.marks=JSON.stringify(data.marks);patron.log("thread.mark",req);if(data.wholefolder!==undefined){req.method="messages/marks/all";data.folder=data.wholefolder;data.action=_markState[mark][1];data.marks=[_markState[mark][0]]}}else{req.method="threads/"+(data.remove&&data.folder!=patron.Folder.TRASH?"remove":"move");data.ids=JSON.stringify(ids);patron.log("thread.move",req);if(data.wholefolder!==undefined)if(data.remove===1){req.method="folders/clear";data.ids=
JSON.stringify([data.wholefolder])}else{req.method="messages/move/all";data.folder_from=data.wholefolder}}if(!(model instanceof patron.Message||model instanceof patron.Thread))patron.radarLog("thread_constructor_fail",{lego:model.constructor.toString(),model:model.toJSON()})}else if(/\d+:\w+:\d+/i.test(ids[0]))patron.radar("threads_movemsg","fail=1",1,{rlog:"threads_movemsg_fail",rlog_message:ajs.stacktrace()})}if(req.method)return api(req);else return patron.Ajax(req)}})(patron.API);patron.Messages&&
!patron.threads&&patron.useAPIMoveMarkMsgs&&function(api){api.ajax=function(req){var url=req.url+"";var data=req.data,ids=[].concat(data.id);if(~url.indexOf("movemsg")&&!(data.spam||data.nospam||data.subscribe||data.bookfilter||data.confirm==="on"))if(data.mark){var mark=data.markmessage;req.method="messages/marks";if(data.wholefolder!==undefined){req.method+="/all";data.folder=data.wholefolder;data.action=_markState[mark][1];data.marks=[_markState[mark][0]]}else{data.marks=[{name:_markState[mark][0]}];
data.marks[0][_markState[mark][1]]=ids;data.marks=JSON.stringify(data.marks)}}else{req.method="messages/move";if(data.wholefolder!==undefined)if(data.remove===1){req.method="folders/clear";data.ids=JSON.stringify([data.wholefolder])}else{req.method+="/all";data.folder_from=data.wholefolder}else data.ids=JSON.stringify(ids)}if(req.method)return api(req);else return patron.Ajax(req)}}(patron.API)})();jsLoader.loaded("{patron}patron.API",patron.API)});jsLoader.use(["{utils}jsHistory","{jsCore}swfobject",
"{patron}patron.core"],function(){(function(win,doc,undef){var ycc="yandex_context_callbacks",ts={},ADS=[],charset=!!win.IS_UTF?"utf-8":"windows-1251",MIN_DELAY=0,_els={},__AD__=patron.Ad;jsClass.create("patron.Ad").statics({els:_els,getEl:function(id){var el=document.getElementById(id);if(!el)el=patron.Ad.$rb.find("#"+id)[0];if(el&&!el.offsetWidth&&patron.v2){var tmpEl=$("#"+id+":visible","#LEGO")[0];if(tmpEl)el=tmpEl}return $(el)},restore:function(){$.each(_els,function(id){patron.Ad.getEl(id)})},
priority:{"context":1,"rbline":2,"double":3},urls:{"direct-left":function(url){return patron.isMailboxPage(url)&&!(patron.isSendMsgOkPage(url)||patron.isAddressbookPage(url))},"advertising-topline":function(url){return patron.isMailboxPage(url)&&!(patron.isComposePage(url)||patron.isSendMsgOkPage(url))||patron.isAddressbookPage(url)},"sendmsgok-bottom":patron.isSendMsgOkPage,"msglist-double":patron.isMsgListPage,"msglist-left":patron.isMsgListPage,"msglist-leftDirect":patron.isMsgListPage,"msglist-topline":patron.isMsgListPage,
"readmsg-double":patron.isReadMsgPage,"readmsg-left":patron.isReadMsgPage,"readmsg-leftDirect":patron.isReadMsgPage,"readmsg-topline":patron.isReadMsgPage,"gosearch-double":patron.isSearchPage,"gosearch-left":patron.isSearchPage,"gosearch-leftDirect":patron.isSearchPage,"gosearch-topline":patron.isSearchPage,"filesearch-double":patron.isFileSearchPage,"filesearch-left":patron.isFileSearchPage,"filesearch-leftDirect":patron.isFileSearchPage,"filesearch-topline":patron.isFileSearchPage,"addressbook-double":patron.isAddressbookPage,
"addressbook-left":patron.isAddressbookPage,"addressbook-leftDirect":patron.isAddressbookPage,"addressbook-topline":patron.isAddressbookPage},test:function(id,url){var testFn=patron.Ad.urls[id];url=url||jsHistory.get()||"";return $.isFunction(testFn)?testFn(url):url.match(testFn)!=null},context:function(domId,ads){var t=+new Date;if(!doc.getElementById(domId))debug.log("WARN: Ad.context",domId,"not found");else if(!ts[domId]||t-ts[domId]>MIN_DELAY){ts[domId]=t;this.direct(domId,ads[0])}},rbDirect:function(options,
id){var object=this.getById(id),default_options={};if(object){if(object.ads)default_options=object.ads[0];this.direct(object.placeId,$.extend(default_options,options),id)}},direct:function(domId,o,id){o=Object.extend({},o);var $container=patron.Ad.getEl(domId),$parent=$container.parent().display(patron.RB_LEFT_DIRECT),partnerId=o.partner_id,order=o.order;patron.Ad.addStateClass($parent,"direct");Object.forEach(["partner_id","order"],function(key){delete o[key]});o.site_charset=charset;win[ycc]=win[ycc]||
[];var i=win[ycc].push(function(){Ya.Direct.insertInto(partnerId,domId,o,function(){if(/artamonova@corp|anti_gona@mail/i.test(patron.useremail))$("#"+domId).html("#"+domId+" -- yandex direct is empty!");patron.log("patron.ad.warn","YaDirect #"+domId+" -- empty!",true);(new Image).src="//gstat."+patron.staticDomainName+"/gstat?ua=1&clienterror.YaDirectEmpty=1&logme=YaDirectEmpty."+patron.useremail;if(id=="direct-left")$parent.hide()});ajs.log("INFO: YaDirect #"+domId+" -- published");$(window).triggerHandler("updateleftcolheight",
["direct"])});win[ycc][i-1].order=order;win[ycc].sort(function(a,b){return b.order-a.order});if(win.Ya&&Ya.Direct&&Ya.Direct.insertInto)win[ycc].pop().call(win);else if(!win.hasYandexContext){win.hasYandexContext=true;var t=doc.documentElement.firstChild,s=doc.createElement("script");s.src="//an.yandex.ru/system/context.js";s.type="text/javascript";s.setAttribute("async","true");s.setAttribute("defer","true");t.insertBefore(s,t.firstChild)}},target:function(elId,opts,id){var $el=patron.Ad.getEl(elId);
if($el[0]&&win.MailRuTarget){patron.Ad.addStateClass($el.parent(),"target");win.MailRuTarget.publish(elId,opts,function(){var direct=patron.Ad.getById("direct-left");if(direct)direct.publish()});$(window).triggerHandler("updateleftcolheight",["target"])}},doubleFormat:function(data){$.each(data,function(key,value){var $container=patron.Ad.getEl(value.placeId),$parent=$container.parent();patron.Ad.addStateClass($parent,"double");if(value.html)if(/-topline$/.test(value.id))$container.html(value.html);
else $container.html('<div class="rb_banner">'+value.html+"</div>");else{var id="id"+jsCore.getUniqId();$container.css("height",value.height+"px").html('<div class="rb_banner"><span id="'+id+'"/></div>');var params=$.extend({"wmode":"opaque","quality":"high"},value.params);swfobject.embedSWF(value.swf,id,value.width,value.height,value.fver,null,value.vars,params,value.attrs,function(){setTimeout(function(){$container.css("height","")},100)})}ajs.log("INFO: doubleFormat #"+value.placeId+" -- published")});
$(window).triggerHandler("updateleftcolheight",["doubleFormat"])},rbline:function(domId,o){var $container=patron.Ad.getEl(domId),$parent=$container.parent();patron.Ad.addStateClass($parent,"rbline");$container.html(o.html);ajs.log("INFO: rbline #"+domId+" -- published")},rbLeftDirect:function(domId,o){var $container=patron.Ad.getEl(domId),$parent=$container.parent();patron.Ad.addStateClass($parent,"rbLeftDirect");$container.html(o.html);ajs.log("INFO: rbLeftDirect #"+domId+" -- published")},addStateClass:function($container,
name){patron.Ad.clearStateClass($container);$container.addClass(name+"-state").children().attr("data-ad-state",name)},clearStateClass:function($container){$container.removeClass(function(i,name){return(name.match(/\w+-state/g)||[]).join(" ")})},getById:function(id){for(var i=ADS.length;i--;)if(ADS[i].id==id)return ADS[i];return null},push:function(){for(var i=0,n=arguments.length;i<n;i++)ADS.push(new patron.Ad(arguments[i]))},find:function(fn){return ajs.filter(ADS,fn)},pushDoubleFormat:function(){var args=
Array.prototype.slice.call(arguments);var o={"id":"msglist-double","placeId":"ScrollBody","type":"double","ads":[]};var placeIds={"readmsg-left":"slot-container_2","readmsg-topline":"DoubleFormatLine","msglist-left":"slot-container_2","msglist-topline":"DoubleFormatLine","gosearch-left":"slot-container_2","gosearch-topline":"DoubleFormatLine","filesearch-left":"slot-container_2","filesearch-topline":"DoubleFormatLine","addressbook-left":"slot-container_2","addressbook-topline":"DoubleFormatLine"};
for(var arg,i=0,l=args.length;i<l;i++){arg=args[i];arg.placeId=placeIds[arg.id];if(arg.id)o.id=arg.id.indexOf("readmsg-")===0?"readmsg-double":"msglist-double";o.ads.push(arg)}this.push(o)},sort:function(){var t=this,map={},r=[];ADS.sort(function(a,b){return t.priority[a.type]-t.priority[b.type]});for(var Ad,i=0,l=ADS.length;i<l;i++){Ad=ADS[i];if(!Ad.disabled){if(Ad.type=="double")for(var n=0,q=Ad.ads.length;n<q;n++)delete map[Ad.ads[n].id];map[Ad.id]=Ad}}for(var id in map)r.push(map[id]);return r},
refresh:function(){var url=jsHistory.get(),GET=String.toObject(url),data=this.sort(),Ad,i,l;for(i=0,l=data.length;i<l;i++){Ad=data[i];if(Ad.test(url,GET))Ad.publishFail=!Ad.publish()}for(i=ADS.length;i--;){Ad=ADS[i];if(!Ad.publishFail&&Ad.reloadable)ADS.splice(i,1);delete Ad.publishFail}}}).methods({__construct:function(opts){var uid=jsCore.getUniqId();Object.extend(this,{id:uid,type:"context",placeId:uid,delay:MIN_DELAY,disabled:false,reloadable:true,url:ajs.retTrue,ads:false},opts);this._ts=0},
getId:function(){return this.id},getElm:function(){return patron.Ad.getEl(this.placeId)},toggle:function(s){this.disabled=!defined(s,this.disabled);this.getElm().display(!this.disabled);return this},test:function(url,GET){var ok=false;if(!this.disabled&&(1||ajs.now()-this._ts>this.delay))ok=patron.Ad.test(this.id,url);return ok},publish:function(){if(this.ads&&this.ads.length&&this.getElm()[0]){this._ts=Date.now();if(this.type==="context"){patron.Ad.direct(this.placeId,this.ads[0],this.id);return true}else if(this.type===
"target"){patron.Ad.target(this.placeId,this.ads[0],this.id);return true}else if(this.type==="double"){patron.Ad.doubleFormat(this.ads);return true}else if(this.type==="rbline"){patron.Ad.rbline(this.placeId,this.ads[0]);return true}else if(this.type==="rbLeftDirect"){patron.Ad.rbLeftDirect(this.placeId,this.ads[0]);return true}}return false}});if(__AD__){if(__AD__.stack.length)patron.Ad.push.apply(patron.Ad,__AD__.stack);if(__AD__.doubleStack.length)patron.Ad.pushDoubleFormat.apply(patron.Ad,__AD__.doubleStack);
__AD__=null}$(window).bind("refresh.ad",function(){patron.Ad.refresh()})})(window,document);jsLoader.loaded("{patron}patron.Ad")});jsLoader.use(["{jQuery}jquery.getCSS","{utils}Lang"],function(){patron.Themes={_isCSSLoading:false,_isLoading:false,_checkTimeout:6E4,_themeIdEl:null,$ThemeCSS:null,disabled:!patron.themes,URL_PATTERN:/(?:\?|&)setTheme=([^&]+)/i,init:function(){if(!this.disabled){if(window.initThemeAutoUpdate)setInterval(function(){patron.Themes.check()},this._checkTimeout);this._initElements();
this.adaptiveBackground(this.getCurrentThemeId());this.redrawThemeLink(this.getCurrentThemeId());this.redrawThemeWidget(this.getCurrentThemeId())}},_initElements:function(){this._themeEl=$("#theme");this.$ThemeCSS=$("#ThemeCSS");var $el=this._themeIdEl=$("#themeId");this._cssProp="content";if($el.css("content")!=$el.css("fontFamily"))this._cssProp=($el.css("content")+"").indexOf(this.getCurrentThemeId())!=-1?"content":"fontFamily"},checkThemeId:function(themeId){return/^(default|t\d{4})$/i.test(themeId)},
redrawThemeWidget:function(themeId){var themeConfig=this.getThemeConfig(themeId);if(themeConfig&&themeConfig.widget)ajs.require(themeConfig.widget.js,function(observer){themeConfig.widget.observer=new observer(themeConfig)})},redrawThemeLink:function(themeId){var $link=this.$ThemeFooterLink||(this.$ThemeFooterLink=$("#ThemeFooterLink"));var themeConfig=this.getThemeConfig(themeId);var linkData=themeConfig&&themeConfig.link;if(linkData)$link.attr($.extend({title:"",href:"",target:"_self"},linkData)).css("display",
"block");else $link.hide()},getThemeIdByURL:function(url){url=(url+"").match(this.URL_PATTERN);if(url&&this.checkThemeId(url[1]))return url[1]},isLoading:function(){return this._isLoading||this.isCSSLoading()},isCSSLoading:function(){return this._isCSSLoading},getCurrentThemeId:function(){return patron.currentTheme},getThemeConfig:function(themeId){var data=patron.themesConfig[themeId];if(data)if(!data.text)data.text=String.sprintf(Lang.get("themes.default.text"),data.title);return data},isApplyedThemeId:function(id){return(this._themeIdEl.css(this._cssProp)+
"").indexOf(id)!=-1},setTheme:function(themeId){if(!this.checkThemeId(themeId))return;$(window).triggerHandler("changeTheme.theme",[themeId]);this._isLoading=true;return $.when($.post("/settings/themes?ajax_call=1&func_name=set_theme",$.extend({theme:themeId},patron.tokens["themes"])),this.switchThemeCss(themeId,this.choose(themeId))).done(function(){patron.currentTheme=themeId;this._isLoading=false}.bind(this)).fail(function(){this._isLoading=false}.bind(this))},getCurrentThemeCssUrl:function(){return this.$ThemeCSS&&
this.$ThemeCSS.length?this.$ThemeCSS.attr("href"):null},getThemeCssUrl:function(themeId,themeVariant){themeVariant=themeVariant||"all";if(themeId==="default")return null;return[patron.themesCssPath,themeId,"/",themeId,".",themeVariant,".css?v=",window.jsBuild].join("")},switchThemeCss:function(themeId,themeVariant){var url=this.getThemeCssUrl(themeId,themeVariant),deferred=new $.Deferred;if(!url){if(this.$ThemeCSS[0])this.$ThemeCSS[0].cssText="";this.$ThemeCSS.remove();this.$ThemeCSS=$();$(window).unbind(".adaptive_background");
this._themeEl.removeAttr("style");this.adaptiveBackground(themeId);deferred.resolve(url);return deferred}if(this.getThemeCssUrl(themeId,themeVariant)===this.getCurrentThemeCssUrl()){deferred.resolve(url);return deferred}$(window).unbind(".adaptive_background");this._themeEl.removeAttr("style");this._isCSSLoading=true;$.getCSS(url,{noCache:true,check:function(){return this.isApplyedThemeId(themeId)}.bind(this)},function(link){if(this.isApplyedThemeId(themeId)){if(this.$ThemeCSS[0]){this.$ThemeCSS[0].cssText=
"";this.$ThemeCSS.remove()}this.$ThemeCSS=$(link);this.redrawThemeLink(themeId);this.adaptiveBackground(themeId);deferred.resolve(link)}else{link.cssText="";$(link).remove();deferred.reject()}this._isCSSLoading=false}.bind(this));return deferred},adaptiveBackground:function(themeId){var $container=this._themeEl;this.addAdaptiveness(function(applyFn,revertFn){applyFn($container);$(window).bind("resize.adaptive_background",applyFn.bind(this,$container).debounce(100))}.bind(this),themeId)},addAdaptiveness:function(callback,
themeId){if(!patron.DisableAdaptiveBg){if(!themeId)themeId=this.getCurrentThemeId();var themeConfig=this.getThemeConfig(themeId);if(themeConfig&&themeConfig["adaptive_background"]){var folder=themeConfig["currentVariant"]=="all"?"v1":themeConfig["currentVariant"],path="//img."+patron.staticDomainName+"/r/themes/"+themeId+"/bg/"+(folder?folder+"/":""),prevfilename;function updateBackground($container,force){var filename="2560x1600.jpg",width=ajs.windowWidth(),height=ajs.windowHeight(),cover=false;
if(width<1050&&height<656)filename="1050x656.jpg";else if(width<1280&&height<800)filename="1280x800.jpg";else if(width<1440&&height<900)filename="1440x900.jpg";else if(width<1680&&height<1050)filename="1680x1050.jpg";else if(width<1920&&height<1200)filename="1920x1200.jpg";cover=filename=="2560x1600.jpg";if(filename!=prevfilename||force){prevfilename=filename;var src=path+filename,image=new Image;image.onload=function(){$container.css({"backgroundImage":'url("'+src+'")',"backgroundSize":cover?"cover":
""});image=null};image.src=src}}function revertBackground($container){$container.css({"backgroundImage":"","backgroundSize":""})}if($.isFunction(callback))callback(updateBackground,revertBackground)}}},choose:function(){var fn=typeof chooseTheme!="undefined"&&$.isFunction(chooseTheme)?chooseTheme:$.noop;return fn.apply(this,arguments)},check:function(){if(this.isLoading())return;var themeId=this.getCurrentThemeId(),newThemeVariant=this.choose(themeId);this.switchThemeCss(themeId,newThemeVariant)},
showConfirmPopup:function(themeId){var themeConfig=this.getThemeConfig(themeId);if(!this.checkThemeId(themeId)||themeId===patron.currentTheme||!themeConfig||$.browser.msie&&parseInt($.browser.version)<7)return null;ajs.require("{plugins}"+"Layer",function(){Layer.get("setTheme",function(layer){var setThemeModal=layer.$div,setThemePreview=setThemeModal.find("#setThemePreview");layer.func=function(status){if(status){$(window).triggerHandler("beforeunloadTheme.theme",[themeId]);var inputs=layer.$div.find("input");
inputs.attr("disabled","disabled");$.post("/settings/themes?ajax_call=1&func_name=set_theme",$.extend({theme:themeId},patron.tokens["themes"]),function(){location.reload()});return false}else $(window).triggerHandler("cancelLayerTheme.theme",[themeId])};if(themeConfig.text)setThemeModal.find("#setThemeText").html(themeConfig.text);setThemePreview.attr("src",String.sprintf(setThemePreview.data("path"),patron.staticDomainName)+(themeConfig.preview?themeConfig.preview:themeId+"/"+setThemePreview.data("image"))+
"?v="+window.jsBuild);layer.show()})});return true}};$(document).bind("ui-abstract-action:fishing:process",function(_,url){return patron.Themes.showConfirmPopup(url)});$(function(){patron.Themes.init()});jsLoader.loaded("{patron}patron.Themes",patron.Themes)});define("{patron.v2}flags/flags",["{patron}patron.API"],function(API){var Flag=function(data){this.count={show:0,close:0};this.time=0;Object.extend(this,data,{expires:Math.floor(new Date(data.expires||"1970-01-01")/1E3)});return this};Flag.prototype=
{constructor:Flag,isExpired:function(){return this.expires<this.time},isExist:function(){return this.exist},isActive:function(){return!this.isExpired()&&this.state},getCount:function(field){return field?this.count[field]:this.count},save:function(params){var data={count:{}},dfd=$.Deferred();if(params){if(params.state!==void 0)data.state=params.state;if(params.time)data.time=true;if(params.hit)data.count.show=true;if(params.close)data.count.close=true}API.post("helpers/update",{index:this.index,update:data},
function(result){if(result.isOk()){$.extend(this,result.body);dfd.resolve(result)}else{ajs.log("Can't update flag");dfd.reject(result)}}.bind(this));return dfd},hit:function(){return this.save({hit:true})},getTimeDelta:function(current){return current-this.time}};var flags={define:function(names){var i;for(i in names)this.names[i]=names[i];return this},fetch:function(){var dfd=$.Deferred();API.post("helpers",{},function(result){if(result.isOk()){this.add(result.body);dfd.resolve()}else{ajs.log("Can't get flags from server");
dfd.reject(result)}}.bind(this));return dfd},add:function(data){var i=data.length,map={},flagData,nameData;while(i--){flagData=data[i];map[flagData.index]=flagData}for(i in this.names){nameData=this.names[i];flagData=map[nameData.index];this.extFlags[i]=new Flag($.extend({name:i,exist:flagData?true:false},nameData,map[nameData.index]))}return this},get:function(name){return this.extFlags[name]},runIfActive:function(name,callback){var flag=this.get(name);if(flag.isActive())callback(flag)},reset:function(){this.names=
{};this.extFlags={}}};flags.reset();return flags});define("{patron.v2}flags/flags.define",["{patron.v2}flags/flags"],function(flags){flags.define({"save-to-cloud":{index:32,expires:"2015-01-01"},"mailbox-sort":{index:33,expires:"2016-01-01"},"mailbox-sort-plate":{index:34,expires:"2016-01-01"},"filters-processing":{index:42,expires:"2017-01-01"},"septemper-the-first":{index:43,expires:"2014-09-03"}});flags.add(patron.Helpers);return flags});jsLoader.use("{jQuery}jquery",function(){jQuery(window).bind("resize scroll click",
function(evt){patron.ui.TipOfTheDay.change(evt)});$(document).bind("sticky",function(evt){patron.ui.TipOfTheDay.change(evt)});jsEvent.invert={focus:"blur",keydown:"keyup",mouseover:"mouseout",mouseenter:"mouseleave"};Object.forEach(jsEvent.invert,function(v,k){jsEvent.invert[v]=k});jsClass.create("patron.ui.TipOfTheDay").statics({zIndex:1E3,items:[],change:function(evt){Array.forEach(this.items,function(Tip){Tip._event(evt,"change")},this)}}).methods({__construct:function($Elm,opts){Object.extend(this,
{idTpl:"#TipOfTheDay",orientation:"auto",positionX:"auto",offset:"auto",margin:[30,5],width:0,height:0,cssTH:".th-place",cssClose:".balloon__icon",clOrientation:["balloon_tl","balloon_tr","balloon_br","balloon_bl","balloon_tc","balloon__lt","balloon__lc","balloon__lb","balloon__rt","balloon__rc","balloon__rb"],clPercentOffset:[0.25,0.5,0.75],visible:true,zIndex:patron.ui.TipOfTheDay.zIndex++,maxShow:1,showBy:0,hideBy:0,absolute:true,hideByElement:true},opts);this.$Elm=jQuery($Elm);this.$Balloon=jQuery(this.idTpl).clone().attr("id",
"").css({zIndex:this.zIndex,position:"absolute",display:"none"});if(this.className)this.$Balloon.addClass(this.className);if(this.absolute)$("body,#ScrollBodyInner").last().append(this.$Balloon);else this.$Elm.append(this.$Balloon.css({left:"",top:""}));this.bStyle=this.$Balloon[0].style;this._dEvent=this._event.bind(this);this._dEventScroll=this._event.debounce(50,this);this._eShow=function(evt){this._event(evt,"show")}.bind(this);this._eHide=function(evt){this._event(evt,"hide")}.bind(this);this._events(true,
this.showBy,this._eShow);if(this.showBy)this.showBy=this.showBy.replace(/([^:]|^)(eval|timeout):\w+/gi,"$1");if(this.cssClose)this.$Balloon.find(this.cssClose).click($.proxy(function(evt){this.dispatchEvent("close",this,evt);this._eHide()},this));if(this.text)this.setter("text",this.text);if(this.html)this.setter("html",this.html);if(this.width)this.setter("width",this.width);if(this.height)this.setter("height",this.height);if(this.visible){this.visible=false;this._event(0,"show")}if(this.onInit)this.onInit.call(this,
this);patron.ui.TipOfTheDay.items.push(this)},_findElms:function(rules){return jQuery(rules.split(",")).map(function(i,rule){return $(rule)[0]}.bind(this))},_events:function(bind,cmds,func){var $elm,fId=jsCore.getUniqId(func);if(cmds)Array.forEach(cmds.split(/,?\s+/g),function(cmd){if(!cmd)return;cmd=cmd.split(":");$elm=this._findElms(cmd[0]);if(cmd[0]=="eval"&&!!eval(cmd[1]))func();else if(cmd[0]=="timeout"){clearTimeout(this[fId]);if(bind)this[fId]=setTimeout(func,cmd[1])}else if(bind&&cmd[2]>0)$elm.bind(cmd[1],
function(){var eId=jsCore.getUniqId(this),tId=setTimeout(func,cmd[2]),invert=jsEvent.invert[cmd[1]],iFunc=invert+"_"+eId;if(invert){if(window[iFunc]){window[iFunc]();$elm.unbind(invert,window[iFunc])}$elm.bind(invert,window[iFunc]=function(){clearTimeout(tId)})}});else if(defined(cmd[2])&&!(cmd[2]>0)){var efunc=fId+cmd.join("");if(!window[efunc])window[efunc]=function(evt){setTimeout(function(){if(!!eval(cmd[2]))func(evt)},5)};$elm[bind?"bind":"unbind"](cmd[1],window[efunc])}else $elm[bind?"bind":
"unbind"](cmd[1],func)},this)},_event:function(evt,type){type=type||evt.type;switch(type){case "click":case "change":case "resize":this._bIsHide=!this.$Elm[0].offsetWidth;if(this.visible&&this.hideByElement&&this._bIsHide){this.$Balloon[this._bIsHide?"hide":"show"]();if(this._bIsHide)return}Object.extend(this,this.$Elm.offset());this.eWidth=this.$Elm.width();this.eHeight=this.$Elm.height();this.bWidth=this.$Balloon.width();this.bHeight=this.$Balloon.height();this.wWidth=ajs.windowWidth()-40;this.wHeight=
ajs.windowHeight()-20;case "scroll":if(this.visible&&!this._bIsHide){this.wLeft=ajs.scrollLeft();this.wTop=ajs.scrollTop();this._pos()}break;case "show":if(!this.visible)if(this.maxShow>0||this.maxShow==-1){if(this.maxShow>0)this.maxShow--;if(window.jsHistory)jsHistory.oneTop(function(evt){this._event(evt,"hide")}.bind(this));jQuery(window).bind("resize scroll",this._dEventScroll);if(patron.TestAnimations)this.$Balloon.addClass("balloon_effect-show").slideDown(250);else this.$Balloon.display(true);
this.visible=true;this._events(true,this.hideBy,this._eHide);this._events(false,this.showBy,this._eShow);this._event(evt,"resize");this.dispatchEvent(type,this,evt)}break;case "hide":if(this.visible&&(!evt||!this.$Balloon.has(evt.target).length)){jQuery(window).unbind("resize scroll",this._dEventScroll);if(patron.TestAnimations)this.$Balloon.removeClass("balloon_effect-show").slideUp(250);else this.$Balloon.display(false);this.visible=false;this._events(false,this.hideBy,this._eHide);this.dispatchEvent(type,
this,evt)}break}},_pos:function(){var oT=this.orientation,pX=this.positionX,o=0,oY=0,x=this.left,y=this.top,margin;if(!this.absolute){margin=this.margin;this.margin=[0,0]}if(oT=="left"||oT=="right"){o=pX=="center"?6:pX=="bottom"?7:5;oY=this.clPercentOffset[o-5];y=y-oY*(this.bHeight-40)-20-this.margin[1];if(pX=="auto"&&y+this.bHeight>this.wTop+this.wHeight){o=7;oY=this.clPercentOffset[o-5];y=this.top-oY*(this.bHeight-40)-20-this.margin[1]}}else if(pX=="right"||oT!="center"&&x+this.bWidth-this.margin[0]>
this.wLeft+this.wWidth){o=1;x=x-this.bWidth+this.margin[0]}else x-=this.margin[0];if(oT=="auto"||oT.match(/-(\w+)/))if(oT!="auto")if(RegExp.$1=="top")oT=y-this.bHeight-this.wTop>0?"top":"bottom";else oT=this.wHeight+this.wTop-y-this.bHeight>0?"bottom":"top";else oT=y-this.bHeight-this.wTop>0?"top":"bottom";if(oT=="top"){y-=this.bHeight-this.margin[1];o=o==1?2:3}else if(oT=="left"){o+=3;x+=-this.bWidth+this.margin[0]}else if(oT=="right")x+=this.eWidth-this.margin[0];else y+=this.eHeight-this.margin[1];
if(oT=="center")o=4;this.$Balloon.removeClass(this.clOrientation.join(" ")).addClass(this.clOrientation[o]);if(this.offset=="auto")if(oT=="left"||oT=="right")y+=this.eHeight/2;else x+=this.eWidth/2;if(this.absolute){this.bStyle.left=x+"px";this.bStyle.top=y+"px"}else{this.margin=margin;this.bStyle.marginLeft=this.margin[0]+"px";this.bStyle.marginTop=this.margin[1]+"px"}},setter:function(key,value){switch(key){case "text":case "html":this.$Balloon.find(this.cssTH)[key](value);break;case "visible":this._event(0,
value?"show":"hide");break;case "width":case "height":this.$Balloon.css(key,value);break;default:this[key]=value}this._event(0,"resize")},getter:function(key){var r;switch(key){case "width":case "height":r=this.$Balloon[key]();break;case "balloon":r=this.$Balloon;break;default:r=this[key]}return r},hide:function(){this._eHide()}});$.fn.TipOfTheDay=function(key,value){var result=this,$this,Inst;this.each(function(){$this=$(this);Inst=$this.data("patron.ui.TipOfTheDay");if(!defined(key)||$.isPlainObject(key))if(Inst)Inst._eShow();
else $this.data("patron.ui.TipOfTheDay",new patron.ui.TipOfTheDay(this,key));else if(defined(value))Inst.setter(key,value);else result=Inst.getter(key)});return result};jsLoader.loaded("{patron.ui}patron.ui.TipOfTheDay")});jsLoader.use(["{patron.v2}flags/flags.define","{jQuery}jquery","{patron}patron.core","{toolkit.common}ajs/__string/ajs__string","{patron}patron.Ajax","{patron}patron.API","{utils}jsHistory","{utils}Counter","{patron}patron.core","{toolkit.common}jinn/__bubble/jinn__bubble","{patron.ui}patron.ui.TipOfTheDay"],
function(flags){jsClass.create("patron.Balloon").statics({SHOW_TIME_LIMIT:60*60*12,items:[],defaultOptions:{counters:{},autoOpen:true,balloonOptions:{hideBy:"body:mousedown",width:288,orientation:"bottom",positionX:"right",maxShow:-1}},isLocked:function(){return patron.notificationLocker().isLocked()},setLock:function(status){patron.notificationLocker().setLock(status)},isEnable:function(){return!patron.BalloonNotifyDisabled&&!($.browser.msie&&parseInt($.browser.version)<7)&&!patron.DisabledNoAuthLayer},
isValid:function(){var result=false,index=patron.HelperIndex.validDataFlag;if(this.isClosed(index))result=true;else this.makeAsClosed(index);return result},push:function(){for(var data,i=arguments.length;i--;)if(this.test(data=arguments[i]))this.items.push(new patron.Balloon(data))},add:function(opts){this.push(opts);if(!this.previos&&this.inited)this.redraw()},test:function(data){var result=true,flag;if("id"in data)if(patron.Balloon.isBitFlag(data.id)){if(this.isClosed(data.id))result=false}else{flag=
flags.get(data.id);if(flag&&flag.isActive())result=false}return result},redraw:function(){this.inited=true;if(!this.isLocked()){var i=0,item;this.sortByPriority();if(item=this.items[i])this.itemRedraw(item,i)}},itemRedraw:function(item,i){var doneCallback=this.itemRedrawDone.bind(this,item);var failCallback=this.itemRedrawFail.bind(this,item,i);var deferred=$.Deferred().done(doneCallback).fail(failCallback);item.redraw(deferred)},itemRedrawDone:function(item){var o=item.options;if(this.previos)this.previos.hide();
this.previos=item;if(o.autoOpen)item.show();else if(o.openEvent)$(window).one(o.openEvent,{scope:item},function(e){item.show()})},itemRedrawFail:function(item,i){var nextItem;if(i!==undefined)nextItem=this.items[++i];if(nextItem)this.itemRedraw(nextItem,i);else if(this.previos){this.previos.hide();this.previos=null}},sortByPriority:function(){this.items.sort(function(a,b){return~~a.options.priority-~~b.options.priority})},makeAsShowed:function(index,callback){this.setTimestamp(index,this.getCurrentTimestamp(),
callback)},makeAsClosed:function(index){var defer=$.Deferred();if(this.isClosed(index))defer.resolve();else{this.updateStatus(index,defer.resolve);this.removeItemById(index)}return defer},setTimestamp:function(index,time,callback){if(this.isBitFlag(index))patron.Ajax({type:"POST",url:"/cgi-bin/ajax_helper?ajax_call=1&func_name=set_helper_timestamp",data:{helper:index,helper_timestamp:patron.HelperTimestamp[index]=time},complete:callback});else flags.get(index).save({time:true}).then(callback)},updateStatus:function(index,
complete){if(this.isBitFlag(index))patron.API.post("helper/set",{index:index},function(result){if(result.isOK())patron.HelperStatus=result.getBody().status;if(complete)complete()});else{var flag=flags.get(index);flag.save({index:true}).then(function(){if(complete)complete()})}},unsetIndex:function(index,complete){patron.API.post("helper/unset",{index:index},function(result){if(result.isOK())patron.HelperStatus=result.getBody().status;if(complete)complete()})},setStatus:function(status){patron.Ajax({type:"POST",
url:"/cgi-bin/ajax_helper?ajax_call=1&func_name=set_helper_status&token="+window.mailru_api_token,data:{helper_mask:patron.HelperStatus=status}})},isClosed:function(index){if(this.isBitFlag(index)){var bit=1<<index,status=patron.HelperStatus;return(status&bit)===bit}else return!flags.get(index).state},removeItemById:function(id){for(var item,i=this.items.length;i--;){item=this.items[i];if(item.options.id==id){this.items.splice(i,1);break}}},getItemById:function(id){for(var item,i=this.items.length;i--;){item=
this.items[i];if(item.options.id==id)return item}return null},inArray:function(str,data){for(var i=data.length;i--;)if(data[i].indexOf(str)!==-1)return true;return false},getCurrentTimestamp:function(){return Math.round(new Date/1E3-patron.CurrentTimestampOffset)},getLastShowTime:function(){var result=0,timestamps=[];Array.forEach(this.items,function(item){if(item&&item.options.id)timestamps.push(patron["HelperTimestamp"][item.options.id])});for(var i=timestamps.length;i--;)result=Math.max(result,
timestamps[i]);for(i in flags.extFlags)result=Math.max(result,flags.extFlags[i].time);return result},getAddressBookData:function(callback){$(window).one("success.abjs error.abjs",function(evt,data){if(!$.isArray(data))data=[];callback(data)});$R("{patron}"+"patron",function(){patron.Utils.getAddressBook()})},checkAccess:function(){var result=true;for(var item,i=this.items.length;i--;){item=this.items[i];if(item.showed&&!(item.closed||item.hided)){result=false;break}}return result},isBitFlag:function(index){var ind=
parseInt(index);return 0<=ind&&ind<32}}).methods({__construct:function(options){var t=this;this.$container=$();this.$balloon=$();this.options=$.extend(true,{},patron.Balloon.defaultOptions,options,{balloonOptions:{onClose:function(){t.close();options.balloonOptions&&options.balloonOptions.onClose&&options.balloonOptions.onClose.apply(this,arguments)},onHide:function(){t.hide();options.balloonOptions&&options.balloonOptions.onHide&&options.balloonOptions.onHide.apply(this,arguments)}}});if(this.options.event)$(window).bind(this.options.event,
{scope:this},function(evt){var scope=evt.data.scope;if("id"in scope.options)patron.Balloon.makeAsClosed(scope.options.id);if(scope.options.counters.showAndDo&&scope.showed)if(patron.Balloon.isBitFlag(this.options.id))Counter.d(scope.options.counters.showAndDo);else $.event.trigger("ui-abstract-action",{chain:["balloon",this.options.id,this.options.event]})}.bind(this))},redraw:function(deferred){this.test(deferred)},show:function(){if(this.options.balloonOptions.loadHTML&&!this.options.balloonOptions.html)patron.Ajax({url:"/cgi-bin/lstatic",
dataType:"text",data:{"get":"balloon",name:this.options.id,lang:patron.LANG,SpamBallonExp:patron.SpamBallonExp,SettingsOn:patron.SettingsOn?1:0,staticDomainName:patron.staticDomainName},success:function(result){if(result.isOK()){this.options.balloonOptions.html=result.getData();this.showBalloon()}}.bind(this)});else this.showBalloon()},showBalloon:function(e){var $container=this.getContainer();this.$balloon=$container.TipOfTheDay(this.options.balloonOptions);this.showed=1;if("id"in this.options)patron.Balloon.makeAsShowed(this.options.id);
$(window).bind("beforeunload.balloon",{scope:this},function(evt){var scope=evt.data.scope;if(evt.originalEvent)if(scope.showed&&!scope.closed&&!scope.hided)Counter.d(604800)});if(this.options.counters&&this.options.counters.show)if(patron.Balloon.isBitFlag(this.options.id))Counter.d(this.options.counters.show);else{flags.get(this.options.id).hit();$.event.trigger("ui-abstract-action",{chain:["balloon",this.options.id,"show"]})}var resolve=this.options.resolve;if($.isFunction(resolve))resolve.call(this);
patron.Balloon.setLock(true)},close:function(){this.closed=1;if("id"in this.options)patron.Balloon.makeAsClosed(this.options.id);if(this.options.counters.close)if(patron.Balloon.isBitFlag(this.options.id))Counter.sb(this.options.counters.close);else{flags.get(this.options.id).save({close:true});$.event.trigger("ui-abstract-action",{chain:["balloon",this.options.id,"close"]})}Counter.d(604797);$(window).unbind(".balloon")},hide:function(){this.hided=1;var balloon=this.$balloon.data("patron.ui.TipOfTheDay");
if(balloon)balloon._eHide();Counter.d(604799);$(window).unbind(".balloon");patron.Balloon.setLock(false)},test:function(deferred){var result=true;var opts=this.options;var test=opts.test;var $container=this.getContainer();var currentTimestamp=patron.Balloon.getCurrentTimestamp();var lastShowTimestamp=patron.Balloon.getLastShowTime();if(!patron.Balloon.test(opts))result=false;else if(lastShowTimestamp>currentTimestamp-patron.Balloon.SHOW_TIME_LIMIT&&!opts.ignorShowTimeLimit)result=false;else if(opts.disposable&&
patron.HelperTimestamp[opts.id]>1)result=false;else if(opts.regTimeLimit&&patron.RegTime>currentTimestamp-opts.regTimeLimit)result=false;else if(opts.timeLimit&&patron.HelperTimestamp[opts.id]>currentTimestamp-opts.timeLimit)result=false;else if(opts.selector&&!($container.length>0&&$container.is(":visible")))result=false;if(result)if($.isFunction(test))test.call(this,deferred);else deferred.resolve();else deferred.reject()},getContainer:function(){var selector=this.options.selector;if($.isFunction(selector))selector=
selector.call(this);return $(selector)}});if(defined(patron.TestHelpersTimeLimit))patron.Balloon.SHOW_TIME_LIMIT=patron.TestHelpersTimeLimit;if(patron.TestHelpersClearAllStatus)patron.Balloon.setStatus(0);if(patron.TestHelpersClearAllShowTime)$.each(patron.HelperTimestamp,function(k){patron.Balloon.setTimestamp(k,1)});if(patron.Balloon.isEnable()){if(patron.Balloon.isValid()){var test_spam=patron.SpamBallonExp;patron.Balloon.push({id:patron.HelperIndex.spam,selector:"#action_buttons a.url-spam",event:"spamLinkClick.readmsg",
priority:20,timeLimit:60*60*24*30,regTimeLimit:60*60*24*30,counters:{show:test_spam?1108777:427005,close:427005,showAndDo:test_spam?1108777:604793},test:function(deferred){if(patron.isReadMsg)$R("{patron}"+"patron.Messages",function(deferred){var success=false,email;if(GET.id){var message=patron.Messages.get(GET.id);if(message)email=message.From}if(!email||email.indexOf("@corp.mail.ru")===-1)success=true;if(success)if(email)patron.Balloon.getAddressBookData(function(data){if(patron.Balloon.inArray(email,
data))deferred.reject();else deferred.resolve()});else deferred.resolve();else deferred.reject()}.bind(this,deferred));else deferred.reject()},balloonOptions:{loadHTML:true}},{id:patron.HelperIndex.nospam,selector:"#action_buttons a.url-nospam",event:"nospamLinkClick.readmsg",priority:30,timeLimit:60*60*24*14,regTimeLimit:60*60*24*14,counters:{show:427007,close:427007,showAndDo:604794},test:function(deferred){if(patron.isReadMsg)$R("{patron}"+"patron.Messages",function(deferred){var success=false,
email;if(GET.id){var message=patron.Messages.get(GET.id);if(message)email=message.From}if(!email||email.indexOf("@corp.mail.ru")===-1)success=true;if(success)if(email)patron.Balloon.getAddressBookData(function(data){if(patron.Balloon.inArray(email,data))deferred.reject();else deferred.resolve()});else deferred.resolve();else deferred.reject()}.bind(this,deferred));else deferred.reject()},balloonOptions:{loadHTML:true}});if(patron.RegisterMailtoHandler)patron.Balloon.push({id:patron.HelperIndex.mailtoObserver,
priority:11,timeLimit:60*60*24*30,test:function(deferred){var supported=!$.browser.opera&&$.isFunction(navigator.registerProtocolHandler);if(supported)deferred.resolve();else deferred.reject()},resolve:function(){var url=patron.getPageURL("compose")+"?mailto=%s";try{navigator.registerProtocolHandler("mailto",url,patron.IsMyCom?"myMail":patron.SingleProductName)}catch(e){}}});patron.Balloon.push({id:patron.HelperIndex.filesearch,selector:function(){var selector,$filesearchButton;if(patron.UseFlatHeader){$filesearchButton=
$('[data-name="ph-files"]',"#portal-menu");if($filesearchButton.is(":visible"))selector=$filesearchButton;else selector=$('[data-name="ph-more"]',"#portal-menu")}else selector=$(".dd-filesearch","#ddbuttons").parent();return $(selector)},priority:60,timeLimit:60*60*24*14,regTimeLimit:60*60*24*14,counters:{show:924461,close:924461},xcounters:{show:874511,close:874511},balloonOptions:{onInit:function(){this.$Balloon.find(this.cssTH).css("cursor","pointer").click(function(){location.href="/filesearch"})},
width:278,positionX:"left",margin:[34,3],absolute:true,zIndex:901,loadHTML:true}});if(patron.jinn&&!(Jinn.hasAccessDenied()||Jinn.hasRight()))patron.Balloon.push({id:patron.HelperIndex.notificationAPI,selector:patron.UseFlatHeader?'#portal-menu [data-name="ph-more"]':"#portal-menu__dropdown",disposable:true,balloonOptions:{onInit:function(){this.$Balloon.delegate("a","click",function(evt){evt.preventDefault();this.hide();patron.Notify.browserAlert("notifications-api");Jinn.access(function(){patron.Notify.browserAlert(false)});
$R("{patron}"+"patron.API",function(){patron.API.post("tokens",function(R){var token=String(R.getBody().token).split(":");patron.Ajax({url:"/settings/ajax_settings?ajax_call=1&func_name=set&name=BrowserNotification&val=1",type:"GET",data:{form_sign:token[0],form_token:token[1]},isUser:true})})})}.bind(this))},width:278,orientation:"center",positionX:"left",margin:[149,6],zIndex:903,loadHTML:true}});if(!patron.IsExternalAccount)patron.Balloon.push({id:patron.HelperIndex.collector,selector:patron.UseFlatHeader?
'#portal-menu [data-name="ph-more"]':"#portal-menu__dropdown",priority:10,counters:{show:816839,close:816846},disposable:true,test:function(deferred){if(!patron.FromCollector&&patron.newreg)deferred.resolve();else deferred.reject()},balloonOptions:{onInit:function(){$(".js-hide",this.$Balloon).bind("click",function(evt){this._eHide();evt.preventDefault()}.bind(this))},width:514,orientation:"center",positionX:"left",margin:[267,6],absolute:true,zIndex:904,loadHTML:true}});(function(ts,id){if(!ts[id]||
ts[id]<1379491788)patron.HelperStatus&=~(1<<id)})(patron.HelperTimestamp,patron.HelperIndex.betaTester);if(patron.MultiAuthBalloonEnable)patron.Balloon.push({id:patron.HelperIndex.multiAuth,event:"multiAuthCloseClick",selector:function(){return $(".w-portal-headline__auth__col_left","#PH_authView")},priority:12,timeLimit:60*60*24*14,regTimeLimit:60*60*24*30,counters:{show:1161658,close:1161658},test:function(deferred){if(window.__PH&&__PH.isMultiAuth&&__PH.isMultiAuth())deferred.resolve();else deferred.reject()},
balloonOptions:{onInit:function(){this.$Balloon.css("right",157).find(this.cssTH).css("cursor","pointer").click(function(evt){this._eHide();evt.preventDefault();if(window.__PH&&__PH.authMenu&&__PH.authMenu.show)__PH.authMenu.show()}.bind(this))},width:256,orientation:"bottom",positionX:"right",margin:[0,20],absolute:false,loadHTML:true}})}if(!patron.Balloon.isClosed(patron.HelperIndex.multiAuth))$(function(){if(window.__PH&&__PH.isMultiAuth&&__PH.isMultiAuth())if(__PH.authMenu&&__PH.authMenu.once)__PH.authMenu.once("show",
function(){patron.Balloon.makeAsClosed(patron.HelperIndex.multiAuth)})});var __mediaId=patron.HelperIndex.messagelineMedia,__mediaTimestamp;try{if(patron.HelperStatus&1<<__mediaId){if((__mediaTimestamp=patron.HelperTimestamp[__mediaId])&&__mediaTimestamp<1356984E3)patron.HelperStatus^=1<<__mediaId;__mediaTimestamp=null}}catch(e){}patron.Balloon.push({id:__mediaId,event:"dropDownViewLinkClick.msglist",priority:12,selector:function(){return $(".toolbar_top .toolbar__right","#MsgListContent")},timeLimit:60*
60*24*7,regTimeLimit:60*60*24*7,balloonOptions:{onInit:function(){this.$Balloon.css("right",0)},onShow:function(){patron.radar("MessageLineWithBal","balloonShow=1")},width:278,positionX:"right",margin:[0,-3],absolute:false,loadHTML:true}});if(patron.IsNewComposeDesign)patron.Balloon.push({id:patron.HelperIndex.composeSelectFields,selector:"#dropdown-select-fields",counters:{show:1423988,close:1423990},priority:10,disposable:true,test:function(deferred){if(patron.isComposePage())deferred.resolve();
else deferred.reject()},balloonOptions:{onInit:function(){$(".js-hide",this.$Balloon).bind("click",function(evt){this._eHide();evt.preventDefault()}.bind(this))},width:308,orientation:"bottom",positionX:"left",margin:[6,0],offset:"none",absolute:true,loadHTML:true}});if(patron["IsShowCloudBalloon"])(function(ts,id){if(ts[id]<1383132273)patron.HelperStatus&=~(1<<id);patron.Balloon.push({id:id,selector:function(){var selector,$cloudButton;if(patron.UseFlatHeader){$cloudButton=$('[data-name="ph-cloud"]',
"#portal-menu");if($cloudButton.is(":visible"))selector=$cloudButton;else selector=$('[data-name="ph-more"]',"#portal-menu")}else{selector="#portal-menu__dropdown";if(patron["ShowCloudButton"]){$cloudButton=$(".portal-menu__buttons__item_cloud","#ddbuttons");if($cloudButton.is(":visible"))selector=$cloudButton}}return $(selector)},priority:10,timeLimit:60*60*24*30,regTimeLimit:60*60*24*30,counters:{show:2299277,close:2299290},balloonOptions:{className:"balloon__cloud",width:263,orientation:"center",
positionX:"left",margin:patron.UseFlatHeader?[142,6]:[-107,-6],absolute:!!patron.UseFlatHeader,zIndex:906,loadHTML:true}})})(patron.HelperTimestamp,patron.HelperIndex["cloud"]);if(patron.IsShowAttachFromCloudBalloon){(function(ts,id){if(ts[id]<1405972800){ts[id]=1;patron.HelperStatus&=~(1<<id)}})(patron.HelperTimestamp,patron.HelperIndex.attachFromCloud);patron.Balloon.push({id:patron.HelperIndex.attachFromCloud,selector:".js-multi-attach",priority:10,disposable:true,regTimeLimit:60*60*24*30,balloonOptions:{onInit:function(){var hasCloud=
patron.CommonPurposeBitmask>>15&1;this.$Balloon.find(".js-balloon29-cloud-exists").display(!!hasCloud);this.$Balloon.find(".js-balloon29-cloud-not-exists").display(!hasCloud);this._event(0,"resize")},onShow:function(){$.event.trigger("ui-abstract-action",{chain:["balloon","attachFromCloud","show"]})},onHide:function(){$.event.trigger("ui-abstract-action",{chain:["balloon","attachFromCloud","hide"]})},onClose:function(){$.event.trigger("ui-abstract-action",{chain:["balloon","attachFromCloud","close"]})},
loadHTML:true,orientation:"right",positionX:"auto",margin:[-30,0],width:300}})}if(patron.IsShowGalaxyGuardiansBalloon)(function(ts,id){if(ts[id]<1405886400){patron.HelperStatus&=~(1<<id);ts[id]=0}patron.Balloon.push({id:id,event:"changeThemeClick",selector:function(e){var $portalMenu,$themesButton,selector;if(patron.UseFlatHeader){$portalMenu=$("#portal-menu");$themesButton=$('[data-name="ph-themes"]',$portalMenu);if($themesButton.eq(0).is(":visible"))selector=$themesButton.eq(0);else selector=$('[data-name="ph-more"]',
$portalMenu)}else{selector="#portal-menu__dropdown";$themesButton=$(".portal-menu__buttons__item_themes","#ddbuttons");if($themesButton.is(":visible"))selector=$themesButton}return $(selector)},priority:9,disposable:true,counters:{show:7695512,close:7695521,showAndDo:7695532},balloonOptions:{onInit:function(){this.$Balloon.find(this.cssTH).css("cursor","pointer").click(function(){$(window).trigger("changeThemeClick");$.event.trigger("ui-abstract-action",{chain:["balloon","galaxy-guardians","changeThemeClick"]});
location.href="/settings/themes?setTheme=t1124"}.bind(this))},onShow:function(){$.event.trigger("ui-abstract-action",{chain:["balloon","galaxy-guardians","show"]})},onHide:function(){$.event.trigger("ui-abstract-action",{chain:["balloon","galaxy-guardians","hide"]})},onClose:function(){$.event.trigger("ui-abstract-action",{chain:["balloon","galaxy-guardians","close"]})},className:"balloon__galaxy-guardians",width:264,orientation:"center",positionX:"left",margin:patron.UseFlatHeader?[142,6]:[-102,
-6],absolute:!!patron.UseFlatHeader,zIndex:908,loadHTML:true}})})(patron.HelperTimestamp,patron.HelperIndex.galaxyGuardians);if(patron.IsShowSeptemberTheFirstBalloon)patron.Balloon.push({id:"septemper-the-first",selector:function(){var selector,form=patron.Compose&&patron.Compose.Form&&patron.Compose.Form.getActive();if(form){var editor=form&&form.getEditor();var cards=editor&&editor.controlManager&&editor.controlManager.get("cards");selector=cards&&"#"+cards.id}return $(selector)},priority:9,disposable:true,
counters:{show:true},test:function(deferred){if(GET["IsShowSeptemberTheFirstBalloonForce"]){deferred.resolve();return}var flag=flags.get(this.options.id);var startTimestamp=(new Date("2014-08-31")).getTime()/1E3;var currentTimestamp=(new Date).getTime()/1E3;if(currentTimestamp<startTimestamp||currentTimestamp>flag.expires||flag.count.show>0)deferred.reject();else deferred.resolve()},balloonOptions:{onInit:function(){this.$Balloon.display(0).find(".balloon__content").css("cursor","pointer").bind("click",
function(){Counter.d(8664864);this.hide();$(window).trigger("balloonSetCardSeptemberTheFirst")}.bind(this));setTimeout(function(){$(window).trigger("resize");this.$Balloon.display(1)}.bind(this),100)},onShow:function(){Counter.d(8664749)},onClose:function(){Counter.sb(8664869)},width:264,orientation:"top",positionX:"right",margin:[35,5],absolute:true,zIndex:909,loadHTML:true}})}if(defined(patron.TestHelpersAllRegTimeLimit))$.each(patron.Balloon.items,function(k,v){v.options.regTimeLimit=patron.TestHelpersAllRegTimeLimit});
if(defined(patron.TestHelpersAllTimeLimit))$.each(patron.Balloon.items,function(k,v){v.options.timeLimit=patron.TestHelpersAllTimeLimit});$(window).bind("showMessage.readmsg show.msglist",function(){patron.Balloon.redraw()});jsLoader.loaded("{patron}patron.Balloon",patron.Balloon)});define("{patron.v2.utils}userStore",["toolkit.common/store/store","{jQuery}jquery"],function(store){var _userStore={};$(window).bind("unload",function(){Object.forEach(_userStore,function(us){us.save()})});var userStore=
function(uniqId){if(_userStore[uniqId])return _userStore[uniqId];else if(!(this instanceof userStore))return new userStore(uniqId||patron.useremail);_userStore[uniqId]=this;this.data={};this.uniqId="us."+uniqId;this.lockKey=this.uniqId+".lock";this.load();store.set(this.lockKey,true)};userStore.prototype={constructor:userStore,get:function(key){return this.data[key]},set:function(key,value){this.data[key]=value},remove:function(key){delete this.data[key]},clear:function(){this.data={}},load:function(){try{this.data=
store.get(this.uniqId)||{}}catch(err){}},save:function(){if(store.get(this.lockKey))store.set(this.uniqId,this.data)}};Array.forEach(["get","set","remove","clear"],function(name){userStore[name]=function(){var store=userStore();return store[name].apply(store,arguments)}});return userStore});define("toolkit.mail/b-informer/b-informer",["toolkit.mail/b-toolkit/b-toolkit"],function(toolkit){return toolkit.create("b-informer",{wrap:function(hodler){this.setElement($("."+this.bemName,hodler));this.$el.delegate(".btn[data-name]",
"click."+this.uniqId,this._onClick.bind(this));this.informerId=this.$el.attr("data-informer-id");return this},_onClick:function(evt){var el=evt.currentTarget,act=$.attr(el,"data-name");this.emit("action",{name:act,el:el});this.emit(act,{name:act,el:el})},is:function(informerId){return this.informerId==informerId},hide:function(el){var $el=$(el||this.$el).closest("."+this.bemName),dfd=$.Deferred();$el.slideUp("fast",dfd.resolve);return dfd.promise()},getEl:function(name){return this.$('[data-name="'+
name+'"]')}})});define("toolkit.mail/b-announcement/b-announcement",["toolkit.mail/b-toolkit/b-toolkit","toolkit.mail/b-informer/b-informer"],function(toolkit){return toolkit["b-announcement"]=toolkit["b-informer"].extend({bemName:"b-announcement",init:function(){this.$el.delegate("[data-name]","click."+this.uniqId,this._onClick.bind(this))},hide:function(force){if(force)this.$el.css("display","none");else this.$el.slideUp("fast")}})});jsLoader.use(["{patron.v2}flags/flags.define","{jQuery}jquery",
"{toolkit.common}store/store","{patron.v2.utils}userStore","{toolkit.mail}b-informer/b-informer","{toolkit.mail}b-announcement/b-announcement"],function(flags,jquery,store,userStore){jsClass.create("patron.Announcement").statics({SHOW_TIME_LIMIT:60*60*12,items:[],defaultOptions:{},push:function(){for(var data,i=0,l=arguments.length;i<l;i++)if(data=arguments[i])this.items.push(new patron.Announcement(data))},redraw:function(){var i=0,item;if(this.beforeItemRedraw()&&(item=this.items[i]))this.itemRedraw(item,
i)},beforeItemRedraw:function(){var result=true;if(this.previous){var opts=this.previous.options,testPage=opts.testPage;if(opts.fixed&&$.isFunction(testPage)&&testPage.call(this.previous))result=false;else{this.previous.hide();this.previous=null}}return result},itemRedraw:function(item,i){var doneCallback=this.itemRedrawDone.bind(this,item);var failCallback=this.itemRedrawFail.bind(this,item,i);var deferred=$.Deferred().done(doneCallback).fail(failCallback);item.redraw(deferred)},itemRedrawDone:function(item){this.previous=
item;item.show()},itemRedrawFail:function(item,i){if(this.previous){this.previous.hide();this.previous=null}var nextItem;if(i!==undefined)nextItem=this.items[++i];if(nextItem)this.itemRedraw(nextItem,i)},removeItemById:function(id){for(var item,i=this.items.length;i--;){item=this.items[i];if(item.options.id==id){this.items.splice(i,1);break}}},getLastShowTime:function(){var result=0,timestamps=[],index;Array.forEach(this.items,function(item){if(item&&item.options.helperId){index=patron["HelperIndex"][item.options.helperId];
timestamps.push(patron["HelperTimestamp"][index])}});for(var i=timestamps.length;i--;)result=Math.max(result,timestamps[i]);return result}}).methods({__construct:function(options){this.$container=$("#announcements");this.options=$.extend(true,{},patron.Announcement.defaultOptions,options);this.userStore=userStore(this.options.id+"|"+patron.useremail);if($.isFunction(this.options.init))this.options.init.apply(this)},redraw:function(deferred){this.test(deferred)},show:function(){if(this.$el)this.showAnnouncement();
else{var opts=this.options;if(patron.v2){this.template=(new patron.toolkit["b-announcement"]({el:$("<div/>"),template:"pages/lego",templateBlock:opts.templateBlock?opts.templateBlock:"b-announcement"})).setData($.extend({},{mods:opts.mods||[],closable:opts.closable,text:patron.toolkit.lang["b-announcement"][$.isFunction(opts.getLangId)?opts.getLangId.call(this):this.options.id.replace(/-/g,"_")],closeLink:patron.toolkit.lang["b-announcement"][($.isFunction(opts.getLangId)?opts.getLangId.call(this):
this.options.id.replace(/-/g,"_"))+".close"]},$.isFunction(opts.templateData)?opts.templateData():opts.templateData||{})).render();this.$el=this.template.$el;this.showAnnouncement()}else patron.Ajax({url:"/cgi-bin/lstatic",dataType:"text",data:$.extend({},{get:"announcement",name:opts.id},$.isFunction(opts.getParamsData)?opts.getParamsData():opts.getParamsData||{}),success:function(result){if(result.isOK()){this.$el=$(result.getData());this.showAnnouncement()}}.bind(this)})}},showAnnouncement:function(){var container=
this.getContainer();if(!container.length){if(patron.Announcement.previous===this)patron.Announcement.previous=null;return}this.visible=true;container.append(this.$el).show();var opts=this.options;if($.isFunction(opts.onShow))opts.onShow.call(this);if(opts.toRadar)$.event.trigger("ui-abstract-action",{chain:["announcement",opts.id,"show"]});this.$el.find(".js-close").bind("click",this.close.bind(this));if(opts.saveHelper)LayerManager.saveHelper(opts.helperId)},hide:function(){this.visible=false;if(this.$el){this.$el.find(".js-close").unbind("click");
this.$el.remove()}if($.isFunction(this.options.onHide))this.options.onHide.call(this);if(patron.Announcement.previous===this)patron.Announcement.previous=null},test:function(deferred){var result=true;var opts=this.options;var test=opts.test;if(!opts.critical){var currentTimestamp=patron.Balloon.getCurrentTimestamp();var lastShowTimestamp=patron.Announcement.getLastShowTime();if(lastShowTimestamp>currentTimestamp-patron.Announcement.SHOW_TIME_LIMIT)result=false;else if(opts.timeLimit&&!LayerManager.isExpire(opts.helperId,
opts.timeLimit))result=false}if($.isFunction(opts.testPage)&&!opts.testPage.call(this))result=false;if(result)if($.isFunction(test))test.call(this,deferred);else deferred.resolve();else deferred.reject()},close:function(e){e.preventDefault();var opts=this.options;if($.isFunction(opts.onClose))opts.onClose.call(this,e);if(opts.toRadar)$.event.trigger("ui-abstract-action",{chain:["announcement",opts.id,"close"]});this.hide()},getContainer:function(){if(!this.$container.length)this.$container=$("#announcements");
return this.$container}});patron.Announcement.push({id:"wrong-time",fixed:true,critical:true,mods:["error"],testPage:function(){return true},test:function(deferred){var localDate=new Date,serverDate=new Date(patron["CurrentTimestamp"]*1E3),offset=60*60*24*7,minDate=new Date(serverDate),maxDate=new Date(serverDate);minDate.setSeconds(minDate.getSeconds()-offset);maxDate.setSeconds(maxDate.getSeconds()+offset);if(localDate<minDate||localDate>maxDate){$("#announcements_wrong-time").remove();deferred.resolve()}else{deferred.reject();
setTimeout(function(){patron.Announcement.removeItemById(this.options.id)}.bind(this),0)}},onShow:function(){$("#announcements_wrong-time").show()}},{id:"mrim-disabled",fixed:true,critical:true,testPage:function(){var url=location.href;return!/settings\/security|editpass/.test(url)},test:function(deferred){if(patron.MrimDisabled)deferred.resolve();else deferred.reject()},onShow:function(){Counter.d("352670")}},{id:"no-space-left",fixed:true,critical:true,testPage:function(){return patron.isMsgList},
test:function(deferred){if(patron["MailboxFree"]==0)deferred.resolve();else deferred.reject()},onShow:function(){var counter=695301;function onIncreaseSuccess(){this.hide()}$(".js-infomessage__link",this.$el).attr("cnt_sb",counter).click(function(e){e.preventDefault();LayerManager.show("increaseSpace",onIncreaseSuccess.bind(this))}.bind(this));if(~location.search.indexOf("MailboxSize"))LayerManager.show("increaseSpace");Counter.d(counter)}},{id:"low-space-left",fixed:true,critical:true,testPage:function(){return patron.isMsgList},
test:function(deferred){if(!patron.IsExternalAccount&&patron.isMsgList&&patron["MailboxFree"]<patron["MailBoxSizePadding"])deferred.resolve();else deferred.reject()},onShow:function(){var counter=695289;function onIncreaseSuccess(){this.hide()}$(".js-infomessage__link",this.$el).attr("cnt_sb",counter).click(function(e){e.preventDefault();LayerManager.show("increaseSpace",onIncreaseSuccess.bind(this))}.bind(this));if(~location.search.indexOf("MailboxSize"))LayerManager.show("increaseSpace");Counter.d(counter)}},
{id:"weak-password_compromised",helperId:"WeakPassword",saveHelper:false,fixed:true,closable:true,critical:true,timeLimit:jsCookie.MONTH*3,toRadar:true,testPage:function(){return patron.isMsgList},test:function(deferred){if(patron["CompromisedPassword"]&&LayerManager.isExpire(this.options.helperId,this.options.timeLimit))deferred.resolve();else deferred.reject()},onClose:function(){LayerManager.saveHelper(this.options.helperId)}},{id:"weak-password",helperId:"WeakPassword",saveHelper:true,fixed:true,
closable:true,timeLimit:jsCookie.MONTH*2,testPage:function(){return patron.isMsgList},test:function(deferred){if(patron["WeakPassword"])deferred.resolve();else deferred.reject()},onShow:function(){Counter.d(674969)},onClose:function(){Counter.sb(674970)}},{id:"collector-status-ok",fixed:true,critical:true,closable:true,getParamsData:function(){return{collectorEmail:GET["collectorEmail"]}},testPage:function(){return patron.isMsgList},test:function(deferred){if(GET["collectorStatus"]=="ok")deferred.resolve();
else deferred.reject()}},{id:"collector-status-exists",fixed:true,critical:true,closable:true,getParamsData:function(){return{collectorEmail:GET["collectorEmail"]}},testPage:function(){return patron.isMsgList},test:function(deferred){if(GET["collectorStatus"]=="exists")deferred.resolve();else deferred.reject()}},{id:"collector-status-error",fixed:true,critical:true,closable:true,getParamsData:function(){return{collectorEmail:GET.collectorEmail}},testPage:function(){return patron.isMsgList},test:function(deferred){if(GET.collectorStatus)deferred.resolve();
else deferred.reject()}},{id:"collector-info",helperId:"attachWord",saveHelper:true,fixed:true,closable:true,getLangId:function(){return"collector_info_v"+patron.CollectorInfoVer},testPage:function(){return patron.isMsgList},test:function(deferred){var name="attachWord",index=patron.HelperIndex[name];if(patron.HelperTimestamp[index]<1372204800)patron.HelperStatus&=~(1<<index);if(!patron.IsExternalAccount&&!patron.HasIMAP&&patron.CollectorInfoVer&&!patron.Balloon.isClosed(index))deferred.resolve();
else deferred.reject()},onShow:function(){(function(){var key="announcements.collectorInfo.shows",val=store.get(key)||store.set(key,1)||1,maxVal=parseInt(patron.CollectorInfoMaxShow,10)||3;if(val<=maxVal)store.set(key,store.get(key)+1);else{store.remove(key);patron.Balloon.updateStatus(patron.HelperIndex.attachWord)}})();var version=patron.CollectorInfoVer-1,counter;if(counter=[1547394,1547406,1547413][version])Counter.d(counter);this.$el.delegate(".js-accept","click",function(){if(counter=[1547397,
1547407,1547414][version])Counter.d(counter)});this.$el.delegate(".js-infomessage__link_collector","click",function(event){require("{patron}patron.Collector",function(){var collectors=new patron.Collector;var counter=collectors.utils.counter.bind(null,"announcement","layer","add");counter();LayerManager.show("collector_add",{promo:true,callback:function(collector){try{counter("success",collector.type)}catch(error){ajs.log(error)}counter("success")}})});this.hide();event.preventDefault()}.bind(this))},
onClose:function(e){var $target=$(e.currentTarget);var version=patron.CollectorInfoVer-1,counter;if($target.hasClass("js-ok")){if(counter=[1547405,1547412,1547418][version])Counter.d(counter)}else if(counter=[1547403,1547410,11547416][version])Counter.d(counter);patron.Balloon.makeAsClosed(patron.HelperIndex.attachWord)}},{id:"mailbox-sort",templateBlock:"b-announcement__mailbox-sort",closable:true,fixed:true,critical:true,init:function(){Object.extend(this,{testFolder:this.options.testFolder,testLocalTime:this.options.testLocalTime,
getType:this.options.getType,plateFlag:flags.get("mailbox-sort-plate"),utilFlag:flags.get("mailbox-sort"),filtersProcessingFlag:flags.get("filters-processing")});if(patron.MailBoxSortPlate)this.plateFlag.constructor.prototype.save=$.noop},templateData:function(){var _lang=patron.toolkit.lang["b-announcement"]["mailbox_sort"],type=patron.MailBoxSortPlate||this.getType();return{mods:["mailbox-sort"],type:type,header:_lang[type]["header"],text:_lang[type]["text"],controls:[{"text":_lang["controls"]["start"],
"attrs":{"href":"#","class":"b-announcement__controls__start pseudo-link","data-mnemo":"mailbox-sort-start","data-name":"mailbox-sort-start"}}]}},getType:function(){var utilFlag=flags.get("mailbox-sort");if(utilFlag&&utilFlag.getCount("show")>0)return"second";return"first"},testPage:function(){return patron.Router&&patron.Router.request.isLettersPage()&&patron.Folders.getSafe().id===0},testFolder:function(){var result=false;if(this.options.testPage())if(patron.Folders.getSafe(0).get("Unread")/patron.messagesPerPage>
2)result=true;return result},testLocalTime:function(){var testTime=showTime=Math.round(new Date/1E3),plateShow=this.userStore.get("plate.show")||{time:testTime,show:0};if(testTime-plateShow.time>jsCookie.DAY)plateShow.show=0;this.userStore.set("plate.show",plateShow);this.userStore.save();return plateShow.show<3},test:function(dfd){var result;if(!patron.MailBoxSort)dfd.reject();if(patron.v2&&patron.MailBoxSort&&this.testFolder()&&!this.filtersProcessingFlag.isActive()){var utilFlag=this.utilFlag,
plateFlag=this.plateFlag,timeDelta=plateFlag.getTimeDelta(patron.CurrentTimestamp),utilShow=utilFlag.getCount("show"),plateClose=plateFlag.getCount("close"),plateShow=plateFlag.getCount("show");if(utilFlag&&utilFlag.isExist()&&utilFlag.isActive())if(utilShow==0)result=!plateShow||!plateClose&&this.testLocalTime()||plateClose&&plateClose<4&&timeDelta>jsCookie.WEEK||plateClose&&plateClose>3&&timeDelta>jsCookie.MONTH;else result=utilFlag.getTimeDelta(patron.CurrentTimestamp)>jsCookie.WEEK*3}if(patron.MailBoxSortPlate)result=
true;if(!this.visible&&result)dfd.resolve();else if(this.visible&&!result)dfd.reject()},onShow:function(){var showTime=Math.round(new Date/1E3),plateFlag=this.plateFlag,utilFlag=this.utilFlag,plateShow=this.userStore.get("plate.show")||{time:showTime,show:0};plateShow={time:showTime,show:plateShow.show+=1};this.userStore.set("plate.show",plateShow);this.userStore.save();plateFlag.save({hit:true,time:true});this.$el.delegate("[data-name]","click",function(event){event.preventDefault();var $target=
$(event.target),name=$target.attr("data-name"),handler=this.options[$.camelCase("on-"+name)];$.isFunction(handler)&&handler.call(this,event)}.bind(this));$.event.trigger("ui-abstract-action",{util:utilFlag,chain:["mailbox-sort","plate",this.getType(),"show"]})},onClose:function(){this.plateFlag.save({close:true});$.event.trigger("ui-abstract-action",{chain:["mailbox-sort","plate",this.getType(),"close"]})},onMailboxSortStart:function(event){require("{patron.v2.layer}patron.layer.Cleaner",function(cleaner){cleaner.showLayer().then(this.hide.bind(this),
this.hide.bind(this))}.bind(this))}},{id:"mobile-app",helperId:"mobileApp",fixed:true,saveHelper:true,closable:true,timeLimit:jsCookie.WEEK,testPage:function(){return patron.isMsgList},test:function(deferred){var name="mobileApp",index=patron["HelperIndex"][name];if(!patron.Balloon.isClosed(index))deferred.resolve();else deferred.reject()},onShow:function(){Counter.d(1448518)},onClose:function(e){var $target=$(e.currentTarget);if($target.hasClass("js-ok"))Counter.d(1448532);else Counter.d(1448522);
patron.Balloon.makeAsClosed(patron["HelperIndex"]["mobileApp"])}},{id:"needmodernbrowser",fixed:true,testPage:function(){return patron.isMsgList},test:function(deferred){var name="patron_v2",index=patron["HelperIndex"][name];if(patron.Balloon.isClosed(index)&&!patron["EnableMAILRUV2Switcher"]&&patron["EnableNeedModernBrowserShow"]&&!(patron["ShowMAILRUV2OutOfService"]==1||GET["ShowMAILRUV2OutOfService"]==1))deferred.resolve();else deferred.reject()},onShow:function(){Counter.d(1925622)}},{id:"septimaoutofservice",
fixed:true,testPage:function(){return patron.isMsgList||patron.isSentMsg||patron.isReadMsg},test:function(deferred){var name="patron_v2",index=patron["HelperIndex"][name];if(patron.Balloon.isClosed(index)&&!patron["EnableMAILRUV2Switcher"]&&patron["EnableNeedModernBrowserShow"]&&(patron["ShowMAILRUV2OutOfService"]==1||GET["ShowMAILRUV2OutOfService"]==1))deferred.resolve();else deferred.reject()},onShow:function(){Counter.d(1925748)}},{id:"acca",helperId:"accaNotify",fixed:true,closable:true,saveHelper:true,
timeLimit:jsCookie.WEEK,testPage:function(){return patron.isMsgList},test:function(deferred){var name="accaNotify",index=patron["HelperIndex"][name];if(patron["HelperTimestamp"][index]<1368001024)patron["HelperStatus"]&=~(1<<index);if(patron["AccaAvailableButDisabled"]&&!patron.Balloon.isClosed(index))deferred.resolve();else deferred.reject()},onShow:function(){Counter.d(1577041)},onClose:function(){Counter.sb(1577043);patron.Balloon.makeAsClosed(patron["HelperIndex"]["accaNotify"])}},{id:"last_login",
templateBlock:"b-announcement__last-login",critical:true,templateData:function(){return{City:patron.adStartupData?patron.adStartupData["last_login_city"]||"":"",WWWCurrentIP:patron["WWWCurrentIP"],WWWLoginDate:patron["WWWLoginDate"],POPLoginDate:patron["POPLoginDate"],PLogins:patron["PLogins"],AccaAvailableButDisabled:patron["AccaAvailableButDisabled"],lang:patron.v2?patron.toolkit.lang["b-announcement"]["last_login"]:{}}},testPage:function(){return patron.isMsgList},test:function(deferred){if(patron.isMsgList&&
patron["ShowLastLogin"]&&GET["back"]==1)deferred.resolve();else deferred.reject()},onShow:function(){if(!patron.v2){var templateId="#announcements__last_login_ejs",templatePlaceholder="#announcements__last_login",data=$.isFunction(this.options.templateData)?this.options.templateData():this.options.templateData;ajs.require(["{jQuery}jquery.tpl"],function(){this.$el.find(templatePlaceholder).tpl(templateId,{data:data}).show()}.bind(this))}}},{id:"light-transition",helperId:"lightTransition",closable:true,
timeLimit:jsCookie.WEEK,testPage:function(){return patron.isMsgList},test:function(def){var version=$.browser.intVersion,resolve=false,index=patron["HelperIndex"]["lightTransition"];if(patron["HelperTimestamp"][index]<1392795427)patron["HelperStatus"]&=~(1<<index);if(!patron.v2&&patron["LightTransitionAnnouncementOn"])if($.browser.mozilla&&version<=4||$.browser.opera&&version<=10||$.browser.msie&&version===7)resolve=true;else if($.browser.safari){version=/version\/(.*)\s+safari\//.exec(navigator.appVersion.toLowerCase());
if(version&&version[1]&&parseInt(version[1],10)<=4)resolve=true}def[resolve?"resolve":"reject"]()},onShow:function(){$.event.trigger("ui-abstract-action",{chain:["announcements","light-transition","show"]})},onClose:function(){LayerManager.saveHelper("lightTransition")}});$(window).bind("showMessage.readmsg show.msglist show.compose showForm.compose",function(){patron.Announcement.redraw()});jsLoader.loaded("{patron}patron.Announcement")});jsLoader.use(["{jQuery}jquery","{utils}HotKeys","{plugins}jQueryEvent",
"{patron}patron.Ajax"],function(){jsClass.create("LayerFade").extend(jQueryEvent).methods({__construct:function(){this.options={};this.hideObserver=this.hide.bind(this);this.resizeObserver=this._resize.bind(this);this.$window=$(window);this.$document=$(document);this.$container=$("body, #ScrollBodyInner").last();this.$wrapper=$ScrollElement.last();this.$div=$("<div/>").css({opacity:patron.isDarkPopup?0.4:0.6,backgroundColor:patron.isDarkPopup?"#000":"#fff",width:"100%",height:"100%",zIndex:65001,
display:"none"}).appendTo(this.$container).setPositionFixed(0,0)},_resize:function(){},_update:function(){},show:function(options){options=options||{};if(!this.visible){this.visible=1;if(options.fill_fade)this.$div.css({opacity:1,backgroundColor:"#fff"});else this.$div.css({opacity:patron.isDarkPopup?0.4:0.6,backgroundColor:patron.isDarkPopup?"#000":"#fff"});this.$div.show();if(patron.TestAnimations&&this.options.effects&&this.options.effects.show){var animClass=this.options.effects.show.animation?
"overlay_effect-"+this.options.effects.show.animation:"";this.$div.addClass(animClass);setTimeout(function(){this.$div.removeClass(animClass)}.bind(this),this.options.effects.show.duration||0)}this.triggerHandler("show")}},hide:function(){if(this.visible){this.visible=0;if(patron.TestAnimations&&this.options.effects&&this.options.effects.hide){var animClass=this.options.effects.hide.animation?"overlay_effect-"+this.options.effects.hide.animation:"";this.$div.addClass(animClass);setTimeout(function(){this.$div.removeClass(animClass).display(false);
this.triggerHandler("hide")}.bind(this),this.options.effects.hide.duration||0)}else{this.$div.display(false);this.triggerHandler("hide")}}},update:function(){this._update()}});jsClass.create("LayerMainDiv").extend(jQueryEvent).methods({__construct:function(){this.fade=LayerFade.getInstance();this.hideObserver=this.hide.bind(this);this.resizeObserver=this._resize.bind(this);this.controlClickObserver=this._controlClick.bind(this);this.$window=$(window);this.$document=$(document);this.$div=$("#MailRuConfirm");
this.$innerDiv=$(".alertDivSpan,.js-layer",this.$div);this.$close=$(".iDelBig,.js-cancel",this.$div).bind("click",this.controlClickObserver);this.opts={position:"fixed"};if($.browser.msie&&parseInt($.browser.version)<8)this.$iFrame=$('<iframe frameborder="0" tabindex="-1" class="pAbs top0 left0 dB2" style="z-index:-1;" src="javascript:0;"/>').appendTo(this.$div);this.fade.bind({hide:this.hideObserver});this.enableHide()},_resize:function(){this.update();this.triggerHandler("resize")},_update:function(){var divSize=
this.$div.getSize(),innerSize=this.$innerDiv.getSize(),wHeight=ajs.windowHeight(),wWidth=ajs.windowWidth(),dh=divSize.height/2,dw=innerSize.width/2,xH=divSize.height>wHeight,xW=innerSize.width>wWidth,x=xH||xW,s={};s.marginTop=-dh;if(jQuery.iePositionFixed===undef){s.top=x?Math.max(dh,wHeight/2)+ajs.scrollTop():wHeight/2;s.position=x?"absolute":this.opts.position}if(s.position==="fixed"){this.$div.setPositionFixed(0,s.top);delete s.top;delete s.position}this.$div.css(s);if(this.$iFrame){var position=
this.$innerDiv.position();var inner=this.$innerDiv[0];this.$iFrame.css({width:inner.offsetWidth,height:inner.offsetHeight,left:position.left});if(!this.iFrameHeightFixed){this.iFrameHeightFixed=true;setTimeout(this._update.bind(this),100)}}},_controlClick:function(event){event.preventDefault();this.triggerHandler("controlClick");this.hide()},show:function(options){options=options||{};if(!this.visible){this.visible=1;this.$div.removePositionFixed().removeAttr("style").show();if(this.$iFrame)this.$iFrame.show();
this.fade.show(options);if(patron.TestAnimations&&this.opts.effects&&this.opts.effects.show){this.startDelay=new $.Deferred;var animClass="popup_effect-"+this.opts.effects.show.animation;this.$innerDiv.addClass(animClass);setTimeout(function(){this.$innerDiv.removeClass(animClass);this.startDelay.resolve()}.bind(this),this.opts.effects.show.duration)}this.update();this.$window.bind("resize",this.resizeObserver);this.triggerHandler("show")}return this},hide:function(){if(this.visible&&!this.fix){this.visible=
0;this.$window.triggerHandler("hide.layer",this);if(patron.TestAnimations&&this.opts.effects&&this.opts.effects.hide){this.fade.hide();this.hideDelay=new $.Deferred;var animClass=this.opts.effects.hide.animation?"popup_effect-"+this.opts.effects.hide.animation:"";this.$innerDiv.addClass(animClass);setTimeout(function(){if(this.$iFrame)this.$iFrame.display(false);this.$innerDiv.removeClass(animClass);this.$div.hide();this.$window.unbind("resize",this.resizeObserver);this.hideDelay.resolve()}.bind(this),
this.opts.effects.hide.duration||0)}else{if(this.$iFrame)this.$iFrame.hide();this.$div.display(false);this.fade.hide();this.$window.unbind("resize",this.resizeObserver)}this.triggerHandler("hide")}return this},disableHide:function(){this.fix=1;this.$close.hide();$.hotkeys.off("esc",this.controlClickObserver);return this},enableHide:function(){this.fix=0;this.$close.show();$.hotkeys.on("esc",this.controlClickObserver);return this},update:function(){this._update()}});jsClass.create("Layer").extend(jQueryEvent).statics({"prefix":function(name){return"is-"+
name},"cssClass":function(name){return"."+Layer.prefix(name)+"_in"},"isExternal":function(){return Layer.options&&Layer.options.type=="external"},"get":function(name,callback,options){this.options=options||{};var prefix=Layer.prefix(name),mainDiv=LayerMainDiv.getInstance(),layerFade=LayerFade.getInstance();if(patron.TestAnimations){mainDiv.opts.effects=this.options.effects&&this.options.effects.layer||null;layerFade.options.effects=this.options.effects&&this.options.effects.overlay||null}var $layer=
$(Layer.cssClass(name),mainDiv.$div);if(this.options.isRefresh)if($layer.length)$layer.remove();if(!this.options.isRefresh&&$layer.length)callback(new Layer(prefix));else patron.Ajax({url:"/cgi-bin/lstatic?get=layer&name="+name,type:"GET",dataType:"text",data:$.extend({EnableChangeAMLang:patron.EnableChangeAMLang,EnableChangeESLang:patron.EnableChangeESLang,EnableChangeKZLang:patron.EnableChangeKZLang,EnableChangeEnglishLang:patron.EnableChangeEnglishLang,EnableChangeBYLang:patron.EnableChangeBYLang,
EnableChangeDELang:patron.EnableChangeDELang,EnableChangeMDLang:patron.EnableChangeMDLang,EnableChangeROLang:patron.EnableChangeROLang,NewMultiAuthLayerLogic:patron.NewMultiAuthLayerLogic,HTTP_PROTOCOL:location.protocol,lang:patron.LANG,SingleDomainName:patron.SingleDomainName},this.options.params),complete:function(Result){if(Result.isOK()){mainDiv.$innerDiv.append(Result.getData());callback(new Layer(prefix))}}})},"set":function(name,node){var mainDiv=LayerMainDiv.getInstance(),prefix=Layer.prefix(name);
if($(Layer.cssClass(name)+":first",mainDiv.$div).length)$(Layer.cssClass(name),mainDiv.$div).replaceWith(node);else $(mainDiv.$innerDiv).append(node)},open:function(name){var dfd=$.Deferred();Layer.get(name,function(layer){layer.func=function(state){dfd[state?"resolve":"reject"](state)};layer.show()});return dfd}}).methods({__construct:function(type,callback){this.mainDiv=LayerMainDiv.getInstance();this.hideObserver=this.hide.bind(this);this.controlClickObserver=this._controlClick.bind(this);this.type=
type;this.func=callback||$.noop;this.$el=this.$div=$("."+this.type+"_in:first",this.mainDiv.$div);$(".confirm-ok,.confirm-cancel",this.$div).unbind(".layer").bind("click.layer",this.controlClickObserver);this.mainDiv.unbind(".layer").bind({"controlClick.layer":this.controlClickObserver,"hide.layer":this.hideObserver});this.$div[this.$div.is("form")?"F":"find"]("form").unbind(".layer").bind("submit.layer",function(){var r=this._execFunc(true);if(r!==1&&r!==false)this.hide();return false}.bind(this));
this.$div.find(".form__select").form__select();this.mods=(this.$div.data("mods")||"").trim().split(/[\s\t]+/)},_controlClick:function(evt){evt.preventDefault();var $target=$(evt.target),status=null;if(evt.target.nodeType){status=$target.is(".confirm-ok")||$(evt.currentTarget).is(".confirm-ok");if(status)status=$target.attr("data-details")||$(evt.currentTarget).attr("data-details")||status}var r=this._execFunc(status);if(r!==1&&r!==false)this.hide()},_execFunc:function(status){var r=this.func.call(this,
status);this.triggerHandler("callback",[status]);return r},_toggleMods:function(state){Object.forEach(this.mods,function(mod){this.mainDiv.$innerDiv.toggleClass("popup_"+mod,state)},this)},_toggleClass:function(state){var className=null;if(Layer.options&&(className=Layer.options.className))this.mainDiv.$innerDiv[state?"addClass":"removeClass"](className)},show:function(options){options=options||{};if(Layer.prev)Layer.prev.hide();Layer.prev=this;if(!this.visible){if(Layer.isExternal())this.mainDiv.$innerDiv.addClass("popup_external");
this._toggleMods(true);this.hideAllErrors();this.visible=1;this.$div.removeClass("dN").show();this.mainDiv.show(options);$.when(this.mainDiv.startDelay).done(function(){$(":input:visible:first",this.$div).not(".confirm-cancel").focus();this._toggleClass(true);$(window).resize();this.triggerHandler("show");if(options&&typeof options.complete=="function")options.complete(this)}.bind(this))}return this},hide:function(options){if(this.visible&&!this.fix){this.visible=0;this.mainDiv.hide();$.when(this.mainDiv.hideDelay).done(function(){if(Layer.isExternal())this.mainDiv.$innerDiv.removeClass("popup_external");
this._toggleMods(false);this.$div.display(false);this._toggleClass(false);$(window).resize();this.triggerHandler("hide")}.bind(this));if(options&&typeof options.complete=="function")options.complete(this)}return this},disableHide:function(){this.fix=1;this.mainDiv.disableHide();return this},enableHide:function(){this.fix=0;this.mainDiv.enableHide();return this},showError:function(text){try{$(".js-formError",this.$div).html(text).show();this.sizeChanged()}catch(e){alert(text)}},hideError:function(){$(".js-formError",
this.$div).hide();this.sizeChanged()},hideAllErrors:function(){this.hideError();this.$div.find(".form__field").removeClass("form__field_error");this.$div.find(".form__spinbox__field").removeClass("form__spinbox__field_error");this.$div.find(".form__select").removeClass("form__select_error");this.$div.find(".form__message").empty()},sizeChanged:function(){var fade=LayerFade.getInstance();var popupTop=parseInt(this.mainDiv.$div.css("top"),10);fade.update();this.mainDiv._resize()}});jsLoader.loaded("{plugins}Layer",
Layer)});jsLoader.use("{jQuery}jquery",function(){(function($){jsClass.create("formatPhone").methods({__construct:function(input,subtract){this.value=input.value;this.subtract=subtract;var first="^\\d{"+this.at(3)+"}",length=this.erase().length;if(this.selected(input))return 0;if(RegExp(first+"\\s\\d{3}\\-\\d{2}\\-\\d{2}$").test(this.value))return 0;if(length<=this.at(10)){if(length>=this.at(4)&&RegExp(first).test(this.value))input.value=this.replace(first,"$& ",1);if(length>=this.at(7))if(RegExp(first+
"\\s\\d{3}").test(this.value))input.value=this.replace(first+"\\s\\d{3}","$&-");else if(length<=this.at(10))input.value=this.replace("("+first+")(\\d{3})(\\d{2})","$1 $2-$3-");else this.clean(input);var delimiter=input.value.match(/\-/g);if(delimiter&&delimiter.length>2)this.clean(input);if(length==this.at(10))input.value=this.erase().replace(RegExp("^\\d{"+this.at(3)+"}"),"$& ").replace(/\s(\d{3})/,"$&-").replace(/\-\d{2}/,"$&-")}else if(/\D/g.test(this.value))input.value=this.erase();if(this.last("-")||
this.last(" "))input.value=this.value.slice(0,-1)},at:function(index){return index-(this.subtract|0)},erase:function(){return this.value.replace(/\D/g,"")},replace:function(expression,item,type){var type=[[/\-+/,"-"],[/\s+/," "]][type||0];return this.value.replace(RegExp(expression),item).replace(type[0],type[1])},last:function(item){return this.value.charAt(this.value.length-1)==item},clean:function(input){input.value=this.value.replace(/[\s\-]/g,"")},selected:function(input){if(!input)return-1;
var selection=input.selectionStart;if(typeof selection=="number")return selection!=input.selectionEnd;else if(typeof(selection=document.selection)!="undefined"){input.focus();return selection.createRange().text}}});$.fn.formatPhone=function(event,subtract,options){var which=event.which,input=this[0],length=input.value.length,caretPos=input.selectionStart;if(!input||typeof event!=="object"||typeof subtract!=="number")return this;if(event.type=="keyup"&&(which==37||which==39))return this;new formatPhone(input,
subtract);if(ajs.isFunction(input.setSelectionRange)&&length===input.value.length)input.setSelectionRange(caretPos,caretPos);return this}})(jQuery);jsLoader.loaded("{plugins}formatPhone")});jsLoader.use(["{plugins}jQueryEvent","{plugins}Layer","{plugins}formatPhone","{patron}patron.Ajax","{utils}Counter"],function(){(function($){function refreshCaptcha(layer){var $captchaFrame=$("#captcha_frame",layer.$div);var $captchaInput=$('input[name="security_image_answer"]',layer.$div);$captchaFrame.attr("src",
patron.captchaURL1+"?"+Math.random());$captchaInput.val("")}jsClass.create("patron.PhoneManager").extend(jQueryEvent).statics({sortCountryList:function(unsortedCountryList){var topCountryList=[];var countryList=[];Array.forEach(unsortedCountryList,function(country){if(country.Top)topCountryList.push(country);else countryList.push(Object.extend({},country,{Top:0}))});countryList=topCountryList.sort(function(a,b){return a.Top>b.Top?1:-1}).concat(countryList.sort(function(a,b){return a.Country>b.Country?
1:-1}));return countryList},getDigitalCountryCode:function(code){if(!patron.UseAlphaPhoneCode)return code;if(!this.countryData){var countryData=this.countryData={};$.each(patron.PhoneManager.sortCountryList(window.CountryList),function(key,country){countryData[country.alphaCode]=country})}return this.countryData[code]&&this.countryData[code].Code||""}}).methods({__construct:function(options){var t=this;t.options={};t.data={};t.xhrs={};t.layers={};t.prevLayer=null;t.setOptions(options)},_createLayer_singSMS:function(){var t=
this;var layer=new Layer("is-signupsms",$.proxy(t._signupSmsCallback,t));layer.bind("show",function(){$('input[name="code"]',this.$div).val("")});var $nosmslinkText=$(".js-nosmslink-text",layer.$div);layer.bind("hide",function(){$nosmslinkText.each(function(){this.style.display="none"});$nosmslinkText.filter('[data-case="DEFAULT"]').get(0).style.display=""});$("a.nosmslink:first",layer.$div).bind("click",$.proxy(t._getSMSStatusLinkClick,t));return layer},_createLayer_addPasswordQuestion:function(callback){Layer.get("addPasswordQuestion",
function(layer){layer.func=this._addAlternativePassremindCallback.bind(this,layer);var $form=$("form",layer.$div);layer.one("show",function(){var $passwordQuestionSelect=$(".js-passwordQuestion",$form);var $passwordCustomQuestionContainer=$(".js-passwordCustomQuestionContainer",$form);$passwordQuestionSelect.change(function(){$passwordCustomQuestionContainer.toggle($passwordQuestionSelect.val()=="Custom")})});layer.bind("show",function(){$(".js-error",$form).hide()});$(".js-refresh-captcha",layer.$div).bind("click",
function(){refreshCaptcha(layer);return false});callback(layer)}.bind(this))},_createLayer_addAdditionalEmail:function(callback){Layer.get("addAdditionalEmail",function(layer){layer.func=this._addAlternativePassremindCallback.bind(this,layer);layer.bind("show",function(){var $form=$("form",layer.$div);$(".js-error",$form).hide()});$(".js-refresh-captcha",layer.$div).bind("click",function(){refreshCaptcha(layer);return false});callback(layer)}.bind(this))},_createLayer_verifySomePhoneSingSMS:function(){var t=
this;var layer=new Layer("is-signupsms",$.proxy(t._verifySomePhoneSingSmsCallback,t));layer.bind("show",function(){$('input[name="code"]',this.$div).val("")});$("a.nosmslink:first",layer.$div).bind("click",$.proxy(t._getSMSStatusLinkClick,t));return layer},_createLayer_selectVerifySomePhone:function(){var t=this;var layer=new Layer("is-selectVerifySomePhone",$.proxy(t._selectVerifySomePhoneCallback,t));layer.bind("show",function(){var t=this;var $error=$(".js-error",t.$div);$error.hide()});$(".js-codeisset",
layer.$div).bind("click",$.proxy(function(evt){var layer=this._getLayer("selectVerifySomePhone");var $phoneSelect=$(".js-phone",layer.$div);var phone=$phoneSelect.val();this.data={"phonecode":"","phone":phone};this._verifySomePhoneCodeIssetLinkClick(evt)},t));$(".js-addPhone",layer.$div).bind("click",$.proxy(function(evt){this._verifySomePhoneAddPhoneLinkClick(evt)},t));return layer},_createLayer_addPhone:function(){var t=phoneManager=this,o=t.options;var layer=new Layer("is-newphone1",$.proxy(t._addPhoneCallback,
t));if(t.options.passcheck)$('input[name="ismobile"]',t.$div).parent().children().hide();layer.bind("show",function(){var t=this;var $phone=$('input[name="phone"]',t.$div);var $ismobile=$('input[name="ismobile"]',t.$div);var $submit=$(".confirm-ok",t.$div);var $phoneCodeSelect=$('select[name="phonecode"]',t.$div);var $childs=$phoneCodeSelect.children();$(".js-defaultText,.js-editpassText",t.$div).hide().filter(o.user.isDisabled?".js-editpassText":".js-defaultText").show();$ismobile.attr("checked",
"checked");$phone.val("");if($childs.length)$phoneCodeSelect.val($childs.first().val()).change();if($ismobile.is(":checked"))$submit.form__disable()}).one("show",function(){var t=this;if(window.CountryList)phoneManager._applyCountryList(t.$div,t);else $.ajax({url:"/cgi-bin/lstatic",data:{get:"countries-list",rnd:jsCore.build,lang:patron.LANG,staticDomainName:patron.staticDomainName,alphaPhoneCode:patron.UseAlphaPhoneCode},dataType:"script",cache:true,context:t,success:function(){phoneManager._applyCountryList(t.$div,
t)}})}).one("show",function(){var t=this;var $phone=$('input[name="phone"]',t.$div);var $ismobile=$('input[name="ismobile"]',t.$div);function liveValidate(event){var t=this;var $phone=$('input[name="phone"]',t.$div);var $error=$("div.red:first, .js-error",t.$div);var $ismobile=$('input[name="ismobile"]',t.$div);var $submit=$(".confirm-ok",t.$div);var value=$phone.val();var prepareValue=value.replace(/[\(\)\-\+\s]/g,"");var error="";var correct=true;var valid=true;switch(t.countryCode){case "7":$phone.formatPhone(event,
0);break;case "380":$phone.formatPhone(event,1);break}if($ismobile.is(":checked"))if(prepareValue.length==0){valid=false;error=Lang.get("reg.phone_code_invalid")}else if(value.length<3){valid=false;error=Lang.get("reg.phone_code_incorrect")}else{if(/[^\(\)\-\+\s0-9]/.test(value)){correct=valid=false;error=Lang.get("reg.phone_sumbol_invalid")}}else if(prepareValue.length==0){valid=false;error=Lang.get("reg.phone_code_invalid")}else if(prepareValue.length<5||prepareValue.length>32||value.length>50){valid=
false;error=Lang.get("reg.phone_code_incorrect")}else if(!/^\d+$/.test(prepareValue)){correct=valid=false;error=Lang.get("reg.phone_sumbol_invalid")}if(correct)$error.hide();else $error.html(error).show();if(valid)$submit.form__enable();else $submit.form__disable()}function postValidate(){var t=this;var $phone=$('input[name="phone"]',t.$div);var $error=$("div.red:first, .js-error",t.$div);var $ismobile=$('input[name="ismobile"]',t.$div);var $submit=$(".confirm-ok",t.$div);var value=$.trim($phone.val());
var prepareValue=value.replace(/[\(\)\-\+\s]/g,"");var error="";var correct=true;var valid=true;if($ismobile.is(":checked"))if(prepareValue.length==0){valid=false;error=Lang.get("reg.phone_code_invalid")}else if(value.length<3){correct=valid=false;error=Lang.get("reg.phone_code_incorrect")}else{if(/[^\(\)\-\+\s0-9]/.test(value)){correct=valid=false;error=Lang.get("reg.phone_sumbol_invalid")}}else if(prepareValue.length==0){valid=false;error=Lang.get("reg.phone_code_invalid")}else if(prepareValue.length<
5||prepareValue.length>32||value.length>50){correct=valid=false;error=Lang.get("reg.phone_code_incorrect")}else if(!/^\d+$/.test(prepareValue)){correct=valid=false;error=Lang.get("reg.phone_sumbol_invalid")}if(correct)$error.hide();else $error.html(error).show();if(valid)$submit.form__enable();else $submit.form__disable()}$phone.bind({"keyup":$.proxy(liveValidate,t),"blur":$.proxy(function(){setTimeout($.proxy(postValidate,this),100)},t)});$ismobile.bind("click",$.proxy(liveValidate,t));$R("{patron.v2.utils}patron.utils.ui.counters",
function(){patron.utils.ui.counters.inputTelephoneCounterTest($phone)})});return layer},_createLayer_signupPhone:function(){var t=phoneManager=this;var layer=new Layer("is-signupphone1",$.proxy(t._signupPhoneCallback,t));layer.bind("show",function(){var t=this;var $phone=$('input[name="phone"]',t.$div);var $ismobile=$('input[name="ismobile"]',t.$div);var $submit=$(".confirm-ok",t.$div);var $phoneCodeSelect=$('select[name="phonecode"]',t.$div);var $childs=$phoneCodeSelect.children();var $error=$("div.red:first, .js-error",
t.$div);$error.hide();$ismobile.attr("checked","checked");$phone.val("");if($childs.length)$phoneCodeSelect.val($childs.first().val()).change();if($ismobile.is(":checked"))$submit.form__disable()}).one("show",function(){var t=this;if(window.CountryList)phoneManager._applyCountryList(t.$div,t);else $.ajax({url:"/cgi-bin/lstatic",data:{get:"countries-list",rnd:jsCore.build,lang:patron.LANG,staticDomainName:patron.staticDomainName,alphaPhoneCode:patron.UseAlphaPhoneCode},dataType:"script",cache:true,
context:t,success:function(){phoneManager._applyCountryList(t.$div,t)}})}).one("show",function(){var t=this;var $phone=$('input[name="phone"]',t.$div);var $ismobile=$('input[name="ismobile"]',t.$div);function liveValidate(event){var t=this;var $phone=$('input[name="phone"]',t.$div);var $error=$("div.red:first, .js-error",t.$div);var $ismobile=$('input[name="ismobile"]',t.$div);var $submit=$(".confirm-ok",t.$div);var value=$phone.val();var prepareValue=value.replace(/[\(\)\-\+\s]/g,"");var error="";
var correct=true;var valid=true;switch(t.countryCode){case "7":$phone.formatPhone(event,0);break;case "380":$phone.formatPhone(event,1);break}if($ismobile.is(":checked"))if(prepareValue.length==0){valid=false;error=Lang.get("reg.phone_code_invalid")}else if(value.length<3){valid=false;error=Lang.get("reg.phone_code_incorrect")}else{if(/[^\(\)\-\+\s0-9]/.test(value)){correct=valid=false;error=Lang.get("reg.phone_sumbol_invalid")}}else if(prepareValue.length==0){valid=false;error=Lang.get("reg.phone_code_invalid")}else if(prepareValue.length<
5||prepareValue.length>32||value.length>50){valid=false;error=Lang.get("reg.phone_code_incorrect")}else if(!/^\d+$/.test(prepareValue)){correct=valid=false;error=Lang.get("reg.phone_sumbol_invalid")}if(correct)$error.hide();else $error.html(error).show();if(valid)$submit.form__enable();else $submit.form__disable()}function postValidate(){var t=this;var $phone=$('input[name="phone"]',t.$div);var $error=$("div.red:first, .js-error",t.$div);var $ismobile=$('input[name="ismobile"]',t.$div);var $submit=
$(".confirm-ok",t.$div);var value=$.trim($phone.val());var prepareValue=value.replace(/[\(\)\-\+\s]/g,"");var error="";var correct=true;var valid=true;if($ismobile.is(":checked"))if(prepareValue.length==0){valid=false;error=Lang.get("reg.phone_code_invalid")}else if(value.length<3){correct=valid=false;error=Lang.get("reg.phone_code_incorrect")}else{if(/[^\(\)\-\+\s0-9]/.test(value)){correct=valid=false;error=Lang.get("reg.phone_sumbol_invalid")}}else if(prepareValue.length==0){valid=false;error=Lang.get("reg.phone_code_invalid")}else if(prepareValue.length<
5||prepareValue.length>32||value.length>50){correct=valid=false;error=Lang.get("reg.phone_code_incorrect")}else if(!/^\d+$/.test(prepareValue)){correct=valid=false;error=Lang.get("reg.phone_sumbol_invalid")}if(correct)$error.hide();else $error.html(error).show();if(valid)$submit.form__enable();else $submit.form__disable()}$phone.bind({"keyup":$.proxy(liveValidate,t),"blur":$.proxy(function(){setTimeout($.proxy(postValidate,this),100)},t)});$ismobile.bind("click",$.proxy(liveValidate,t))});return layer},
_createLayer_check:function(){var t=this;var layer=new Layer("is-phone_verify_check");$(".confirm-return:first",layer.$div).bind("click",$.proxy(t._editPhoneLinkClick,t));$("a.withoutphone:first",layer.$div).bind("click",$.proxy(t._withoutPhoneLinkClick,t));$(".confirm-ok:first",layer.$div).bind("click",$.proxy(function(){t.check(t.data.phonecode,t.data.phone)},t));layer.bind("show",function(){var t=this;$(".confirm-return",t.$div).show();$(".confirm-ok",t.$div).hide()});return layer},_createLayer_noSMS1:function(){var t=
this;var layer=new Layer("is-nosms1");$("a.editphone:first",layer.$div).bind("click",$.proxy(t._editPhoneLinkClick,t));$("a.withoutphone:first",layer.$div).bind("click",$.proxy(t._withoutPhoneLinkClick,t));$(".confirm-return:first",layer.$div).bind("click",$.proxy(t._returnLinkClick,t));return layer},_createLayer_noSMS2:function(){var t=this,layer=new Layer("is-nosms2");$("a.editphone:first",layer.$div).bind("click",$.proxy(t._editPhoneLinkClick,t));$("a.withoutphone:first",layer.$div).bind("click",
$.proxy(t._withoutPhoneLinkClick,t));$(".js-ivr-visible").each(function(){this.style.display=t.options.ivr_lang?"":"none"});$(".js-no-ivr-visible").each(function(){this.style.display=t.options.ivr_lang?"none":""});$(".js-resend",layer.$div).bind("click",function(evt){evt.preventDefault();$.extend(t.data,{ivr:$(this).data("media")==="ivr"?1:0,ivr_lang:t.options.ivr_lang});t._noSMS1LayerCallback(true)});$(".confirm-return:first",layer.$div).bind("click",$.proxy(t._returnLinkClick,t));return layer},
_createLayer_genDel:function(){var t=this;var layer=new Layer("is-genDelPhone",$.proxy(t._genDelPhoneLayerCallback,t));$("a.nosmslink:first",layer.$div).bind("click",$.proxy(t._getSMSStatusLinkClick,t));$("a.resendsms:first",layer.$div).bind("click",$.proxy(t._genDelPhoneResendLinkClick,t));layer.bind("show",function(){var t=this;var $code=$('input[name="code"]',t.$div);var $error=$("div.red:first, .js-error",t.$div);var $info=$("div.info:first",t.$div);$error.add($info).hide();$code.val("")});return layer},
_createLayer_genDelPhoneConfirm:function(){var t=this;var layer=new Layer("is-genDelPhoneConfirm",$.proxy(t._genDelPhoneConfirmLayerCallback,t));$("a.codeisset:first",layer.$div).bind("click",$.proxy(t._getDelCodeIssetLinkClick,t));return layer},_createLayer_verifyPhoneConfirm:function(){var t=this;var layer=new Layer("is-verifyPhoneConfirm",$.proxy(t._verifyPhoneConfirmLayerCallback,t));$("a.codeisset:first",layer.$div).bind("click",$.proxy(t._verifyPhoneCodeIssetLinkClick,t));return layer},_createLayer_genDelPhoneSuccess:function(){var t=
this;var layer=new Layer("is-genDelPhoneSuccess");return layer},_createLayer_addPhoneAlreadyExists:function(){var t=this;var layer=new Layer("is-addPhoneAlreadyExists");return layer},_send:function(o){var t=this;if(t.xhrs[o.func_name])t.xhrs[o.func_name].abort();if(o.data&&/^[a-z]{2}$/i.test(o.data.phonecode))o.data.phonecode=patron.PhoneManager.getDigitalCountryCode(o.data.phonecode);t.xhrs[o.func_name]=patron.Ajax({type:"POST",url:"/cgi-bin/smsverificator?&ajax_call=1&lang="+patron.LANG+"&func_name="+
o.func_name,data:$.extend({x_reg_id:t.options.x_reg_id,user:t.options.user.name,domain:t.options.user.domain},o.data),timeout:o.timeout||5E3,complete:$.proxy(o.complete,t)})},_getLayer:function(name){var t=this,l=t.layers;return l[name]?l[name]:l[name]=t["_createLayer_"+name]()},_getLayerAsync:function(name,callback){var t=this,l=t.layers;l[name]?callback(l[name]):t["_createLayer_"+name](function(layer){callback(l[name]=layer)})},setOptions:function(o){var t=this;t.options=$.extend({},o)},check:function(phonecode,
phone){var t=this;var layer=t._getLayer("check");var $error=$("div.red:first, .js-error",layer.$div);var $load=$("div.inLoading:first",layer.$div);var $controls=$("div.controls:first",layer.$div);t.data=$.extend({"ismobile":1,"phonecode":phonecode,"phone":phone},{"ivr":t.data.ivr,"ivr_lang":t.options.ivr_lang});t._send({"func_name":t.options.x_reg_id?"register":"gen","data":t.data,"complete":t._checkComplete});$error.hide();$load.show();$controls.hide();layer.show()},phoneStatus:function(phonecode,
phone){var t=this;var layer=t._getLayer("check");var $error=$("div.red:first, .js-error",layer.$div);var $load=$("div.inLoading:first",layer.$div);var $controls=$("div.controls:first",layer.$div);phonecode=patron.PhoneManager.getDigitalCountryCode(phonecode);t.data={"phonecode":phonecode,"phone":phone};t._send({"func_name":"phone_status","data":{"phone":phonecode+phone},"complete":t._phoneStatusComplete});$error.hide();$load.show();$controls.hide();layer.show()},_phoneStatusComplete:function(result){var t=
this;t.ajaxResult=null;if(result.isOK())t.ajaxResult=result.getData();if(t.ajaxResult)if(t.ajaxResult.status=="ERROR"||t.ajaxResult.status=="INCORRECT_PHONE_NUMBER"){t.ajaxResult.text=Lang.get("reg.phone_code_incorrect");t._checkError()}else if(t.ajaxResult.status=="UNSUPPORTED_NUMBER"){t.ajaxResult.text=Lang.get("phone_status_error");t._checkError()}else if(t.ajaxResult.status=="latency"){var $c=t._getLayer("check").$div;var $controls=$("div.controls:first",$c);$(".confirm-return",$controls).hide();
$(".confirm-ok",$controls).show();t.ajaxResult.text=Lang.get("phone_status_latency");t._checkError()}else t.check(t.data.phonecode,t.data.phone);else t.check(t.data.phonecode,t.data.phone)},addPhone:function(){var t=this;var layer=t._getLayer("addPhone");var $error=$("div.red:first, .js-error",layer.$div);$error.hide();layer.show();layer.$div.find(".form__select").form__select()},signup:function(){var t=this;t._getLayer("signupPhone").show()},cancelDeletePhone:function(phone){var t=this;t.data={"phonecode":"",
"phone":phone};t._send({"func_name":"undelete","data":t.data,"complete":t._cancelDeletePhoneComplete})},_cancelDeletePhoneComplete:function(result){var t=this;t.ajaxResult=null;if(result.isOK())t.ajaxResult=result.getData();if(t.ajaxResult)t.triggerHandler("cancelDeletePhoneSuccess")},changeFlag:function(phone,flag){var t=this;t.data={"phonecode":"","phone":phone,"flags":flag};t._send({"func_name":"chflags","data":t.data,"complete":null})},deletePhone:function(phone,ismobile,verified){var t=this;
t.data={"phonecode":"","phone":phone.ID,"value":phone.Value};if(ismobile&&verified){var layer=t._getLayer("genDelPhoneConfirm");var $phone=$("span.phone:first",layer.$div);$phone.text(phone.Value);layer.show();t.triggerHandler("genDelPhoneConfirmShow",[t.data])}else t._send({"func_name":"delete","data":t.data,"complete":t._deletePhoneComplete})},deleteRemindPhone:function(phone){var t=this;t.data={"phonecode":"","phone":phone};t._send({"func_name":"del_remind_phone","data":t.data,"complete":t._deletePhoneComplete})},
selectVerifySomePhone:function(phones){var t=this;var layer=t._getLayer("selectVerifySomePhone");var $phoneSelect=$(".js-phone",layer.$div);var $phoneLabel=$(".js-phone-single",layer.$div);var html="";$.each(phones,function(k,v){html+='<option value="'+(v.ID?v.ID:v.Value)+'">'+v.Value+"</option>"});$phoneSelect.html(html);$phoneSelect.change();if(phones.length==1){html=phones[0].Value;$phoneLabel.text(html);$phoneLabel.show();$(".js-phone-container",layer.$div).hide()}layer.show()},verifySomePhone:function(phonecode,
phone){var t=this;var layer=t._getLayer("check");var $error=$("div.red:first, .js-error",layer.$div);var $load=$("div.inLoading:first",layer.$div);var $controls=$("div.controls:first",layer.$div);t.data={"phonecode":phonecode,"phone":phone};t._send({"func_name":"send_auth_code","data":t.data,"complete":t._verifySomePhoneComplete});$error.hide();$load.show();$controls.hide();layer.show()},verifyPhone:function(phonecode,phone){var t=this;t.data={"ismobile":1,"phonecode":phonecode,"phone":phone.ID};
var layer=t._getLayer("verifyPhoneConfirm");var $phone=$("span.phone:first",layer.$div);$phone.text(phone.Value);layer.show()},_genDelPhoneResendLinkClick:function(evt){var t=this;t._genDelPhoneConfirmLayerCallback(1);evt.preventDefault()},_getDelCodeIssetLinkClick:function(evt){var t=this;var layer=t._getLayer("genDel");var $code=$('input[name="code"]',layer.$div);var $error=$("div.red:first, .js-error",layer.$div);var $info=$("div.info:first",layer.$div);var $phone=$("span.phone:first",layer.$div);
$error.add($info).hide();$code.val("");$phone.text(t.data.value);t.prevLayer=layer.show();evt.preventDefault()},_verifySomePhoneCodeIssetLinkClick:function(evt){var t=this;var layer=t._getLayer("verifySomePhoneSingSMS");var $code=$('input[name="code"]',layer.$div);var $error=$("div.red:first, .js-error",layer.$div);var $info=$("div.info:first",layer.$div);var $phone=$("span.phone:first",layer.$div);$error.add($info).hide();$code.val("");$phone.text(t.data.phone);t.prevLayer=layer.show();evt.preventDefault()},
_verifySomePhoneAddPhoneLinkClick:function(evt){this.addPhone();evt.preventDefault()},_verifyPhoneCodeIssetLinkClick:function(evt){var t=this;var layer=t._getLayer("singSMS");var $code=$('input[name="code"]',layer.$div);var $error=$("div.red:first, .js-error",layer.$div);var $info=$("div.info:first",layer.$div);var $phone=$("span.phone:first",layer.$div);var $password=$(".js-password",layer.$div);$error.add($info).add($password).hide();$code.val("");$phone.text(t.data.phone);if(t.options.AskPassword)$password.show();
t.prevLayer=layer.show();evt.preventDefault()},_genDelPhoneConfirmLayerCallback:function(status){var t=this;if(status){var layer=t._getLayer("check");var $error=$("div.red:first, .js-error",layer.$div);var $load=$("div.inLoading:first",layer.$div);var $controls=$("div.controls:first",layer.$div);t._send({"func_name":"gendel","data":t.data,"complete":t._genDelPhoneComplete});$error.hide();$load.show();$controls.hide();layer.show()}},_verifyPhoneConfirmLayerCallback:function(status){var t=this;if(status)t.check(t.data.phonecode,
t.data.phone)},_genDelPhoneLayerCallback:function(status){var t=this;var $c=t._getLayer("genDel").$div;if(status){t.data.code=$.trim($('input[name="code"]',$c).val());t._send({"func_name":"delete","data":t.data,"complete":t._verifyGenDelComplete});return 1}else t.triggerHandler("genDelPhoneCancel")},_verifyGenDelComplete:function(result){var t=this;t.ajaxResult=null;if(result.isOK())t.ajaxResult=result.getData();if(t.ajaxResult)if(t.ajaxResult.error_type===2)t._verifyGenDelPhoneError();else t._verifyGenDelPhoneSuccess()},
_verifyGenDelPhoneSuccess:function(){var t=this;var $c=t._getLayer("genDelPhoneSuccess").$div;var $phone=$("span.phone:first",$c);var readablephone="";if(t.ajaxResult)readablephone=t.ajaxResult.readable_phone;$phone.text(readablephone);t._getLayer("genDelPhoneSuccess").show();t.triggerHandler("verifyGenDelSuccess",[t.data])},_verifyGenDelPhoneError:function(){var t=this;var $c=t._getLayer("genDel").$div;var $error=$("div.red:first, .js-error",$c);var text="";if(t.ajaxResult)text=t.ajaxResult.text;
$error.html(text).show()},_genDelPhoneComplete:function(result){var t=this;t.ajaxResult=null;if(result.isOK())t.ajaxResult=result.getData();if(t.ajaxResult)if(t.ajaxResult.error_type===2)t._genDelPhoneError();else t._genDelPhoneSuccess();else t._genDelPhoneError()},_genDelPhoneSuccess:function(){var t=this;var $c=t._getLayer("genDel").$div;var $phone=$("span.phone:first",$c);var $info=$("div.info:first",$c);var readablephone="";t.prevLayer=t._getLayer("genDel").show();if(t.ajaxResult){if(t.ajaxResult.text)if(t.ajaxResult.error_type===
1)$info.html(t.ajaxResult.text).show();readablephone=t.ajaxResult.readable_phone}$phone.text(readablephone)},_genDelPhoneError:function(){var t=this;var $c=t._getLayer("check").$div;var $load=$("div.loadProgress:first, .js-loadProgress",$c);var $error=$("div.red:first, .js-error",$c);var $controls=$("div.controls:first",$c);var text=Lang.get("verify_phone_error");if(t.ajaxResult)text=t.ajaxResult.text;$error.html(text).show();$controls.hide()},_deletePhoneComplete:function(result){var t=this;t.ajaxResult=
null;if(result.isOK())t.ajaxResult=result.getData();if(t.ajaxResult)if(!patron.SecretDisabled&&(t.ajaxResult.result==543709||t.ajaxResult.result=="PHONE_LAST_VERIFIED_WO_PWD_QSTN"))t._getLayerAsync(patron.IsMyCom?"addAdditionalEmail":"addPasswordQuestion",function(layer){layer.show()});else t.triggerHandler("deletePhoneSuccess",[t.ajaxResult,t.data])},_noSMS1LayerCallback:function(status){var t=this;if(status)if(t.options.user.isDisabled)t.verifySomePhone(t.data.phonecode,t.data.phone);else t.check(t.data.phonecode,
t.data.phone)},_returnLinkClick:function(evt){var t=this;t.prevLayer.show();evt.preventDefault()},_withoutPhoneLinkClick:function(evt){var t=this;t._getLayer("noSMS1").hide();t._getLayer("noSMS2").hide();t._getLayer("check").hide();evt.preventDefault();t.triggerHandler("withoutPhone")},_editPhoneLinkClick:function(evt){var t=this;t._getLayer("noSMS1").hide();t._getLayer("noSMS2").hide();t._getLayer("check").hide();evt.preventDefault();t.triggerHandler("editPhone")},_getSMSStatusLinkClick:function(evt){var t=
this;t._getSMSStatus();evt.preventDefault()},_getSMSStatus:function(){var t=this;var layer=t._getLayer("check");var $error=$("div.red:first, .js-error",layer.$div);var $load=$("div.loadProgress:first",layer.$div);t._send({"func_name":"get_status","data":t.data,"complete":t._getSMSStatusComplete});$error.hide();$load.show();layer.show()},_getSMSStatusComplete:function(result){var t=this;t.ajaxResult=null;if(result.isOK())t.ajaxResult=result.getData();if(t.ajaxResult)if(t.ajaxResult.status==1)t._noSMS1LayerShow();
else t._noSMS2LayerShow()},_noSMS1LayerShow:function(){var t=this;var $c=t._getLayer("noSMS1").$div;var $phone=$("span.phone:first, .js-phone",$c);var $time=$("span.time:first, .js-time",$c);var readablephone="";var minutes=0;if(t.ajaxResult){readablephone=t.ajaxResult.readable_phone;minutes=t.ajaxResult.time_passed}$phone.text(readablephone);$time.text(t._getReadableTimeByMinutes(minutes));t._getLayer("noSMS1").show()},_getReadableTimeByMinutes:function(m){var s="";m=parseInt(m)||0;if(m<5)s=Lang.get("phonemanager.lt5min");
else if(m<10)s=Lang.get("phonemanager.lt10min");else if(m<15)s=Lang.get("phonemanager.lt15min");else if(m<20)s=Lang.get("phonemanager.lt20min");else if(m<30)s=Lang.get("phonemanager.lt30min");else if(m<60)s=Lang.get("phonemanager.lt60min");else s=Lang.get("phonemanager.gt60min");return s},_noSMS2LayerShow:function(){var t=this;var layer=t._getLayer("noSMS2");var $phone=$("span.phone:first",layer.$div);var readablephone="";if(t.ajaxResult)readablephone=t.ajaxResult.readable_phone;$phone.text(readablephone);
layer.show();Counter.d(3915567);Counter.d(3915596)},_selectVerifySomePhoneCallback:function(status){var t=this;var layer=t._getLayer("selectVerifySomePhone");if(status){var $phoneSelect=$(".js-phone",layer.$div);var phone=$phoneSelect.val();t.verifySomePhone("",phone)}},_verifySomePhoneSingSmsCallback:function(status){var t=this;var layer=t._getLayer("verifySomePhoneSingSMS");if(status){t.data.code=$.trim($('input[name="code"]',layer.$div).val());if(t.data.code)t._send({"func_name":"send_auth_code",
"data":t.data,"complete":t._verifySomePhoneSingSmsComplete});else{t.ajaxResult={text:Lang.get("captcha_invalid")};t._verifySomePhoneSingSmsError()}return 1}else t.triggerHandler("verifyPhoneCancel",[t.data])},_signupSmsCallback:function(status){var t=this;var $c=t._getLayer("singSMS").$div;if(status){t.data.code=$.trim($('input[name="code"]',$c).val());if(t.options.passcheck)t._send({"func_name":"verifyfromremind","data":t.data,"complete":t._verifyComplete});else{t.data.password=$.trim($('input[name="password"]',
$c).val());t._send({"func_name":"verify","data":t.data,"complete":t._verifyComplete})}return 1}else{t.triggerHandler("verifyPhoneCancel",[t.data]);$(document).trigger("PhoneManager.verifyPhoneCancel")}},_signupPhoneCallback:function(status){var t=this;var $c=t._getLayer("signupPhone").$div;if(status){t.data.phonecode=$.trim($('select[name="phonecode"]',$c).val());t.data.phone=$.trim($('input[name="phone"]',$c).val());t.data.ismobile=$('input[name="ismobile"]:checked',$c).length;t._send({"func_name":"addnew",
"data":t.data,"complete":t._signupPhoneComplete});return 1}},_signupPhoneComplete:function(result){var t=this;t.ajaxResult=null;if(result.isOK())t.ajaxResult=result.getData();if(t.ajaxResult)if(t.ajaxResult.error_type===2||t.ajaxResult.error_type===4)t._signupPhoneError();else t._signupPhoneSuccess();else t._signupPhoneError()},_signupPhoneError:function(){var t=this;var $c=t._getLayer("signupPhone").$div;var $error=$("div.red:first, .js-error",$c);var text="";if(t.ajaxResult)text=t.ajaxResult.text;
$error.html(text).show()},_signupPhoneSuccess:function(){var t=this;var $c=t._getLayer("singSMS").$div;var $error=$("div.red:first, .js-error",$c);var $info=$("div.info:first",$c);var $mainText=$("div.mainText:first",$c);var $password=$(".js-password",$c);$error.add($info).add($mainText).add($password).hide();if(t.ajaxResult)if(t.ajaxResult.text)if(t.ajaxResult.error_type===1)$info.html(t.ajaxResult.text).show();else $mainText.html(t.ajaxResult.text).show();if(t.data.ismobile)t.prevLayer=t._getLayer("singSMS").show();
else t._getLayer("signupPhone").hide();t.triggerHandler("signupPhoneSuccess",[t.data]);$(document).trigger("PhoneManager.signupPhoneSuccess")},_addAlternativePassremindCallback:function(layer,status){if(status){var $form=$("form",layer.$div);var data=$form.toObject();if(!data.additional_email){data.secret={question:data.custom_question||data.question,answer:data.answer};delete data.question;delete data.custom_question;delete data.answer}data.capcha=data.security_image_answer;delete data.security_image_answer;
patron.API.post($form.attr("action"),data,this._addAlternativePassremindComplete.bind(this,layer));return 1}},_addAlternativePassremindComplete:function(layer,result){var data=result.getData();if(result.isOK())this.deletePhone({ID:this.data.phone});else{var $error=$(".js-error",layer.$div);var errorStr;if(data["capcha"])errorStr=Lang.get("captcha_invalid");else if(data["current_password"])errorStr=Lang.get("delete_phone_error.NO_AUTH");else if(data["additional_email"])errorStr=Lang.get("delete_phone_error.EMPTY_ADDITIONAL_EMAIL");
else if(data["secret.question"])errorStr=Lang.get("delete_phone_error.EMPTY_QUESTION");else if(data["secret.answer"])errorStr=Lang.get("delete_phone_error.EMPTY_ANSWER");else errorStr=Lang.get("delete_phone_error.DEFAULT");$error.html(errorStr).show();refreshCaptcha(layer)}},_addPhoneCallback:function(status){var t=this;var $c=t._getLayer("addPhone").$div;if(status){t.data.phonecode=$.trim($('select[name="phonecode"]',$c).val());t.data.phone=$.trim($('input[name="phone"]',$c).val());t.data.ismobile=
$('input[name="ismobile"]:checked',$c).length;if(t.options.passcheck)t._send({"func_name":"addfromremind","data":t.data,"complete":t._addPhoneComplete});else t._send({"func_name":"addnew","data":t.data,"complete":t._addPhoneComplete});return 1}},_addPhoneComplete:function(result){var t=this;t.ajaxResult=null;if(result.isOK())t.ajaxResult=result.getData();if(t.ajaxResult)if(t.ajaxResult.error_type===2||t.ajaxResult.error_type===4)t._addPhoneError();else if(t.ajaxResult.error_type===5)if(t.options.user.isDisabled)t.verifySomePhone(t.data.phonecode,
t.data.phone);else t._addPhoneAlreadyExists();else t._addPhoneSuccess();else t._addPhoneError()},_addPhoneAlreadyExistsCallback:function(evt,status){this.triggerHandler("addPhoneAlreadyExistsSuccess",[this.ajaxResult,this.data])},_addPhoneAlreadyExists:function(){var t=this;Layer.get("addPhoneAlreadyExists",function(layer){var $phone=$(".js-phone",layer.$div);var readablephone="";if(t.ajaxResult)readablephone=t.ajaxResult.readable_phone;$phone.text(readablephone);layer.one("callback",$.proxy(t._addPhoneAlreadyExistsCallback,
t));layer.show()})},_addPhoneError:function(){var t=this;var layer=t._getLayer("addPhone");var $error=$("div.red:first, .js-error",layer.$div);var text="";if(t.ajaxResult)text=t.ajaxResult.text;$error.html(text).show()},_addPhoneSuccess:function(){var t=this;var signLayer=t._getLayer("singSMS");var addPhoneLayer=t._getLayer("addPhone");var $error=$("div.red:first, .js-error",signLayer.$div);var $info=$("div.info:first",signLayer.$div);var $mainText=$("div.mainText:first",signLayer.$div);var $password=
$(".js-password",signLayer.$div);$error.add($info).add($mainText).add($password).hide();if(t.ajaxResult){if(t.ajaxResult.text)if(t.ajaxResult.error_type===1)$info.html(t.ajaxResult.text).show();else $mainText.html(t.ajaxResult.text).show();var $nosmslinkText=$(".js-nosmslink-text",signLayer.$div);var match;$nosmslinkText.each(function(){if(this.getAttribute("data-case")===t.ajaxResult.result){match=true;this.style.display=""}else this.style.display="none"});if(!match)$nosmslinkText.filter('[data-case="DEFAULT"]').get(0).style.display=
""}if(t.options.AskPassword)$password.show();if(t.data.ismobile)t.prevLayer=signLayer.show();else addPhoneLayer.hide();t.triggerHandler("addPhoneSuccess",[t.ajaxResult,t.data])},_verifySomePhoneSuccess:function(){var t=this;var signLayer=t._getLayer("verifySomePhoneSingSMS");var $error=$("div.red:first, .js-error",signLayer.$div);var $info=$("div.info:first",signLayer.$div);var $mainText=$("div.mainText:first",signLayer.$div);$error.add($info).add($mainText).hide();if(t.ajaxResult&&t.ajaxResult.text)if(t.ajaxResult.error_type===
1)$info.html(t.ajaxResult.text).show();else $mainText.html(t.ajaxResult.text).show();t.prevLayer=signLayer.show();t.triggerHandler("addPhoneSuccess",[t.ajaxResult,t.data])},_verifySomePhoneSingSmsComplete:function(result){var t=this;t.ajaxResult=null;if(result.isOK())t.ajaxResult=result.getData();if(t.ajaxResult)if(t.ajaxResult.error_type)t._verifySomePhoneSingSmsError();else t._verifySuccess();else t._verifySomePhoneSingSmsError()},_verifySomePhoneSingSmsError:function(){var t=this;var layer=t._getLayer("verifySomePhoneSingSMS");
var $error=$("div.red:first, .js-error",layer.$div);var text="";if(t.ajaxResult)text=t.ajaxResult.text;$error.html(text).show()},_verifyComplete:function(result){var t=this;t.ajaxResult=null;if(result.isOK())t.ajaxResult=result.getData();if(t.ajaxResult)if(t.ajaxResult.error_type)t._verifyError();else t._verifySuccess();else t._verifyError()},_verifyError:function(){var t=this;var $c=t._getLayer("singSMS").$div;var $error=$("div.red:first, .js-error",$c);var text="";if(t.ajaxResult)text=t.ajaxResult.text;
$error.html(text).show()},_verifySuccess:function(){var t=this;t.triggerHandler("verifySuccess",[t.ajaxResult,t.data])},_verifySomePhoneComplete:function(result){var t=this;t.ajaxResult=null;if(result.isOK())t.ajaxResult=result.getData();if(t.ajaxResult)if(t.ajaxResult.error_type===2)t._checkError();else t._verifySomePhoneSuccess();else t._checkError()},_checkComplete:function(result){var t=this;t.ajaxResult=null;if(result.isOK()){t.ajaxResult=result.getData();if(t.ajaxResult.ivr_lang)t.options.ivr_lang=
t.ajaxResult.ivr_lang}else if(result.status==="wrong_reg"){window.location.reload();return}if(t.ajaxResult)if(t.ajaxResult.verified)t._verifySuccess();else if(t.ajaxResult.error_type===2)t._checkError();else t._addPhoneSuccess();else t._checkError()},_checkError:function(){var t=this;var $c=t._getLayer("check").$div;var $load=$("div.loadProgress:first",$c);var $error=$("div.red:first, .js-error",$c);var $controls=$("div.controls:first",$c);var text=Lang.get("verify_phone_error");if(t.ajaxResult)text=
t.ajaxResult.text;$load.hide();$error.html(text).show();$controls.show()},_applyCountryList:function($context,layer){var $prefix=$(".js-phonePrefix, .phonePrefix",$context);var $phoneCodeSelect=$('select[name="phonecode"]',$context).empty();var $phone=$('input[name="phone"]',$context);var countryData={};var phoneCodeType=patron.UseAlphaPhoneCode?"alphaCode":"Code";$.each(patron.PhoneManager.sortCountryList(window.CountryList),function(key,country){$("<option/>",{"value":country[phoneCodeType],"css":{"fontWeight":country.Top?
"bold":""},"text":country.Country}).appendTo($phoneCodeSelect);countryData[country[phoneCodeType]]=country});$phoneCodeSelect.bind("change",function(){var country=countryData[$(this).val()];layer.countryCode=country.Code;$prefix.css("backgroundImage",'url("'+country.Icon+'")').text("+"+country.Code).show();var p=$prefix[0].offsetWidth+10;$phone.css({"paddingLeft":p,"width":166-p})}).change();patron.PhoneManager.countryData=countryData}})})(jQuery);jsLoader.loaded("{patron}patron.PhoneManager")});
jsLoader.use(["{utils}Counter"],function(){(function($){var COUNTERS={VERIFIED_SHOW:386681,VERIFIED_SUCCESS:386683,VERIFIED_FAIL:386684,UNVERIFIED_SHOW:386686,UNVERIFIED_SIGNUP_PHONE:386687,UNVERIFIED_SEND_REQUEST:386688,UNVERIFIED_CANCEL:386689,UNVERIFIED_SUCCESS:386690,UNVERIFIED_FAIL:386691,COMPOSE_SHOW:440880,COMPOSE_SEND:440881,COMPOSE_SAVE:440882,COMPOSE_CANCEL:440883,COMPOSE_SHOW_ALL_FIELDS:440884,COMPOSE_REAL_NAME_LINK_CLICK:440885,COMPOSE_REAL_NAME_CHANGE:440887,COMPOSE_REAL_NAME_SETTINGS:440889,
COMPOSE_ADDRESSBOOK_LINKS_CLICK:440890,COMPOSE_ADDRESSBOOK_ICONS_CLICK:440891,COMPOSE_UPLOADER_ADD_FILE_FLASH:440892,COMPOSE_UPLOADER_ADD_FILE_JS:440893,COMPOSE_UPLOADER_SETTINGS:440895,COMPOSE_PRIORITY:440896,COMPOSE_RECEIPT:440897,COMPOSE_EDITOR_TOOLBAR_BOTTONS_LT_SMILES:440898,COMPOSE_EDITOR_TOOLBAR_SMILES:440899,COMPOSE_EDITOR_TOOLBAR_UNDOREDO:440901,COMPOSE_EDITOR_TOOLBAR_BOTTONS_FORMAT:440902,COMPOSE_EDITOR_TOOLBAR_ENABLE_TEXT_EDITOR:440903,COMPOSE_EDITOR_TOOLBAR_ENABLE_HTML_EDITOR:440904,COMPOSE_EDITOR_TOOLBAR_TRANSFER:440905,
COMPOSE_EDITOR_TOOLBAR_KEYBOARD:440907,COMPOSE_EDITOR_TOOLBAR_SPELL:440908,COMPOSE_EDITOR_TOOLBAR_TRANSLIT:440909,COMPOSE_EDITOR_TOOLBAR_STYLE:440910,COMPOSE_EDITOR_TOOLBAR_STYLE_SELECT:440911,COMPOSE_EDITOR_TOOLBAR_SIGNATURE:1345775,COMPOSE_EDITOR_TOOLBAR_SIGNATURE_CLICK:1345777,COMPOSE_EDITOR_TOOLBAR_CARD_SELECT:1345781,FOLDERS_INBOX:440739,FOLDERS_BULK:440740,FOLDERS_SENT:440741,FOLDERS_DRAFTS:440742,FOLDERS_TRASH:440745,FOLDERS_USER:440746,FOLDERS_SETTINGS:440748,FOLDERS_UNREAD:440749,FOLDERS_MRIM_ARCH:440750,
FOLDERS_CLEAR_TRASH:440751,FOLDERS_CLEAR_BULK:440752,FOLDERS_MORE:{UP:1982659,DOWN:1982667},MSGLIST_PAGE1:440753,MSGLIST_PAGE2:440755,MSGLIST_PAGE3:440756,MSGLIST_PAGE4:440757,MSGLIST_PAGE5:440758,MSGLIST_PAGE_OTHER:440760,MSGLIST_SHORT_MODE:440762,MSGLIST_FULL_MODE:440763,MSGLIST_SELECT_LINK:440764,MSGLIST_SELECT_ALL_LINK:440765,MSGLIST_SELECT_UNREAD_LINK:440766,MSGLIST_SELECT_READ_LINK:440767,MSGLIST_SELECT_MARK_LINK:440769,MSGLIST_SELECT_WITHFILES_LINK:440771,MSGLIST_SELECT_FROMUSER_LINK:440772,
MSGLIST_SELECT_NONE_LINK:440773,MSGLIST_DELETE:440774,MSGLIST_SPAM:440775,MSGLIST_MOVE_LINK:440778,MSGLIST_MOVE:440779,MSGLIST_MOVE_CREATE_NEW_FOLDER:440780,MSGLIST_MARK_LINK:440781,MSGLIST_MARK_READ:440782,MSGLIST_MARK_UNREAD:440783,MSGLIST_MARK_FLAG:440784,MSGLIST_MARK_UNFLAG:440785,MSGLIST_MORE_LINK:440786,MSGLIST_MORE_ADDRESSBOOK:440787,MSGLIST_MORE_BLACKLIST:440788,MSGLIST_MORE_CREATE_FILTER:440790,MSGLIST_MORE_SEARCH:440792,MSGLIST_MORE_FORWARD:440793,MSGLIST_SORT_LINK:440795,MSGLIST_SORT:440796,
MSGLIST_ATTACH:440799,READMSG_SHOW:440802,READMSG_PREV_MESSAGE:440809,READMSG_NEXT_MESSAGE:440810,READMSG_REPLY:440811,READMSG_REPLY_ALL:440812,READMSG_FORWARD:440813,READMSG_DELETE:440815,READMSG_SPAM:440816,READMSG_MOVE_LINK:440817,READMSG_MOVE:440818,READMSG_MOVE_CREATE_NEW_FOLDER:440819,READMSG_MARK_LINK:440820,READMSG_MARK_READ:440821,READMSG_MARK_UNREAD:440822,READMSG_MARK_FLAG:440824,READMSG_MARK_UNFLAG:440825,READMSG_MORE_LINK:440826,READMSG_MORE_ADDRESSBOOK:440827,READMSG_MORE_BLACK_LIST:440828,
READMSG_MORE_CREATE_FILTER:440829,READMSG_MORE_SEARCH:440831,READMSG_MORE_TRANSFER:440832,READMSG_MORE_PRINT:440833,READMSG_MORE_DOWNLOAD:440834,READMSG_MORE_RESEND:440835,READMSG_MORE_FORWARD:440836,READMSG_MORE_RFC:440837,READMSG_PRINT_ICON:440838,READMSG_TRANSLIT_ICON:440839,READMSG_FLAG_ICON:440841,READMSG_ADDRESSBOOK_ICON:440842,READMSG_SEARCH_FROM_USER:440843,READMSG_CHANGE_AVATAR:440844,READMSG_ATTACH_ICON:440845,READMSG_ATTACH_IMAGE_SHOW:440846,READMSG_ATTACH_TXTSHOW:440847,READMSG_ATTACH_LINK:440848,
READMSG_ATTACH_ITEM_LINK:440849,READMSG_ATTACH_DOWNLOAD:440850,READMSG_ATTACH_ITEM_IMAGE_PREVIEW:440852,READMSG_ATTACH_ITEM_IN_ALBUM:440853,READMSG_ATTACH_ITEM_PREVIEW:440854,READMSG_FAST_ANSWER_SHORT_REPLY:440855,READMSG_FAST_ANSWER_SHORT_REPLYALL:440856,READMSG_FAST_ANSWER_SHORT_FORWARD:440857,READMSG_FAST_ANSWER_SHORT_TEXTAREA:440858,READMSG_FAST_ANSWER_FULL_REPLY:440860,READMSG_FAST_ANSWER_FULL_REPLYALL:440862,READMSG_FAST_ANSWER_FULL_FORWARD:440863,READMSG_FAST_ANSWER_FULL_FORM_LINK:440865,READMSG_FAST_ANSWER_FULL_FORM:440867,
READMSG_FAST_ANSWER_FULL_SEND:440868,READMSG_FAST_ANSWER_FULL_SAVE:440870,READMSG_FAST_ANSWER_FULL_CANCEL:440872,ATTACH_VIEWER_LIST_CLICK:590136,ATTACH_VIEWER_SLIDER_NEXT_CLICK:590140,ATTACH_VIEWER_SLIDER_PREV_CLICK:590142,ATTACH_VIEWER_PREVIEW_PREV_CLICK:590144,ATTACH_VIEWER_PREVIEW_NEXT_CLICK:590145,ATTACH_VIEWER_SLIDER_LIST_CLICK:590146,ATTACH_VIEWER_SLIDER_ROOT_CLICK:1789089,ATTACH_VIEWER_SUBJECT_CLICK:1789080,ATTACH_VIEWER_RESIZE_CLICK:1789090,ATTACH_VIEWER_RESIZE_MINUS_CLICK:1789094,ATTACH_VIEWER_PREVIEW_IMAGE_CLICK:590155,
ATTACH_VIEWER_PREVIEW_OTHER_CLICK:590156,ATTACH_VIEWER_PREVIEW_CLOSE_CLICK:590157,ATTACH_VIEWER_PREVIEW_DOWNLOAD_CLICK:590158,ATTACH_VIEWER_PREVIEW_IN_ALBUM_CLICK:590162,ATTACH_VIEWER_PREVIEW_NEW_WINDOW_CLICK:590164,ATTACH_VIEWER_MODE_SHORT_CLICK:602416,ATTACH_VIEWER_MODE_FULL_CLICK:602418,THEMES:{"default":518501,"t1000":518503,"t1001":518504,"t1002":518505,"t1003":529521,"t1004":529522,"t1005":529523,"t1006":529524,"t1007":529525,"t1009":529526,"t1010":529527,"t1011":529528,"t1012":529529,"t1008":542191,
"t1013":542192,"t1014":542193,"t1015":542195,"t1016":542196,"t1017":545468,"t1018":545464,"t1021":545466,"t1022":545462,"t1023":545469,"t1024":558990,"t1025":570162,"t1026":570164,"t1027":570163,"t1028":599645,"t1029":603227,"t1030":603228,"t1031":603229,"t1032":603230,"t1038":658518,"t1036":658521,"t1037":658513,"t1041":660449,"t1040":658516,"t1042":720575,"t1043":660446,"t1044":545471,"t1045":818213,"t1046":868710,"t1047":868709,"t1048":866077,"t1049":972824,"t1050":1020302,"t1051":1031938,"t1052":1031708,
"t1053":603231,"t1054":1106787,"t1055":1119205,"t1056":1150108,"t1057":1138594,"t1058":1152229,"t1059":1168842,"t1060":1049171,"t1061":1180031,"t1062":1196375,"t1063":1220788,"t1064":1152231,"t1065":1220790,"t1066":1271947,"t1067":1296950,"t1068":1315466,"t1069":1296227,"t1070":1220787,"t1071":1325858,"t1072":1325869,"t1073":1325861,"t1074":1325863,"t1075":1348691,"t1076":1347100,"t1077":1348692,"t1078":1392414,"t1079":1392418,"t1080":1409909,"t1081":1392416,"t1082":1461732,"t1083":1430420,"t1084":1489721,
"t1085":1489722,"t1086":1541523,"t1087":1541609,"t1088":1628557,"t1089":1807124,"t1090":1852220,"t1101":5568497,"t1102":3036292,"t1103":3493005,"t1104":3990266,"t1105":3672508,"t1106":3672510,"t1107":3672511,"t1108":3672512,"t1109":3672514,"t1110":4236569,"t1112":5433519,"t1113":5598407,"t1117":5753261,"t1118":5756779,"t1119":5756681,"t1120":5756678,"t1124":7589355,"t1125":8307665,"t1190":6587117,"t1191":1628549,"t1192":1628555,"t1193":1628550,"t1194":2062651,"t1195":2062652,"t1196":2062648,"t1197":1628548,
"t1198":2062654,"t1199":2062647,"t2011":5719916,"t2012":5719917,"t2013":5719923,"t2014":5719932,"t2015":5719945,"t2016":5719953,"t2017":5719967,"t2018":5719915,"t2019":5719971,"t2020":5719973,"t2022":5719975,"t2023":5719977,"t2024":5719980,"t2025":5719982,"t2026":5719997,"t2027":5720005,"t2028":5720024,"t2031":5720045,"t2032":5720083,"t2033":5720125,"t2034":5720151},THEMES_ON_PAGE_LOAD:{"default":585249,"t1000":585250,"t1001":585251,"t1002":585645,"t1003":585646,"t1004":585651,"t1005":585644,"t1006":585650,
"t1007":585647,"t1008":585656,"t1009":585648,"t1010":585664,"t1011":585659,"t1012":585667,"t1013":585658,"t1024":585662,"t1015":585652,"t1016":585655,"t1017":585657,"t1018":585663,"t1019":585673,"t1021":585670,"t1022":585654,"t1023":585665,"t1025":585649,"t1026":585666,"t1027":585661,"t1028":599644,"t1029":603236,"t1030":603237,"t1031":603239,"t1033":585671,"t1034":625677,"t1038":658529,"t1036":656830,"t1037":658523,"t1041":660487,"t1040":658527,"t1042":720576,"t1043":660483,"t1044":585673,"t1045":818202,
"t1046":868711,"t1047":868708,"t1048":866080,"t1049":972825,"t1050":1020300,"t1051":1031939,"t1052":1031709,"t1053":603243,"t1054":1106788,"t1055":1119206,"t1056":1150111,"t1057":1138595,"t1058":1152230,"t1059":1168846,"t1060":1049160,"t1061":1180032,"t1062":1196376,"t1063":1220792,"t1064":1152234,"t1065":1220793,"t1066":1271948,"t1067":1296952,"t1068":1315467,"t1069":1296228,"t1070":1220791,"t1071":1325872,"t1072":1325879,"t1073":1325875,"t1074":1325877,"t1075":1348693,"t1076":1347101,"t1077":1348694,
"t1078":1392428,"t1079":1392433,"t1080":1409910,"t1081":1392430,"t1082":1461734,"t1083":1430421,"t1084":1489723,"t1085":1489724,"t1086":1541524,"t1087":1541612,"t1088":1628545,"t1089":1807125,"t1090":1852222,"t1101":5568496,"t1102":3036298,"t1103":3493011,"t1104":3990267,"t1105":3672518,"t1106":3672522,"t1107":3672524,"t1108":3672526,"t1109":3672528,"t1110":4236578,"t1112":5433525,"t1113":5598416,"t1117":5753264,"t1118":5756769,"t1119":5756688,"t1120":5756666,"t1124":7589374,"t1125":8307671,"t1190":6587123,
"t1191":1628537,"t1192":1628540,"t1193":1628539,"t1194":2062668,"t1195":2062671,"t1196":2062664,"t1197":1628536,"t1198":2062674,"t1199":2062660,"t2011":5720185,"t2012":5720187,"t2013":5720189,"t2014":5720192,"t2015":5720193,"t2016":5720197,"t2017":5720198,"t2018":5720183,"t2019":5720204,"t2020":5720205,"t2022":5720206,"t2023":5720207,"t2024":5720208,"t2025":5720209,"t2026":5720212,"t2027":5720213,"t2028":5720214,"t2031":5720215,"t2032":5720217,"t2033":5720218,"t2034":5720219},LANG_ON_PAGE_LOAD:{"ru_RU":688171,
"uk_UA":688173,"en_US":688175,"uz_UZ":827872,"be_BY":997040,"kk_KZ":1169273,"es_ES":1196378,"hy_AM":1196383,"de_DE":3372471,"mo_MD":3372473,"ro_RO":3372475},LANG_ON_CHANGE:{"ru_RU":688170,"uk_UA":688172,"en_US":688174,"uz_UZ":827871,"be_BY":997037,"kk_KZ":1169268,"es_ES":1196373,"hy_AM":1196382,"de_DE":3372450,"mo_MD":3372472,"ro_RO":3372474},EXTERNAL:{oauth_token_restored:4017336,oauth_password_restored:4017204},SIGNUP_PAGE:{external:{submit:1740552,show:1740552,captcha:1740557,hosts:{yandex:1864820,
gmail:1864825,qip:1864861,yahoo:1864919,outlook:1864931,hotmail:1864937}},pdd:{submit:1797988,show:1797987,captcha:1802105,hosts:{yandex:1864971,gmail:1864968}},tutorial:{skip:2421887}},LOGIN_PAGE:{"default":{show:1551883}},ATTACH_ARCHIVE:{"rar":655847,"zip":655849,"7z":655850,"arj":655851,"tar":655852,"jar":655853,"bz2":655854,"gz":655856,"lzh":655857,"cab":655858},EXTERNAL_ACCOUNT:{signup:{settings:{show:3172062,success:3172062,fail:{exists_domain:3172075,collect_auth_fail:3172082,smtp_auth_fail:3172085,
collect_timeout:3172330,smtp_timeout:3172333}},suggests:{show:{load:3171886,hint:3171998},click:{any:3171886,hint:3171998,wrong:3172016}},user:{}}},COLLECTOR:{EXTERNAL_ACCOUNT:1715266,EDIT:{success:1672592,fail:1672592,layer:{pop3:{main:{yandex:1801169,rambler:1801171,gmail:1801176,qip:1801173,yahoo:1801178,hotmail:1801179},other:1801185,folder:1801210,active:1801185,convert:1801181}},alert:{pop3:{show:1801155,later:1801165,skip:1801166}},auth_limit:2041344},ADD:{show:1685432,success:1685432,auth_limit:2041344},
BUTTON:1982674}};$(window).bind({"external.oauth_token_restored":function(){Counter.d(COUNTERS.EXTERNAL.oauth_token_restored)},"external.oauth_password_restored":function(){Counter.d(COUNTERS.EXTERNAL.oauth_password_restored)},"external_account.signup.settings.show":function(){Counter.d(COUNTERS.EXTERNAL_ACCOUNT.signup.settings.show)},"external_account.signup.settings.success":function(){Counter.sb(COUNTERS.EXTERNAL_ACCOUNT.signup.settings.success)},"external_account.signup.settings.fail":function(event,
error){var counter=COUNTERS.EXTERNAL_ACCOUNT.signup.settings.fail[error];if(counter)Counter.d(counter)},"external_account.signup.suggests.show":function(event,data){var counter=COUNTERS.EXTERNAL_ACCOUNT.signup.suggests.show[data];if(counter)Counter.d(counter)},"external_account.signup.suggests.click":function(event,data){var counter=COUNTERS.EXTERNAL_ACCOUNT.signup.suggests.click[data];if(counter)Counter.sb(counter)}});$(window).bind({"collector.external_account":function(){Counter.d(COUNTERS.COLLECTOR.EXTERNAL_ACCOUNT)},
"collector.edit.success":function(){Counter.sb(COUNTERS.COLLECTOR.EDIT.success)},"collector.edit.show":function(){Counter.d(COUNTERS.COLLECTOR.EDIT.success)},"collector.edit.fail":function(){Counter.sb(COUNTERS.COLLECTOR.EDIT.fail)},"collector.edit.layer":function(event,data){var counter=COUNTERS.COLLECTOR.EDIT.layer[data.type||"pop3"][data.action];Counter[data.state](counter)},"collector.edit.alert":function(event,data){var counter=COUNTERS.COLLECTOR.EDIT.alert[data.type||"pop3"][data.action];if(typeof data.provider==
"object")counter=counter[data.provider];Counter[data.state](counter)},"collector.edit.auth_limit":function(){Counter.d(COUNTERS.COLLECTOR.EDIT.auth_limit)},"collector.add.show":function(){Counter.d(COUNTERS.COLLECTOR.ADD.show)},"collector.add.auth_limit":function(){Counter.d(COUNTERS.COLLECTOR.ADD.auth_limit)},"collector.add.success":function(){Counter.sb(COUNTERS.COLLECTOR.EDIT.success)},"collector.button":function(){Counter.sb(COUNTERS.COLLECTOR.BUTTON)}});$(document).bind({"Captcha.checkSuccess":function(evt,
data){if(data.ref.options.is_verified)Counter.d(COUNTERS.VERIFIED_SUCCESS);else Counter.d(COUNTERS.UNVERIFIED_SUCCESS)},"Captcha.checkError":function(evt,data){if(data.ref.options.is_verified)Counter.d(COUNTERS.VERIFIED_FAIL);else Counter.d(COUNTERS.UNVERIFIED_FAIL)},"Captcha.show":function(evt,data){if(data.ref.options.is_verified)Counter.d(COUNTERS.VERIFIED_SHOW);else Counter.d(COUNTERS.UNVERIFIED_SHOW)},"Captcha.signupPhoneManager":function(){Counter.d(COUNTERS.UNVERIFIED_SIGNUP_PHONE)},"PhoneManager.verifyPhoneCancel":function(){Counter.d(COUNTERS.UNVERIFIED_CANCEL)},
"PhoneManager.signupPhoneSuccess":function(){Counter.d(COUNTERS.UNVERIFIED_SEND_REQUEST)}});$(window).bind({"showForm.compose":function(){if(patron.isSentMsg)Counter.d(COUNTERS.COMPOSE_SHOW)},"sendClick.compose":function(){if(patron.isSentMsg)Counter.sb(COUNTERS.COMPOSE_SEND);else if(patron.isReadMsg)Counter.sb(COUNTERS.READMSG_FAST_ANSWER_FULL_SEND)},"saveClick.compose":function(){if(patron.isSentMsg)Counter.sb(COUNTERS.COMPOSE_SAVE);else if(patron.isReadMsg)Counter.sb(COUNTERS.READMSG_FAST_ANSWER_FULL_SAVE)},
"cancelClick.compose":function(){if(patron.isSentMsg)Counter.sb(COUNTERS.COMPOSE_CANCEL);else if(patron.isReadMsg)Counter.sb(COUNTERS.READMSG_FAST_ANSWER_FULL_CANCEL)},"showAllFieldsLinkClick.compose":function(){if(patron.isSentMsg)Counter.sb(COUNTERS.COMPOSE_SHOW_ALL_FIELDS)},"realNameLinkClick.compose":function(){if(patron.isSentMsg)Counter.sb(COUNTERS.COMPOSE_REAL_NAME_LINK_CLICK)},"realNameChange.compose":function(){if(patron.isSentMsg)Counter.sb(COUNTERS.COMPOSE_REAL_NAME_CHANGE)},"realNameSettingsLinkClick.compose":function(){if(patron.isSentMsg)Counter.sb(COUNTERS.COMPOSE_REAL_NAME_SETTINGS)},
"addressBookLinksClick.compose":function(){if(patron.isSentMsg)Counter.sb(COUNTERS.COMPOSE_ADDRESSBOOK_LINKS_CLICK)},"addressBookIconsClick.compose":function(){if(patron.isSentMsg)Counter.sb(COUNTERS.COMPOSE_ADDRESSBOOK_ICONS_CLICK)},"uploaderAddFileFlashClick.compose":function(){if(patron.isSentMsg){Counter.sb(COUNTERS.COMPOSE_UPLOADER_ADD_FILE_FLASH);Counter.d(COUNTERS.COMPOSE_UPLOADER_ADD_FILE_FLASH)}},"uploaderAddFileJSClick.compose":function(){if(patron.isSentMsg){Counter.sb(COUNTERS.COMPOSE_UPLOADER_ADD_FILE_JS);
Counter.d(COUNTERS.COMPOSE_UPLOADER_ADD_FILE_JS)}},"uploaderSettingsLinkClick.compose":function(){if(patron.isSentMsg)Counter.sb(COUNTERS.COMPOSE_UPLOADER_SETTINGS)},"priorityCheckboxClick.compose":function(){if(patron.isSentMsg)Counter.sb(COUNTERS.COMPOSE_PRIORITY)},"receiptCheckboxClick.compose":function(){if(patron.isSentMsg)Counter.sb(COUNTERS.COMPOSE_RECEIPT)},"editorToolbarButtonStyleChangeClick.compose":function(){if(patron.isSentMsg)Counter.sb(COUNTERS.COMPOSE_EDITOR_TOOLBAR_STYLE_SELECT)},
"editorToolbarSignatureClick.compose":function(){if(patron.isSentMsg)Counter.sb(COUNTERS.COMPOSE_EDITOR_TOOLBAR_SIGNATURE_CLICK)},"editorToolbarButtonCardSelect.compose":function(){if(patron.isSentMsg)Counter.sb(COUNTERS.COMPOSE_EDITOR_TOOLBAR_CARD_SELECT)},"editorToolbarButtonDropDownClick.compose":function(evt,id){if(patron.isSentMsg){if(id=="forecolor"||id=="backcolor"||id=="fontactions"||id=="justifyselect"||id=="textindentactions"||id=="bullistactions")Counter.sb(COUNTERS.COMPOSE_EDITOR_TOOLBAR_BOTTONS_LT_SMILES);
else if(id=="emotions")Counter.sb(COUNTERS.COMPOSE_EDITOR_TOOLBAR_SMILES);else if(id=="signature")Counter.sb(COUNTERS.COMPOSE_EDITOR_TOOLBAR_SIGNATURE);var o={forecolor:964787,backcolor:964788,fontactions:964795,justifyselect:964796,textindentactions:964802,bullistactions:964803,emotions:964804};if(o[id])Counter.sb(o[id])}},"editorToolbarButtonClick.compose":function(evt,cmd){if(patron.isSentMsg){if(cmd=="Undo"||cmd=="Redo")Counter.sb(COUNTERS.COMPOSE_EDITOR_TOOLBAR_UNDOREDO);else if(cmd=="Strikethrough"||
cmd=="mceLink"||cmd=="InsertHorizontalRule"||cmd=="RemoveFormat")Counter.sb(COUNTERS.COMPOSE_EDITOR_TOOLBAR_BOTTONS_FORMAT);else if(cmd=="mceAppKeyboard")Counter.sb(COUNTERS.COMPOSE_EDITOR_TOOLBAR_KEYBOARD);else if(cmd=="mceAppTranslit")Counter.sb(COUNTERS.COMPOSE_EDITOR_TOOLBAR_TRANSLIT);else if(cmd=="mceAppSpelling")Counter.sb(COUNTERS.COMPOSE_EDITOR_TOOLBAR_SPELL);else if(cmd=="mceAppTransfer")Counter.sb(COUNTERS.COMPOSE_EDITOR_TOOLBAR_TRANSFER);else if(cmd=="mceEnableTextEditor")Counter.sb(COUNTERS.COMPOSE_EDITOR_TOOLBAR_ENABLE_TEXT_EDITOR);
else if(cmd=="mceEnableHTMLEditor")Counter.sb(COUNTERS.COMPOSE_EDITOR_TOOLBAR_ENABLE_HTML_EDITOR);else if(cmd=="mceShowTemplates"||cmd=="mceHideTemplates")Counter.sb(COUNTERS.COMPOSE_EDITOR_TOOLBAR_STYLE);else if(cmd=="Bold"||cmd=="Italic"||cmd=="Underline")Counter.sb(COUNTERS.COMPOSE_EDITOR_TOOLBAR_BOTTONS_LT_SMILES);var o={Bold:964760,Italic:964781,Underline:964782,Undo:964806,Redo:964807,Strikethrough:964812,mceLink:964816,InsertHorizontalRule:964817,RemoveFormat:964818,mceShowCards:964819,mceHideCards:964819};
if(o[cmd])Counter.sb(o[cmd])}},"folderLinkClick.folders":function(evt,id){if(id==0){Counter.sb(COUNTERS.FOLDERS_INBOX);if(patron.NewHeaderWithMessages)Counter.sb(684443);else Counter.sb(684440)}else if(id==950)Counter.sb(COUNTERS.FOLDERS_BULK);else if(id==5E5)Counter.sb(COUNTERS.FOLDERS_SENT);else if(id==500001)Counter.sb(COUNTERS.FOLDERS_DRAFTS);else if(id==500002)Counter.sb(COUNTERS.FOLDERS_TRASH);else Counter.sb(COUNTERS.FOLDERS_USER)},"folderSettingsLinkClick.folders":function(){Counter.sb(COUNTERS.FOLDERS_SETTINGS)},
"folderUnreadLinkClick.folders":function(){Counter.sb(COUNTERS.FOLDERS_UNREAD)},"folderMRIMArchLinkClick.folders":function(){Counter.sb(COUNTERS.FOLDERS_MRIM_ARCH)},"folderClearLinkClick.folders":function(evt,id){if(id==950)Counter.sb(COUNTERS.FOLDERS_CLEAR_BULK);else if(id==500002)Counter.sb(COUNTERS.FOLDERS_CLEAR_TRASH)},"foldersMore":function(event,state){Counter.sb(COUNTERS.FOLDERS_MORE[state?"UP":"DOWN"])},"show.msglist":function(evt,page){if(patron.isMsgList)if(page==1)Counter.d(COUNTERS.MSGLIST_PAGE1);
else if(page==2)Counter.d(COUNTERS.MSGLIST_PAGE2);else if(page==3)Counter.d(COUNTERS.MSGLIST_PAGE3);else if(page==4)Counter.d(COUNTERS.MSGLIST_PAGE4);else if(page==5)Counter.d(COUNTERS.MSGLIST_PAGE5);else Counter.d(COUNTERS.MSGLIST_PAGE_OTHER)},"changeModeClick.msglist":function(evt,mode){if(patron.isMsgList)if(mode)Counter.sb(COUNTERS.MSGLIST_SHORT_MODE);else Counter.sb(COUNTERS.MSGLIST_FULL_MODE)},"dropDownClick.msglist":function(evt,name,mode){if(mode)if(patron.isMsgList)if(name=="select-messages")Counter.sb(COUNTERS.MSGLIST_SELECT_LINK);
else if(name=="folders")Counter.sb(COUNTERS.MSGLIST_MOVE_LINK);else if(name=="mark")Counter.sb(COUNTERS.MSGLIST_MARK_LINK);else if(name=="more")Counter.sb(COUNTERS.MSGLIST_MORE_LINK);else{if(name=="sort-messages")Counter.sb(COUNTERS.MSGLIST_SORT_LINK)}else if(patron.isReadMsg)if(name=="folders")Counter.sb(COUNTERS.READMSG_MOVE_LINK);else if(name=="mark")Counter.sb(COUNTERS.READMSG_MARK_LINK);else if(name=="readmsg-more")Counter.sb(COUNTERS.READMSG_MORE_LINK)},"dropDownLinkClick.msglist":function(evt,
name,data){var type=data&&data[2];if(patron.isMsgList)if(name=="select-messages")if(type=="all")Counter.sb(COUNTERS.MSGLIST_SELECT_ALL_LINK);else if(type=="unread")Counter.sb(COUNTERS.MSGLIST_SELECT_UNREAD_LINK);else if(type=="readed")Counter.sb(COUNTERS.MSGLIST_SELECT_READ_LINK);else if(type=="flagged")Counter.sb(COUNTERS.MSGLIST_SELECT_MARK_LINK);else if(type=="attach")Counter.sb(COUNTERS.MSGLIST_SELECT_WITHFILES_LINK);else if(type=="email")Counter.sb(COUNTERS.MSGLIST_SELECT_FROMUSER_LINK);else{if(type==
"none")Counter.sb(COUNTERS.MSGLIST_SELECT_NONE_LINK)}else if(name=="folders")if(type=="new")Counter.sb(COUNTERS.MSGLIST_MOVE_CREATE_NEW_FOLDER);else Counter.sb(COUNTERS.MSGLIST_MOVE);else if(name=="mark")if(type==2)Counter.sb(COUNTERS.MSGLIST_MARK_READ);else if(type==1)Counter.sb(COUNTERS.MSGLIST_MARK_UNREAD);else if(type==6)Counter.sb(COUNTERS.MSGLIST_MARK_FLAG);else{if(type==7)Counter.sb(COUNTERS.MSGLIST_MARK_UNFLAG)}else if(name=="more")if(type=="abook")Counter.sb(COUNTERS.MSGLIST_MORE_ADDRESSBOOK);
else if(type=="blist")Counter.sb(COUNTERS.MSGLIST_MORE_BLACKLIST);else if(type=="create_filter")Counter.sb(COUNTERS.MSGLIST_MORE_CREATE_FILTER);else if(type=="all")Counter.sb(COUNTERS.MSGLIST_MORE_SEARCH);else{if(type=="as_attachments")Counter.sb(COUNTERS.MSGLIST_MORE_FORWARD)}else{if(name=="sort-messages")Counter.sb(COUNTERS.MSGLIST_SORT)}else if(patron.isReadMsg)if(name=="folders")if(type=="new")Counter.sb(COUNTERS.READMSG_MOVE_CREATE_NEW_FOLDER);else Counter.sb(COUNTERS.READMSG_MOVE);else if(name==
"mark")if(type==2)Counter.sb(COUNTERS.READMSG_MARK_READ);else if(type==1)Counter.sb(COUNTERS.READMSG_MARK_UNREAD);else if(type==6)Counter.sb(COUNTERS.READMSG_MARK_FLAG);else{if(type==7)Counter.sb(COUNTERS.READMSG_MARK_UNFLAG)}else if(name=="more")if(type=="abook")Counter.sb(COUNTERS.READMSG_MORE_ADDRESSBOOK);else if(type=="blist")Counter.sb(COUNTERS.READMSG_MORE_BLACK_LIST);else if(type=="create_filter")Counter.sb(COUNTERS.READMSG_MORE_CREATE_FILTER);else if(type=="search")Counter.sb(COUNTERS.READMSG_MORE_SEARCH);
else if(type=="translate")Counter.sb(COUNTERS.READMSG_MORE_TRANSFER);else if(type=="print")Counter.sb(COUNTERS.READMSG_MORE_PRINT);else if(type=="getmsg")Counter.sb(COUNTERS.READMSG_MORE_DOWNLOAD);else if(type=="composebounce")Counter.sb(COUNTERS.READMSG_MORE_RESEND);else if(type=="forward")Counter.sb(COUNTERS.READMSG_MORE_FORWARD);else if(type=="ViewType")Counter.sb(COUNTERS.READMSG_MORE_RFC)},"controlClick.msglist":function(evt,type){if(patron.isMsgList)if(type=="delete")Counter.sb(COUNTERS.MSGLIST_DELETE);
else if(type=="spam")Counter.sb(COUNTERS.MSGLIST_SPAM)},"attachLinkClick.msglist":function(){if(patron.isMsgList)Counter.sb(COUNTERS.MSGLIST_ATTACH)},"show.readmsg":function(){if(patron.isReadMsg)Counter.sb(COUNTERS.READMSG_SHOW)},"actionLinkClick.readmsg":function(evt,type){if(patron.isReadMsg)if(type=="reply")Counter.sb(COUNTERS.READMSG_REPLY);else if(type=="replyAll")Counter.sb(COUNTERS.READMSG_REPLY_ALL);else if(type=="forward")Counter.sb(COUNTERS.READMSG_FORWARD);else if(type=="remove")Counter.sb(COUNTERS.READMSG_DELETE);
else if(type=="spam")Counter.sb(COUNTERS.READMSG_SPAM);else if(type=="print")Counter.sb(COUNTERS.READMSG_PRINT_ICON);else if(type=="translate")Counter.sb(COUNTERS.READMSG_TRANSLIT_ICON);else if(type=="prev")Counter.sb(COUNTERS.READMSG_PREV_MESSAGE);else if(type=="next")Counter.sb(COUNTERS.READMSG_NEXT_MESSAGE);else if(type=="flag")Counter.sb(COUNTERS.READMSG_FLAG_ICON);else if(type=="new_abcontact")Counter.sb(COUNTERS.READMSG_ADDRESSBOOK_ICON);else if(type=="gosearch")Counter.sb(COUNTERS.READMSG_SEARCH_FROM_USER);
else if(type=="go2attach")Counter.sb(COUNTERS.READMSG_ATTACH_ICON);else if(type=="avatar")Counter.sb(COUNTERS.READMSG_CHANGE_AVATAR)},"fastAnswerControlsClick.readmsg":function(evt,expanded,type){if(patron.isReadMsg)if(expanded)if(type=="reply")Counter.sb(COUNTERS.READMSG_FAST_ANSWER_FULL_REPLY);else if(type=="replyall")Counter.sb(COUNTERS.READMSG_FAST_ANSWER_FULL_REPLYALL);else{if(type=="forward")Counter.sb(COUNTERS.READMSG_FAST_ANSWER_FULL_FORWARD)}else if(type=="reply")Counter.sb(COUNTERS.READMSG_FAST_ANSWER_SHORT_REPLY);
else if(type=="replyall")Counter.sb(COUNTERS.READMSG_FAST_ANSWER_SHORT_REPLYALL);else if(type=="forward")Counter.sb(COUNTERS.READMSG_FAST_ANSWER_SHORT_FORWARD)},"fastAnswerFakeBodyClick.readmsg":function(){if(patron.isReadMsg){Counter.sb(COUNTERS.READMSG_FAST_ANSWER_SHORT_TEXTAREA);Counter.d(COUNTERS.READMSG_FAST_ANSWER_FULL_FORM)}},"fastAnswerFullFormLinkClick.readmsg":function(){if(patron.isReadMsg)Counter.sb(COUNTERS.READMSG_FAST_ANSWER_FULL_FORM_LINK)},"attachHasImage.readmsg":function(){if(patron.isReadMsg)Counter.d(COUNTERS.READMSG_ATTACH_TXTSHOW)},
"attachPreviewText.readmsg":function(){if(patron.isReadMsg)Counter.d(COUNTERS.READMSG_ATTACH_IMAGE_SHOW)},"attachIconClick.readmsg":function(){if(patron.isReadMsg)Counter.sb(COUNTERS.READMSG_ATTACH_LINK)},"attachTitleClick.readmsg":function(){if(patron.isReadMsg)Counter.sb(COUNTERS.READMSG_ATTACH_ITEM_LINK)},"attachPreviewClick.readmsg":function(){if(patron.isReadMsg)Counter.sb(COUNTERS.READMSG_ATTACH_ITEM_IMAGE_PREVIEW)},"attachDownloadLinkClick.readmsg":function(){if(patron.isReadMsg)Counter.sb(COUNTERS.READMSG_ATTACH_DOWNLOAD)},
"attachInAlbumLinkClick.readmsg":function(){if(patron.isReadMsg)Counter.sb(COUNTERS.READMSG_ATTACH_ITEM_IN_ALBUM)},"attachPreviewLinkClick.readmsg":function(){if(patron.isReadMsg)Counter.sb(COUNTERS.READMSG_ATTACH_ITEM_PREVIEW)},"changeTheme.theme":function(evt,themeId){if(COUNTERS.THEMES[themeId]){Counter.sb(COUNTERS.THEMES[themeId]);if(patron.IsPddAccount)Counter.d("1712131")}},"cancelLayerTheme.theme":function(evt,themeId){if(COUNTERS.THEMES[themeId])Counter.sb(COUNTERS.THEMES[themeId])},"beforeunloadTheme.theme":function(evt,
themeId){if(COUNTERS.THEMES[themeId])Counter.d(COUNTERS.THEMES[themeId])},"attachViewerListClick.attachViewer":function(){Counter.sb(COUNTERS.ATTACH_VIEWER_LIST_CLICK)},"attachViewerSliderNextClick.attachViewer":function(){Counter.sb(COUNTERS.ATTACH_VIEWER_SLIDER_NEXT_CLICK)},"attachViewerSliderPrevClick.attachViewer":function(){Counter.sb(COUNTERS.ATTACH_VIEWER_SLIDER_PREV_CLICK)},"attachViewerPreviewPrevClick.attachViewer":function(){Counter.sb(COUNTERS.ATTACH_VIEWER_PREVIEW_PREV_CLICK)},"attachViewerPreviewNextClick.attachViewer":function(){Counter.sb(COUNTERS.ATTACH_VIEWER_PREVIEW_NEXT_CLICK)},
"attachViewerSliderListClick.attachViewer":function(){Counter.sb(COUNTERS.ATTACH_VIEWER_SLIDER_LIST_CLICK)},"attachViewerSubjectClick.attachViewer":function(){Counter.sb(COUNTERS.ATTACH_VIEWER_SUBJECT_CLICK)},"attachViewerSliderRootClick.attachViewer":function(){Counter.sb(COUNTERS.ATTACH_VIEWER_SLIDER_ROOT_CLICK)},"attachViewerResizeClick.attachViewer":function(){Counter.sb(COUNTERS.ATTACH_VIEWER_RESIZE_CLICK)},"attachViewerResizeMinusClick.attachViewer":function(){Counter.sb(COUNTERS.ATTACH_VIEWER_RESIZE_MINUS_CLICK)},
"attachViewerPreviewImageClick.attachViewer":function(){Counter.sb(COUNTERS.ATTACH_VIEWER_PREVIEW_IMAGE_CLICK)},"attachViewerPreviewOtherClick.attachViewer":function(){Counter.sb(COUNTERS.ATTACH_VIEWER_PREVIEW_OTHER_CLICK)},"attachViewerPreviewCloseClick.attachViewer":function(){Counter.sb(COUNTERS.ATTACH_VIEWER_PREVIEW_CLOSE_CLICK)},"attachViewerPreviewDownloadClick.attachViewer":function(){Counter.sb(COUNTERS.ATTACH_VIEWER_PREVIEW_DOWNLOAD_CLICK)},"attachViewerPreviewInAlbumClick.attachViewer":function(){Counter.sb(COUNTERS.ATTACH_VIEWER_PREVIEW_IN_ALBUM_CLICK)},
"attachViewerPreviewNewWindowClick.attachViewer":function(){Counter.sb(COUNTERS.ATTACH_VIEWER_PREVIEW_NEW_WINDOW_CLICK)},"attachViewerChangeModeClick.attachViewer":function(evt,isShort){if(isShort)Counter.d(COUNTERS.ATTACH_VIEWER_MODE_SHORT_CLICK);else Counter.d(COUNTERS.ATTACH_VIEWER_MODE_FULL_CLICK)},"attachViewerRedraw.attachViewer":function(evt,files,links){var exts={},ext,counters=COUNTERS.ATTACH_ARCHIVE;$.each(files.concat(links),function(k,v){ext=v.ext.toLowerCase();if(!exts[ext]&&counters[ext]){Counter.d(counters[ext]);
exts[ext]=1}})},"themePageLoad.themes":function(evt,theme){if(COUNTERS.THEMES_ON_PAGE_LOAD[theme]){Counter.d(COUNTERS.THEMES_ON_PAGE_LOAD[theme]);if(patron.IsPddAccount)Counter.d("1712134")}},"langPageLoad.lang":function(evt,lang){lang=lang||"ru_RU";if(COUNTERS.LANG_ON_PAGE_LOAD[lang])Counter.d(COUNTERS.LANG_ON_PAGE_LOAD[lang])},"langChange.lang":function(evt,newLang){if(COUNTERS.LANG_ON_CHANGE[newLang])Counter.d(COUNTERS.LANG_ON_CHANGE[newLang])}});$(window).bind({"showExternal.signup":function(){Counter.d(COUNTERS.SIGNUP_PAGE.external.show)},
"submitExternal.signup":function(){Counter.sb(COUNTERS.SIGNUP_PAGE.external.submit)},"captchaExternal.signup":function(){Counter.sb(COUNTERS.SIGNUP_PAGE.external.captcha)},"hostExternal.signup":function(event,data){if(data){var counter=COUNTERS.SIGNUP_PAGE.external.hosts[data.host];if(counter)Counter[data.type](counter)}},"showPDD.signup":function(){Counter.d(COUNTERS.SIGNUP_PAGE.pdd.show)},"submitPDD.signup":function(){Counter.sb(COUNTERS.SIGNUP_PAGE.pdd.submit)},"captchaPDD.signup":function(){Counter.sb(COUNTERS.SIGNUP_PAGE.pdd.captcha)}});
ajs.require("{toolkit.common}store/store",function(){var key="tutorial.skip";$(window).bind({"signup.tutorial.set":function(){store.set(key,true)},"signup.tutorial.show":function(){if(store.get(key))Counter.d(COUNTERS.SIGNUP_PAGE.tutorial.skip)},"signup.tutorial.click":function(){if(store.get(key)){Counter.sb(COUNTERS.SIGNUP_PAGE.tutorial.skip);store.remove(key)}}})});$(window).bind({"show.login":function(){Counter.d(COUNTERS.LOGIN_PAGE["default"].show)}})})(jQuery);jsLoader.loaded("{patron}patron.BindedCounters")});
jsLoader.use("{patron.model}patron.Model",function(Model){patron.Thread=Model.extend({url:"threads/thread",defaults:{length:1,expand:[],messages:[]},aliases:{"FolderId":function(attrs,value){return arguments.length===1?attrs.folder:attrs.folder=value},"Unread":function(attrs,value){var flags=attrs.flags||{};if(arguments.length===1)return flags.unread;else flags.unread=!!value},"Flagged":function(attrs,value){var flags=attrs.flags||{};if(arguments.length===1)return flags.flagged;else flags.flagged=
!!value},"PrevId":function(attrs,value){if(arguments.length===1)return attrs.prev;else attrs.prev=value},"NextId":function(attrs,value){if(arguments.length===1)return attrs.next;else attrs.next=value}},isUnread:function(){return this.get("Unread")},isEditable:function(){return true},getFolder:function(){return patron.Folders.getSafe(this.get("folder"))},invalidate:function(){},fetchNext:function(limit){var model=this;var defer=$.Deferred();var messages=model.get("messages");if(messages.length<this.get("length"))patron.Threads.fetch({id:this.id,
offset:messages.length,limit:limit||patron.Thread.LIMIT},function(err,Res){if(!err){messages.push.apply(messages,Res.getData().messages);defer.resolve(model)}else defer.reject(Res)});else defer.resolve(model);return defer.promise()},remove:function(){var dfd=$.Deferred();patron.API.call("post","threads/remove",{ids:[this.id]},function(R){if(R.isOK())dfd.resolve(R.getBody());else dfd.reject(R.status)});return dfd.promise()},canListUnsubscribe:function(){var headers=this.get("headers");return patron.ListUnsubscribeEnabled&&
!!(this.get("ListUnsubscribe")||headers&&headers["List-Unsubscribe"])},getCountUnread:function(){return this.get("length_unread")||(this.isUnread()?1:0)}});patron.Thread.Null=new patron.Thread({id:null},{silent:true});patron.Thread.LIMIT=25;jsLoader.loaded("{patron.model}patron.Thread",patron.Thread)});define("{patron}patron.Threads",["{patron.model}patron.Thread","{patron}patron.API"],function(Thread){var _cacheStore={};function _getCacheKey(id){return id}var Threads={_index:{},model:Thread,models:[],
switchMode:function(state,callback){var notify=patron.Notify.add("load");patron.API.post("tokens",function(result){if(result.isOK()){var tokens=String(result.getBody().token).split(":");patron.Ajax({url:"/settings/ajax_settings?ajax_call=1&func_name=set_msglistflags&flag=use_threads",type:"post",data:{val:+!!state,form_sign:tokens[0],form_token:tokens[1]},isUser:true,complete:function(){notify.close();callback()}})}})},_rebuildIndex:function(){var i=this.models.length;this._index={};while(i--)this._index[this.models[i].id]=
i},resetCache:function(model){if(model){model.set("expired",true);delete _cacheStore[_getCacheKey(model.id)]}else Array.forEach(this.models,Threads.resetCache)},get:function(id){var idx=this._index[id];return this.models[idx]},create:function(data){var model=new this.model(data);model.thread=true;this.models.push(model);this._rebuildIndex();model.on("change",function(model,changes){if("length_unread"in changes||"length_flagged"in changes)Threads.resetCache(model)});return model},merge:function(threads){if(threads){var i=
0,n=threads.length,thread,data;for(i;i<n;i++){data=threads[i];if(thread=this.get(data.id))thread.set(data);else this.create(data)}}},remove:function(model){this.models=Array.remove(this.models,model);this._rebuildIndex()},find:function(data,fn){var id=data.id,cacheKey=_getCacheKey(id),defer=_cacheStore[cacheKey]||new $.Deferred,thread=data.cache!==false&&this.get(id);if(thread&&!thread.get("expired")&&thread.get("length")==thread.get("messages").length){fn&&fn(null,thread);defer.resolve(thread)}else if(!_cacheStore[cacheKey]){_cacheStore[cacheKey]=
defer;patron.log("patron.Thread.find",id);this.fetch(data,function(err,Res){delete _cacheStore[cacheKey];if(!err){var data=Res.getData(),flags=data.flags||{},messages=data.messages||[];patron.log("patron.Thread.find.done",{id:data.id,unread:flags.unread,flagged:flags.flagged,length:data.length,messages:messages.length});data.expired=false;Threads.merge([data]);fn&&fn(null,Threads.get(id));defer.resolve(Threads.get(id))}else{patron.log("patron.Thread.find.fail",{id:id,res:Res});fn&&fn(Res);defer.reject(Res)}})}return defer.promise()},
fetch:function(query,callback){var defer=$.Deferred();callback=callback||ajs.F;patron.API({url:this.model.prototype.url,data:ajs.extend({offset:0,limit:patron.Thread.LIMIT,htmlencoded:false},query),loadPage:true,complete:function(Res){callback(!Res.isOK(),Res);if(Res.isOK())defer.resolve(Res.getData());else defer.reject(Res)}});return defer.promise()},toJSON:function(){return ajs.map(this.models,function(model){return model.toJSON()})}};if(patron.threads){patron.Events.bind("updated.folder",function(){Threads.resetCache()}.debounce(10));
patron.Events.bind("updated.message",function(evt){var msg=evt.DATA;var thread=Threads.get(msg.thread);thread&&Threads.resetCache(thread)}.debounce(10))}return patron.Threads=Threads});jsLoader.use(["{patron.utils}patron.Utils"],function(){var _cache={delim:{},highlightReplace:{}};var htmlEscape=ajs.HTML.escape;var _addParts=function(tokens,token,delim){if(token.indexOf(delim)>-1){if(_cache.delim[delim]===undefined)_cache.delim[delim]=new RegExp(delim.replace(/\./g,"\\.")+"+");var parts=token.split(_cache.delim[delim]);
for(var i=0,l=parts.length;i<l;i++)if(parts[i])tokens.push(parts[i])}};function regExpEscape(str){return str.replace(/[\\"\?\(\)\|!#\$%\^\*\+\-\[\]\.]/g,"\\$&")}function prepareChoisesValue(str){return regExpEscape(htmlEscape(str))}var Search=patron.Utils.Search={queryToTokens:function(str,noNeedToEscape){str=$.trim(str);if(!noNeedToEscape)str=regExpEscape(str);str=str.toLowerCase();var tokens=str.split(/[\s]+/),token;for(var i=0,l=tokens.length;i<l;i++){token=tokens[i];if(noNeedToEscape||token!=
"\\"){_addParts(tokens,token,noNeedToEscape?".":"\\.");_addParts(tokens,token,"@")}}return tokens},highlightReplace:function(filter,wrapperStart,wrapperEnd){wrapperStart=wrapperStart||"<b>";wrapperEnd=wrapperEnd||"</b>";var cacheKey=filter+"|"+wrapperStart+"|"+wrapperEnd,choises,tokens,match,replace,filterObject;if(!_cache.highlightReplace[cacheKey]){choises=[];tokens=Search.queryToTokens(filter,true);Array.forEach(tokens,function(token){choises.push(prepareChoisesValue(token));choises.push(prepareChoisesValue(patron.Utils.punto(token)));
var translit=patron.Utils.translit(token,true),i,len,part,value;value="";for(i=0,len=translit.length;i<len;i++){part=translit[i];if(typeof part==="string")value+=prepareChoisesValue(part);else value+="(?:"+Array.map(part,prepareChoisesValue).join("|")+")"}choises.push(value)});filterObject={};choises=Array.filter(choises,function(str){var result=str&&str.length&&filterObject[str]===void 0;if(result)filterObject[str]=null;return result});filterObject=null;choises.sort(function(a,b){return a.length==
b.length?0:a.length>b.length?-1:1});if(choises.length){match=new RegExp("(^|\\s|@|\\.)("+choises.join("|")+")","gi");replace="$1"+wrapperStart+"$2"+wrapperEnd;_cache.highlightReplace[cacheKey]=function(text){return htmlEscape(text).replace(/\\s/g,"&#32;").replace(match,replace)}}else _cache.highlightReplace[cacheKey]=function(text){return text}}return _cache.highlightReplace[cacheKey]}};jsLoader.loaded("{patron.utils}patron.Utils.Search")});jsLoader.use(["{patron}patron.core","{jQuery}autocomplete",
"{patron.utils}patron.Utils","{utils}jsHistory","{patron.utils}patron.Utils.Search"],function(){var RE_EMAIL=/([\w.\u0430-\u044f\u0451\-+]+)@([\w.\u0430-\u044f\u0451\-]+)\.[\w\u0430-\u044f\u0451]+/,RE_NAME_AND_EMAIL_IN_LTGT=new RegExp("[\"']?(.*?)[\"']?\\s+(?:<|&lt;)("+RE_EMAIL.source+")(?:>|&gt;)"),RE_REGEXP_ESCAPE=/([.?*+^$[\]\\(){}|-])/g,INPUT_EVENT_NAME="oninput"in document?"input":"keyup",OPERANDS_SEARCH_TYPES_MAP={q_from:1,q_to:2,q_subj:4,q_query:8},_HTML_escape_=ajs.HTML.escape;OPERANDS_SEARCH_TYPES_MAP.ALL=
OPERANDS_SEARCH_TYPES_MAP.q_from|OPERANDS_SEARCH_TYPES_MAP.q_to|OPERANDS_SEARCH_TYPES_MAP.q_subj|OPERANDS_SEARCH_TYPES_MAP.q_query;OPERANDS_SEARCH_TYPES_MAP.PEOPLE=OPERANDS_SEARCH_TYPES_MAP.q_from|OPERANDS_SEARCH_TYPES_MAP.q_to;OPERANDS_SEARCH_TYPES_MAP.TEXT=OPERANDS_SEARCH_TYPES_MAP.q_subj|OPERANDS_SEARCH_TYPES_MAP.q_query;(function($){var waitCache={};patron.ui.SearchSuggest=function(selector,opts){waitCache[selector]=waitCache[selector]||$.Deferred();this._onPrint=this._onPrint.bind(this);this._onSelect=
this._onSelect.bind(this);if(!patron.isAddressbookPage()){this._getData=this._getData.bind(this);this._request=this._request.bind(this)}else{this._request=function(val,fn){fn([])};this._getData=function(a){return a}}this._logUnlock=function(){this._logLock=0}.bind(this);this._go2Advanced=this._go2Advanced.bind(this);this._advancedHide=this._advanced.bind(this,false);this._onpagechange=this._onpagechange.bind(this);Object.extend(opts.suggest,{getData:this._getData,request:this._request,minLength:2,
onprint:this._onPrint,onexpand:function(state){this._onPrint();if(!state)this._startTS=0}.bind(this),multiSuggests:false});this.Search=ajs.ui.search(selector,opts);this.$Search=$("#portal-menu__search__form");if(patron.isFileSearchPage()||patron.isAddressbookPage())this.disable();else{this.enable();if(this.Search.$Operands)Object.forEach(ajs.toObject(jsHistory.get()),function(val,name){if(val){val=val.replace(/\+/g," ");this.Search.$Operands.setOperandValue(name,val)}},this)}if(this.Search.$Operands){this.Search.$Operands.addTrigger("operands:activeInputChange",
function(e){if(this.__doNotCountingOperandShow){this.__doNotCountingOperandShow=false;return}var oldInput=e.oldInput,oldInputIsOperand,newInputIsOperand=e.isOperandInput;if("length"in oldInput)oldInput=oldInput[0];if(!oldInput.getAttribute)return;oldInputIsOperand=!!oldInput.getAttribute("data-operand");if(!oldInputIsOperand&&newInputIsOperand)$.event.trigger("ui-abstract-action",{chain:["portal-menu","operand","show"]});else if(oldInput&&oldInputIsOperand&&newInputIsOperand)setTimeout(function(){if(!this.getAttribute("data-next-operand")&&
!this.getAttribute("data-next-operand"))$.event.trigger("ui-abstract-action",{chain:["portal-menu","operand","switch"]})}.bind(oldInput));e=oldInput=null}.bind(this));var RE_EMAIL_AND_SPACE_AND_SYMBOL=new RegExp(RE_EMAIL.source+"\\s.");this.Search.$Operands.addTrigger("operands:find",function(e){var currentOperand=e["currentOperand"],inputValue,spaceIndex,caret;if((currentOperand==="q_from"||currentOperand==="q_to")&&(inputValue=e["inputValue"])&&(spaceIndex=inputValue.lastIndexOf(" "))!==-1&&RE_EMAIL_AND_SPACE_AND_SYMBOL.test(inputValue)){caret=
ajs.$.getCaretPosition(e["input"],true);inputValue=e["inputValue"];if(caret&&caret["start"]===caret["end"]&&caret["end"]>=inputValue.length-1){e["newOperand"]="q_query";e["lastPrefixIndex"]=spaceIndex}}});this.$Search.submit(function(){var operandInput;(operandInput=this.Search)&&(operandInput=operandInput.$Operands)&&(operandInput=operandInput.$Input);if((operandInput=operandInput[0])&&operandInput.getAttribute("data-operand")&&operandInput.style.display!="none")$.event.trigger("ui-abstract-action",
{chain:["portal-menu","operand","search"]})}.bind(this));if(this.Search.Suggest){this.__cache={};this.Search.Suggest.addTrigger("suggests:find suggests:rebuild",function(e){var ajsSuggest=e.currentTarget,data=e.data,inputName=ajsSuggest.$Input.attr("name")+"|"+(ajsSuggest.$Input.attr("data-operand")||""),localCache,suggestValue=e.suggestValue||e.val||e.suggest;if(!(localCache=this.__cache[inputName]))localCache=this.__cache[inputName]={};if(e.type=="suggests:rebuild"&&(!data.__inputName||data.__inputName==
inputName)){localCache[suggestValue]=data;data.__inputName=inputName}else{e.data=localCache[suggestValue];ajsSuggest.reset()}}.bind(this))}this._operandLinkedInputChange=function(evt){var advancedSearchInput=evt.target,inputNodeName=advancedSearchInput.nodeName.toUpperCase(),operandName,operand,targetValue,oldTargetValue;if("value"in advancedSearchInput&&(inputNodeName=="INPUT"||inputNodeName=="TEXTAREA")){targetValue=advancedSearchInput.value;operandName=advancedSearchInput.name;oldTargetValue=advancedSearchInput.__oldValue;
if(operandName&&oldTargetValue!=targetValue){advancedSearchInput.__oldValue=targetValue;operand=this.operands&&this.operands[operandName];if(!operand&&!targetValue)return;this.setOperandValue(operandName,advancedSearchInput.value);$(this.$Input[0]).change();if(!operand&&!(operand=this.operands&&this.operands[operandName]))return;if(operand.$Input[0]&&operand.$Input[0].scrollIntoView)operand.$Input[0].scrollIntoView(false);if(!operand["isOnInputBind"]){operand["isOnInputBind"]=true;$(operand.$Input[0]).bind(INPUT_EVENT_NAME,
function(evt){var target=evt.target,value=target.value;advancedSearchInput.value=value})}}}}.bind(this.Search.$Operands)}if(this.Search.Suggest){this.Search.Suggest.addTrigger("suggests:rebuild",function(e){var data=e["details"]||e["data"];if(data&&data.length==1&&data[0]+""==e["val"])e["showInternet"]=e["showList"]=false}).addTrigger("suggests:select",this._onSelect);this.Search.Suggest.addTrigger("suggests:find",function(e){if(this.__suggestSelected&&(!e.originalEvent||e.originalEvent.type!="focus")&&
e.val){this.$FromSuggestsInput.val("0");this.__suggestSelected=!e.val}}.bind(this));if(opts.suggest&&opts.suggest.controlHeight)this.Search.Suggest.addTrigger("suggests:show suggests:afterRebuild suggests:rebuild:after",this.setSuggestNodesVisibility.bind(this))}this.Search.$Input.closest("form").bind("submit",function(){this._autoLogMe(true)}.bind(this));$(window).bind("hashchange",this._advancedHide).bind("abjs:updated",this.reset.bind(this));if(opts.clearSearchResultBasedOnHash)$(window).bind("hashchange pagechange",
this._onpagechange);$(function(){this.$AdvansedSearchLink=$("#search-result-advanced-link").add(this.Search.$Elm.find(".js-section-link")).bind("click",this._advanced.bind(this,null));if(patron.isFileSearchPage()||patron.isAddressbookPage())this.disable();else this.enable()}.bind(this));this.$FromSuggestsInput=$("<input type=hidden name=from_suggest value=0 />");this.$FromSuggestsInput.appendTo(this.$Search);waitCache[selector].resolve(this)};function regexpEscape(str){return String(str||"").replace(RE_REGEXP_ESCAPE,
"\\$1")}function GroupedSuggestItem(config,text,find,search,category,categoryIndex){this.config=config;this.category=category;this.categoryIndex=categoryIndex;this.html=text;this.search=search||text;this.find=regexpEscape(find)}GroupedSuggestItem.prototype.toString=function(){return""+(this.category&&this.categoryIndex===0?'<div class="'+this.config.cdGroupHeader+'">'+this.category+"</div>":"")+this.html};patron.ui.SearchSuggest.prototype={constructor:patron.ui.SearchSuggest,_onpagechange:function(){var operandsDisabled=
patron.isFileSearchPage()||patron.isMRIMPage()||patron.isAddressbookPage();if(operandsDisabled)this.disable();else this.enable();var $Search=this.$Search;if(!$Search)$Search=this.$Search=$("#portal-menu__search__form");var layer_form=$Search.length>0?$Search[0]:{},layer_form_elements=layer_form.elements||[],hashParams=ajs.toObject(jsHistory.get()),operands=this.Search.$Operands&&this.Search.$Operands.operands,operandKeys=operands&&Object.keys(operands)||[];if(layer_form)Array.forEach(layer_form_elements,
function(el){var elNN=el&&el.nodeName,elType=el&&(el.type+"").toUpperCase();if(el.name&&(elNN=="INPUT"&&(elType=="TEXT"||elType==="")||elNN=="TEXTAREA"))el.value=""});Object.forEach(hashParams,function(val,name){var target=layer_form_elements[name],i;val=val?val.replace(/\+/g," "):val;if(target)target.value=val;if(operandKeys.length&&name in operands){if(operandsDisabled)val="";this.Search.$Operands.setOperandValue(name,val);i=Array.indexOf(operandKeys,name);if(i>=0)operandKeys.splice(i,1)}},this);
if(operandKeys.length)Array.forEach(operandKeys,function(name){try{var val=operandsDisabled?"":this.Search.$Operands.getOperandValue(name)||"";this.Search.$Operands.setOperandValue(name,val)}catch(e){}},this);if((layer_form=this.Search)&&"_placeholderCheck"in layer_form)layer_form._placeholderCheck()},_advanced:function(expand,evt){var self=this,$Layer=this.$Layer;if(!$Layer)$Layer=this.$Layer=$("#popup_advanced-search");if(expand==null)expand=!$Layer.is(":visible");else if(!expand&&evt.type!="hashchange")if(!$(evt.currentTarget).is(".js-close")&&
$Layer.has(evt.target)[0])return;if(expand&&!$Layer.data("inited")){ajs.require("{jQuery}"+"jquery.mrcalendar",function(){$Layer.data("inited",true).find(".form__select").form__select().end().find(".js-date-from-calendar").mrcalendar({toggle:$Layer.find(".js-date-from"),linkoff:true,onclick:function(data,evt){evt.preventDefault();$Layer.find(".js-date-from").val(data[2]+"."+data[1]+"."+data[0])}});$(".js-calendar-link",$Layer).click(function(evt){$(this).siblings("input").focus();return false})});
var ajsSuggestsEvents={events:{"suggests:select":function(){self.__suggestSelected=true},"suggests:find":function(e){self.__suggestSelected=!e.val}}};ajs.require("{jQuery}"+"expandField"+(patron.CanUseNewAddressbookSuggests?",{jQuery}addressbookSuggest":""),function(){$(".js-ac-addressbook",$Layer).expandField({parent:"body"});if(patron.CanUseNewAddressbookSuggests)$(".js-ac-addressbook",$Layer).addressbookSuggest(Object.extend({onlyEmailAfterSelect:true,deleteLastComma:true,multiSuggests:false,updateOnMark:true,
autoMarked:-1},ajsSuggestsEvents));else $(".js-ac-addressbook",$Layer).bind("focus keyup",function _fn(){patron.Utils.getAddressBook();$(this).unbind("focus keyup",_fn)}).each(function(){$.Autocompleter.addressbook(this,true)})});ajs.require("{patron.ui}"+"patron.ui.SearchSuggest",function(){var opts=Object.extend({cnBlur:"portal-menu__search_blur",hideEmailList:true,autoTabIndex:false,suggest:{cnItem:"portal-menu__search__suggest__item",cnSelected:"portal-menu__search__suggest__item_selected",cnList:"portal-menu__search__suggest__inner",
cnInternetCont:"js-suggest-internet-cont",cnInternet:"portal-menu__search__suggest__item_internet-link",template:function(val,item){var text=(item instanceof Object&&(item["word"]||item["text"])||item||"")+"";val=_HTML_escape_(text).replace(new RegExp(val,"i"),"<b>$&</b>");return"<div data-suggest='"+text+"' class=\""+this.opts.cnItem+'">'+val+"</div>"},searchUrl:"http://go.mail.ru/search?fr=mailsearch&q=#query#",ajaxUrl:'/cgi-bin/gosearch_ajax?ajax_call=1&func_name=ajax_suggest&data=["#query#"]&token='+
window["mailru_api_token"],autosubmit:false,showInternet:false}},ajsSuggestsEvents);function onShow(e){var input=e.target.$Input,suggestsContainer=e.target.$List;if((suggestsContainer=suggestsContainer[0])&&(suggestsContainer=suggestsContainer.parentNode))suggestsContainer.style.width=input[0].clientWidth+"px"}(new patron.ui.SearchSuggest("#adv-search-theme-name",opts)).Search.Suggest.addTrigger("suggests:show",onShow);(new patron.ui.SearchSuggest("#adv-search-word-contain",opts)).Search.Suggest.addTrigger("suggests:show",
onShow)});ajsSuggestsEvents=null;if(this.Search.$Operands&&!this.Search.$Operands["doOnce_pas_oprds"]){this.Search.$Operands["doOnce_pas_oprds"]=true;$("#popup_advanced-search").find("form").bind(INPUT_EVENT_NAME+" change",this._operandLinkedInputChange)}}if(expand){if(!$Layer.data("already_set_onsubmit")){$Layer.data("already_set_onsubmit",true);$(this.$Search).bind("submit",function(evt){var layer_form;if(evt.isDefaultPrevented()){layer_form=($Layer.find("form")||[])[0];if(layer_form)layer_form.reset()}})}if(this.Search.$Operands)Array.forEach(Object.keys(this.Search.$Operands.operands),
function(name){$Layer.find('[name="'+name+'"]').val(this.Search.$Operands.getOperandValue(name)).trigger("change")},this);else Object.forEach(ajs.toObject(jsHistory.get()),function(val,name){$Layer.find('[name="'+name+'"]').val(val).trigger("change")})}$Layer.display(expand).trigger(expand?"show":"hide")[expand?"delegate":"undelegate"](".js-close","click",this._advancedHide).find("form")[expand?"bind":"unbind"]("submit",this._go2Advanced)[expand?"find":"F"]("input[autofocus=true],textarea[autofocus=true]").focus();
(function(){$(document)[expand?"bind":"unbind"]("click",this._advancedHide)}).gap(this)();if(evt)evt.preventDefault()},_go2Advanced:function(evt){var data=$(evt.target).toObject(),lapse=Math.max(~~data.q_date_lapse,0)*jsCookie.DAY*1E3,time=(new Date((data.q_date+"").replace(/(\d+)\.(\d+)\.(\d+)/,"$3/$2/$1"))).getTime(),bdate=new Date(time-lapse),edate=new Date(time+lapse),tmp;if(time){data.ddb=bdate.getDate();data.dmb=bdate.getMonth()+1;data.dyb=bdate.getFullYear();data.dde=edate.getDate();data.dme=
edate.getMonth()+1;data.dye=edate.getFullYear()}this._advancedHide(evt);if((tmp=data["q_from"])&&(tmp=(tmp+"").trim()).charAt(tmp.length-1)==",")data["q_from"]=tmp.substr(0,tmp.length-1);if((tmp=data["q_to"])&&(tmp=(tmp+"").trim()).charAt(tmp.length-1)==",")data["q_to"]=tmp.substr(0,tmp.length-1);data.from_search=patron.isSearchPage()?1:0;jsHistory.set(patron.getPageURL("gosearch")+"?"+ajs.toQuery(data));evt.preventDefault()},_onPrint:function(){this.__value=this.val();clearTimeout(this._autoLog_pid);
if(!this._startTS)this._startTS=ajs.now()},_onSelect:function(evt){var searchName,form,item,onSubmitCheck,originalInputValue,suggestObject=evt.target;this.__suggestSelected=true;this.$FromSuggestsInput.val("1");setTimeout(function(){jQuery(this.$Input[0]).change()}.bind(suggestObject));clearTimeout(this._autoLog_pid);this._logMe(evt.newSuggest,evt.newSuggestIndex);if(!this.Search.$Operands){searchName=$(evt.newSuggestNode).data("search-name");if(searchName){suggestObject["__original$InputName"]=suggestObject.$Input[0].name;
suggestObject.$Input[0].name=searchName}else{if(suggestObject["__original$InputName"])suggestObject.$Input[0].name=suggestObject["__original$InputName"];suggestObject["__original$InputName"]=void 0}originalInputValue=suggestObject.$Input[0].value;item=evt.newSuggestData||originalInputValue;if(typeof item=="object"&&item.search){suggestObject["__original$InputValue"]=originalInputValue;evt["newSuggest"]=item.search}else if(suggestObject["__original$InputValue"]){evt["newSuggest"]=suggestObject["__original$InputValue"];
delete suggestObject["__original$InputValue"]}form=suggestObject.$Elm.find("form");if(form&&form.length){if(!(onSubmitCheck=suggestObject["__isOnSubmitCheck"])){onSubmitCheck=suggestObject["__isOnSubmitCheck"]=function(evt){var tmp;if(evt.isDefaultPrevented()){if(tmp=this["__original$InputName"]){this.$Input[0].name=tmp;this["__original$InputName"]=void 0}if(tmp=this["__original$InputValue"]){this.$Input[0].value=tmp;this["__original$InputValue"]=void 0}}}.bind(suggestObject);$(form).bind("submit",
onSubmitCheck)}}else if(suggestObject["__original$InputName"]){suggestObject.$Input[0].name=suggestObject["__original$InputName"];form=suggestObject.$Elm.find("form");if(form&&suggestObject["__isOnSubmitCheck"])$(form).unbind("submit",suggestObject["__isOnSubmitCheck"])}}},_logMe:function(val,idx,useEnter){if(!this._logLock&&this._startTS){this._logLock=1;var Suggest=this.Search.getSuggest(),_val=this.__value;patron.Utils.suggestLog("search",{start_ts:this._startTS,sel_ts:this._selTS,val:_val,sel:val,
data:Suggest._cache[_val]||[],idx:idx,enter:useEnter,abjs:$.isArray(patron.abjsData)?patron.abjsData.length:0});this._selTS=this._startTS=0;setTimeout(this._logUnlock,100)}},_autoLogMe:function(useEnter){this._logMe("",-1,useEnter)},_request:function(url,fn){if(!patron.abjsData){var _fn=function(){var args=arguments;ajs.wait("abjs:complete",function(){fn.apply(this,args)})};patron.Utils.getAddressBook();$.get(url,_fn,"json")}else $.get(url,fn,"json")},setSuggestNodesVisibility:function(evt){var Suggest=
this.Search&&this.Search.Suggest;if(!Suggest)return;var suggestNodes=Suggest.__ListItems,node,node_height,i=0,l,k,windowHeight=$(window).height(),minHeightLimit=340,heightLimit,suggestNodes_height,suggestGroups={},suggestGroupsKeys=[],suggestGroup;function getHeight(node){var result=0;if(node)result=node.getBoundingClientRect().height;return result}if(!Suggest.isExpanded()||evt&&(!evt["showContainer"]||!evt["showList"])||!suggestNodes||!(suggestNodes_height=getHeight(Suggest.$List[0])+getHeight(Suggest.$InternetCont[0])))return;
heightLimit=Math.floor(windowHeight/2);if(patron.UseFlatHeader&&heightLimit<minHeightLimit)heightLimit=minHeightLimit;while(node=suggestNodes[i++]){suggestGroup=node.getAttribute("data-search-name")||"";if(!suggestGroups[suggestGroup]){suggestGroups[suggestGroup]=[];suggestGroupsKeys.push(suggestGroup)}suggestGroups[suggestGroup].push(node);if(node.style.display=="none")suggestNodes_height+=node.__clientHeight||0}i=l=suggestGroupsKeys.length;k=suggestNodes.length;while(k-- >0){if(--i<0)i=l-1;suggestGroup=
suggestGroups[suggestGroupsKeys[i]];node=suggestGroup.pop();if(!suggestGroup.length)continue;node_height=node.__clientHeight;if(node_height==void 0)node.__clientHeight=node_height=node.clientHeight;node.style.display=suggestNodes_height>heightLimit?"none":"";suggestNodes_height-=node_height}},_getData:function(res,val,_event){if(res[1]=="Error")return[];if(res&&Array.isArray(res)&&res.length==3&&typeof res[0]+typeof res[1]+typeof res[2]=="stringstringobject")if(res[2]&&res[2].response!==void 0)res=
res[2].response;else if(res[0]&&res[0].response!==void 0)res=res[0].response;else res=null;res=res||[];val=val||val.suggestValue||this.Search.Suggest.val();var suggestOptions=this.Search.opts.suggest,suggestsMaxCount=8,suggestsCount=0,hideEmailList=this.Search.opts.hideEmailList||val.length>100,searchRegexp=!hideEmailList&&$.Autocompleter.CreateFindRegExp(val),emails=!hideEmailList&&patron.abjsData||[],findVal_replaceString_start,findVal_replaceString_end,createTick,groupsTitles=suggestOptions.groupsTitles||
{},searchType,needGroupHeader;if((searchType=_event&&_event.currentTarget)&&(searchType=searchType.$Input)&&(searchType=searchType.attr("data-operand")))searchType=OPERANDS_SEARCH_TYPES_MAP[searchType]||OPERANDS_SEARCH_TYPES_MAP.ALL;else searchType=OPERANDS_SEARCH_TYPES_MAP.ALL;emails=searchType&OPERANDS_SEARCH_TYPES_MAP.PEOPLE&&!hideEmailList?Array.filter(emails,function(email){return suggestsCount<suggestsMaxCount&&$.Autocompleter.MatchSubsetByRegExp(email,searchRegexp)&&++suggestsCount}):[];if(!(searchType&
OPERANDS_SEARCH_TYPES_MAP.TEXT))res=[];suggestsCount=0;if(!suggestOptions.grouping)res=emails.concat(Array.map(res,function(item){return _HTML_escape_(item.word||item.text||item+"")}));else{findVal_replaceString_start='<b class="'+(suggestOptions.cnItemTick||"")+'">';findVal_replaceString_end="</b>";createTick=patron.Utils.Search.highlightReplace(_HTML_escape_(val),findVal_replaceString_start,findVal_replaceString_end);needGroupHeader=searchType&searchType-1||searchType==OPERANDS_SEARCH_TYPES_MAP.PEOPLE;
res=Array.map(res,function(_item,i){if(++suggestsCount>suggestsMaxCount)return;var str=_item["word"]||_item["text"],item=new GroupedSuggestItem(suggestOptions,str,val,null,needGroupHeader&&groupsTitles["inLetter"]||"",i);if(suggestOptions.resItemHtml)item.html=suggestOptions.resItemHtml({str:str,createTick:createTick});else item.html='<div data-search-name="q_query" data-suggest="'+str+'" class="'+suggestOptions.cnItem+'">'+createTick(str)+"</div>";return item},this);res=Array.filter(res,function(a){return!!a});
emails=Array.map(emails,function(str,i){var nameAndEmail_parts=str.match(RE_NAME_AND_EMAIL_IN_LTGT),avatar,item,suggest,name,email;if(nameAndEmail_parts){name=nameAndEmail_parts[1];email=nameAndEmail_parts[2];avatar=patron.Utils.getAvatarSrc(email,name,32,null)}else{name=str;email="";if(str.contains("@"))avatar=patron.Utils.getAvatarSrc(str,"",32,null)}item=new GroupedSuggestItem(suggestOptions,name,val,email&&(suggestOptions.searchPeopleOnlyForEmail?email:name+" <"+email+">"),needGroupHeader&&groupsTitles["peoples"],
i);if(suggestOptions.searchPeopleOnlyForEmail)suggest=_HTML_escape_(email?email:name);else suggest=_HTML_escape_(name);if(suggestOptions.emailItemHtml)item.html=suggestOptions.emailItemHtml({suggest:suggest,email:email,name:name,avatar:avatar,createTick:createTick});else item.html='<div style="position:relative;" data-search-name="q_from" data-suggest="'+suggest+'" class="'+suggestOptions.cnItem+" "+suggestOptions.cnItem+'_people">'+(createTick(name)+" "+"<span class='"+suggestOptions.cdSuggestHint+
"'>"+(email?createTick(email):"&nbsp;")+"</span>")+(avatar?"<img alt='' class=\""+suggestOptions.cnItem+"_people__image\" width=30 height=30 src='"+avatar+"' />":"")+"</div>";return item},this);if(emails&&emails[0]&&needGroupHeader){emails[0].category=groupsTitles["peoples"]||"";if(res.length)res[0].category=groupsTitles["inLetter"]||""}res=emails.concat(res)}if(res.length==1&&res[0])if(typeof res[0]=="object"&&res[0].search==val||res[0]==val)res=[];this._selTS=ajs.now();if(!res.length)this._logMe("",
-1);else{clearTimeout(this._autoLog_pid);this._autoLog_pid=setTimeout(this._autoLogMe.bind(this),15E3)}searchRegexp=suggestOptions=emails=findVal_replaceString_start=findVal_replaceString_end=createTick=null;return res},val:function(val){return this.Search.getSuggest().val(val)},reset:function(){this.Search.getSuggest().reset()},disable:function(){if(this.Search)this.Search.disable();if(this.$AdvansedSearchLink)this.$AdvansedSearchLink.hide()},enable:function(){if(this.Search)this.Search.enable();
if(this.$AdvansedSearchLink)this.$AdvansedSearchLink.show()}};patron.ui.SearchSuggest.waitFor=function(selector){return waitCache[selector]=waitCache[selector]||$.Deferred()}})(jQuery);jsLoader.loaded("{patron.ui}patron.ui.SearchSuggest")});jsLoader.use(["{patron.utils}patron.Utils"],function(){patron.Utils.SearchIndex=function(tokenizer){var cache={};function normalize(str){return $.trim(str).toLowerCase()}return{create:function(data){cache={};for(var i=0,l=data.length;i<l;i++){var str=data[i];this.set([str],
str)}},set:function(phrases,object){var words=[];var phrase,tokens,token;for(var i=0,l=phrases.length;i<l;i++){phrase=normalize(phrases[i]);if(phrase&&phrase.length){tokens=tokenizer(phrase);for(var j=0,k=tokens.length;j<k;j++){token=tokens[j];words.push(token,patron.Utils.punto(token),patron.Utils.translit(token))}}}var usedKeys={},word;for(var j=0,k=words.length;j<k;j++){word=words[j];if(!word)continue;for(var i=0,l=word.length;i<l;i++){var key=word.substr(0,i+1);if(!usedKeys[key]){usedKeys[key]=
true;if(cache[key]===undefined)cache[key]=[];cache[key].push(object)}}}},find:function(query){var results=[];Array.forEach(tokenizer(normalize(query)),function(token){results.push(cache[token]||[])});return Array.intersect.apply(null,results)}}};jsLoader.loaded("{patron.utils}patron.Utils.SearchIndex")});define("toolkit.common/ajs/__pager/ajs__pager",function(){var Pager=function(list,perPage,page,singlePage){page=parseInt(page)||1;var urlCreator=$.noop;function pageBorders(){return{from:(page-1)*
perPage,to:Math.min(page*perPage,list.length)}}function pagesCount(){return Math.ceil(list.length/perPage)}return{setUrlCreator:function(callback){urlCreator=callback},doesNeedWidget:function(){return!singlePage&&pagesCount()>1},widgetParams:function(){var pages=pagesCount();var pList=[];var from=Math.max(page-(pages-page<3?5-(pages-page):3),0);var to=Math.min(from+5,pages);for(var p=from+1;p<=to;p++)pList.push(p);return{prevPage:page>1?page-1:null,nextPage:page<pages?page+1:null,lastPage:pages,currentPage:page,
doesNeed:{prevHellip:page>4&&pages>6,nextHellip:pages>6&&pages-page>3,prevPage:page>1,nextPage:page<pages,firstPage:pages>5&&page>3,lastPage:pages>5&&pages-page>2},getUrl:function(page){return urlCreator(page)},pages:pList}},all:function(){return list},total:function(){return list.length},pageBorders:pageBorders,pagesCount:pagesCount,visible:function(){var borders=pageBorders();return list.slice(singlePage?0:borders.from,borders.to)},slice:function(){var borders=pageBorders();return list.slice(borders.from,
borders.to)},hasNext:function(){return page*perPage<list.length},hasPrev:function(){return page>1},next:function(){page++},prev:function(){page--}}};if(typeof module!="undefined"&&typeof module!="function")module.exports=Pager;else if(typeof define==="function"&&define.amd)define(Pager);if(!window.ajs)window.ajs={};window.ajs.Pager=Pager});jsLoader.use(["{patron.utils}patron.Utils.SearchIndex","{toolkit.common}ajs/__pager/ajs__pager"],function(){var defaultOpts={cnSuggest:"suggests__block",cnList:"suggests__block__list",
cnItem:"suggests__block__item",cnSelected:"suggests__block__item_hover",cnInput:"suggests__input",internalSource:false,ignoreUsedData:false,templateInternetVal:function(){return false},searchIndexTokenizer:function(str){return str.split(/\s+/)},afterSelect:function(val){return val},afterGetData:$.noop,filterUsed:function(data,usedMap){var filteredData=[];for(var i=0,l=data.length;i<l;i++){var row=data[i];if(usedMap[row]===undefined)filteredData.push(row)}return filteredData},startFindSuggest:null,
startFindSuggest:null,limit:10,autoMarked:0,updateOnMark:false};jsClass.create("patron.ui.Suggest").methods({__construct:function(input,data,opts){this.input=input;this.opts=Object.extend({},defaultOpts,opts);this.setData(data);this.ignoreUsed([]);this._initResultsList();this._initAjsSuggest()},_initResultsList:function(){var opts=this.opts;var inputName=this.input.attr("name")||this.input.attr("data-original-name")||"";this.block=$('<div style="display: none; position: absolute;" data-original-name="'+
inputName+'" class="'+opts.cnSuggest+'"></div>');this.list=$('<div class="'+opts.cnList+'"></div>');this.block.append(this.list);this.block.appendTo($("#ScrollBodyInner")[0]||document.body);if(typeof opts.cnInput==="string")this.input.addClass(opts.cnInput)},_initAjsSuggest:function(){var suggest=this,suggestOpts=this.opts,input=this.input,block=this.block,_fetch=suggestOpts.fetching,_events;if(suggestOpts.internalSource&&!suggestOpts.request){suggestOpts.request=function(url,fn,val){fn()};suggestOpts.ajaxUrl=
"#"}suggestOpts=Object.extend(suggestOpts,{fetching:_fetch,expire:_fetch,cnSuggest:block[0],cnList:this.list[0]});this.ajsSuggest=ajs.ui.suggest(input.parent()[0],suggestOpts);if(Object.isObject(_events=suggestOpts["events"])){Object.forEach(_events,function(eventHandler,eventName){if(eventName.contains("suggests:"))this.addTrigger(eventName,eventHandler)},this.ajsSuggest);delete suggestOpts["events"];_events=null}this.ajsSuggest.addTrigger("suggests:getData",function(e){var data=e["data"],suggestValue=
e["suggestValue"];if(data&&data["__nooverride"])return;if(suggestOpts.internalSource&&suggest.localData)data=suggest._getData(suggestValue);if(data.length){if(Object.keys(suggest.usedMap).length)data=suggestOpts.filterUsed(data,suggest.usedMap);if(this.opts.fetching){suggest.pager=ajs.Pager(data,this.opts.fetchCount);data=suggest.pager.slice()}else{delete suggest.pager;if(suggestOpts.limit)data=data.slice(0,suggestOpts.limit)}}e["data"]=data}).addTrigger("suggests:mark",function(e){var opts=this.opts;
e["updateInputValue"]=e["updateInputValue"]&&opts.updateOnMark}).addTrigger("suggests:select",function(e){var originalEvent=e["originalEvent"];if(originalEvent&&originalEvent.type=="blur"){e["updateInputValue"]=false;return}var sug=e["newSuggest"];if(sug)e["newSuggest"]=suggestOpts.afterSelect(sug,e["newSuggestIndex"],e.inputValueLeftPart,e.inputValueRightPart);e["inputSelectionStart"]=Infinity;e["inputSelectionEnd"]=Infinity;setTimeout(function(){this.change()}.bind(jQuery(this["$Input"])))}).addTrigger("suggests:afterRebuild",
function(e){var offset=input.offset(),margin=suggestOpts.margin?suggestOpts.margin:7,tmp;tmp=typeof suggestOpts.width;if(tmp==="string"){if(suggestOpts.width==="auto")if(tmp=input[0])suggestOpts.width=Math.max(tmp.clientWidth,100)+"px";tmp=suggestOpts.width}else if(tmp==="number"&&suggestOpts.width>0)tmp=suggestOpts.width;else tmp=Math.max(input.width(),100);block.css({width:tmp,top:offset.top+input.height()+margin,left:offset.left,zIndex:4E4});if(suggestOpts.afterRebuild)suggestOpts.afterRebuild(e,
block)});if(_fetch){this.ajsSuggest.addTrigger("suggests:fetch",function(e){var data=e["data"];if(data&&suggest.pager&&suggest.pager.hasNext()){suggest.pager.next();data.splice.bind(data,e["fetchFrom"]+1,0).apply(null,suggest.pager.slice())}});if(suggestOpts.ignoreUsedData)this.ajsSuggest.addTrigger("suggests:hide",function(){suggest.ignoreUsed(suggest.getSuggestWords())})}if(suggestOpts.internalSource)this.ajsSuggest.addTrigger("suggests:find",function(e){e.expire=true;if(suggestOpts.startFindSuggest&&
e.originalEvent&&e.originalEvent.type=="focus")if(suggestOpts.startFindSuggest()===false)return false});if(typeof suggestOpts.afterGetSuggestWords=="function")this.ajsSuggest.addTrigger("suggests:getSuggestWords:after",function(event){var ignoreAfter;ignoreAfter=(ignoreAfter=event.target)&&(ignoreAfter=ignoreAfter.opts)&&ignoreAfter.ignoreAfterGetSuggestWords;if(!ignoreAfter)event["data"]=this(event["data"])}.bind(suggestOpts.afterGetSuggestWords))},_getData:function(suggestValue){return suggestValue?
this.localData.find(suggestValue):this.localData.all()},setData:function(data){if(data&&"find"in data&&"all"in data&&$.isFunction(data.find)&&$.isFunction(data.all))this.localData=data;else if(Array.isArray(data)){var searchIndex=new patron.Utils.SearchIndex(this.opts.searchIndexTokenizer);searchIndex.create(data);this.localData={type:"fromArray",all:function(){return data},find:function(suggestValue){return searchIndex.find(suggestValue)}}}else throw new Error("Undefined type of data");},isExpanded:function(){return this.ajsSuggest.isExpanded()},
hide:function(){this.ajsSuggest.hide()},ignoreUsed:function(used){this.usedMap={};if(Array.isArray(used))for(var i=0,l=used.length;i<l;i++)if(used[i])this.usedMap[used[i]]=true},showWholeList:function(){if(this.opts.internalSource)this.ajsSuggest.reset();this.ajsSuggest.showSuggests("",false,this.data,true)},getSuggestWords:function(ignoreAfter){var result;if(ignoreAfter)this.ajsSuggest.opts.ignoreAfterGetSuggestWords=true;result=this.ajsSuggest.getSuggestWords();if(ignoreAfter)delete this.ajsSuggest.opts.ignoreAfterGetSuggestWords;
return result},getCurrentFindValue:function(){return this.ajsSuggest.getCurrentFindValue()},rebuildSuggestsList:function(){if(this.opts.internalSource)this.ajsSuggest.reset();this.ajsSuggest.showSuggests(this.getCurrentFindValue(),false)}});jsLoader.loaded("{patron.ui}patron.ui.Suggest")});(function(global){var k,_handlers={},_mods={16:false,18:false,17:false,91:false},_scope="all",_MODIFIERS={"\u21e7":16,shift:16,"\u2325":18,alt:18,option:18,"\u2303":17,ctrl:17,control:17,"\u2318":91,command:91},
_MAP={backspace:8,tab:9,clear:12,enter:13,"return":13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,"delete":46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},code=function(x){return _MAP[x]||x.toUpperCase().charCodeAt(0)},_downKeys=[];for(k=1;k<20;k++)_MODIFIERS["f"+k]=111+k;function index(array,item){var i=array.length;while(i--)if(array[i]===item)return i;return-1}var modifierMap={16:"shiftKey",18:"altKey",
17:"ctrlKey",91:"metaKey"};function updateModifierKey(event){for(k in _mods)_mods[k]=event[modifierMap[k]]}function dispatch(event,scope){var key,handler,k,i,modifiersMatch;key=event.keyCode;if(index(_downKeys,key)==-1)_downKeys.push(key);if(key==93||key==224)key=91;if(key in _mods){_mods[key]=true;for(k in _MODIFIERS)if(_MODIFIERS[k]==key)assignKey[k]=true;return}updateModifierKey(event);if(!assignKey.filter.call(this,event))return;if(!(key in _handlers))return;for(i=0;i<_handlers[key].length;i++){handler=
_handlers[key][i];if(handler.scope==scope||handler.scope=="all"){modifiersMatch=handler.mods.length>0;for(k in _mods)if(!_mods[k]&&index(handler.mods,+k)>-1||_mods[k]&&index(handler.mods,+k)==-1)modifiersMatch=false;if(handler.mods.length==0&&!_mods[16]&&!_mods[18]&&!_mods[17]&&!_mods[91]||modifiersMatch)if(handler.method(event,handler)===false){if(event.preventDefault)event.preventDefault();else event.returnValue=false;if(event.stopPropagation)event.stopPropagation();if(event.cancelBubble)event.cancelBubble=
true}}}}function clearModifier(event){var key=event.keyCode,k,i=index(_downKeys,key);if(i>=0)_downKeys.splice(i,1);if(key==93||key==224)key=91;if(key in _mods){_mods[key]=false;for(k in _MODIFIERS)if(_MODIFIERS[k]==key)assignKey[k]=false}}function resetModifiers(){for(k in _mods)_mods[k]=false;for(k in _MODIFIERS)assignKey[k]=false}function assignKey(key,scope,method){var keys,mods,i,mi;if(method===undefined){method=scope;scope="all"}key=key.replace(/\s/g,"");keys=key.split(",");if(keys[keys.length-
1]=="")keys[keys.length-2]+=",";for(i=0;i<keys.length;i++){mods=[];key=keys[i].split("+");if(key.length>1){mods=key.slice(0,key.length-1);for(mi=0;mi<mods.length;mi++)mods[mi]=_MODIFIERS[mods[mi]];key=[key[key.length-1]]}key=key[0];key=code(key);if(!(key in _handlers))_handlers[key]=[];_handlers[key].push({shortcut:keys[i],scope:scope,method:method,key:keys[i],mods:mods})}}function isPressed(keyCode){if(typeof keyCode=="string")keyCode=code(keyCode);return index(_downKeys,keyCode)!=-1}function getPressedKeyCodes(){return _downKeys.slice(0)}
function filter(event){var tagName=(event.target||event.srcElement).tagName;return!(tagName=="INPUT"||tagName=="SELECT"||tagName=="TEXTAREA")}for(k in _MODIFIERS)assignKey[k]=false;function setScope(scope){_scope=scope||"all"}function getScope(){return _scope||"all"}function deleteScope(scope){var key,handlers,i;for(key in _handlers){handlers=_handlers[key];for(i=0;i<handlers.length;)if(handlers[i].scope===scope)handlers.splice(i,1);else i++}}function addEvent(object,event,method){if(object.addEventListener)object.addEventListener(event,
method,false);else if(object.attachEvent)object.attachEvent("on"+event,function(){method(window.event)})}addEvent(document,"keydown",function(event){dispatch(event,_scope)});addEvent(document,"keyup",clearModifier);addEvent(window,"focus",resetModifiers);var previousKey=global.key;function noConflict(){var k=global.key;global.key=previousKey;return k}global.key=assignKey;global.key.setScope=setScope;global.key.getScope=getScope;global.key.deleteScope=deleteScope;global.key.filter=filter;global.key.isPressed=
isPressed;global.key.getPressedKeyCodes=getPressedKeyCodes;global.key.noConflict=noConflict;if(typeof module!=="undefined")module.exports=key})(this);define("toolkit.common/keymaster/keymaster",[],function(){return key});window["__log"].core_file_js=0;if(typeof window.patron!=="object")window.patron={ui:{}};jsLoader.use(["{jQuery}jquery","{jsCore}jsCore","{jsCore}Date","{jsCore}jsCore.ajs","{jsCore}swfobject","{jsCore}JSON","{toolkit.common}callstack/callstack","{toolkit.common}modernizr/modernizr",
"{utils}Lang","{utils}jsHistory","{utils}Counter","{utils}HotKeys","{toolkit.common}ajs/__router/ajs__router","{toolkit.common}store/store","{toolkit.common}jinn/__bubble/jinn__bubble","{jQuery}extensions","{jQuery}jquery.getCSS","{jQuery}jquery.xdr-transport","{jQuery}jquery.tpl","{jQuery}jquery.fest-x","{jQuery}autocomplete","{toolkit.common}jquery/__event-fix/jquery__event-fix","{toolkit.common}jquery/__event-tap/jquery__event-tap","{toolkit.common}jquery/__event-scroll/jquery__event-scroll","{toolkit.common}jquery/__event-mousewheel/jquery__event-mousewheel",
"{toolkit.common}jquery/__classList/jquery__classList","{plugins}LightBox","{plugins}Dropdown","{plugins}LayerManager","{toolkit.mail}b-toolkit/b-toolkit","{patron.utils}patron.Utils","{patron}patron.API","{patron}patron.Ad","{patron}patron.Themes","{patron}patron.core","{patron}patron.Spinner","{patron}patron.Notify","{patron}patron.Balloon","{patron}patron.Announcement","{patron}patron.PhoneManager","{patron}patron.BindedCounters","{patron}patron.Threads","{patron}patron.Messages","{patron.ui}patron.ui.SearchSuggest",
"{patron.ui}patron.ui.Suggest","{patron}patron.Collector","{toolkit.common}keymaster/keymaster","{patron.v2.utils}patron.utils.ui.counters"],function(){jsLoader.loaded("{patron.build}core");window["__log"].core_file_js=1});window.$=window.jQuery=jQuery})(window.patron&&patron.jQuery||window.jQuery);
