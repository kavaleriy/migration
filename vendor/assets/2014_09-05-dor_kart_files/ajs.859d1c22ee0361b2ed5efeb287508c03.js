/*

 Simple/pseudo jQuery
 @author	RubaXa	<trash@rubaxa.org>, termi <termi1uc1@gmail.com>
 @build	ui/ajs.ui.dropdown, ui/ajs.ui.search, ui/ajs.ui.suggest

 @author				Egor Halimonenko <termi1uc1@gmail.com>
 @compatibility		JavaScript 1.5+
 http://developer.mozilla.org/en/docs/Core_JavaScript_1.5_Reference:Global_Objects:Array
 Polyfills from https://github.com/termi/ES5-DOM-SHIM

 Extensions for "String" object

 @author	RubaXa	<trash@rubaxa.org>
 @version	1.0
*/
window.define=window.define||function(name,deps,callback){(callback||deps||name)()};
(function(){var global=window,ajs={},_tmp_;_tmp_="%BUILD.VERSION%";if(!parseFloat(_tmp_))_tmp_="0.13.0";ajs["version"]=_tmp_;global["ajs"+ajs["version"]]=ajs;if(!global["ajs"])global["ajs"]=ajs;if(!Function.prototype.bind)Function.prototype.bind=function(context){var self=this;if(arguments.length>1){var args=_Array_slice_.call(arguments,1);return function(){return self.apply(context,args.concat(_Array_slice_.call(arguments,0)))}}else return function(){return self.apply(context,arguments)}};var _document=
global.document,_browser_msie="attachEvent"in _document&&"all"in _document&&"uniqueID"in _document.documentElement&&+((/msie (\d+)/i.exec(navigator.userAgent)||[])[1]||0)||null,RE_dot=/\./g,RE_num=/^\d+/,RE_unsafe_space=/\s+/,RE_linebreaks=/[\r\n\t]/g,classAttr="className",getElement="getElement",getElementById=getElement+"ById",getElementsByClassName=getElement+"sByClassName",getElementsByTagName=getElement+"sByTagName",IS_ADD_EVENT_LISTENER_SUPPORT="addEventListener"in _document,IEEventHandlers=
!IS_ADD_EVENT_LISTENER_SUPPORT&&{},addEventListener=IS_ADD_EVENT_LISTENER_SUPPORT?"addEventListener":"attachEvent",removeEventListener=IS_ADD_EVENT_LISTENER_SUPPORT?"removeEventListener":"detachEvent",querySelectorSupport=!!_document.querySelectorAll,cssNumber={"fillOpacity":true,"fontWeight":true,"lineHeight":true,"opacity":true,"orphans":true,"widows":true,"zIndex":true,"zoom":true},_Array_slice_=(_tmp_=Array.prototype).slice,_Array_forEach_=_tmp_.forEach,_Array_filter_=_tmp_.filter,_Array_reduce_=
_tmp_.reduce,_Array_every_=_tmp_.every,_Array_some_=_tmp_.some,RE_left_spaces=/^\s+/,RE_space=/\s/,NEED_PREPARE_STRING=function(strObj){return strObj[0]!="a"||!(0 in strObj)}(Object("a")),_toObject=function(obj,_allowNull){if(obj==null&&!_allowNull)throw new TypeError;if(NEED_PREPARE_STRING&&typeof obj=="string"&&obj)return String.prototype.split.call(obj,"");return Object(obj)},_String_trim_=String.prototype.trim||function(){var str=this.replace(RE_left_spaces,""),i=str.length;while(RE_space.test(str.charAt(--i)));
return str.slice(0,i+1)},_String_contains,_String_trim_whitespace="\t\n\x0B\f\r \u00a0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff",_String_trim_beginRegexp,_String_trim_endRegexp,_Function_apply_=Function.prototype.apply,_Function_call_=Function.prototype.call,_call_function=function(_function,context,var_args){return _Function_apply_.call(_function,context,_Array_slice_.call(arguments,2))},_hasOwnProperty=_Function_call_.bind(Object.prototype.hasOwnProperty),
IS_SUPPORT_CLASSLIST="classList"in _document.documentElement&&function(el){el["classList"].add(1,2);return el["classList"].contains(2)?2:1}(_document.createElement("b")),$_addClass_helper,$_removeClass_helper,UUID_PREFIX=("_"+Math.random()).substr(3,6),HANDLER_UUID_PROPNAME="uuid"+UUID_PREFIX,_toString_=Object.prototype.toString,array_for_escape_and_unescape,array_some_or_every;if(!String.prototype["contains"])String.prototype["contains"]=function(str,fromIndex){return!!~String(this).indexOf(str,
fromIndex|0)};_String_contains=_Function_call_.bind(String.prototype["contains"]);if(!String.prototype["startsWith"])String.prototype["startsWith"]=function(substring,fromIndex){substring=String(substring);if(!substring.length)return true;fromIndex=fromIndex|0;if(fromIndex<0)fromIndex=0;return this.charCodeAt(fromIndex)===substring.charCodeAt(0)&&this.indexOf(substring,fromIndex)===fromIndex};if(!String.prototype["endsWith"])String.prototype["endsWith"]=function(substring,position){substring=String(substring);
var subLen=substring.length|0;if(!subLen)return true;var strLen=this.length;if(position===void 0)position=strLen;else position=position|0;if(position<1)return false;var fromIndex=(strLen<position?strLen:position)-subLen;return(fromIndex>=0||subLen===-fromIndex)&&(position===0||this.charCodeAt(fromIndex)===substring.charCodeAt(0))&&this.indexOf(substring,fromIndex)===fromIndex};if(!Object.create)Object.create=function(_prototype){var _object;if(_prototype===null)_object={"__proto__":null};else{var Type=
function(){};Type.prototype=_prototype;_object=new Type;_object.__proto__=_prototype}return _object};if(!Object.keys)Object.keys=function(hasDontEnumArgumentsBug){var DontEnums,DontEnumsLength,hasDontEnumBug=!{"toString":null}.propertyIsEnumerable("toString"),eab_callerSupport,eab_objectArgumentsToStringSupport;if(hasDontEnumBug){DontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"];DontEnumsLength=DontEnums.length}for(hasDontEnumArgumentsBug in arguments){hasDontEnumArgumentsBug=
false;break}if(hasDontEnumArgumentsBug!==false){hasDontEnumArgumentsBug=true;if((eab_objectArgumentsToStringSupport=_toString_.call(arguments))!=="[object Arguments]"){eab_objectArgumentsToStringSupport=false;eab_callerSupport="caller"in arguments}}return function(obj){if(typeof obj!=="object"&&typeof obj!=="function"||obj===null)throw new TypeError("Object.keys called on a non-object");var result=[];for(var name in obj)if(_hasOwnProperty(obj,name))result.push(name);var i;if(hasDontEnumBug)for(i=
0;i<DontEnumsLength;i++)if(_hasOwnProperty(obj,DontEnums[i]))result.push(DontEnums[i]);var len;if(hasDontEnumArgumentsBug)if(eab_objectArgumentsToStringSupport?_toString_.call(obj)===eab_objectArgumentsToStringSupport:typeof obj==="object"&&"callee"in obj&&(!eab_callerSupport||"caller"in obj)&&typeof(len=obj.length)==="number")for(i=0;i<len;i++)if(_hasOwnProperty(obj,i))result.push(i);return result}}(null);Object.isObject=function(object){var type;return!!object&&((type=typeof object)==="object"||
type==="function")};Object.isPlainObject=function(object){return!!object&&_toString_.call(object)==="[object Object]"&&(typeof object.constructor==="function"&&_toString_.call(object.constructor)==="[object Function]"||object.__proto__===null)&&!_hasOwnProperty(object,"callee")};if(!Object.forEach)Object.forEach=function(object,callback,context){if(typeof callback!=="function")throw new TypeError(callback+" is not a function");var key;if(object)for(key in object)if(_hasOwnProperty(object,key))if(callback.call(context,
object[key],key,object)===false)break};if(!String.prototype.trim||_String_trim_whitespace.trim()){_String_trim_whitespace="["+_String_trim_whitespace+"]";_String_trim_beginRegexp=new RegExp("^"+_String_trim_whitespace+_String_trim_whitespace+"*");_String_trim_endRegexp=new RegExp(_String_trim_whitespace+_String_trim_whitespace+"*$");String.prototype.trim=function(){return String(this).replace(_String_trim_beginRegexp,"").replace(_String_trim_endRegexp,"")}}if(!Function.prototype.throttle)Function.prototype.throttle=
function(delayedTime,context){var _function=this,timer,args;return function(){var doJob;args=arguments;if(!timer){doJob=function(){timer=null;if(args){_function.apply(this,args);args=null;timer=setTimeout(doJob,delayedTime)}}.bind(context||this);doJob()}}};if(!Function.prototype.debounce)Function.prototype.debounce=function(delayedTime,context){var _function=this,timer;return function(){clearTimeout(timer);timer=setTimeout(function(args){_function.apply(this,args)}.bind(context||this,arguments),delayedTime)}};
if(!Number.isNumber)Number.isNumber=function(value){return!global.isNaN(global.parseFloat(value))&&global.isFinite(value)};Number.isNumeric=function(value){return!global.isNaN(global.parseFloat(value))&&global.isFinite(value)};if(!Number.isFinite)Number.isFinite=function(value){return typeof value==="number"&&global.isFinite(value)};if(!Number.isInteger)Number.isInteger=function(value){return Number.isFinite(value)&&value>=-9007199254740992&&value<=9007199254740992&&Math.floor(value)===value};var $=
function(sel,context){if(!(this instanceof $))return new $(sel,context);else if(sel&&sel["ajs"]===UUID_PREFIX&&sel instanceof $)return sel;this.length=0;this["selector"]=typeof sel=="string"?sel:"";if(!sel);else if(sel==="body"){this[0]=_document.body;this.length=1}else if(sel===global){this[0]=global;this.length=1}else if(typeof sel==="string"){this.context=context=context||_document;if(sel.charAt(0)=="<"){var div=_document.createElement("div");div.innerHTML=sel;this.push(div.childNodes);div=null}else this.push(find($(context),
sel))}else if(sel)if(sel.nodeType==1||sel.nodeType==9){this[0]=sel;this.length=1}else this.push(sel);return this};if(!Array["forEach"])Array["forEach"]=_Array_forEach_?function(array,iterator,context){return _Array_forEach_.apply(array,_Array_slice_.call(arguments,1))}:function(array,iterator,context){var thisArray=_toObject(array),length=thisArray.length>>>0,i=-1;while(++i<length)if(i in thisArray)_call_function(iterator,context,thisArray[i],i,array)};if(!Array["filter"])Array["filter"]=_Array_filter_?
function(array,callback,thisObject){return _Array_filter_.apply(array,_Array_slice_.call(arguments,1))}:function(array,callback,thisObject){var thisArray=_toObject(array),len=thisArray.length>>>0,result=[],val;for(var i=0;i<len;i++)if(i in thisArray){val=thisArray[i];if(_call_function(callback,thisObject,val,i,thisArray))result.push(val)}return result};if(!Array["reduce"])Array["reduce"]=_Array_reduce_?function(array,accumulator,initialValue){return _Array_reduce_.apply(array,_Array_slice_.call(arguments,
1))}:function(array,accumulator,initialValue){var thisArray=_toObject(array),l=thisArray.length>>>0,i=0;if(l===0&&arguments.length<=1)throw new TypeError("Array length is 0 and no second argument");if(initialValue===void 0)initialValue=(++i,thisArray[0]);for(;i<l;++i)if(i in thisArray)initialValue=accumulator.call(void 0,initialValue,thisArray[i],i,thisArray);return initialValue};array_some_or_every=_Array_every_?null:function(array,callback,thisObject,_option_isAll){if(_option_isAll===void 0)_option_isAll=
true;var result=_option_isAll;Array.forEach(array,function(value,index){if(result==_option_isAll)result=!!_call_function(callback,thisObject,value,index,this)},array);return result};if(!Array["every"])Array["every"]=_Array_every_?function(array){return _Array_every_.apply(array,_Array_slice_.call(arguments,1))}:function(array,callback,thisObject){return array_some_or_every(array,callback,thisObject)};if(!Array["some"])Array["some"]=_Array_some_?function(array){return _Array_some_.apply(array,_Array_slice_.call(arguments,
1))}:function(array,callback,thisObject){return array_some_or_every(array,callback,thisObject,false)};$["forEach"]=Array["forEach"];$["filter"]=Array["filter"];$["reduce"]=Array["reduce"];$["every"]=Array["every"];$["some"]=Array["some"];if(!Array.isArray)Array.isArray=function(object){return _toString_.call(object)==="[object Array]"};if(!Array.from)Array.from=function(iterableObject){if(iterableObject.toArray)return iterableObject.toArray();var object=_toObject(iterableObject,true),length=object.length>>>
0,result;try{result=_Array_slice_.call(object)}catch(e){}if(result&&result.length===length)return result;result=[];for(var key=0;key<length;key++)if(key in object)result[key]=object[key];return result};if(!Array.of)Array.of=function(){return _Array_slice_.call(arguments)};function ajs_dom_mutationMacro(nodes){var resultNode=null,i,k,l,maxLength=nodes.length,node,newNodes=[];for(i=0;i<maxLength;++i){node=nodes[i];if(node&&node["ajs"]&&node instanceof $)for(k=0,l=node.length;k<l;++k)newNodes.push(node[k]);
else{if(typeof node==="string")node=_document.createTextNode(node);if(node.nodeType)newNodes.push(node)}}if((maxLength=newNodes.length)===1)resultNode=newNodes[0];else{resultNode=_document.createDocumentFragment();for(i=0;i<maxLength;++i)resultNode.appendChild(newNodes[i])}return resultNode}$.extend=function(dst){var i=1,n=arguments.length,val,key,src;if(!n){$["expand"]($["fn"],dst);return this}else{for(;i<n;i++)if(src=arguments[i])for(key in src)if(_hasOwnProperty(src,key)&&(val=src[key])!==null&&
val!==void 0)dst[key]=val;return dst}};$.trim=function(text){return text==null?"":_String_trim_.call(text)};$["gid"]=1;$["each"]=Array.forEach;$["noop"]=function(a){return a};$["quote"]=function(str){return(str+"").replace(/[\\"']/g,"\\$&").replace(/\u0000/g,"\\0")};$["callAsync"]=function(method,context,_arguments,previousCallAsyncHandler){if(previousCallAsyncHandler)clearTimeout(previousCallAsyncHandler);return setTimeout(function(){method.apply(context||null,_arguments||[])})};array_for_escape_and_unescape=
["&#039;","&apos;","&#39;","&quot;","&lt;","&gt;","&#92;","&#35;","&amp;","'","'","'",'"',"<",">","\\","#","&"];var array_for_escape_and_unescape_length=array_for_escape_and_unescape.length;for(_tmp_=0;_tmp_<array_for_escape_and_unescape_length;++_tmp_)array_for_escape_and_unescape[_tmp_+array_for_escape_and_unescape_length]=new RegExp(array_for_escape_and_unescape[_tmp_].replace(/^\\$/,"\\\\"),"g");array_for_escape_and_unescape_length=array_for_escape_and_unescape.length;function _html_escape_and_unescape(RE_all_symbols,
indent_strForTest,indent_RE_forReplace,indent_strForReplace,str){str=String(str||"");if(str&&RE_all_symbols.test(str)){var i=array_for_escape_and_unescape_length/4;while(i--)if(~str.indexOf(this[i+indent_strForTest]))str=str.replace(this[i+indent_RE_forReplace],this[i+indent_strForReplace])}return str}if(!ajs.Html){ajs.Html={};ajs.HTML=ajs.Html}ajs.Html.escape=_html_escape_and_unescape.bind(array_for_escape_and_unescape,new RegExp(array_for_escape_and_unescape.slice(array_for_escape_and_unescape_length/
4+2,array_for_escape_and_unescape_length/2).join("|")),array_for_escape_and_unescape_length/4,array_for_escape_and_unescape_length*3/4,0);ajs.Html.unescape=_html_escape_and_unescape.bind(array_for_escape_and_unescape,new RegExp(array_for_escape_and_unescape.slice(0,array_for_escape_and_unescape_length/4).join("|")),0,array_for_escape_and_unescape_length/2,array_for_escape_and_unescape_length/4);$.inherits=function(Child,Parent,props){Child.prototype=Object.create((Child["superclass"]=Parent).prototype);
Child.prototype["constructor"]=Child;if(Object.isObject(props))$.extend(Child.prototype,props);return Child};function $_classList_toggle_(toggle_helper,overwriteClassName){var i=0,elementsLength="length"in this&&!("nodeType"in this)&&this.length||0,elm=elementsLength&&this[0]||this,klasses,updated,isSupportClassList;overwriteClassName=overwriteClassName.replace(RE_linebreaks," ").split(RE_unsafe_space);isSupportClassList=IS_SUPPORT_CLASSLIST&&(IS_SUPPORT_CLASSLIST===2||overwriteClassName.length===
1?2:1);do{if(elm)if(isNode(elm)&&isSupportClassList&&typeof toggle_helper=="string"){elm=elm["classList"];if(isSupportClassList===2)elm[toggle_helper].apply(elm,overwriteClassName);else Array.forEach(overwriteClassName,elm[toggle_helper].bind(elm))}else if(typeof(klasses=elm[classAttr])==="string"){updated=klasses.length;if(!updated)klasses=overwriteClassName.join(" ");else{klasses=(" "+klasses+" ").replace(RE_linebreaks);updated=klasses.length;klasses=Array.reduce(overwriteClassName,toggle_helper,
klasses)+""}if(updated!==klasses.length)elm[classAttr]=klasses.trim()}elm=i++<elementsLength?this[i]:null}while(elm);return this}$_addClass_helper=IS_SUPPORT_CLASSLIST?"add":function(str,klas){klas=" "+klas;if(!_String_contains(str,klas+" "))return str+klas;return str};$_removeClass_helper=IS_SUPPORT_CLASSLIST?"remove":function(str,klas){klas=" "+klas+" ";if(_String_contains(str,klas))return str.replace(klas," ");return str};$.prototype=$["fn"]={constructor:$,"ajs":UUID_PREFIX,attr:function(name,
val){var elm=this[0],i,n,key,ret;if(typeof name=="string"&&val===void 0){if(elm)if(name in elm||!("getAttribute"in elm))ret=elm[name];else ret=elm.getAttribute(name);return ret}else{name=objByKeyVal(name,val);for(i=0,n=this.length;i<n;i++)if(elm=this[i])for(key in name){val=name[key];if(key in elm||!("setAttribute"in elm))elm[key]=val;else elm.setAttribute(key,val)}return this}},currentStyle:function(name){if(!this[0])return"";var val,ce,tmp;if("getComputedStyle"in global)val=global.getComputedStyle(this[0])[name];
else{ce=this[0].currentStyle;if((val=ce[name])===void 0)if(name=="font"){val="";val+=ce[name+"Style"];tmp=ce[name+"Variant"];val+=tmp?" "+tmp:"";tmp=ce[name+"Weight"];val+=tmp?" "+tmp:"";tmp=ce[name+"Size"];val+=tmp?" "+tmp:"";tmp=ce["lineHeight"];val+=tmp?"/"+tmp:"";tmp=ce[name+"Family"];val+=tmp?" "+tmp:""}else if(name=="border")val=ce[name+"Width"]+" "+ce[name+"Style"]+" "+ce[name+"Color"]}return val},css:function(name,val){var elm=this[0],i,n,key,ret;if(typeof name=="string"&&val===void 0){ret=
elm&&elm.style&&elm.style[name]||void 0;if(ret&&RE_num.test(ret))ret=parseFloat(ret);return ret}else{name=objByKeyVal(name,val);for(i=0,n=this.length;i<n;++i)if((elm=this[i])&&(elm=elm.style))for(key in name){val=name[key];if(val!==""&&!isNaN(val)&&!cssNumber[key])val+="px";elm[key]=val}}return this},size:function(){return this.length},push:function(array,prev){if(prev){var ret=$(array);ret["prevObject"]=this;return ret}this.length=0;for(var i=0,l=array.length;i<l;++i){this[i]=array[i];this.length++}return this},
each:function(fn){for(var i=0,l=this.length,item;i<l;++i)fn.call(item=this[i],i,item,this);return this},eq:function(idx){return this.push(this[idx],1)},filter:function(sel){sel=sel.split(".");return this.push(matchesSelector(this,sel[0],sel[1]),1)},find:function(sel){return this.push(find(this,sel),1)},children:function(idx){if(this[0]){var childs=this[0].childNodes;return this.push(idx===void 0?childs:childs[idx],1)}return this.push(0,1)},end:function(){return this["prevObject"]||$()},parent:function(){var this_0=
this[0],hasParentElement=!this_0||"parentElement"in this_0,parentElement=this_0&&this_0.parentElement||null;if(!hasParentElement&&!parentElement){parentElement=this_0&&this_0.parentNode;while(parentElement&&parentElement.nodeType!=1)parentElement=parentElement.parentNode}return this.push(parentElement,1)},html:function(html){return html===void 0?this[0]&&this[0].innerHTML:this.each(function(){this.innerHTML=html})},val:function(val){if(val===void 0)return this[0]&&this[0].value||"";else{var l=this.length,
item;while(l--)if(item=this[l]){item.value=val;item.setAttribute("value",val)}return this}},append:function(var_args){var elm=this[0];if(elm)elm.appendChild(ajs_dom_mutationMacro(arguments));return this},prepend:function(var_args){var elm=this[0];if(elm)elm.insertBefore(ajs_dom_mutationMacro(arguments),elm.firstChild);return this},after:function(var_args){var elm=this[this.length-1];if(elm&&elm.parentNode)elm.parentNode.insertBefore(ajs_dom_mutationMacro(arguments),elm.nextSibling);return this},before:function(var_args){var elm=
this[0];if(elm&&elm.parentNode)elm.parentNode.insertBefore(ajs_dom_mutationMacro(arguments),elm);return this},remove:function(){return this.each(function(){this.parentNode&&this.parentNode.removeChild(this)})},bind:function(events,fn){return eventListener(this,1,events,fn)},unbind:function(events,fn){return eventListener(this,0,events,fn)},trigger:function(events){return this.each(function(){try{this[events]()}catch(e){if(console.log)console.log(this,events)}})},one:function(events,fn){return this.bind(events,
function l(){$(this).unbind(events,l);return fn.apply(this,arguments)}.bind(this))},hasClass:function(className){var matches=matchClasses.bind(null,className.replace(RE_linebreaks," ").split(RE_unsafe_space));return"length"in this?Array.some(this,matches):matches(this)},addClass:function(className){return $_classList_toggle_.call(this,$_addClass_helper,className)},removeClass:function(className){return $_classList_toggle_.call(this,$_removeClass_helper,className)},toggleClass:function(className,state){var arrayLike=
"length"in this&&!("nodeType"in this)?this:[this];return((state===void 0?!$["fn"].hasClass.call(arrayLike,className):state)?$["fn"].addClass:$["fn"].removeClass).call(arrayLike,className)},hasMod:function(modName){if(!modName)return false;var matches=function(el){return el.className&&this.test(el.className)}.bind(RegExp("(_"+modName.trim().replace(/\s/g," _")+"(\\s|$))","g"));return"length"in this&&!isNode(this)?Array.some(this,matches):matches(this)},addMod:function(modName){return $_classList_toggle_.call(this,
function(klas,mod){if(klas&&!_String_contains(klas,mod)){klas=klas.trim();klas+=" "+klas.replace(/(\s|$)/g,mod+"$1")}return klas},"_"+modName.trim().replace(/\s/g," _"))},removeMod:function(modName){return $_classList_toggle_.call(this,function(klas,mod){if(klas&&_String_contains(klas,mod)){klas=klas.trim();klas=" "+klas.replace(RegExp("(\\s|^)[\\w-_]+"+mod+"(?=\\s|$)","g"),"")}return klas.trim()},"_"+modName.trim().replace(/\s/g," _"))},toggleMod:function(modName,state){var arrayLike="length"in this&&
!("nodeType"in this)?this:[this];return((state===void 0?!$["fn"].hasMod.call(arrayLike,modName):state)?$["fn"].addMod:$["fn"].removeMod).call(arrayLike,modName)},closest:function(sel,context){var elm=this[0],tag;if(context&&!isNode(context))context=null;if(elm){sel=sel.split(".");tag=sel[0]?sel[0].toUpperCase():false;sel=sel[1]?sel.slice(1):false;do if(isNode(elm)&&(!tag||elm.tagName.toUpperCase()==tag)&&(!sel||matchClasses(sel,elm)))return this.push(elm,1);while(elm&&(!context||context!=elm)&&(elm=
elm.parentNode)&&elm!==_document.body)}return this.push(void 0,1)},show:function(){var cur=this.css("display");return cur=="none"?this.css("display",""):cur},hide:function(){return this.css("display","none")},toggle:function(state){if(state===void 0)state=this.css("display")=="none";return this[state?"show":"hide"]()},add:function(something,matchesSelector){var elements=$(something),i=0,current=this.length,l;if(matchesSelector)elements=elements.filter(matchesSelector);l=elements.length;for(;i<l;++i)this[i+
current]=elements[i];this.length+=l}};Array.forEach(["add","remove","has","toggle"],function createMethod(_methodName,i,a,postfix){var _funcName=_methodName+(postfix||"Class");if(_funcName in this.fn)this[_funcName]=_Function_call_.bind($.fn[_funcName]);if(!postfix)createMethod.call(this,_methodName,i,a,"Mod")},$);$["get"]=function __ajax_get(url,complete){if(!__ajax_get._$_head)__ajax_get._$_head=$("head");var callback="ajs__jsonp__"+$["gid"]++,transport=_document.createElement("script");transport.type=
"text/javascript";transport.src=url+"&callback="+callback;global[callback]=function(result){complete(result);global[callback]=null;try{delete global[callback]}catch(er){}setTimeout($["fn"].remove.bind($(transport)))};setTimeout($["fn"].append.bind(__ajax_get._$_head,transport))};$["getCaretPosition"]=function(input,safe){if(safe&&input!=_document.activeElement)return;var nodeName=(input.nodeName||"").toUpperCase(),str,range,textInputRange,rangeEnd,start,end,normalizedValue,len;if(nodeName!="INPUT"&&
nodeName!="TEXTAREA")return;if("selectionStart"in input)return{"start":+input.selectionStart||0,"end":+input.selectionEnd||0};else if(_document.selection){range=_document.selection.createRange();if(range&&range.parentElement()==input){str=input.value;len=str.length;normalizedValue=str.replace(/\r\n/g,"\n");textInputRange=input.createTextRange();textInputRange.moveToBookmark(range.getBookmark());rangeEnd=input.createTextRange();rangeEnd.collapse(false);if(textInputRange.compareEndPoints("StartToEnd",
rangeEnd)>-1)start=end=len;else{start=-textInputRange.moveStart("character",-len);start+=normalizedValue.slice(0,start).split("\n").length-1;if(textInputRange.compareEndPoints("EndToEnd",rangeEnd)>-1)end=len;else{end=-textInputRange.moveEnd("character",-len);end+=normalizedValue.slice(0,end).split("\n").length-1}}}return{"start":start,"end":end}}};$["setCaretPosition"]=function setCaretPosition(input,positionStart,positionEnd){if(!isNode(input)&&input&&"length"in input){Array.forEach(input,function(input){setCaretPosition(input,
positionStart,positionEnd)});return}if(input!=document.activeElement)return;if(arguments.length==1){positionStart=0;positionEnd=input.value.length}else if(arguments.length==2)positionEnd=positionStart;if(input.setSelectionRange)input.setSelectionRange(positionStart,positionEnd);else if(input.createTextRange){var range=input.createTextRange();range.collapse(true);range.moveEnd("character",positionEnd);range.moveStart("character",positionStart);range.select()}};function matchClasses(classes,elm){return isNode(elm)&&
Array.every(classes,IS_SUPPORT_CLASSLIST?elm["classList"].contains.bind(elm["classList"]):classNameContains.bind(null,(" "+elm[classAttr]+" ").replace(RE_linebreaks," ")))}var classNameContains=IS_SUPPORT_CLASSLIST?null:function(klassName,klas){return _String_contains(klassName," "+klas+" ")};function isNode(ele){return ele&&ele.nodeType===1}$.__processHandler=function(handler){if(typeof handler==="object")return handler.handleEvent;return handler};function fixIEEvent_stopPropagation(){this.cancelBubble=
true}function fixIEEvent_preventDefault(){this.returnValue=false}function fixIEEvent_(event,currentTarget){if(!event["__fixed"]){if(!event.target)event.target=event.srcElement||_document;if(event.target.nodeType===3)event.target=event.target.parentNode;if(!event.currentTarget)event.currentTarget=currentTarget;if(!event.relatedTarget&&event.fromElement)event.relatedTarget=event.fromElement===event.target?event.toElement:event.fromElement;if(!event.stopPropagation)event.stopPropagation=fixIEEvent_stopPropagation;
if(!event.preventDefault)event.preventDefault=fixIEEvent_preventDefault;if(!event.which&&"button"in event)event.which=event.button&1?1:event.button&2?3:event.button&4?2:0;event["__fixed"]=true}return event}function commonIEHandler_(event){var data=this,currentTarget=data["ct"],key=data["k"],context,handlers=IEEventHandlers[key],handler,i=0,len=handlers&&handlers.length,result;if(currentTarget===true)currentTarget=global;else if(currentTarget===false)currentTarget=_document;else if(typeof currentTarget===
"string")currentTarget=_document.all[currentTarget];if(len){event=fixIEEvent_.call(null,event||global.event,currentTarget);for(;i<len;i++)if(handler=handlers[i]){if(typeof handler==="object"){context=handler;handler=$.__processHandler(handler)}if((result=handler.call(context||currentTarget,event))===false)event.returnValue=false}}return event.returnValue}function eventListener(elms,bind,events,handler){events=events.split(RE_unsafe_space);var i=0,j,elementsLength="length"in elms&&!("nodeType"in elms)&&
elms.length||0,elm=elementsLength&&elms[0]||elms,eventsLength=events.length,evt,key,tmp,eventHandlers,callback=handler;if(elm){do{if(Object.isObject(elm)&&elm[addEventListener])for(j=0;j<eventsLength;j++){evt=events[j];if(!IS_ADD_EVENT_LISTENER_SUPPORT){handler=callback;handler[HANDLER_UUID_PROPNAME]||(handler[HANDLER_UUID_PROPNAME]="_"+$["gid"]++);evt="on"+evt;if(elm===global||elm===_document||!("uniqueID"in elm))key=elm[HANDLER_UUID_PROPNAME]||(elm[HANDLER_UUID_PROPNAME]="_"+$["gid"]++);else key=
elm["uniqueID"];key=key+"_"+evt;eventHandlers=IEEventHandlers[key];if(bind){if(!("uniqueID"in elm)||elm===_document)if(elm===global)tmp=true;else if(elm===_document)tmp=false;else tmp=elm;else tmp=elm["uniqueID"];tmp={"ct":tmp,"k":key};if(!eventHandlers){eventHandlers=IEEventHandlers[key]=[handler];eventHandlers[handler[HANDLER_UUID_PROPNAME]]=null;handler=IEEventHandlers[key+"_"]=commonIEHandler_.bind(tmp)}else{if(eventHandlers[handler[HANDLER_UUID_PROPNAME]]!==void 0)tmp=eventHandlers=null;else{eventHandlers[handler[HANDLER_UUID_PROPNAME]]=
null;eventHandlers.push(handler)}handler=null}}else if(eventHandlers){tmp=eventHandlers.length;while(--tmp>=0)if(eventHandlers[tmp]===handler)break;if(tmp!==-1)eventHandlers.splice(tmp,1);if(tmp=handler[HANDLER_UUID_PROPNAME])delete eventHandlers[tmp];if(eventHandlers.length)handler=null;else{handler=IEEventHandlers[key+"_"];delete IEEventHandlers[key+"_"];delete IEEventHandlers[key]}}}if(handler)elm[bind?addEventListener:removeEventListener](evt,handler,false)}elm=i++<elementsLength?elms[i]:null}while(elm)
}return elms}function objByKeyVal(key,val){if(val!==void 0){var obj={};obj[key]=val;return obj}return key}var findBySelector=/\[native\s+code\]/i.test(_document[getElementsByClassName])?function(klasses,context){return context[getElementsByClassName](klasses)}:function(klasses,context){return matchesSelector(context[getElementsByTagName]("*"),null,klasses)};function find(context,selector){var res,ret=[],i=0,elementsLength=context.length,p=selector.indexOf(" "),sel=(~p?selector.substr(0,p):selector).replace(RE_unsafe_space),
prefix,_sel,ctx,tmp;for(;i<elementsLength;i++){ctx=context[i];if(~p&&querySelectorSupport)res=ctx.querySelectorAll(selector);else{_sel=sel.substr(1);prefix=sel.charAt(0);if(prefix==="#"){res=_document[getElementById](_sel);res=res?[res]:[]}else if(prefix===".")res=findBySelector(_sel.replace(RE_dot," "),ctx);else{tmp=sel.split(".");res=ctx[getElementsByTagName](tmp[0]);if(_String_contains(sel,"."))res=matchesSelector(res,null,tmp.slice(1));else res=Array.from(res)}}if(res.length){if(~p&&!querySelectorSupport)res=
find(res,selector.substr(p+1));ret=ret.concat(_Array_slice_.call(res,0))}}return ret}function matchesSelector(elms,tag,klasses){var ret=[],i=0,n=elms.length,elm;if(tag)tag=tag.toUpperCase();if(klasses&&typeof klasses=="string")klasses=klasses.replace(RE_dot," ").split(RE_unsafe_space);for(;i<n;i++){elm=elms[i];if(isNode(elm)&&(!tag||tag==elm.tagName.toUpperCase())&&(!klasses||matchClasses(klasses,elm)))ret.push(elm)}return ret}$["support"]={"oninput":"oninput"in _document};$["_random_string_"]=UUID_PREFIX;
$.own=_hasOwnProperty;if(!("ui"in ajs))ajs["ui"]={};if(!ajs.browser)ajs.browser={};if(_browser_msie)ajs.browser["msie"]=_browser_msie;else if((_tmp_=global["opera"])&&typeof(_tmp_=_tmp_["version"])=="function")ajs.browser["opera"]=+_tmp_();ajs["$"]=$;if(!global.CSS||!global.CSS.supports){if(!global.CSS)global.CSS={};if(!global.CSS.supports&&global["supportsCSS"])global.CSS.supports=global["supportsCSS"].bind(global);else{var _CSS_supports_cache={};global.CSS.supports=function(msie,testElement,ToCamel_replacer,
propertyName,propertyValue){var name_and_value=propertyName+"\\/"+propertyValue;if(name_and_value in _CSS_supports_cache)return _CSS_supports_cache[name_and_value];if(arguments.length<5)throw new Error("WRONG_ARGUMENTS_ERR");var __bind__RE_FIRST_LETTER=this,propertyName_CC=(propertyName+"").replace(__bind__RE_FIRST_LETTER,ToCamel_replacer);var result=propertyName&&propertyValue&&propertyName_CC in testElement.style;if(result)if(msie)if(/\(|\s/.test(propertyValue))try{testElement.style[propertyName_CC]=
propertyValue;result=!!testElement.style[propertyName_CC]}catch(e){result=false}else{testElement.style.cssText="display:none;height:0;width:0;visibility:hidden;position:absolute;position:fixed;"+propertyName+":"+propertyValue;document.documentElement.appendChild(testElement);result=testElement.currentStyle[propertyName_CC]==propertyValue;document.documentElement.removeChild(testElement)}else{testElement.style.cssText=propertyName+":"+propertyValue;result=testElement.style[propertyName_CC]==propertyValue}testElement.style.cssText=
"";_CSS_supports_cache[name_and_value]=result;return result}.bind(/(-)([a-z])/g,_browser_msie&&_browser_msie<10,global["document"].createElement("_"),function(a,b,c){return c.toUpperCase()})}}_browser_msie=_tmp_=array_for_escape_and_unescape=_html_escape_and_unescape=null})();
void function(){var NEED_PREPARE_STRING=function(strObj){return strObj[0]!="a"||!(0 in strObj)}(Object("a")),_toObject=function(obj){if(obj==null)throw new TypeError("Not an object");if(NEED_PREPARE_STRING&&typeof obj=="string"&&obj)return String.prototype.split.call(obj,"");return Object(obj)},_Function_apply_=Function.prototype.apply,_Array_slice_=Array.prototype.slice,_call_function=function(_function,context,var_args){return _Function_apply_.call(_function,context,_Array_slice_.call(arguments,
2))},_Array_indexOf_=Array.prototype.indexOf,_Array_lastIndexOf_=Array.prototype.lastIndexOf,_Array_forEach_=Array.prototype.forEach,_Array_every_=Array.prototype.every,_Array_some_=Array.prototype.some,_Array_filter_=Array.prototype.filter,_Array_map_=Array.prototype.map,_Array_reduce_=Array.prototype.reduce,_Array_reduceRight_=Array.prototype.reduceRight,_Array_contains_=Array.prototype["contains"],array_some_or_every;if(!Array["indexOf"])Array["indexOf"]=_Array_indexOf_?function(array,searchElement,
fromIndex){return _Array_indexOf_.apply(array,_Array_slice_.call(arguments,1))}:function(array,searchElement,fromIndex){var thisArray=_toObject(array),length=thisArray.length>>>0;if(!length||(fromIndex=~~fromIndex)>=length)return-1;for(fromIndex=(length+fromIndex)%length;fromIndex<length&&(!(fromIndex in thisArray)||thisArray[fromIndex]!==searchElement);fromIndex++);return fromIndex^length?fromIndex:-1};if(!Array["lastIndexOf"])Array["lastIndexOf"]=_Array_lastIndexOf_?function(array,searchElement,
fromIndex){return _Array_lastIndexOf_.apply(array,_Array_slice_.call(arguments,1))}:function(array,searchElement,fromIndex){var thisArray=_toObject(array),length=thisArray.length>>>0,i;if(!length)return-1;i=length-1;if(fromIndex!==void 0)i=Math.min(i,+fromIndex);i=i>=0?i:length-Math.abs(i);for(;i>=0;i--)if(i in thisArray&&thisArray[i]===searchElement)return i;return-1};if(!Array["forEach"])Array["forEach"]=_Array_forEach_?function(array,iterator,context){return _Array_forEach_.apply(array,_Array_slice_.call(arguments,
1))}:function(array,iterator,context){var thisArray=_toObject(array),length=thisArray.length>>>0,i=-1;while(++i<length)if(i in thisArray)_call_function(iterator,context,thisArray[i],i,thisArray)};array_some_or_every=_Array_every_?null:function(array,callback,thisObject,_option_isAll){if(_option_isAll===void 0)_option_isAll=true;var result=_option_isAll;Array["forEach"](array,function(value,index){if(result==_option_isAll)result=!!_call_function(callback,thisObject,value,index,this)},array);return result};
if(!Array["every"])Array["every"]=_Array_every_?function(array,callback,thisObject){return _Array_every_.apply(array,_Array_slice_.call(arguments,1))}:function(array,callback,thisObject){return array_some_or_every(array,callback,thisObject)};if(!Array["some"])Array["some"]=_Array_some_?function(array,callback,thisObject){return _Array_some_.apply(array,_Array_slice_.call(arguments,1))}:function(array,callback,thisObject){return array_some_or_every(array,callback,thisObject,false)};if(!Array["filter"])Array["filter"]=
_Array_filter_?function(array,callback,thisObject){return _Array_filter_.apply(array,_Array_slice_.call(arguments,1))}:function(array,callback,thisObject){var thisArray=_toObject(array),len=thisArray.length>>>0,result=[],val;for(var i=0;i<len;i++)if(i in thisArray){val=thisArray[i];if(_call_function(callback,thisObject,val,i,thisArray))result.push(val)}return result};if(!Array["map"])Array["map"]=_Array_map_?function(array,callback,thisArg){return _Array_map_.apply(array,_Array_slice_.call(arguments,
1))}:function(array,callback,thisArg){var thisArray=_toObject(array),len=thisArray.length>>>0,result=[];for(var i=0;i<len;i++)if(i in thisArray)result[i]=_call_function(callback,thisArg,thisArray[i],i,this);return result};if(!Array["reduce"])Array["reduce"]=_Array_reduce_?function(array,accumulator,initialValue){return _Array_reduce_.apply(array,_Array_slice_.call(arguments,1))}:function(array,accumulator,initialValue){var thisArray=_toObject(array),l=thisArray.length>>>0,i=0;if(l===0&&arguments.length<=
1)throw new TypeError("Array length is 0 and no second argument");if(initialValue===void 0)initialValue=(++i,thisArray[0]);for(;i<l;++i)if(i in thisArray)initialValue=accumulator.call(void 0,initialValue,thisArray[i],i,thisArray);return initialValue};if(!Array["reduceRight"])Array["reduceRight"]=_Array_reduceRight_?function(array,accumulator,initialValue){return _Array_reduceRight_.apply(array,_Array_slice_.call(arguments,1))}:function(array,accumulator,initialValue){var thisArray=_toObject(array),
l=thisArray.length>>>0;if(l===0&&arguments.length<=1)throw new TypeError("Array length is 0 and no second argument");--l;if(initialValue===void 0)initialValue=(--l,thisArray[l+1]);for(;l>=0;--l)if(l in thisArray)initialValue=_call_function(accumulator,void 0,initialValue,thisArray[l],l,thisArray);return initialValue};if(!Array["contains"])Array["contains"]=_Array_contains_?function(array,item){return _Array_contains_.call(array,item)}:function(array,item){return!!~Array["indexOf"](array,item)};if(!Array["intersect"])Array["intersect"]=
function(left,var_args){var rights=Array.prototype.slice.call(arguments,1),intersection,right,leftLength,rightLength,i,j;if(left.length&&rights.length){intersection=[];right=rights[0];if(right.length){leftLength=left.length;rightLength=right.length;i=0;while(i<leftLength){j=0;while(j<rightLength){if(left[i]==right[j])intersection.push(left[i]);j++}i++}return Array["intersect"].apply(null,[intersection].concat(rights.slice(1)))}else return[]}else return left};if(!Array["append"])Array["append"]=function(array,
var_args){if(arguments.length>2)var_args=array.concat.apply([],_Array_slice_.call(arguments,1));array.push.apply(array,var_args);return array};if(!Array["prepend"])Array["prepend"]=function(array,var_args){if(arguments.length>2)var_args=array.concat.apply([],_Array_slice_.call(arguments,1));array.unshift.apply(array,var_args);return array};Array["unique"]=function(array){var result=[],used={},item,i=0,l=array.length,itemKey;for(;i<l;++i)if(i in array){item=array[i];if(typeof item==="object"){if((itemKey=
item["__uniqueId"])===void 0){if(Array["indexOf"](array,item,i+1)<0)result.push(item);continue}}else itemKey=item;if(used[itemKey]!==void 0)continue;used[itemKey]=null;result.push(item)}return result};Array["uniq"]=Array["unique"];if(!Array["removeAt"])Array["removeAt"]=function(array,start,count){if(start>=0)array.splice(start,count===void 0?1:count|0);return array};if(!Array["remove"])Array["remove"]=function(array,var_args){var length=arguments.length,index;while(--length)while((index=Array["indexOf"](array,
arguments[length]))!=-1)array.splice(index,1);return array};Array["search"]=function(er,fn,ctx){for(var i=0,n=er.length;i<n;i++)if(fn.apply(ctx,[er[i],i]))return i;return-1}}();
(function(undef){String._as={"'":new RegExp("(^|[^\\\\])((\\\\)*)'","g"),'"':new RegExp('(^|[^\\\\])((\\\\)*)"',"g")};var legacy={_hex:function(h){return h.length<2?h+""+h:h},rgb2hex:function(c){if(typeof c=="string"){if(c.indexOf(",")<0)return"#"+c.replace("#","").replace(/^(\w)(\w)(\w)$/gi,"$1$1$2$2$3$3");c=c.replace(/(rgb\(|\)|\s+)/ig,"").split(",")}else if(c.red){c[0]=c.red;c[1]=c.green;c[2]=c.blue}c=String._hex((c[0]*1).toString(16))+String._hex((c[1]*1).toString(16))+String._hex((c[2]*1).toString(16));
return"#"+c},addSlashes:function(s,q){return String(s).replace(String._as[q=q||"'"],"$1$2\\"+q)},padZero:function(n,l){var s=""+n;while(s.length<l)s="0"+s;return s},trim:function(s){return String(s).replace(/^([\s\r\n]+)|([\s\r\n]+)$/g,"")},num:function(n,L,i){if(L==null)return"";var x=n%100<=10||n%100>=20?n%10:0;var l=L.length;if(l==2&&x==1)x=0;else if(l==3&&x>1)x=x<5?2:0;return(i?n+(i&&i!=1?i:""):"")+(typeof L!="string"?L[x]||L[x>1&&x<5?x:0]||L[x>1?1:0]:L)},ucfirst:function(s){return s.charAt(0).toUpperCase()+
s.substr(1)},repeat:function(s,n){var r="",i=0;for(;i<n;i++)r+=s;return r},toQuery:function(o){var s="",i=0,k,kn,v;if(o)if(typeof o!="string"){s=[];for(var p in o)if(p!=""){p=encodeURIComponent(p);v=defined(o[p],"");if(v&&v.constructor===Array)for(k=0,kn=v.length;k<kn;k++)s[i++]=p+"="+encodeURIComponent(defined(v[k],""));else s[i++]=p+(v!=null&&v!==""?"="+encodeURIComponent(v):"")}s=s.join("&")}else s=o;return s},toObject:function(s){var o={};if(typeof s==="object")o=s||o;else if(s=String(s)){if(s.indexOf("?")>
-1||/^http:/.test(s))s=s.split("?")[1]||"";s=s.split("&");for(var i=0,n=s.length,v,k;i<n;i++)if(s[i]!=""){s[i]=s[i].split("=");v=s[i][1];k=s[i][0];if(typeof v=="string")try{v=decodeURIComponent(v)}catch(e){v=unescape(v)}else v="";try{k=decodeURIComponent(k)}catch(e){k=unescape(k)}o[k]=v}return o}return o},html2text:function(h){return String(h).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},nl2br:function(t){return String(t).replace(/[\r\n]/g,"<br />")},wordWrap:function(t,
m,l,e,spaceAfterMaxLength){t=String(t).replace(new RegExp("(\\S{"+(m||20)+"})","ig"),"$1 ");if(l&&t.length>l){if(spaceAfterMaxLength)for(l--;l<t.length;l++){if(/\s/.test(t.charAt(l)))break}else for(l++;l--;)if(/\s/.test(t.charAt(l)))break;t=t.substr(0,l)+e}return t},supplant:function(str,o){return str.replace(/#\{([^\{\}]*)\}/g,function(a,b){var r=o[b];return typeof r==="string"||typeof r==="number"?r:a})},numberFormat:function(n,d,f,s){var n=Math.round(n,d).toString().split(".");if(s)for(var i=n[0].length-
3;i>=0;i-=3)n[0]=n[0].substr(0,i)+s+n[0].substr(i);return n[0]+(n[1]?f+n[1]:"")},sizeFormat:function(filesize){if(filesize>=Math.GB)filesize=String.numberFormat(filesize/Math.GB,2,".","")+" "+Lang.get("Size").gb;else if(filesize>=Math.MB)filesize=String.numberFormat(filesize/Math.MB,2,".","")+" "+Lang.get("Size").mb;else if(filesize>=Math.KB)filesize=String.numberFormat(filesize/Math.KB,0)+" "+Lang.get("Size").kb;else filesize=String.numberFormat(filesize,0)+" "+Lang.get("Size").bytes;return filesize},
sprintf:function(txt){if(typeof txt==="string")for(var i=1,n=arguments.length;i<n;i++)txt=txt.replace("%s",arguments[i]);return txt},concat:function(){return Array.prototype.join.call(arguments,"")},preg_quote:function(str){return(str||"").replace(/([\\\.\+\*\?\[\^\]\$\(\)\{\}\=\!<>\|\:])/g,"\\$1")}};for(var method in legacy)String[method]=legacy[method];var _String_split_=String.prototype.split,_String_split_shim_isnonparticipating;if("te".split(/(s)*/)[1]!=void 0||"1_1".split(/(_)/).length!=3){_String_split_shim_isnonparticipating=
/()??/.exec("")[1]===void 0;String.prototype.split=function(separator,limit){var str=this;if(!(separator instanceof RegExp)){if(separator===void 0&&limit===0)return[];return _String_split_.call(str,separator,limit)}var output=[],flags=(separator["ignoreCase"]?"i":"")+(separator["multiline"]?"m":"")+(separator["extended"]?"x":"")+(separator["sticky"]?"y":""),lastLastIndex=0,separator2,match,lastIndex,lastLength;separator=new RegExp(separator.source,flags+"g");str+="";if(!_String_split_shim_isnonparticipating)separator2=
new RegExp("^"+separator.source+"$(?!\\s)",flags);limit=limit===void 0?-1>>>0:limit>>>0;if(!limit)return[];while(match=separator.exec(str)){lastIndex=match.index+match[0].length;if(lastIndex>lastLastIndex){output.push(str.slice(lastLastIndex,match.index));if(!_String_split_shim_isnonparticipating&&match.length>1)match[0].replace(separator2,function(){for(var i=1,l=arguments.length-2;i<l;i++)if(arguments[i]===void 0)match[i]=void 0});if(match.length>1&&match.index<str.length)output.push.apply(output,
match.slice(1));lastLength=match[0].length;lastLastIndex=lastIndex;if(output.length>=limit)break}if(separator.lastIndex===match.index)separator.lastIndex++}if(lastLastIndex===str.length){if(lastLength||!separator.test(""))output.push("")}else output.push(str.slice(lastLastIndex));return output.length>limit?output.slice(0,limit):output}}})();
void function(ajs,$){var UUID=1;var UUID_PREFIX=$["_random_string_"],HANDLER_UUID_PROPNAME="uuid"+UUID_PREFIX,_hasOwnProperty=$.own,HAS_NO_PROPERTY_FLAG="noprop_"+HANDLER_UUID_PROPNAME,eventExtendProperties=["target","preventDefault","isDefaultPrevented","stopImmediatePropagation"],_Object_isPlainObject=Object.isPlainObject,_extend=$.extend,__processHandler=$.__processHandler;function ajsUIComponent(){this._asynchMarkers={}}_extend(ajsUIComponent.prototype,{constructor:ajsUIComponent,buildClassName:function(klas,
$root){$root=$root||this.$Elm;var rootClass,tmp,index;if((index=klas.indexOf("&"))!=-1)if((rootClass=$root["selector"])&&((tmp=rootClass.charAt(0))==="."||tmp==="#"))klas=(index>0?klas.substr(0,index):"")+rootClass.substr(1)+klas.substr(index+1);else klas="";return klas},findSub:function(selector){var $root=this.$Elm,tmp;if(typeof selector==="string"){if((tmp=selector.charAt(0))&&tmp!=="."&&tmp!=="#"&&tmp!=="[")selector="."+selector;selector=this.buildClassName(selector)}return new $(selector,$root)},
hasTrigger:function(eType){var _=this["_"],events,_event;if(_&&(events=_["__events__"])){eType=eType.toUpperCase().split(" ");while(_event=eType.pop())if(_event in events)return true}return false},addTrigger:function(eType,handler){var _=this["_"],events,eventHandlers,_event;if(handler){if(!_)_=this["_"]={};eType=eType.toUpperCase().split(" ");events=_["__events__"];if(!events)events=_["__events__"]={};while(_event=eType.pop()){if(!events[_event])eventHandlers=events[_event]={};else eventHandlers=
events[_event];if(!handler[HANDLER_UUID_PROPNAME]&&(handler[HANDLER_UUID_PROPNAME]=UUID_PREFIX+ ++UUID)||!(handler[HANDLER_UUID_PROPNAME]in eventHandlers))eventHandlers[handler[HANDLER_UUID_PROPNAME]]=handler}}return this},removeTrigger:function(eType,handler){var _=this["_"],events,_event;if(!_||!handler||!handler[HANDLER_UUID_PROPNAME]||!(events=_["__events__"]))return this;eType=eType.toUpperCase().split(" ");while(_event=eType.pop()){if(!(_event=events[_event])||!(handler[HANDLER_UUID_PROPNAME]in
_event))continue;delete _event[handler[HANDLER_UUID_PROPNAME]]}return this},fireTrigger:function(eventObject){var context=this,_=context["_"],events,i,handler,isEventObject=eventObject&&typeof eventObject=="object",eType=isEventObject&&eventObject["type"]||eventObject,prev_preventDefault,__isDefaultPrevented=false,__stopNow=false,prev,result=true,hasNoTriggers=!_||!(events=_["__events__"])||!eType||!(events=events[eType.toUpperCase()]);if(prev=this._nextTriggerOptions)if(eType in prev){if(isEventObject)_extend(eventObject,
prev[eType]);delete prev[eType]}if(hasNoTriggers)return result;if(!isEventObject)eventObject={"type":eventObject};if(eventObject["name"]===void 0||eventObject["namespace"]===void 0){prev=eType.split(":");if(!eventObject["name"])eventObject["name"]=prev[1]||prev[0];if(!eventObject["namespace"])eventObject["namespace"]=prev.length?prev[0]:""}prev=Array.reduce(eventExtendProperties,function(val,key){val[key]=key in eventObject?eventObject[key]:HAS_NO_PROPERTY_FLAG;return val},{});eventObject["currentTarget"]=
eventObject["target"]=this;prev_preventDefault=eventObject.preventDefault;eventObject.preventDefault=function(){if(prev_preventDefault)prev_preventDefault.apply(this.context,arguments);__isDefaultPrevented=true};eventObject["isDefaultPrevented"]=function(){return __isDefaultPrevented};eventObject.stopImmediatePropagation=function(){if(prev["stopImmediatePropagation"])prev["stopImmediatePropagation"].apply(this.context,arguments);else if(this.stopPropagation)this.stopPropagation();__stopNow=true};
for(i in events)if(_hasOwnProperty(events,i)){handler=events[i];if(typeof handler==="object")context=handler;handler=__processHandler(handler);if(handler&&(result=handler.call(context,eventObject))===false)eventObject.preventDefault();if(__stopNow)break}if(result!==false&&eventObject["isDefaultPrevented"]())result=false;Array.reduce(eventExtendProperties,function(val,key){if(val[key]===HAS_NO_PROPERTY_FLAG)delete eventObject[key];else eventObject[key]=val[key];return val},prev);if(_Object_isPlainObject(_=
eventObject["nextTriggerOptions"])){if(!(prev=this._nextTriggerOptions))prev=this._nextTriggerOptions={};for(i in _)if(_hasOwnProperty(_,i)&&_Object_isPlainObject(context=_[i])){if(!prev[i])prev[i]={};_extend(prev[i],context)}}prev=eventObject=handler=context=__stopNow=__isDefaultPrevented=eType=isEventObject=events=_=null;return result!==false},_callAfterTrigger:function(eventObject){return this.fireTrigger(eventObject,eventObject["type"]+":AFTER")},disable:function(){this.__disabled=true},enable:function(){this.__disabled=
false},_callTriggerFunctionAsync:function(){var event=this,uiComponent=event["currentTarget"];if(event["result"]===false||event["async"]!==true||!uiComponent._asynchMarkers||event["_asynchMarker"]!==uiComponent._asynchMarkers[event.type])return;if(!(uiComponent instanceof ajsUIComponent))return;uiComponent._asynchMarkers[event.type]=null;if(event.type in uiComponent)uiComponent[event.type](event)}});if(!ajs["ui"])ajs["ui"]={};ajs["ui"]["ajsUIComponent"]=ajsUIComponent}.call(null,this["ajs"],this["ajs"]["$"]);
void function(_document,ajs,$){var $_document=$(_document);function dropdown(sel,opts){if(!(this instanceof dropdown))return new dropdown(sel,opts);sel=$(sel);if(sel.size()>1)return Array.reduce(sel,function(initialValue,val,i){if(i)initialValue.push(new dropdown(val,opts));return initialValue},[this]);this.opts=opts=$.extend({"cnLink":"js-link","cnMenu":"js-menu","cnSection":"js-section","cnExpand":"js-expand","cnHover":"js-hover","cnIndex":0,"onselect":$["noop"],"timeout":1500,"hideByClick":true,
"autoPos":false},opts);this.$Elm=sel;this.$Link=this.findSub(opts["cnLink"]).bind("click mouseout mouseover blur keyup",this).attr("unselectable","off").css({"userSelect":"none","MozUserSelect":"none","WebKitUserSelect":"none","OUserSelect":"none","MSUserSelect":"none"});if(opts["tabIndex"]!==false)this.$Link.attr("tabIndex",ajs["ui"]["tabIndex"]++);this.$Link.find("*").attr("unselectable","off");this.$Menu=this.findSub(opts["cnMenu"]).bind("click mouseout mouseover mousedown mouseup",this);this.$Menu.__Sections=
this.findSub(opts["cnSection"]);if(opts["cnIndex"]>=0)this._onSelect({},this.$Menu.__Sections[opts["cnIndex"]]);Array.forEach(["cnSectionHover","cnSectionExpand"],function(name){var str=this.opts[name];if(str)this.opts[name]=this.buildClassName(str)},this)}$.inherits(dropdown,ajs["ui"]["ajsUIComponent"],{"destroy":function(){this.$Link.unbind("click mouseout mouseover blur keyup",this);this.$Menu.unbind("click mouseout mouseover mousedown mouseup",this);$["destroyObject"](this)},handleEvent:function(evt,
type){if(this.__disabled)return;var opts=this.opts,currentTarget=evt.currentTarget,$Menu0=this.$Menu[0],$Link0=this.$Link[0],key,doNotStop;clearTimeout(this._tid);type=type||evt.type;switch(type){case "keyup":if(currentTarget===$Link0){key=evt.keyCode;if(key==40||key==38||key==13)if(this["expanded"]())if(key==13){this._onSelect(evt);this._expand(false)}else this._move(key==40?1:-1);else if(key==13)this.handleEvent(evt,"keyup.click")}break;case "blur":if(!this.__down){currentTarget=evt["explicitOriginalTarget"]||
_document.activeElement;if(currentTarget.nodeType!=1)currentTarget=currentTarget.parentNode;if(!this._hitTest(currentTarget))this._expand(false)}break;case "click":if(currentTarget!==document){if(evt.pointerType!="mouse"&&evt.detail!=void 0&&evt.detail==0){evt.preventDefault();break}if(evt.which>1){doNotStop=true;break}}case "keyup.click":if(currentTarget===$Link0)evt.preventDefault();else if(currentTarget!==document)this._onSelect(evt);if(opts["hideByClick"]||!this._hitTest(evt)){this._expand(!this["expanded"]());
doNotStop=true}break;case "mouseup":case "mousedown":this.__down=type==="mousedown";doNotStop=true;break;case "mouseover":currentTarget=evt.target;do if($["fn"].hasClass.call(currentTarget,"js-section")){this._move(currentTarget);break}while(currentTarget!==$Menu0&&currentTarget!==$Link0&&(currentTarget=currentTarget.parentNode));doNotStop=true;break;case "mouseout":if(opts["timeout"]>0)this._tid=setTimeout(this._expand.bind(this,false),opts["timeout"]);break}if(!doNotStop)evt.stopPropagation()},
_onSelect:function(evt,node){if(node||(node=this.$Menu.find("."+this.opts["cnHover"])[0]))this.opts["onselect"].call(this,evt,node)},_move:function(direction){var $Items=this.$Menu.__Sections,cnHover=this.opts["cnHover"],idx=-1;if(!$Items||!$Items.length)return;$Items.each(function(i,node){node=$(node);if(node.hasClass(cnHover)){idx=i;node.removeClass(cnHover)}});if(direction)if(direction.tagName)$(direction).addClass(cnHover);else{if(idx!=-1)idx+=direction;if(!$Items[idx])idx=~direction?0:$Items.length-
1;$Items.eq(idx).addClass(cnHover)}},_hitTest:function(evt){return!!$(evt.target||evt).closest("."+this.opts["cnMenu"]).size()},_expand:function(state){this.$Elm.toggleClass(this.opts["cnExpand"],state);var $Menu=this.$Menu,$LInk_rec1,$Menu_rec2,_rectHeight;$Menu.toggle(state);if(this.opts["autoPos"]&&this.$Link[0]&&$Menu[0]){if(state){$LInk_rec1=this.$Link[0].getBoundingClientRect();$Menu_rec2=$Menu[0].getBoundingClientRect();_rectHeight=$LInk_rec1.height||$LInk_rec1.bottom-$LInk_rec1.top}$Menu.css({"marginLeft":state?
$LInk_rec1.left-$Menu_rec2.left+"px":0,"marginTop":state?$LInk_rec1.top+_rectHeight-$Menu_rec2.top+"px":0})}$_document.unbind("click",this);if(state){this._move();setTimeout(function(){$_document.bind("click",this)}.bind(this),0)}},"expanded":function(){return this.$Elm.hasClass(this.opts["cnExpand"])}});ajs["ui"]["tabIndex"]=ajs["ui"]["tabIndex"]||1;ajs["ui"]["dropdown"]=dropdown}.call(null,this.document,this["ajs"],this["ajs"]["$"]);
void function(_document,ajs,$){function search(sel,opts){if(!(this instanceof search))return new search(sel,opts);sel=$(sel);if(sel.size()>1)return Array.reduce(sel,function(initialValue,val,i){if(i)initialValue.push(new search(val,opts));return initialValue},[this]);this["opts"]=opts=$.extend({"cnForm":"js-form","cnInput":"js-input","cnBlur":"js-blur","cnPlaceholder":"js-placeholder","cnSection":"js-section","cnSectionTxt":"js-section-text","cnSectionLink":"js-section-link","cnSectionMenu":"js-section-menu",
"cnSectionHover":"js-section-hover","cnSectionExpand":"js-section-expand","cnSectionSelected":"js-section-selected","paddingRight":35,"searchInputResize":true,"useOperands":false,"autoTabIndex":true},opts);this.$Elm=sel;this.$Form=this.findSub(opts["cnForm"]).bind("submit",this);this.$Placeholder=this.findSub(opts["cnPlaceholder"]);this.$Input=this.findSub(opts["cnInput"]).bind("focus blur",this);if(opts["autoTabIndex"])this.$Input.attr({"tabIndex":ajs["ui"]["tabIndex"]++});this.$Section=this.findSub(opts["cnSectionTxt"]);
var sectionMenu=this.findSub(opts["cnSectionLink"]),SectionRootElement=opts["newSubElementsLogic"]?sectionMenu:this.$Elm;if(sectionMenu.size())this["Sections"]=new ajs["ui"]["dropdown"](SectionRootElement,{"cnLink":sectionMenu,"cnMenu":opts["cnSectionMenu"],"cnHover":opts["cnSectionHover"],"cnExpand":opts["cnSectionExpand"],"cnIndex":opts["cnSectionIndex"],"onselect":this._section.bind(this)});sel.find("input").each(function(){if(this.type=="submit")this.tabIndex=ajs["ui"]["tabIndex"]++});if(opts["suggest"])this["Suggest"]=
ajs["ui"]["suggest"](sel,opts["suggest"]);if(opts["operands"])(this["$Operands"]=new ajs["ui"]["operands"](this.$Elm.find(".w-portal-menu__search__operands"),opts["operands"],this.$Input)).init(this);this._placeholderCheck=this._placeholderCheck.bind(this);setTimeout(this._placeholderCheck);if(_document.readyState!=="complete"){$(_document).bind("DOMContentLoaded",this._placeholderCheck);$(window).bind("load",this._placeholderCheck)}this.isPlaceholder=true;this._section({});this.isReady=true;Array.forEach(["cnBlur",
"cnSection"],function(name){var str=this.opts[name];if(str)this.opts[name]=this.buildClassName(str)},this)}$.inherits(search,ajs["ui"]["ajsUIComponent"],{"destroy":function(){var opts=this["opts"];this.$Form.unbind("submit",this);this.$Input.unbind("focus blur",this);if(this["Sections"])this["Sections"]["destroy"]();if(opts["suggest"])this["Suggest"]["destroy"]();if(opts["operands"])this["$Operands"]["destroy"]();$["destroyObject"](this)},handleEvent:function(evt,type){var isEmpty=this["isEmpty"](),
isBlur;switch(type||evt.type){case "submit":if(isEmpty){this.$Input.trigger("focus");evt.preventDefault()}break;case "blur":isBlur=isEmpty;default:this.$Elm.toggleClass(this["opts"]["cnBlur"],!!(isBlur&&this.isPlaceholder));if(isBlur)this.val("")}},_placeholderCheck:function(evt){var type=evt&&evt.type;if(type==="DOMContentLoaded"){$(_document).unbind("DOMContentLoaded",this._placeholderCheck);setTimeout(this._placeholderCheck,20);return}else if(type==="load"){$(window).unbind("load",this._placeholderCheck);
setTimeout(this._placeholderCheck,20);return}if(typeof _document.activeElement=="unknown"||this.$Input[0]!==_document.activeElement)this.handleEvent({type:"blur"})},_section:function(evt,node){var opts=this["opts"],target=node||evt.target,cnSelected=opts["cnSectionSelected"],$Item=$(target).closest("."+opts["cnSection"]),$Sections=this.findSub(opts["cnSection"]);if(target){$Sections.filter("."+cnSelected).removeClass(cnSelected);$Item.addClass(cnSelected)}if(($Item=$Sections.filter("."+cnSelected))[0]){this.$Form.attr({"action":$Item.attr("data-action"),
"target":$Item.attr("data-target")||"_self"});this.$Input.attr("name",$Item.attr("data-input-name"));this.$Section.html($Item.html());if(this["Suggest"])this["Suggest"].set("ajaxUrl",$Item.attr("data-suggest-url"),!this.isReady)}if(evt&&evt.preventDefault){if(evt.type=="click"||evt.keyCode==13)this.$Input.trigger("focus");evt.preventDefault()}},"isEmpty":function(){return this.val()===""},val:function(val){var needCheckPlaceholder;if(val!==void 0){needCheckPlaceholder=this.__val!==val;this.$Input.val(val);
this.__val=val;if(needCheckPlaceholder)this._placeholderCheck();return this}return $["trim"](this.$Input.val())},getSuggest:function(){return this["Suggest"]},setPlaceholder:function(val){this.$Placeholder.html(val)},disable:function(){if(this["$Operands"])this["$Operands"].disable();if(this["Suggest"])this["Suggest"].disable();this._placeholderCheck()},enable:function(){if(this["$Operands"])this["$Operands"].enable();if(this["Suggest"])this["Suggest"].enable();this._placeholderCheck()}});ajs["ui"]["tabIndex"]=
ajs["ui"]["tabIndex"]||1;ajs["ui"]["search"]=search}.call(null,document,this["ajs"],this["ajs"]["$"]);
void function(_document,ajs,$){var encode=encodeURIComponent,_String_split_=String.prototype.split,_String_split_good_="1_1".split(/(_)/).length!=3?function(separator,limit){var str=this;if(!(separator instanceof RegExp)){if(separator===void 0&&limit===0)return[];return _String_split_.call(str,separator,limit)}var output=[],flags=(separator["ignoreCase"]?"i":"")+(separator["multiline"]?"m":"")+(separator["extended"]?"x":"")+(separator["sticky"]?"y":""),lastLastIndex=0,match,lastIndex,lastLength;separator=
new RegExp(separator.source,flags+"g");str+="";limit=limit===void 0?-1>>>0:limit>>>0;if(!limit)return[];while(match=separator.exec(str)){lastIndex=match.index+match[0].length;if(lastIndex>lastLastIndex){output.push(str.slice(lastLastIndex,match.index));if(match.length>1&&match.index<str.length)output.push.apply(output,match.slice(1));lastLength=match[0].length;lastLastIndex=lastIndex;if(output.length>=limit)break}if(separator.lastIndex===match.index)separator.lastIndex++}if(lastLastIndex===str.length){if(lastLength||
!separator.test(""))output.push("")}else output.push(str.slice(lastLastIndex));return output.length>limit?output.slice(0,limit):output}:_String_split_,htmlEscape=ajs.HTML.escape,ajsUIComponent=ajs["ui"]["ajsUIComponent"],_Object_isObject=Object.isObject;function regexpEscape(str){return String(str||"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}function SuggestOptions(){}SuggestOptions.prototype={constructor:SuggestOptions,"cnInput":"js-input","cnSuggest":"js-suggest","cnList":"&__suggest__inner","cnItem":"&__suggest__item",
"cnItemTick":"&__suggest__item__tick","cnSelected":"&__suggest__item_selected","cnInternetCont":"&__suggest__item_internet","cnInternet":"&__suggest__item_internet-link","cdGroupHeader":"&__suggest__group-header","cdSuggestHint":"&__suggest__item__hint","getData":function(e){var res=e&&e["data"]||e;return res&&res[1]=="OK"&&res[2]},"template":function(val,item){var suggest=(_Object_isObject(item)&&(item["suggest"]||item["text"]||item["word"])||item||"")+"",text=(_Object_isObject(item)&&(item["text"]||
item["word"])||item||"")+"";text=htmlEscape(text);suggest=htmlEscape(suggest);val=htmlEscape(val);text=text.replace(new RegExp(val,"i"),'<b class="'+this.opts["cnItemTick"]+'">$&</b>');return'<div data-suggest="'+suggest+'" class="'+this.opts["cnItem"]+'">'+text+"</div>"},"groupHeaderTemplate":function(category){return'<div class="'+this.opts["cdGroupHeader"]+'">'+category+"</div>"},"templateInternetVal":function(val){return htmlEscape(val)},"request":function(url,fn,val){$.get(url,fn)},"multiSuggests":false,
"suggestSeparator":/\s/g,"suggestEscapeStart":null,"suggestEscapeEnd":null,"getSuggest":function(a){return a.trim()},"setSuggest":$.noop,"minLength":1,"maxLength":0,"timeout":300,"expire":0,"autosubmit":true,"ajaxUrl":void 0,"searchUrl":"http://go.mail.ru/search?q=#query#","encodeBeforeSend":true,"showInternet":true,"ondraw":$.noop,"grouping":false,"fetching":false,"fetchCount":30,"markByMouseOver":true,"autoMarked":-1,"undeterminedStage":true,"selectInputDiff":false,"selectByTab":false,"hideInactive":true,
"useCache":true,"searchLast":false,"findLastWord":/^.*\s+/,"ondata":$.noop,"onprint":null,"onexpand":$.noop,"onsearch":$.noop,"onselect":$.noop};function transitionalPeriodWrapper__getData(method,e){e["data"]=method.call(this,e["data"],e["findValue"],e)}function _oldDeprecatedGetSuggestWord(suggestVal,inputValue,opts){var searchLast=opts["searchLast"],findLastWord=opts["findLastWord"];if(!searchLast)return suggestVal;if(typeof findLastWord==="function"&&!findLastWord.test&&findLastWord.call)suggestVal=
findLastWord.call(this,inputValue,this);else suggestVal=inputValue.replace(findLastWord,"");return suggestVal}function _oldDeprecatedSetSuggestWord(suggestVal,inputValue,opts){var searchLast=opts["searchLast"],findLastWord=opts["findLastWord"],prevSuggest;if(!searchLast)return inputValue;prevSuggest=this.__prevSuggest;inputValue=$["trim"](inputValue.replace(new RegExp(regexpEscape(prevSuggest&&prevSuggest.val||"")+"$"),"")+this.__val).replace(/\S+$/,"")+""+(prevSuggest.val=suggestVal);if(inputValue!=
"")inputValue+="";return inputValue}function suggest(sel,opts){if(!(this instanceof suggest))return new suggest(sel,opts);suggest.superclass.apply(this);sel=$(sel,void 0);if(sel.size()>1)this.__others=Array.reduce(sel,function(initialValue,val,i){if(i)initialValue.push(new suggest(val,opts));return initialValue},[this]);this.__prevSuggest={};this.__expandedState=false;var suggestSeparator=opts["suggestSeparator"],multiSuggests=opts["multiSuggests"],suggestEscapeStart=opts["suggestEscapeStart"],suggestEscapeEnd=
opts["suggestEscapeEnd"];if(suggestSeparator!=null)suggestSeparator=opts["suggestSeparator"]=new RegExp(suggestSeparator instanceof RegExp?suggestSeparator.source:suggestSeparator+"",(suggestSeparator["ignoreCase"]?"ig":"g")+(suggestSeparator["multiline"]?"m":""));if(multiSuggests===void 0)if(opts["searchLast"]){opts["getSuggest"]=_oldDeprecatedGetSuggestWord;opts["setSuggest"]=_oldDeprecatedSetSuggestWord}if(suggestEscapeStart&&suggestEscapeEnd){if(!(suggestEscapeStart instanceof RegExp))opts["suggestEscapeStart"]=
new RegExp("(?:[^\\\\]|^)"+suggestEscapeStart);if(!(suggestEscapeEnd instanceof RegExp))opts["suggestEscapeEnd"]=new RegExp("(?:[^\\\\]|^)"+suggestEscapeEnd)}else opts["suggestEscapeStart"]=opts["suggestEscapeEnd"]=null;if(opts["getData"])this.addTrigger("suggests:getData",transitionalPeriodWrapper__getData.bind(this,opts["getData"]));if(opts["afterGetData"])this.addTrigger("suggests:getData:after",opts["afterGetData"]);if(opts["multiSuggests"]&&!opts["setSuggest"])opts["setSuggest"]=function(suggestValue,
inputValue){return inputValue};this.opts=opts=$.extend(new SuggestOptions,opts);this._cache={};this.$Elm=sel;this.$Input=null;this["applyToInput"](this.findSub(opts["cnInput"]));this.$SuggestMouseDownClick=this.$SuggestMouseDownClick.bind(this);this.$Suggest=this.findSub(opts["cnSuggest"]).bind("click mousedown",this.$SuggestMouseDownClick);this.hide=this.hide.bind(this);this.$InternetCont=this.findSub(opts["cnInternetCont"]).bind("click",this.hide);this.$Internet=this.findSub(opts["cnInternet"]);
this._onScroll=this._onScroll.bind(this);this._selectByClick=this._selectByClick.bind(this);this.$List=this.findSub(opts["cnList"]).bind("click",this._selectByClick).bind("scroll",this._onScroll).bind("mousewheel DOMMouseScroll",this._onMouseWheel);if(opts["markByMouseOver"]){this._suggestNodeMouseover=this._suggestNodeMouseover.throttle(100,this);this.$List.bind("mouseover",this._suggestNodeMouseover)}if(opts["fetching"]){this._fetchOnScroll=this._fetchOnScroll.throttle(250,this);this.__$List_onscroll=
function(e){e.preventDefault();e.stopPropagation();this._fetchOnScroll()}.bind(this);this.$List.bind("scroll",this.__$List_onscroll)}if(opts["expire"])this.__prevRequestTime=+new Date;$(window).bind("hashchange popstate",this);Array.forEach(["cnItem","cnItemTick","cnSelected","cdGroupHeader","cdSuggestHint"],function(name){var str=this.opts[name];if(str)this.opts[name]=this.buildClassName(str)},this);this._timeoutHandler=function(){var func=this._timeoutFunction,args=this._timeoutArguments;this._timeoutFunction=
this._timeoutArguments=null;if(func)if(Array.isArray(args))func.apply(this,args);else if(args!=null)func.call(this,args);else func.call(this)}.bind(this);opts=null}$.inherits(suggest,ajsUIComponent,{"destroy":function(){var opts=this["opts"];this["hide"]();this["applyToInput"](null,true);this.$Suggest.unbind("click mousedown",this.$SuggestMouseDownClick);this.$InternetCont.unbind("click",this.hide);this.$List.unbind("click",this._selectByClick).unbind("scroll",this._onScroll).unbind("mousewheel DOMMouseScroll",
this._onMouseWheel);if(opts["markByMouseOver"])this.$List.unbind("mouseover",this._suggestNodeMouseover);if(opts["fetching"])this.$List.unbind("scroll",this.__$List_onscroll);this.$List.html("");$(window).unbind("hashchange popstate",this);$["destroyObject"](this)},handleEvent:function(evt,type){if(this.__disabled)return;var key=evt.keyCode,opts=this.opts,hideInactive=opts["hideInactive"],preventEvent,triggerEventObject,findValue,isExpanded,data,isExpire,tmp,_clearTimeout,delayedHideEnd=true;if(type===
void 0)type=type||evt.type;preventEvent=+this.$Input.attr("data-prevent-event-"+type);if(preventEvent){--preventEvent;if(!preventEvent)this.$Input[0].removeAttribute("data-prevent-event-"+type);else this.$Input.attr("data-prevent-event-"+type,preventEvent);return}this.blurred=_document.activeElement!=this.$Input[0];if(this.blurred&&type!=="blur")return;switch(type){case "hashchange":case "popstate":case "blur":if(!this._down||type!=="blur"){if(this._fireActiveEvent(false)!==false){this.blurred=true;
if(hideInactive){tmp=this.__currentMarkedChangeValue;if(this.hide()!==false){if(tmp)this._onselect(evt,tmp);_clearTimeout=true}}}}else if(this._down){delayedHideEnd=false;this._down=false;if(_document.activeElement!==this.$Input[0]){this.$Input.attr("data-prevent-event-focus",1);this.$Input[0].focus();if(tmp=this.__bluredCaret)ajs.$.setCaretPosition(this.$Input[0],tmp["start"],tmp["end"]);this._findValue()}}break;case "keyup":case "keydown":isExpanded=this.isExpanded();if((key==38||key==40)&&isExpanded){if(type==
"keydown")this._mark(key==38?-1:0);evt.preventDefault();evt.stopPropagation()}else if(key==39&&this.__currentMarkedChangeValue)this._onselect(evt,this.__currentMarkedChangeValue);else if(key==13||key==9&&opts["selectByTab"]){if(key==9&&evt&&evt.ctrlKey)return;if(type=="keydown"&&isExpanded)if(this.__currentMarked){if(this._onselect(evt,this.__currentMarked,true,opts["autosubmit"],false,key==9||key==39)===false);}else this.hide()}else if(key==27){if(type=="keyup")if(this.hide(evt)!==false){this._findValue(null);
evt.preventDefault();_clearTimeout=true}}else{type=type=="keyup"?"onprint":null;this.handleEvent(evt,type);return}break;case "onprint":default:if(type==="focus")if(this._fireActiveEvent(true)===false)return;this._down=false;_clearTimeout=false;if((findValue=this._checkSomethingIsChanges())!==false){this.__currentMarkedChangeValue=this.__currentMarked=null;if(!opts["useCache"]){this._cache={};data=null}else data=this._cache[findValue]||null;isExpire=opts["expire"]&&this.__prevRequestTime>+new Date+
opts["expire"]*1E3;triggerEventObject={"type":"suggests:find","originalEvent":evt,"findValue":opts.maxLength>0?findValue.substr(0,opts.maxLength):findValue,"data":data,"expire":isExpire};triggerEventObject["val"]=triggerEventObject["findValue"];if(this.fireTrigger(triggerEventObject)!==false){this._loadVal=null;this._internetVal(findValue);findValue=findValue!=triggerEventObject["val"]?triggerEventObject["val"]:triggerEventObject["findValue"];if(data=triggerEventObject["data"])this._cache[findValue]=
data;if(type=="onprint"&&opts["onprint"])opts["onprint"].call(this,findValue,this);if(triggerEventObject["expire"]){this["reset"]();data=null}if(this._tid){clearTimeout(this._tid);this._tid=this._timeoutFunction=this._timeoutArguments=null}if(data){delete triggerEventObject["expire"];this._timeoutFunction=this._rebuild;this._timeoutArguments=triggerEventObject;this._tid=setTimeout(this._timeoutHandler)}else if(this._checkPrevResultIsNotEmpty(findValue,opts)){this._timeoutFunction=this["find"];this._timeoutArguments=
findValue;this._tid=setTimeout(this._timeoutHandler,opts["timeout"])}}}}if(_clearTimeout&&this._tid){clearTimeout(this._tid);this._tid=this._timeoutFunction=this._timeoutArguments=null}if(delayedHideEnd)this._delayedHideEnd()},"applyToInput":function(input,noNeedToRebuild){if(this.$Input)this.$Input.unbind("blur focus click keyup keydown",this);if(input)this.$Input=$(input).attr("autocomplete","off").bind("blur focus click keyup keydown",this);if(!noNeedToRebuild&&this.$Suggest&&this.isExpanded())this._rebuild(this.__val)},
$SuggestMouseDownClick:function(evt){this._down=evt.type=="mousedown";if(this._down)this.__bluredCaret=$.getCaretPosition(this.$Input[0]);this._delayedHideStart()},_checkSomethingIsChanges:function(){var suggestWord=this._findValue(),tmpSuggestValue,node;if(node=this.__currentMarkedChangeValue){tmpSuggestValue=node.getAttribute("data-suggest");if(tmpSuggestValue==suggestWord)return false}this.__prevSuggest.caret=this.__prevSuggest.val=null;return this._findValue()},_checkPrevResultIsNotEmpty:function(val,
opts){if(!opts["useCache"])return true;var i=val.length-1,key,cache=this._cache;for(;i>=opts["minLength"];i--){key=val.substr(0,i);if(cache[key]!==void 0)return(key=cache[key])&&key.length>0}return true},_closest:function(node,val){var closestTop=this.$List[0];do if(node.nodeType==1&&"getAttribute"in node){val=node.getAttribute("data-suggest-idx");if(val>0)return node}while(node&&(node=node.parentNode)&&node!==closestTop)},_suggestNodeMouseover:function(e){if(this.__disabled)return;var target=e.target,
suggestNode;if(target.parentNode)suggestNode=this._closest(e.target);if(suggestNode)this._mark(void 0,suggestNode,void 0,false,e)},_selectByClick:function(evt){if(this.__disabled)return;var opts=this.opts,ItemNode=this._closest(evt.target);if(ItemNode)if(this._mark(null,ItemNode,true,void 0,evt)!==false)this._onselect(evt,ItemNode,true,opts["autosubmit"]);return false},_mark:function(move,_newSuggestNode,doNotAddClass,changeInputValue,originalEvent){if(_newSuggestNode!==void 0&&this.__currentMarked===
_newSuggestNode&&!!this.__currentMarkedChangeValue==changeInputValue||this.__inFetching)return;var opts=this.opts,$List=this.$List,_oldSuggestNode=this.__currentMarked||this.__currentMarkedChangeValue,_oldSelIndex,_newSelIndex,_suggestData,$childs=this.__ListItems,$child_size,suggest,currentPositionOfNewSuggestNode,currentPositionOfList,eventObject,caretPositionStart,caretPositionEnd,currentFindValue,selectInputDiff;if(changeInputValue===void 0)changeInputValue=true;if($childs){suggest=_oldSuggestNode&&
_oldSuggestNode.getAttribute("data-suggest")||null;$child_size=$childs.size();_oldSelIndex=_newSelIndex=(_oldSuggestNode&&~~_oldSuggestNode.getAttribute("data-suggest-idx")||0)-1;if(!_newSuggestNode){if(_oldSuggestNode)_newSelIndex+=move<0?-1:1;else _newSelIndex=move<0?$child_size-1:0;_newSelIndex=_newSelIndex>=$child_size?-1:_newSelIndex;while(!_newSuggestNode&&_newSelIndex<$child_size&&_newSelIndex>=0){_newSuggestNode=$childs[_newSelIndex];if(_newSuggestNode&&_newSuggestNode.style.display!="none");
else{_newSuggestNode=null;if(move<0)_newSelIndex--;else _newSelIndex++}}if(!_newSuggestNode||_newSelIndex<0){_newSelIndex=-1;_newSuggestNode=null}}else _newSelIndex=~~_newSuggestNode.getAttribute("data-suggest-idx")-1;currentFindValue=this.__val;_suggestData=currentFindValue!=null&&this._cache[currentFindValue];if(!_newSuggestNode&&move>-1&&_oldSelIndex>-1&&opts["fetching"]&&!_suggestData["EOF"])if(this._fetchMore(move,this._mark.bind(this,move))!==false)return;if(_newSelIndex>=$child_size||_newSelIndex<
0)if(!opts["undeterminedStage"]){_newSelIndex=move<0?$child_size-1:0;_newSuggestNode=$childs[_newSelIndex]}if(_newSuggestNode){currentPositionOfNewSuggestNode=_newSuggestNode.getBoundingClientRect();currentPositionOfList=$List[0].getBoundingClientRect();if(_newSelIndex==0)$List[0].scrollTop=0;else if(currentPositionOfNewSuggestNode.top<currentPositionOfList.top)$List[0].scrollTop+=currentPositionOfNewSuggestNode.top-currentPositionOfList.top;else if(currentPositionOfNewSuggestNode.bottom>currentPositionOfList.bottom)$List[0].scrollTop+=
currentPositionOfNewSuggestNode.bottom-currentPositionOfList.bottom}eventObject={"type":"suggests:mark","oldSuggestIndex":_oldSelIndex,"oldSuggestData":_oldSelIndex>=0&&_suggestData&&_suggestData[_oldSelIndex]||null,"oldSuggestNode":_oldSuggestNode,"oldSuggest":suggest,"newSuggestIndex":_newSelIndex,"newSuggestData":_newSelIndex>=0&&_suggestData&&_suggestData[_newSelIndex]||null,"newSuggestNode":_newSuggestNode,"newSuggest":suggest=_newSuggestNode&&_newSuggestNode.getAttribute("data-suggest")||null,
"updateInputValue":changeInputValue,"findValue":currentFindValue,"originalEvent":originalEvent||null};selectInputDiff=opts["selectInputDiff"];if(changeInputValue&&selectInputDiff){if(caretPositionStart=this.__prevSuggest.caret)caretPositionStart=caretPositionStart["end"];else caretPositionStart=currentFindValue.length;caretPositionEnd=caretPositionStart+(suggest||"").length}else caretPositionEnd=caretPositionStart=-1;eventObject["caretPositionStart"]=caretPositionStart;eventObject["caretPositionEnd"]=
caretPositionEnd;if(this.fireTrigger(eventObject)!==false){suggest=eventObject["newSuggest"];caretPositionEnd=eventObject["caretPositionEnd"];caretPositionStart=eventObject["caretPositionStart"];void this._cancelMark();if(_newSuggestNode){$.addClass(_newSuggestNode,this.opts["cnSelected"]);this.__currentMarked=_newSuggestNode;if(changeInputValue!=(changeInputValue=eventObject["updateInputValue"])&&changeInputValue&&selectInputDiff&&caretPositionEnd===-1&&caretPositionStart===caretPositionEnd){if(caretPositionStart=
this.__prevSuggest.caret)caretPositionStart=caretPositionStart["end"];else caretPositionStart=currentFindValue.length;caretPositionEnd=caretPositionStart+(suggest||"").length}if(changeInputValue=eventObject["updateInputValue"])this.__currentMarkedChangeValue=this.__currentMarked}else this.__currentMarkedChangeValue=this.__currentMarked=null}else return false}else suggest=_oldSuggestNode.attr("data-suggest");if(changeInputValue)this._findValue(suggest,null,changeInputValue&&caretPositionStart>-1?caretPositionStart:
void 0,changeInputValue&&caretPositionEnd>-1?caretPositionEnd:void 0)},_onselect:function(evt,node,doNotRemoveClass,isBeforeSubmit,doNotChangeInputValue,doNotPreventDefault){var opts=this.opts,newSuggestValue=node.getAttribute("data-suggest"),idx=node.getAttribute("data-suggest-idx")-1,cache=this._cache[this.__val],$Input=this.$Input,multiSuggestsReplacementDescription=this._getSuggestReplacement(),inputValue=multiSuggestsReplacementDescription?multiSuggestsReplacementDescription.inputValue:$Input.val(),
eventObject={"type":"suggests:select","newSuggest":newSuggestValue,"newSuggestData":cache&&cache[idx],"newSuggestIndex":idx,"newSuggestNode":node,"findValue":this.__val,"inputValue":inputValue,"inputValueLeftPart":multiSuggestsReplacementDescription?multiSuggestsReplacementDescription.leftPart:"","inputValueRightPart":multiSuggestsReplacementDescription?multiSuggestsReplacementDescription.rightPart:"","inputSelectionStart":-1,"inputSelectionEnd":-1,"changeInputValue":!doNotChangeInputValue,"originalEvent":evt||
null,"submitForm":isBeforeSubmit||false},result,needToHide;if(!doNotRemoveClass||!isBeforeSubmit)$.removeClass(node,opts["cnSelected"]);result=opts["onselect"].call(this,eventObject,this);if(result!==false){if((result=this.fireTrigger(eventObject))!==false){this.__currentMarkedChangeValue=this.__currentMarked=null;if(eventObject["changeInputValue"])this._findValue(eventObject["newSuggest"],multiSuggestsReplacementDescription,(idx=eventObject["inputSelectionStart"])!=-1?idx:void 0,(idx=eventObject["inputSelectionEnd"])!=
-1?idx:void 0);if(evt&&!doNotPreventDefault){evt.stopPropagation();evt.preventDefault()}if(eventObject["submitForm"]){var form;if(form=$Input.closest("form")[0]){var i=form.length,input;while(i--)if((input=form[i])&&input.type=="submit"){input.click();break}}}needToHide=true}if(!doNotPreventDefault)this.$Input[0].focus();if(needToHide)this.hide()}this.__prevSuggest.caret=this.__prevSuggest.val=null;return result},_cancelMark:function(){var sel=this.opts["cnSelected"],$List=this.$List,$Sel=$List.find("."+
sel);if($Sel.length)$Sel.removeClass(sel);return $Sel},_loaded:function(val,force,result){if(!force&&_document.activeElement!=this.$Input[0])return;var opts=this["opts"],hideInactive=opts["hideInactive"],eventObject={"data":result,"findValue":val,"type":"suggests:getData"};eventObject["suggestValue"]=val;if(this.fireTrigger(eventObject)!==false){eventObject["type"]+=":after";this.fireTrigger(eventObject);this._cache[val]=result=eventObject["data"];opts["ondata"].call(this,val,result,this);if(force||
this._loadVal==val&&(!hideInactive||!this.blurred))this._rebuild(val,void 0,void 0,void 0,force===true)}},_rebuild:function(valOrEvent,dataFrom,dataCount,insertAfter,forceShowContainer){if(dataFrom==null)dataFrom=-1;var opts=this.opts,isEventObject=_Object_isObject(valOrEvent),val=isEventObject?valOrEvent["findValue"]:valOrEvent,isValidValue=val!=null&&typeof val=="string",data=isValidValue&&this._cache[val]||[],isDataNotEmpty=data&&!!(data.length||data.toArray),dataTo=dataFrom>-1?dataFrom+(dataCount!=
void 0?dataCount:opts["fetchCount"]):-1,i,n,html,escapedVal,markedItem,groupingSupport=opts["grouping"],currentData,showOptions,eventDict={"type":"suggests:rebuild","showContainer":forceShowContainer||isDataNotEmpty&&isValidValue,"showList":isDataNotEmpty,"showInternet":opts["showInternet"],"data":data,"findValue":val,"dataFrom":dataFrom,"dataTo":dataTo,"markedItem":opts["autoMarked"]};showOptions=isEventObject?$.extend(valOrEvent,eventDict):eventDict;showOptions["suggest"]=val;data=showOptions["data"];
if(!Array.isArray(data)&&data.toArray)data=data.toArray();showOptions["showList"]=isDataNotEmpty;showOptions["showContainer"]=showOptions["showContainer"]&&(showOptions["showList"]||showOptions["showInternet"]);if(showOptions["showContainer"])if(this.fireTrigger(showOptions)!==false){dataFrom=showOptions["dataFrom"];if(dataFrom===-1);else{if(dataFrom===Infinity)dataFrom=this.__ListItems&&this.__ListItems.length-1;if(!insertAfter)insertAfter=this.__ListItems&&this.__ListItems[dataFrom]}dataTo=showOptions["dataTo"];
if(dataTo===-1&&dataFrom!==-1)dataTo=dataFrom>-1?dataFrom+(dataCount!=void 0?dataCount:opts["fetchCount"]):-1;if(insertAfter||this.__val!==(val=showOptions["findValue"]!=val?showOptions["findValue"]:showOptions["suggest"])){this.__inFetching=false;this.__currentMarked=insertAfter||null;this.__val=val;if(showOptions["showList"]){i=dataFrom>-1?dataFrom+1:0;n=dataTo>-1&&data.length>dataTo?dataTo+1:data.length;html=[];escapedVal=regexpEscape(val);for(;i<n;i++)if(currentData=data[i]){if(groupingSupport&&
_Object_isObject(currentData)&&currentData["groupHeader"])html.push($.trim(opts["groupHeaderTemplate"].call(this,currentData["groupHeader"],escapedVal,currentData)));html.push($.trim(opts.template.call(this,escapedVal,currentData,i,data,val)))}if(html.length)if(dataFrom>-1&&insertAfter){html=$(html.join(""));$(insertAfter).after(html);html=html.filter("."+opts["cnItem"]);this.__ListItems.add(html);Array.forEach(html,function(N,i){N.setAttribute("data-suggest-idx",i+dataFrom+2)})}else{this.__ListItems=
this.$List.html(html.join("")).find("."+opts["cnItem"]).each(function(i,N){N.setAttribute("data-suggest-idx",i+1)});if(html=this.$List[0])html.scrollTop=0}}opts["ondraw"].call(this,val,data,this)}}delete showOptions["dataFrom"];delete showOptions["dataTo"];if(this._onExpand(showOptions["showContainer"],showOptions)!==false){this.$List.toggle(showOptions["showList"]);this.$Suggest.toggle(showOptions["showContainer"]);this.$InternetCont.toggle(showOptions["showInternet"])}if(!this.__currentMarked&&
showOptions["showContainer"]&&showOptions["showList"]&&Number.isInteger(markedItem=showOptions["markedItem"])&&markedItem>=0)this._mark(markedItem,void 0,void 0,false);showOptions["type"]="suggests:afterRebuild";this.fireTrigger(showOptions);showOptions["data"]=null},_request:function(url,fn,val){this.opts["request"](url,fn,val)},_internetVal:function(val){var opts=this.opts,el;val=htmlEscape(val);if(opts["showInternet"]){this["$InternetCont"].attr("href",opts["searchUrl"].replace("#query#",opts["encodeBeforeSend"]?
encode(val):val));if((val=opts["templateInternetVal"].call(this,val,this["$InternetCont"],this["$Internet"]))!==false){el=this["$Internet"];if(el.size())el.attr("innerHTML","")[0].innerHTML=val}}},_onExpand:function(state,showOptions,originalEvent){if(this.__expandedState!==state){this.opts["onexpand"].call(this,state,this);showOptions=showOptions||{};showOptions["type"]="suggests:"+(state?"show":"hide");if(originalEvent)showOptions["originalEvent"]=originalEvent;if(this.fireTrigger(showOptions)===
false)return false;this.__expandedState=state}else return false},val:function(val){if(val!==void 0){this._internetVal(val);this.$Input.val(val);if(val==""&&!this._cache[val])this.hide();return this}return this._findValue()},"getFindWords":function(){var opts=this.opts,multiSuggests=opts["multiSuggests"],suggestSeparator=opts["suggestSeparator"],input=this.$Input[0],inputValue=input.value,inputValue_array,additional_inputValue_array,inputValue_array_length,i,word,separatorWord,escapedSuggestPart1_start=
null,escapedSuggest_k,suggestEscapeStart=opts["suggestEscapeStart"],suggestEscapeEnd=suggestEscapeStart&&opts["suggestEscapeEnd"],triggerEvent,triggerEvent_type="suggests:getSuggestWords",result,_hasTrigger=this.hasTrigger(triggerEvent_type+" "+triggerEvent_type+":AFTER");if(_hasTrigger){triggerEvent={"type":triggerEvent_type,"input":input,"inputValue":inputValue,"data":null};if(this.fireTrigger(triggerEvent)===false)return[];else inputValue=triggerEvent["inputValue"]}if(multiSuggests){inputValue_array=
_String_split_good_.call(inputValue,suggestSeparator);additional_inputValue_array=[];suggestSeparator=new RegExp(suggestSeparator.source,(suggestSeparator["global"]?"g":"")+(suggestSeparator["ignoreCase"]?"i":"")+(suggestSeparator["multiline"]?"m":""));inputValue_array_length=inputValue_array.length;for(i=0;i<inputValue_array_length;++i){word=inputValue_array[i];(separatorWord=suggestSeparator.exec(inputValue))&&(separatorWord=separatorWord[0]);if(suggestEscapeStart)if(word)if(escapedSuggestPart1_start!=
null){if((escapedSuggest_k=word.search(suggestEscapeEnd))!==-1){inputValue_array[escapedSuggestPart1_start]=additional_inputValue_array.slice(escapedSuggestPart1_start,i).join("")+word;for(escapedSuggestPart1_start++;escapedSuggestPart1_start<=i;escapedSuggestPart1_start++)inputValue_array[escapedSuggestPart1_start]=null;escapedSuggestPart1_start=null}}else if((escapedSuggest_k=word.search(suggestEscapeStart))!==-1){escapedSuggest_k=word.substr(escapedSuggest_k+1).search(suggestEscapeEnd);if(escapedSuggest_k===
-1)escapedSuggestPart1_start=i}if(suggestEscapeStart)additional_inputValue_array[i]=inputValue_array[i]+(separatorWord||"")}result=Array.filter(inputValue_array,function(a){return!!a})}else result=[inputValue];if(_hasTrigger){triggerEvent["data"]=result;triggerEvent["type"]=triggerEvent_type+":AFTER";if(this.fireTrigger(triggerEvent)!==false)result=triggerEvent["data"]}return result},_getSuggestReplacement:function(IS_GETTER){var opts=this.opts,multiSuggests=opts["multiSuggests"],suggestSeparator,
currentPosition,suggestPositionStart,suggestPositionEnd,$Input=this.$Input,inputValue=$Input.val(),inputValueLeftPart,inputValueRightPart,inputValue_length,inputValue_array,inputValue_array_length,i,word,word_length,separatorWord,escapedSuggestPart1_start=null,escapedSuggest_k,suggestEscapeStart,suggestEscapeEnd,suggestPositionStart_escapeFallback,suggestPositionEnd_escapeFallback;if(multiSuggests){currentPosition=this.__prevSuggest.caret||$["getCaretPosition"]($Input[0]);if(!currentPosition)return;
suggestPositionStart=currentPosition["start"];suggestPositionEnd=currentPosition["end"];if(!this.__prevSuggest.caret){suggestSeparator=opts["suggestSeparator"];inputValue_length=0;suggestEscapeStart=opts["suggestEscapeStart"];suggestEscapeEnd=suggestEscapeStart&&opts["suggestEscapeEnd"];inputValue_array=_String_split_good_.call(inputValue,suggestSeparator);suggestSeparator=new RegExp(suggestSeparator.source,(suggestSeparator["global"]?"g":"")+(suggestSeparator["ignoreCase"]?"i":"")+(suggestSeparator["multiline"]?
"m":""));inputValue_array_length=inputValue_array.length;for(i=0;i<inputValue_array_length;++i){word=inputValue_array[i];(separatorWord=suggestSeparator.exec(inputValue))&&(separatorWord=separatorWord[0]);if(suggestEscapeStart)if(word)if(escapedSuggestPart1_start!==null){if((escapedSuggest_k=word.search(suggestEscapeEnd))!==-1){inputValue_length=inputValue_array.slice(0,escapedSuggestPart1_start).join("").length;word=inputValue_array.slice(escapedSuggestPart1_start,i+1).join("");escapedSuggestPart1_start=
null}}else if((escapedSuggest_k=word.search(suggestEscapeStart))!==-1){escapedSuggest_k=word.substr(escapedSuggest_k+1).search(suggestEscapeEnd);if(escapedSuggest_k===-1)escapedSuggestPart1_start=i}word_length=word.length;if((inputValue_length+=word_length)>=suggestPositionStart)if(escapedSuggestPart1_start===null){suggestPositionStart=inputValue_length-word_length;suggestPositionEnd=inputValue_length;break}else if(suggestPositionStart_escapeFallback===void 0){suggestPositionStart_escapeFallback=
inputValue_length-word_length;suggestPositionEnd_escapeFallback=inputValue_length}if(separatorWord)inputValue_length+=separatorWord.length;if(suggestEscapeStart&&separatorWord)inputValue_array[i]+=separatorWord}if(escapedSuggestPart1_start!==null&&suggestPositionStart_escapeFallback!==void 0){suggestPositionStart=suggestPositionStart_escapeFallback;suggestPositionEnd=suggestPositionEnd_escapeFallback}currentPosition["start"]=suggestPositionStart;currentPosition["end"]=suggestPositionEnd;this.__prevSuggest.caret=
currentPosition}if(!IS_GETTER){inputValueLeftPart=inputValue.substring(0,suggestPositionStart);inputValueRightPart=inputValue.substring(suggestPositionEnd,inputValue.length)}else currentPosition=null;return{position:currentPosition,start:suggestPositionStart,end:suggestPositionEnd,value:inputValue,leftPart:inputValueLeftPart,rightPart:inputValueRightPart}}return null},_findValue:function(suggestValue,multiSuggestsReplacementDescription,setter_curetPositionStart,setter_curetPositionEnd){var IS_GETTER=
suggestValue===void 0,opts=this.opts,$Input=this.$Input,inputValue,inputValueLeftPart,inputValueRightPart,currentPosition,suggestPositionStart,suggestPositionEnd;if(!multiSuggestsReplacementDescription)multiSuggestsReplacementDescription=this._getSuggestReplacement(IS_GETTER);if(suggestValue===null){suggestValue=this.__val;if(suggestValue==null)return}if(multiSuggestsReplacementDescription){inputValue=multiSuggestsReplacementDescription.value;currentPosition=multiSuggestsReplacementDescription.position;
suggestPositionStart=multiSuggestsReplacementDescription.start;suggestPositionEnd=multiSuggestsReplacementDescription.end;if(IS_GETTER)suggestValue=inputValue.substring(suggestPositionStart,suggestPositionEnd);else{inputValueLeftPart=multiSuggestsReplacementDescription.leftPart;inputValueRightPart=multiSuggestsReplacementDescription.rightPart;inputValue=inputValueLeftPart+suggestValue+inputValueRightPart;suggestPositionEnd=currentPosition["end"]=currentPosition["start"]+suggestValue.length}}else if(IS_GETTER)suggestValue=
$Input.val();else if(!opts["searchLast"])inputValue=suggestValue;inputValue=opts[IS_GETTER?"getSuggest":"setSuggest"].call(this,suggestValue,inputValue,opts,suggestPositionStart,suggestPositionEnd);if(IS_GETTER){this.__prevSuggest.val=inputValue;return inputValue}this.val(inputValue);if(suggestPositionEnd==void 0)suggestPositionEnd=inputValue.length;if(setter_curetPositionStart==Infinity)setter_curetPositionStart=inputValue.length;if(setter_curetPositionEnd==Infinity)setter_curetPositionEnd=inputValue.length;
$["setCaretPosition"]($Input[0],setter_curetPositionStart!=void 0?setter_curetPositionStart:suggestPositionEnd,setter_curetPositionEnd!=void 0?setter_curetPositionEnd:suggestPositionEnd)},"find":function(val,force){var opts=this.opts,url=opts["ajaxUrl"];if(opts.needUpdateValue){opts.needUpdateValue=false;val=this._findValue()}if(!force&&(!url||!val&&opts["minLength"]>0))this.hide();else if(this._loadVal!=val||this._loadUrl!=url){this._loadUrl=url;this._loadVal=val;opts["onsearch"].call(this,val,this);
this._request(url.replace("#query#",opts["encodeBeforeSend"]?encode(val):val)+"&"+Math.random(),this._loaded.bind(this,val,force),val)}},"set":function(name,val,force){this.opts[name]=val;if(name=="ajaxUrl"){this._cache=[];this.__val=""}if(!force)this.find(this.val());return this},"get":function(name){return this.opts[name]},"reset":function(){var val=this._loadVal,cache=this._cache[val];this.__val=this._loadVal=void 0;this._cache={};if(this.isExpanded()&&cache)this._cache[val]=cache},show:function(val){this._rebuild(val||
this.val())},hide:function(evt){this._down=false;if(this._onExpand(false,null,evt)===false)return false;this.__currentMarkedChangeValue=null;this.$Suggest.hide();this._delayedHideEnd();clearTimeout(this._tid)},"showSuggests":function(findValue,setToInput,data,setFocus){if(setToInput&&findValue!=void 0)this.val(findValue);if(findValue===void 0)findValue=this.val();if(data===void 0)data=this._cache[findValue];if(setFocus){this.$Input.attr("data-prevent-event-focus",1);this.$Input[0].focus();this.val();
this.blurred=false}clearTimeout(this._tid);if(data)this._loaded(findValue,true,data);else this._tid=setTimeout(this["find"].bind(this,findValue,true),this.opts["timeout"])},isExpanded:function(){return this.__expandedState===true},_fetchMore:function(move,_next_callback){if(!this.opts["fetching"])return false;if(move===void 0)move=1;var val=this.__val,data=this._cache[val],lastSuggestIndex=(data&&data.length||0)-1,insertAfter=lastSuggestIndex>=0?this.__ListItems[lastSuggestIndex]:null;if(!insertAfter||
!data||data["EOF"])return false;var dataLength=data.length,eventObject={"type":"suggests:fetch","fetchFrom":lastSuggestIndex,"fetchCount":this.opts["fetchCount"],"fetchDirection":move<0?"UP":"DOWN","data":data,"findValue":val,"EOF":false,"async":false,"currentDataLength":dataLength,"insertAfter":insertAfter},result;eventObject["val"]=val;eventObject["suggestValue"]=val;if((result=this.fireTrigger(eventObject))!=false)if(eventObject["async"]!==true){this[eventObject.type](eventObject,_next_callback);
this.__inFetching=false}else if(!this._asynchMarkers[eventObject.type]){if(!this._asynchMarkers)this._asynchMarkers={};eventObject["_asynchMarker"]=this._asynchMarkers[eventObject.type]=+new Date;eventObject["_next_callback"]=_next_callback;eventObject["next"]=this._callTriggerFunctionAsync;this.__inFetching=!eventObject["EOF"]}else eventObject["async"]=false;return result},_fetchOnScroll:function(){if(!this.isExpanded()||this.__inFetching)return;var $List0=this["$List"][0],isScrollOnBottom=$List0.offsetHeight+
$List0.scrollTop+20>$List0.scrollHeight;if(isScrollOnBottom)this._fetchMore()},"suggests:fetch":function(eventObject,_next_callback){var dataLength=eventObject["currentDataLength"],insertAfter=eventObject["insertAfter"],val=eventObject["suggestValue"],data,result;_next_callback=_next_callback||eventObject["_next_callback"];data=this._cache[val]=eventObject["data"];if(data.length==dataLength||eventObject["EOF"])eventObject["EOF"]=data["EOF"]=true;if(data["EOF"]||!insertAfter&&!(insertAfter=this.__ListItems[eventObject["fetchFrom"]]))result=
eventObject["result"]=false;if(result!==false){this._rebuild(val,eventObject["fetchFrom"],eventObject["fetchCount"],insertAfter);if(_next_callback)_next_callback()}this.__inFetching=false;return result},"getCurrentFindValue":function(){return this.__val},_hideIfNotActiveInput:function(){this._down=false;if(_document.activeElement!=this.$Input[0])this.hide()},_delayedHideStart:function(){this.__delayedHide=setTimeout(this._hideIfNotActiveInput.bind(this),500)},_delayedHideEnd:function(){if(this.__delayedHide){clearTimeout(this.__delayedHide);
this.__delayedHide=null}},_onMouseWheel:function(e){var wheelDelta=e.wheelDelta||e.detail*-1;if(!wheelDelta)return;var currentTarget=e.currentTarget,scrollTop=currentTarget.scrollTop,scrollHeight=currentTarget.scrollHeight,clientHeight=currentTarget.clientHeight,signPos=wheelDelta>0;if(signPos?scrollTop==0:scrollHeight<=clientHeight+scrollTop){e.preventDefault();e.stopPropagation()}},_onScroll:function(){this._down=false;this._delayedHideEnd()},_fireActiveEvent:function(activeIn){var eventObject=
{"type":"suggests:active"+(activeIn?"In":"Out")};return this.fireTrigger(eventObject)}});suggest.prototype["getSuggestWords"]=suggest.prototype["getFindWords"];ajs["ui"]["suggest"]=suggest}(document,this["ajs"],this["ajs"]["$"]);
(function(_document,ajs,$){var _browser_msie=ajs.browser.msie,INPUT_EVENT_NAMES=$["support"]["oninput"]&&(!_browser_msie||_browser_msie>9)?"input":"input keypress keyup",CLIP_AUTO_VALUE,_hasOwnProperty=$.own;function setActiveInputElement(initialValue){if(document.activeElement!=this){this.setAttribute("data-prevent-event-focus",1);this.focus()}if(initialValue!=void 0)ajs.$.setCaretPosition(this,this.value.length)}function operands(sel,opts,mainInput){if(CLIP_AUTO_VALUE===void 0)CLIP_AUTO_VALUE=CSS.supports("clip",
"auto")?"auto":"rect(auto,auto,auto,auto)";if(!opts["items"])return null;if(!(this instanceof operands))return new operands(sel,opts);sel=$(sel);if(sel.size()>1)return Array["reduce"](sel,function(initialValue,val,i){if(i)initialValue.push(new operands(val,opts));return initialValue},[this]);this.opts=opts=$.extend({cnForm:"js-form",deleteName:true,operandClassWrapperMenu:"w-portal-menu__search__operands__menu",operandClassWrapperInput:"w-portal-menu__search__operands__input"},opts);this.$Elm=sel;
sel.bind("scroll",this);sel.find(".w-portal-menu__search__operands__width_outer").bind("scroll",this);sel.find(".w-portal-menu__search__operands__width_inner").bind("scroll",this);this.$Input=this.$original_Input=mainInput;this.$Input.bind(INPUT_EVENT_NAMES,this);this.operandsKeysString="";this.operandsKeys={};this.operandsNames={};this.operands={};this.operandsTabIndex={};var noOperandsOrder=!this.opts["order"];if(noOperandsOrder)noOperandsOrder=this.opts["order"]={};Array.forEach(Object.keys(this.opts["items"]),
function(key,index){var name=this.opts["items"][key];key=key.toUpperCase();this.operandsKeys[key]=name;this.operandsNames[name]=key;this.operands[name]=void 0;this.operandsTabIndex[name]=ajs.ui.tabIndex++;this.operandsKeysString+="|"+key+"|";if(noOperandsOrder)noOperandsOrder[key]=index},this);this.operandsKeysString=this.operandsKeysString.toUpperCase();this.operandsKeysOrder={};this.operandsNamesOrder={};Array.forEach(Object.keys(this.opts["order"]),function(key){var value=this.opts["order"][key];
key=key.toUpperCase();this.operandsNamesOrder[this.operandsKeys[key]]=this.operandsKeysOrder[key]=value},this)}$.inherits(operands,ajs["ui"]["ajsUIComponent"],{"destroy":function(){var opts=this["opts"];$["destroyObject"](this)},init:function(SearchInstance){this.addTrigger("operands:activeInputChange",function(e){this.$Input=e["newInput"];if(this["Suggest"])this["Suggest"]["applyToInput"](this.$Input,e["isNewOperand"]);this.isPlaceholder=!e["isOperandInput"];this._placeholderCheck()}.bind(SearchInstance));
var Suggest=SearchInstance["Suggest"];if(Suggest)Suggest.addTrigger("suggests:mark",function(e){if(!e["updateInputValue"])return;var Operands=this,newSuggestNode=e["newSuggestNode"],oldSuggestNode=e["oldSuggestNode"],newSuggest=e["newSuggest"],inputName=newSuggestNode&&newSuggestNode.getAttribute("data-search-name"),oldOperandName,currentOperand=Operands.getCurrentOperand();if(!currentOperand||!currentOperand["stable"]){if(oldSuggestNode&&inputName!=(oldOperandName=oldSuggestNode.getAttribute("data-search-name")))if(oldOperandName)Operands.deactivateOperand(oldOperandName,
true);if(inputName){Operands.createOperands(Operands["getOperandKeyByKeyOrName"](inputName),"","",2,true);currentOperand=Operands["getCurrentOperand"]();if(!currentOperand["__onblue"]){currentOperand["__onblue"]=function(){currentOperand["stable"]=true};currentOperand.$Input.bind("blur",currentOperand["__onblue"])}}}Operands._checkLabelsPosition();Operands.updateOperandWidth(void 0,e["updateInputValue"]?newSuggest:void 0)}.bind(this)).addTrigger("suggests:select",function(e){var Operands=this,currentOperand=
Operands.getCurrentOperand();if(!currentOperand||!currentOperand["stable"])currentOperand["stable"]=true;this._checkLabelsPosition();this.updateOperandWidth(void 0,e["updateInputValue"]?e["newSuggest"]:void 0)}.bind(this))},handleEvent:function(evt){if(this.__disabled)return;var eventType=evt.type;if(INPUT_EVENT_NAMES.contains(eventType)){key=evt.keyCode;if(key==8||key==46||key==37||key==39)return;return this._operandsInput(evt)}if(eventType=="click"&&(evt.currentTarget.nodeName+"").toUpperCase()==
"LABEL")return this._operandLabelClick(evt);if(eventType=="scroll"){this.horisontalScroll(evt);this._checkLabelsPosition(evt);return false}var key,position,target=$(evt.target),targetValue,operand,operandObject,otherOperand,otherOperandAttr="data-prev-operand",otherOperandObject;if(eventType=="keydown"){operand=target.attr("data-operand");operandObject=this.operands[operand];key=evt.keyCode;if(!operandObject||!key)return;position=$["getCaretPosition"](evt.target,true);if(key==37&&position["end"]===
0||key==39&&position["start"]===(targetValue=target[0].value).length&&(otherOperandAttr="data-next-operand")){otherOperand=target.attr(otherOperandAttr);if(otherOperandObject=this.operands[otherOperand]){this._currentOperandObject=operandObject;evt.preventDefault();this.selectOperand(otherOperandObject,otherOperandAttr!="data-next-operand"?-1:0);operandObject=otherOperandObject}}else if(key==8&&position["start"]===0&&position["end"]===0){this._currentOperandObject=operandObject;evt.preventDefault();
this.deactivateOperand(operand);operandObject=null}else if((key==8||key==46)&&operandObject["stable"]===false&&(position["start"]===0&&position["end"]===evt.target.value.length||key==8&&position["start"]===1&&position["end"]===1)){evt.target.value="";this._currentOperandObject=operandObject;evt.preventDefault();this.deactivateOperand(operand);operandObject=null}}else if(eventType=="keyup"){operand=target.attr("data-operand");operandObject=this.operands[operand]}if(operandObject)this._checkOperandCaretPosition(operandObject)},
setActiveInput:function(newInput,isNewOperand){if(this.$Input!==newInput)if(this.fireTrigger({"type":"operands:activeInputChange","oldInput":this.$Input,"newInput":newInput,"isOperandInput":!!newInput.attr("data-operand"),"isNewOperand":isNewOperand||false}))this.$Input=newInput},getCurrentOperand:function(){return this._currentOperandObject},createOperands:function(operandKey,initialValue,valueForPrevInput,focusBehavior,notStable){focusBehavior=focusBehavior==void 0?1:focusBehavior;operandKey=operandKey.toUpperCase();
var opts=this["opts"],operandsWrapper=this.$Elm,operandCnMenu="portal-menu__search__operands__menu",operandCnLink="portal-menu__search__operands__menu__button",operandCnMenuDropdown="portal-menu__search__operands__menu__dropdown",operand_class_wrapperMenu=opts.operandClassWrapperMenu,operand_class_wrapperInput=opts.operandClassWrapperInput,operandObject,currentOperandObject,inputWrapper,menuWrapper,current$Input,$Input,operandName=this.operandsKeys[operandKey],selectOperandIndex=this.operandsNamesOrder[operandName],
currentOperandName=this.$Input[0].getAttribute("data-operand"),nextOperandName,tmp;if(!operandName)return;current$Input=this.$Input;if(!(operandObject=this.operands[operandName])){inputWrapper=operandsWrapper.find("."+operand_class_wrapperInput+"_"+operandName);$Input=inputWrapper.find(".portal-menu__search__operands__input__field").attr({tabIndex:this.operandsTabIndex[operandName]});operandsWrapper.css("display","");menuWrapper=operandsWrapper.find("."+operand_class_wrapperMenu+"_"+operandName).css("display",
"");operandObject=this.operands[operandName]=new ajs.ui.dropdown(menuWrapper.find("."+operandCnMenu),{cnLink:operandCnLink,cnMenu:operandCnMenuDropdown,cnExpand:"portal-menu__buttons__item_open",cnHover:"portal-menu__buttons__item_hover",cnIndex:selectOperandIndex,timeout:0,tabIndex:false,autoPos:true,onselect:function(currentOperandName,evt,node){var Operands=this,newOperandName=node&&node.getAttribute("data-operand-name"),newOperand,operandObject;if(newOperandName&&newOperandName!==currentOperandName){operandObject=
this.operands[currentOperandName];newOperand=this.operands[newOperandName];if(newOperand&&!newOperand.isActive||!newOperand&&newOperandName in this.operands)Operands.createOperands(this.operandsNames[newOperandName],"",void 0,0);Operands.deactivateOperand(operandObject.operandName,void 0,newOperand)}}.bind(this,operandName)});$.bind("labels"in $Input[0]?$Input[0].labels[0]:$Input.closest("label")[0],"click",this);$Input.bind("focus",this.operandsFocus.bind(this,$Input,operandObject)).bind(INPUT_EVENT_NAMES,
this.updateOperandWidth.bind(this,operandObject,null));tmp=INPUT_EVENT_NAMES+(INPUT_EVENT_NAMES.contains("keydown")?"":" keydown");tmp=tmp+(tmp.contains("keyup")?"":" keyup");$Input.bind(tmp,this);operandObject.operandName=operandName;operandObject.operandKey=operandKey;operandObject.InputWrapper=inputWrapper;operandObject.MenuWrapper=menuWrapper;operandObject.$Input=$Input;operandObject.$Input.attr("data-operand",operandName);operandObject.ElementForHeight=$("<span></span>").css({"position":"fixed",
"top":"-10000px","left":"-10000px","visibility":"hidden","font":operandObject.$Input.currentStyle("font"),"padding":operandObject.$Input.currentStyle("padding"),"border":operandObject.$Input.currentStyle("border")});$(_document.body).append(operandObject.ElementForHeight)}else{$Input=operandObject.$Input;operandsWrapper.css("display","")}$Input[0].name=$Input.attr("data-input-name");operandObject.isActive=true;operandObject["stable"]=notStable!==true;if(!current$Input.attr("data-operand")){if(this.opts.deleteName)this.$original_Input.__name=
this.$original_Input[0].name;this.$original_Input.__value=this.$original_Input[0].value;if(this.opts.deleteName)this.$original_Input[0].name="";this.$original_Input[0].value="";this.$original_Input.attr("readonly","true");this.$original_Input.css("visibility","hidden");this.$original_Input.attr("data-allow-empty-value","true")}else if(valueForPrevInput!=void 0)current$Input[0].value=valueForPrevInput;if(current$Input!=operandObject.$Input){nextOperandName=current$Input[0].getAttribute("data-next-operand");
if(nextOperandName){currentOperandObject=this.operands[nextOperandName];currentOperandObject.$Input.attr("data-prev-operand",operandName)}if(current$Input!=this.$original_Input)current$Input.attr("data-next-operand",operandName);if(currentOperandName&&(currentOperandObject=this.operands[currentOperandName])!=operandObject){$Input.attr("data-prev-operand",currentOperandName);currentOperandObject.InputWrapper.after(operandObject.MenuWrapper[0]);operandObject.MenuWrapper.after(operandObject.InputWrapper[0]);
if(nextOperandName)$Input.attr("data-next-operand",nextOperandName);else $Input[0].removeAttribute("data-next-operand")}}operandObject.MenuWrapper.css("display","");operandObject.InputWrapper.css("display","");if(_browser_msie<8){tmp=operandObject.MenuWrapper[0].className;operandObject.MenuWrapper[0].className="";operandObject.MenuWrapper[0].className=tmp}if(initialValue!=void 0)$Input[0].value=initialValue;if(currentOperandObject=this.operands[current$Input[0].getAttribute("data-operand")])this.updateOperandWidth(currentOperandObject);
this.updateOperandWidth(operandObject);this._checkLabelsPosition();this.setActiveInput($Input,true);if(focusBehavior>0){if(focusBehavior==2)$Input.attr("data-prevent-event-focus",1);$Input[0].focus();if(!_browser_msie&&!ajs["browser"]["opera"])this.__asyncFocusHandler=$["callAsync"](setActiveInputElement,$Input[0],[initialValue],this.__asyncFocusHandler);else if(initialValue!=void 0)ajs.$.setCaretPosition($Input[0],initialValue.length)}return this._currentOperandObject=operandObject},deactivateOperand:function(operandName,
focusBehavior,selectOperandObject){focusBehavior=focusBehavior==void 0?1:focusBehavior;var operandObject,currentOperandObject,nextOperandName,prevOperandName,value,canSwitchActiveInput;if(operandObject=this.operands[operandName]){this._resetLabelsPosition(operandObject);this._currentOperandObject=null;canSwitchActiveInput=operandObject.$Input==this.$Input;value=operandObject.$Input.val();nextOperandName=operandObject.$Input[0].getAttribute("data-next-operand");prevOperandName=operandObject.$Input[0].getAttribute("data-prev-operand");
if(this.opts.deleteName)operandObject.$Input[0].name="";operandObject.$Input[0].removeAttribute("data-next-operand");operandObject.$Input[0].removeAttribute("data-prev-operand");operandObject.$Input[0].name="";operandObject.$Input.val("");if(nextOperandName||prevOperandName||selectOperandObject){if(nextOperandName&&(currentOperandObject=this.operands[nextOperandName]))if(prevOperandName)currentOperandObject.$Input[0].setAttribute("data-prev-operand",prevOperandName);else currentOperandObject.$Input[0].removeAttribute("data-prev-operand");
if(prevOperandName&&(currentOperandObject=this.operands[prevOperandName])){if(nextOperandName)currentOperandObject.$Input[0].setAttribute("data-next-operand",nextOperandName);else currentOperandObject.$Input[0].removeAttribute("data-next-operand");if(canSwitchActiveInput)if(!selectOperandObject)selectOperandObject=currentOperandObject}else if(canSwitchActiveInput)if(!selectOperandObject)selectOperandObject=this.operands[nextOperandName];if(selectOperandObject)this.setActiveInput(selectOperandObject.$Input)}else{this.$Elm.css("display",
"none");if(canSwitchActiveInput)this.setActiveInput(this.$original_Input);if(this.opts.deleteName)this.$Input[0].name=this.$original_Input.__name;this.$Input[0].removeAttribute("readonly");this.$Input.css("visibility","");this.$original_Input[0].removeAttribute("data-allow-empty-value");if(this.Suggest)this.Suggest.applyToInput(this.$Input)}this.$Input[0].value=value&&this.$Input[0].value?this.$Input[0].value+" "+value:this.$Input[0].value||value||"";if(focusBehavior>0){if(focusBehavior==2)this.$Input.attr("data-prevent-event-focus",
1);this.__asyncFocusHandler=$["callAsync"](this.$Input[0].focus,this.$Input[0],null,this.__asyncFocusHandler);$["setCaretPosition"](this.$Input[0],this.$Input[0].value.length)}operandObject.MenuWrapper.css("display","none");operandObject.InputWrapper.css({"display":"none","width":"","min-width":""});if(selectOperandObject){if(!selectOperandObject.isActive)this.createOperands(selectOperandObject.operandKey);this.updateOperandWidth(selectOperandObject);this.selectOperand(selectOperandObject,selectOperandObject.operandName==
prevOperandName?-1:0,focusBehavior==0)}operandObject["stable"]=operandObject.isActive=false}},getOperandByKeyOrName:function(operandNameOrKeyOrOperandObject){var operandObject=operandNameOrKeyOrOperandObject;return typeof operandObject=="object"&&operandObject||((operandObject=this.operands[operandNameOrKeyOrOperandObject])||(operandObject=this.operands[this.operandsKeys[operandNameOrKeyOrOperandObject]]))&&operandObject},getOperandKeyByKeyOrName:function(operandNameOrKey){return operandNameOrKey in
this.operandsNames?this.operandsNames[operandNameOrKey]:operandNameOrKey in this.operandsKeys?operandNameOrKey:null},getOperandValue:function(operandNameOrKeyOrOperandObject){var operandObject=this.getOperandByKeyOrName(operandNameOrKeyOrOperandObject);return operandObject&&operandObject.$Input.val()},setOperandValue:function(operandNameOrKeyOrOperandObject,value,allowEmptyValue,doNotShowHiddenOperand){if(value==null)value="";var operandObject=this.getOperandByKeyOrName(operandNameOrKeyOrOperandObject);
if(operandObject)if(value===""){if(!allowEmptyValue&&operandObject.isActive){operandObject.$Input.val(value);this.deactivateOperand(operandObject.operandName,0);return value}}else{if(operandObject.MenuWrapper.css("display")=="none"&&!doNotShowHiddenOperand)operandObject=this.createOperands(operandObject.operandKey,void 0,void 0,0)}else if(!operandObject){if(!(operandNameOrKeyOrOperandObject=this.getOperandKeyByKeyOrName(operandNameOrKeyOrOperandObject)))return;if(value!==""||allowEmptyValue)operandObject=
this.createOperands(operandNameOrKeyOrOperandObject,value,void 0,0)}if(operandObject){operandObject.$Input.val(value);this.updateOperandWidth(operandObject)}return value},operandsFocus:function($operandInput,operandObject){this._currentOperandObject=operandObject;this.setActiveInput($operandInput)},updateOperandWidth:function(operandObject,inputValue){var minWidth_px=22,delta=INPUT_EVENT_NAMES=="input"?10:20,width,$input,nextOperandName,setWidthStyleName,removeWidthStyleName,somethingIsChange;if(!operandObject)if(!(operandObject=
this._currentOperandObject))return;$input=operandObject.$Input;inputValue=inputValue||$input[0].value;nextOperandName=$input[0].getAttribute("data-next-operand");operandObject.ElementForHeight.html(ajs.Html.escape(inputValue));width=operandObject.ElementForHeight[0].clientWidth;if(width<minWidth_px)width=minWidth_px;width=width+delta;if(nextOperandName){setWidthStyleName="width";removeWidthStyleName="minWidth"}else{setWidthStyleName="minWidth";removeWidthStyleName="width"}if(operandObject.InputWrapper.css(setWidthStyleName)!=
width){width=width+"px";operandObject.InputWrapper.css(setWidthStyleName,width);$input.css(setWidthStyleName,width);somethingIsChange=true}if(operandObject.InputWrapper.css(removeWidthStyleName)){operandObject.InputWrapper.css(removeWidthStyleName,"");$input.css(removeWidthStyleName,"");somethingIsChange=true}if(somethingIsChange)this._checkLabelsPosition()},selectOperand:function(operandObject,caretPosition,noFocus){if(!noFocus){operandObject.$Input[0].focus();if(this.Suggest)this.Suggest.applyToInput(operandObject.$Input)}if(caretPosition!==
void 0){if(caretPosition<0)caretPosition=operandObject.$Input.val().length;$["setCaretPosition"](operandObject.$Input[0],caretPosition)}this._checkLabelsPosition();this._currentOperandObject=operandObject},_operandLabelClick:function(e){if(this.__disabled)return;this.$Input[0].focus();e.preventDefault()},_operandsInput:function(){if(this.__disabled)return;var inputValue=this.$Input[0].value,value,p=inputValue.lastIndexOf(":"),k,h,fromIndex=0,operandKey,operandName,activatedOperandInputChange,eventObject,
result,deactivateOperandName,operandsKeysString;eventObject={"type":"operands:find","input":this.$Input[0],"inputValue":inputValue,"newOperand":null,"lastPrefixIndex":p,"currentOperand":this.$Input.attr("data-operand")||null};if(this.fireTrigger(eventObject)===false)return;inputValue=eventObject["inputValue"];p=eventObject["lastPrefixIndex"];k=p;if(operandKey=eventObject["newOperand"]){operandName=operandKey;operandKey=this.operandsNames[operandKey]}if(eventObject["currentOperand"]&&this.$Input["oldValue"]!==
inputValue){activatedOperandInputChange=true;this.$Input["oldValue"]=inputValue}if(!operandKey&&k>=0){value=inputValue.toUpperCase();operandsKeysString=this.operandsKeysString;while(~(h=operandsKeysString.indexOf(value.substr(--p,k-p),fromIndex)))if(operandsKeysString.charCodeAt(h+(k-p))===124){operandKey=value.substr(p,k-p);if(operandsKeysString.charCodeAt(h+(k-p)-operandKey.length-1)===124){if(!(p<1||/\s/.test(value.charAt(p-1))))operandKey="";break}else operandKey=""}else fromIndex=h;eventObject["newOperand"]=
operandKey}if(operandKey){if(!operandName)operandName=this.operandsKeys[operandKey];if(operandName&&operandName in this.operands&&!(this.operands[operandName]&&this.operands[operandName].isActive)){eventObject["type"]="operands:activate";eventObject["leftPart"]=inputValue.substring(0,p).trim();eventObject["rightPart"]=inputValue.substring(k+1).trim();if(this.fireTrigger(eventObject)!==false){if(eventObject["leftPart"]+eventObject["rightPart"]=="")if(this._currentOperandObject)deactivateOperandName=
this._currentOperandObject.operandName;result=this.createOperands(operandKey,eventObject["rightPart"],eventObject["leftPart"]);if(deactivateOperandName)this.deactivateOperand(deactivateOperandName);return result}}}if(activatedOperandInputChange)this._checkLabelsPosition()},horisontalScroll:function(e){if(this.__disabled)return;var scrollTarget=e.target;if(!this.__scrollContainer)this.__scrollContainer=scrollTarget;scrollTarget.scrollTop=0;e.preventDefault();e.stopPropagation();return false},_resetLabelsPosition:function(operandObject){if(operandObject){operandObject.$Elm.css({"width":"",
"height":""});operandObject.$Link.css({"position":"","top":"auto","left":"auto","clip":CLIP_AUTO_VALUE})}},_checkLabelsPosition:function(){if(this.__disabled)return;var input,operandKey,operandObject,operands=this.operands,$Elm_clientRect=this.$Elm[0].getBoundingClientRect(),operandInput_clientRect,opeprandDropdown$Elm,opeprandDropdown$Link,operand$Link_clientRect,operand$Eml_clientRect,x,clipString=CLIP_AUTO_VALUE,_rectWidth,_rectHeight;function checkNeedPositionedLink(elm,link,input,prev){var result=
true,x;if(!prev){operand$Eml_clientRect=elm.getBoundingClientRect();if(operand$Eml_clientRect.left>$Elm_clientRect.left)result=false}if(result){if(!operandInput_clientRect)operandInput_clientRect=input.getBoundingClientRect();if(operandInput_clientRect.right<=$Elm_clientRect.left)return false;if(!operand$Link_clientRect)operand$Link_clientRect=link.getBoundingClientRect();_rectWidth=operand$Link_clientRect.width||operand$Link_clientRect.right-operand$Link_clientRect.left;x=operandInput_clientRect.right-
30-($Elm_clientRect.left+_rectWidth);if(x<0)result=-x;else result=0;return result}return false}for(operandKey in operands)if(_hasOwnProperty(operands,operandKey)){operandObject=operands[operandKey];if(operandObject&&operandObject.isActive&&operandObject.$Input){input=operandObject.$Input[0];if(input)if((x=checkNeedPositionedLink(operandObject.$Elm[0],operandObject.$Link[0],input))!==false)break;else operandInput_clientRect=operand$Link_clientRect=input=null;input=void 0}}if(this.__prevPositioned_operandObject)if(input!==
void 0&&this.__prevPositioned_operandObject.$Input[0]!=input)this._resetLabelsPosition(this.__prevPositioned_operandObject);if(input&&(opeprandDropdown$Elm=operandObject.$Elm)){if(!x||x<0)x=0;else{_rectWidth=operand$Link_clientRect.width||operand$Link_clientRect.right-operand$Link_clientRect.left;_rectHeight=operand$Link_clientRect.height||operand$Link_clientRect.bottom-operand$Link_clientRect.top;clipString=["0px",_rectWidth+"px",_rectHeight+"px",x+"px"];clipString="rect("+clipString.join(",")+")"}opeprandDropdown$Link=
operandObject.$Link;operandInput_clientRect=input.getBoundingClientRect();opeprandDropdown$Elm.css({"width":opeprandDropdown$Link[0].clientWidth,"height":opeprandDropdown$Link[0].clientHeight});opeprandDropdown$Link.css({"position":"absolute","top":0,"left":0-x,"clip":clipString});this.__prevPositioned_operandObject=operandObject}},_checkOperandCaretPosition:function(operandObject){if(!operandObject||!this.__scrollContainer)return;var scrollContainer=this.__scrollContainer,input=operandObject.$Input[0],
inputValue=input.value;if(!inputValue)return;var input_clientRec=input.getBoundingClientRect(),label_clientRec=operandObject.$Link[0].getBoundingClientRect();if(input_clientRec.left>=label_clientRec.right)return;var caretPosition=$["getCaretPosition"](input),inputValue_beforeCaret=inputValue.substr(0,caretPosition["end"]),absoluteCaretPosition,scrollValue,_rectWidth;operandObject.ElementForHeight.html(ajs.Html.escape(inputValue_beforeCaret));absoluteCaretPosition=operandObject.ElementForHeight[0].clientWidth+
input_clientRec.left-(inputValue_beforeCaret?10:0);if(absoluteCaretPosition<label_clientRec.right){_rectWidth=label_clientRec.width||label_clientRec.right-label_clientRec.left;scrollValue=absoluteCaretPosition-(label_clientRec.left+_rectWidth);if(scrollValue<0)scrollContainer.scrollLeft+=scrollValue}}});ajs["ui"]["tabIndex"]=ajs["ui"]["tabIndex"]||1;ajs["ui"]["operands"]=operands}).call(null,this["document"],this["ajs"],this["ajs"]["$"]);
define("{patron.build}ajs",["{toolkit.common}ajs/ajs","{toolkit.common}ajs/__array/ajs__array","{toolkit.common}ajs/__string/ajs__string","{toolkit.common}ajs/__ui/ajs__ui","{toolkit.common}ajs/__ui__dropdown/ajs__ui__dropdown","{toolkit.common}ajs/__ui__search/ajs__ui__search","{toolkit.common}ajs/__ui__suggest/ajs__ui__suggest","{toolkit.common}ajs/__ui__operands/ajs__ui__operands"],function(){});
